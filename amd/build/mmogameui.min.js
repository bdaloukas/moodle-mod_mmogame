function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}define("mod_mmogame/mmogameui",["mod_mmogame/mmogame"],(function(MmoGame){return class extends MmoGame{constructor(){super(),_defineProperty(this,"vertical",void 0),_defineProperty(this,"kindSound",void 0),_defineProperty(this,"buttonSound",void 0),_defineProperty(this,"colorDefinition",0),_defineProperty(this,"colorScore",void 0),_defineProperty(this,"definition",void 0),_defineProperty(this,"buttonAvatarHeight",void 0),_defineProperty(this,"buttonAvatarTop",void 0),_defineProperty(this,"colorBackground",16777215),_defineProperty(this,"url",void 0),_defineProperty(this,"mmogameid",void 0),_defineProperty(this,"pin",void 0),_defineProperty(this,"user",void 0),_defineProperty(this,"gateCreateButtonSubmit",((maxWidth,bottom2)=>{this.btnSubmit=this.createImageButton(this.area,"mmogame-gate-submit",(maxWidth-this.iconSize)/2,bottom2,0,this.iconSize,"assets/submit.svg",!1,"submit"),this.btnSubmit.style.visibility="hidden";const instance=this;this.btnSubmit.addEventListener("click",(function(){void 0!==instance.edtCode&&(instance.user=instance.edtCode.value),instance.gatePlayGame(!0,instance.edtNickname.value,instance.paletteid,instance.avatarid)}))}))}getMuteFile(){return 0===this.kindSound?"assets/sound-on-flat.png":"assets/sound-off-flat.png"}playAudio(audioElement){0!==this.kindSound&&audioElement&&1===audioElement.networkState&&audioElement.play()}createButtonSound(left,top){this.buttonSound=this.createButton(this.body,"mmogame-button-sound",left,top,this.iconSize,this.iconSize,this.getMuteFile(),this.getStringM("js_sound")),this.buttonSound.addEventListener("click",(()=>this.onClickSound(this.buttonSound)))}onClickSound(button){this.kindSound=(this.kindSound+1)%2,button.src=this.getMuteFile(),this.setOptions({kindSound:this.kindSound})}gateOpen(mmogameid,pin,kinduser,user,url){this.url=url,this.minFontSize*=2,this.maxFontSize*=2,this.mmogameid=mmogameid,this.pin=pin,this.kinduser=kinduser,this.user=user,this.gateComputeSizes(),this.areaTop=this.padding,this.areaWidth=Math.round(window.innerWidth-2*this.padding),this.areaHeight=Math.round(window.innerHeight-this.areaTop)-this.padding;let instance=this;this.getOptions().then((function(options){options.kindsound=options.kindsound||0,options.nickname=options.nickname||"",options.avatarid=options.avatarid||0,options.paletteid=options.paletteid||0,instance.kindSound=[1,2].includes(options.kindSound)?options.kindSound:0;const isReady=options.nickname&&0!==options.avatarid&&0!==options.paletteid;if("moodle"!==kinduser||!isReady)return"guid"===kinduser&&(options.userGUID=options.userGUID||"",options.userGUID.length>=10&&isReady)?(instance.user=options.userGUID,void instance.gatePlayGame(!1,options.nickname,options.paletteid,options.avatarid)):void instance.gateCreateScreen();instance.gatePlayGame(!1,options.nickname,options.paletteid,options.avatarid)})).catch((error=>{this.showError("gateOpen",error)}))}gatePlayGame(save,nickname,paletteid,avatarid){if("guid"===this.kinduser&&""===this.user&&this.uuid4(),!save)return this.nickname=nickname,this.paletteid=paletteid,this.avatarid=avatarid,void this.callGetAttempt({nickname:nickname,colorpaletteid:paletteid,avatarid:avatarid});let options={nickname:nickname,avatarid:avatarid,paletteid:paletteid},instance=this;this.setOptions(options).then((function(){return instance.nickname=nickname,instance.paletteid=paletteid,instance.avatarid=avatarid,instance.callGetAttempt(),!0})).catch((error=>(instance.showError(error.message),!1)))}gateCreateScreen(){this.vertical=window.innerWidth<window.innerHeight,this.createArea(),this.vertical?this.gateCreateScreenVertical():this.gateCreateScreenHorizontal()}gateCreateScreenVertical(){let size,maxHeight=this.areaHeight-5*this.padding-this.iconSize,maxWidth=this.areaWidth,instance=this;const labels=[this.getStringM("js_name")+": ",this.getStringM("js_code"),this.getStringM("js_palette")];this.fontSize=this.findbest(this.minFontSize,this.maxFontSize,(function(fontSize){if(size=instance.gateComputeLabelSize(fontSize,labels),size[0]>=maxWidth)return 1;let heightCode="guid"!==instance.kinduser&&"moodle"!==instance.kinduser?size[1]+instance.padding:0,heightColors=2*(maxHeight-4*fontSize)/5;if(0===Math.floor(heightColors/instance.iconSize))return 1;let heightAvatars=3*(maxHeight-4*fontSize+heightColors)/5;return heightCode+3*size[1]+8*instance.padding+heightColors+heightAvatars<maxHeight?-1:1}));let gridWidthColors=maxWidth-this.padding,gridWidthAvatars=maxWidth-this.padding,gridHeightColors=2*(maxHeight-4*this.fontSize)/5,newHeight=Math.floor(gridHeightColors/instance.iconSize)*instance.iconSize,newWidth=Math.floor(gridWidthColors/instance.iconSize)*instance.iconSize,rest=gridHeightColors-newHeight;gridHeightColors=newHeight;let bottom,gridHeightAvatars=3*(maxHeight-4*this.fontSize+rest)/5;"guid"!==this.kinduser&&"moodle"!==this.kinduser?(bottom=this.gateCreateLabelEditVertical(0,0,maxWidth,this.fontSize,size[0],this.getStringM("js_code")+": ","mmogame-gate-code-label","mmogame-gate-code")+2*this.padding,this.edtCode=this.edt,this.edtCode.addEventListener("keyup",this.debounce((()=>instance.gateUpdateSubmit()),300))):bottom=0,bottom=this.gateCreateLabelEditVertical(0,bottom,newWidth-2*this.padding,this.fontSize,size[0],this.getStringM("js_name")+": ","mmogame-gate-name-label","mmogame-gate-name")+2*this.padding,this.edtNickname=this.edt,this.edtNickname.addEventListener("keyup",this.debounce((()=>instance.gateUpdateSubmit()),300)),this.gateCreateScreenPalette(bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars),bottom+=this.fontSize+this.padding,this.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+this.fontSize+this.padding,gridWidthAvatars,gridHeightAvatars);let bottom2=bottom+gridHeightColors+this.fontSize+this.padding+gridHeightAvatars;this.gateCreateButtonSubmit(maxWidth,bottom2)}gateCreateScreenHorizontal(){let size,maxHeight=this.areaHeight-7*this.padding-this.iconSize,maxWidth=this.areaWidth,instance=this;const sName=this.getStringM("js_name")+": ";let labels=[this.getStringM("js_code"),sName,this.getStringM("js_palette")];this.fontSize=this.findbest(this.minFontSize,this.maxFontSize,(function(fontSize){if(size=instance.gateComputeLabelSize(fontSize,labels),size[0]>=maxWidth)return 1;let heightCode="guid"!==instance.kinduser&&"moodle"!==instance.kinduser?size[1]+instance.padding:0,heightColors=2*(maxHeight-4*fontSize)/5;if(0===Math.floor(heightColors/instance.iconSize))return 1;let heightAvatars=3*(maxHeight-4*fontSize+heightColors)/5;return heightCode+2*size[1]+7*instance.padding+heightColors+heightAvatars<maxHeight?-1:1}));let gridWidthColors=maxWidth-this.padding,gridWidthAvatars=maxWidth-this.padding,gridHeightColors=2*(maxHeight-4*this.fontSize)/5,newHeight=Math.floor(gridHeightColors/instance.iconSize)*instance.iconSize,newWidth=Math.floor(gridWidthColors/instance.iconSize)*instance.iconSize,rest=gridHeightColors-newHeight;gridHeightColors=newHeight;let bottom,gridHeightAvatars=Math.floor(3*(maxHeight-4*this.fontSize)/5+rest);"guid"!==this.kinduser&&"moodle"!==this.kinduser?(bottom=this.gateCreateLabelEditVertical(0,0,maxWidth,this.fontSize,size[0],this.getStringM("js_code"))+2*this.padding,this.edtCode=this.edt,this.edtCode.addEventListener("keyup",this.debounce((()=>instance.gateUpdateSubmit()),300))):bottom=0;let sizeLabel=this.gateComputeLabelSize(this.fontSize,[sName]);bottom=this.gateCreateLabelEditHorizontal(0,bottom,newWidth-2*this.padding,this.fontSize,sizeLabel[0],this.getStringM("js_name")+": ","mmogame-gate-name-label","mmogame-gate-name"),this.edtNickname=this.edt,this.edtNickname.addEventListener("keyup",this.debounce((()=>instance.gateUpdateSubmit()),300));let label1=document.createElement("label");label1.style.position="absolute",label1.style.color=this.getContrastingColor(this.colorBackground),label1.innerHTML=this.getStringM("js_palette"),label1.style.font="FontAwesome",label1.style.fontSize=this.fontSize+"px",label1.style.width="0px",label1.style.whiteSpace="nowrap",this.area.appendChild(label1);let btn=this.createImageButton(this.area,"mmogame-button-gate-refresh",label1.scrollWidth+this.padding,bottom,this.iconSize,this.fontSize,"assets/refresh.svg",!1,"refresh");this.addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars,!0,!1),label1.style.left=0,label1.style.color=this.getContrastingColor(this.colorBackground),label1.style.top=bottom+"px",bottom+=this.fontSize+this.padding;let label=document.createElement("label");label.style.position="absolute",label.innerHTML=this.getStringM("js_avatars"),label.style.font="FontAwesome",label.style.fontSize=this.fontSize+"px",label.style.width="0 px",label.style.whiteSpace="nowrap",this.area.appendChild(label),btn=this.createImageButton(this.area,"mmogame-button-gate-refresh-avatars",label.scrollWidth+this.padding,bottom+gridHeightColors,this.iconSize,this.fontSize,"assets/refresh.svg",!1,"refresh"),btn.addEventListener("click",(function(){let elements=instance.area.getElementsByClassName("mmogame_avatar");for(;elements[0];)elements[0].parentNode.removeChild(elements[0]);instance.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+instance.fontSize+instance.padding,gridWidthAvatars,gridHeightAvatars,!1,!0)})),label.style.left="0 px",label.style.color=this.getContrastingColor(this.colorBackground),label.style.top=bottom+gridHeightColors+"px",this.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+this.fontSize+this.padding,gridWidthAvatars,gridHeightAvatars);let bottom2=bottom+gridHeightColors+this.fontSize+this.padding+gridHeightAvatars;this.btnSubmit=this.createImageButton(this.area,"mmogame-button-gate-submit",(maxWidth-this.iconSize)/2,bottom2,0,this.iconSize,"assets/submit.svg",!1,"submit"),this.btnSubmit.style.visibility="hidden",this.btnSubmit.addEventListener("click",(function(){void 0!==instance.edtCode&&(instance.user=instance.edtCode.value),instance.gatePlayGame(!0,instance.edtNickname.value,instance.paletteid,instance.avatarid)}))}gateComputeLabelSize(fontSize,aLabel){let maxWidth=0,maxHeight=0;for(let i=0;i<aLabel.length;i++){const label=document.createElement("label");label.style.position="absolute",label.innerHTML=aLabel[i],label.style.whiteSpace="nowrap",label.style.font="FontAwesome",label.style.fontSize=fontSize+"px",label.style.width="0px",label.style.height="0px",this.area.appendChild(label),label.scrollWidth>maxWidth&&(maxWidth=label.scrollWidth),label.scrollHeight>maxHeight&&(maxHeight=label.scrollHeight),this.area.removeChild(label)}return[maxWidth,maxHeight]}gateCreateLabelEditVertical(left,top,width,fontSize,labelWidth,title,classnamesLabel,classnamesEdit){const label=this.createLabel(this.area,classnamesLabel,left,top,labelWidth,fontSize,title);return label.style.color=this.getContrastingColor(this.colorBackground),top+=label.scrollHeight,this.edt=this.gateCreateInput(classnamesEdit,left,top,width,fontSize),top+fontSize+this.padding}gateShowAvatars(left,top,width,height,countX,avatarids,avatars){if(!avatars||0===avatars.length)return;const fragment=document.createDocumentFragment();this.avatar=void 0;const count=avatars.length;let leftOriginal=left,w=Math.round(this.padding/2)+"px";for(let i=0;i<count;i++){let avatarImagePath="assets/avatars/"+avatars[i],btn=this.createCenterImageButton(fragment,left,top,this.iconSize-this.padding,this.iconSize-this.padding,"mmogame-avatar",avatarImagePath);btn.classList.add("mmogame_avatar");let id=avatarids[i];btn.addEventListener("click",(()=>{this.gateUpdateAvatar(btn,id,w)})),left+=this.iconSize,(i+1)%countX==0&&(top+=this.iconSize,left=leftOriginal)}this.area.appendChild(fragment)}gateSendGetColorsAvatars(leftColors,topColors,gridWidthColors,gridHeightColors,leftAvatars,topAvatars,gridWidthAvatars,gridHeightAvatars){let updateColors=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],updateAvatars=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],countXcolors=Math.floor(gridWidthColors/this.iconSize),countYcolors=Math.floor(gridHeightColors/this.iconSize),countXavatars=Math.floor(gridWidthAvatars/this.iconSize),countYavatars=Math.floor((gridHeightAvatars+2*this.padding)/this.iconSize);updateColors||(countXcolors=countXcolors=0),updateAvatars||(countXavatars=countYavatars=0);let instance=this;require(["core/ajax"],(function(Ajax){let params={mmogameid:instance.mmogameid,kinduser:instance.kinduser,user:instance.user,avatars:countXavatars*countYavatars,colorpalettes:countXcolors*countYcolors};Ajax.call([{methodname:"mod_mmogame_get_assets",args:params}])[0].done((function(_ref){let{avatarids:avatarids,avatars:avatars,colorpaletteids:colorpaletteids,colorpalettes:colorpalettes}=_ref;updateColors&&instance.gateShowColorPalettes(leftColors,topColors,gridWidthColors,gridHeightColors,countXcolors,countYcolors,colorpaletteids,colorpalettes),updateAvatars&&instance.gateShowAvatars(leftAvatars,topAvatars,gridWidthAvatars,gridHeightAvatars,countXavatars,avatarids,avatars)})).fail((function(error){return error}))}))}gateShowColorPalettes(left,top,width,height,countX,countY,colorpaletteids,colorpalettes){let i=0;const count=colorpalettes.length;this.canvasColor=void 0;const canvasSize=this.iconSize-3*this.padding/2,parsedPalettes=colorpalettes.map((palette=>palette.split(",").map((value=>parseInt(value,10)||0)))),fragment=document.createDocumentFragment();for(let iy=0;iy<countY;iy++)for(let ix=0;ix<countX;ix++){if(i>=count||!parsedPalettes[i]||!colorpaletteids[i]){i++;continue}let canvas=document.createElement("canvas");canvas.style.position="absolute",canvas.style.left="".concat(left+ix*this.iconSize,"px"),canvas.style.top="".concat(top+iy*this.iconSize,"px"),canvas.width=canvasSize,canvas.height=canvasSize,canvas.style.cursor="pointer",canvas.classList.add("mmogame_color"),fragment.appendChild(canvas),this.showColorPalette(canvas,parsedPalettes[i]);let id=colorpaletteids[i];canvas.addEventListener("click",(()=>{this.gateUpdateColorPalette(canvas,id)})),i++}this.area.appendChild(fragment)}gateUpdateColorPalette(canvas,id){void 0!==this.canvasColor&&(this.canvasColor.style.borderStyle="none"),this.canvasColor=canvas;let w=Math.round(this.padding/2)+"px";Object.assign(canvas.style,{borderStyle:"outset",borderLeftWidth:w,borderTopWidth:w,borderRightWidth:w,borderBottomWidth:w}),this.paletteid=id,this.gateUpdateSubmit()}gateUpdateAvatar(avatar,id,w){void 0!==this.avatar&&(this.avatar.style.borderStyle="none"),this.avatar=avatar,avatar.style.borderStyle="outset",avatar.style.borderLeftWidth=w,avatar.style.borderTopWidth=w,avatar.style.borderRightWidth=w,avatar.style.borderBottomWidth=w,this.avatarid=id,this.gateUpdateSubmit()}gateUpdateSubmit(){var _this$edtCode,_this$edtNickname,_this$edtNickname$val;const isCodeValid=null===(_this$edtCode=this.edtCode)||void 0===_this$edtCode||!_this$edtCode.value||Number(this.edtCode.value)>0,hasAvatar=void 0!==this.avatarid,hasPalette=void 0!==this.paletteid,hasNickname=(null===(_this$edtNickname=this.edtNickname)||void 0===_this$edtNickname||null===(_this$edtNickname$val=_this$edtNickname.value)||void 0===_this$edtNickname$val?void 0:_this$edtNickname$val.length)>0;this.btnSubmit.style.visibility=isCodeValid&&hasAvatar&&hasPalette&&hasNickname?"visible":"hidden"}gateComputeSizes(){this.computeSizes(),this.iconSize=Math.round(.8*this.iconSize),this.padding=Math.round(.8*this.padding)}gateCreateLabelEditHorizontal(left,top,width,fontSize,labelWidth,title,classnamesLabel,classnamesEdit){const label=this.createLabel(this.area,classnamesLabel,left,top,labelWidth,fontSize,title);label.style.color=this.getContrastingColor(this.colorBackground);let ret=top+Math.max(label.scrollHeight,fontSize)+this.padding,leftEdit=left+labelWidth+this.padding;return this.edt=this.gateCreateInput(classnamesEdit,leftEdit,top,width-leftEdit-this.padding,fontSize),ret}gateCreateInput(classnames,left,top,width,fontSize){const div=document.createElement("input");return div.style.position="absolute",div.style.width=width+"px",div.style.type="text",div.style.fontSize=fontSize+"px",div.style.left=left+"px",div.style.top=top+"px",div.autofocus=!0,div.classList.add(...classnames.split(/\s+/)),this.area.appendChild(div),this.edt=div,div}gateCreateScreenPalette(bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars){const label=this.createDOMElement("label",{parent:this.area,styles:{position:"absolute",font:"FontAwesome",fontSize:"".concat(this.fontSize,"px"),width:"0px",whiteSpace:"nowrap",color:this.getContrastingColor(this.colorBackground),top:"".concat(bottom,"px"),left:"0px"},attributes:{innerHTML:this.getStringM("js_palette")}}),btn=this.createImageButton(this.area,"mmogame-gate-palette",label.scrollWidth+this.padding,bottom,this.iconSize,this.fontSize,"assets/refresh.svg",!1,"refresh");this.addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars)}addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars,updateColors,updateAvatars){const instance=this;btn.addEventListener("click",(function(){Array.from(instance.area.getElementsByClassName("mmogame_color")).forEach((element=>element.remove())),instance.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+instance.fontSize+instance.padding,gridWidthAvatars,gridHeightAvatars,updateColors,updateAvatars)}))}createArea(){this.area&&this.body.removeChild(this.area),this.area=this.createDiv(this.body,"mmogame-area",this.padding,this.areaTop,this.areaWidth,this.areaHeight)}createModal(classnames,title,content){const modal=this.createDOMElement("div",{parent:this.body,classnames:"".concat(classnames," modal"),styles:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#fff",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",padding:"20px",zIndex:1e3}});this.createDOMElement("div",{parent:modal,classnames:"".concat(classnames,"-header"),styles:{fontWeight:"bold",marginBottom:"10px"}}).innerText=title;this.createDOMElement("div",{parent:modal,classnames:"".concat(classnames,"-body")}).innerHTML=content;const closeButton=this.createDOMElement("button",{parent:modal,classnames:"".concat(classnames,"-close"),styles:{marginTop:"10px",display:"block",marginLeft:"auto",marginRight:"auto"},attributes:{type:"button"}});return closeButton.innerText="Close",closeButton.addEventListener("click",(()=>{this.body.removeChild(modal)})),modal}createDivMessage(classnames,message){void 0!==this.area&&(this.body.removeChild(this.area),this.area=void 0),void 0!==this.divMessageHelp&&(this.body.removeChild(this.divMessageHelp),this.divMessageHelp=void 0);let left=this.padding,top=this.areaTop,width=window.innerWidth-2*this.padding,height=window.innerHeight-this.getCopyrightHeight()-this.padding-top;this.createDivMessageDo(classnames,left,top,width,height,message,height),this.divMessage.style.top=(height-this.divMessage.scrollHeight)/2+"px"}createButtonsAvatar(num,left){let widthNickName=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,heightNickName=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;0===widthNickName&&(widthNickName=this.iconSize),0===heightNickName&&(heightNickName=this.iconSize-this.buttonAvatarHeight),void 0===this.buttonsAvatarLeft&&(this.buttonsAvatarLeft=[]),this.buttonsAvatarLeft[num]=left,void 0===this.buttonsAvatarSrc&&(this.buttonsAvatarSrc=[]),this.buttonsAvatarSrc[num]="",void 0===this.nicknames&&(this.nicknames=[]),this.nicknames[num]="",void 0===this.buttonsAvatar&&(this.buttonsAvatar=[]),this.buttonsAvatar[num]=this.createImageButton(this.body,"mmogame-avatar"+num,left,this.avatarTop,this.iconSize,this.iconSize),2===num&&void 0!==this.avatarTop&&(this.buttonsAvatar[num].title=this.getStringM("js_opponent")),void 0===this.divNicknames&&(this.divNicknames=[]),void 0===this.divNicknamesWidth&&(this.divNicknamesWidth=[]),void 0===this.divNicknamesHeight&&(this.divNicknamesHeight=[]),this.divNicknamesWidth[num]=widthNickName,this.divNicknamesHeight[num]=heightNickName,this.divNicknames[num]=this.createDiv(this.body,"mmogame-gate-nickname",left,this.padding,widthNickName,heightNickName)}createDivMessageStart(message){void 0!==this.area&&(this.body.removeChild(this.area),this.area=void 0);let left=this.padding,top=this.areaTop,width=window.innerWidth-2*this.padding,height=window.innerHeight-this.getCopyrightHeight()-this.padding-top,height1=height/8;if(this.createDivMessageDo("mmogame-message-start",left,top,width,height,message,height1),top+=(height1-this.divMessage.scrollHeight)/2,this.divMessage.style.top=top+"px",void 0===this.divMessageHelp){let div=document.createElement("div");div.style.position="absolute",div.style.left=left+"px",div.style.textAlign="left",div.style.width=width-2*this.padding+"px",div.style.paddingLeft=this.padding+"px",div.style.paddingRight=this.padding+"px",div.style.color=this.getContrastingColor(this.colorDefinition);let top=this.iconSize+3*this.padding+height1;div.style.top=top+this.padding+"px",div.style.height=height-height1+"px",this.divMessageHelp=div,this.body.appendChild(this.divMessageHelp),this.showHelpScreen(div,width-2*this.padding,height-height1)}}createAddScore(classnames,left,top,width,height,num){const div=this.createDiv(this.body,classnames,left,top,width,height);div.style.textAlign="center",div.style.color=this.getContrastingColor(this.colorScore),div.title=this.getStringM("js_grade_last_question"),1===num?this.labelAddScore=div:this.labelAddScore2=div}updateButtonsAvatar(num,avatar,nickname){if(void 0===avatar&&(avatar=""),void 0===nickname&&(nickname=""),""===avatar&&""===nickname)return this.buttonsAvatar[num].style.visibility="hidden",void(this.divNicknames[num].style.visibility="hidden");if(this.nicknames[num]!==nickname||""===nickname){this.nicknames[num]=nickname;let s=nickname;if(0===nickname.length){s=avatar;let pos=s.lastIndexOf("/");pos>=0&&(s=s.slice(pos+1)),pos=s.lastIndexOf("."),pos>=0&&(s=s.slice(0,pos));s=avatar.split("/").pop().split(".").slice(0,-1).join(".")}s=this.repairNickname(s),void 0!==this.divNicknames[num]&&this.divNicknames[num].innerHTML!==s&&(this.divNicknames[num].innerHTML=s,this.divNicknames[num].style.textAlign="center",this.divNicknames[num].style.color=this.getContrastingColor(this.colorsBackground),this.autoResizeText(this.divNicknames[num],this.divNicknamesWidth[num],this.divNicknamesHeight[num],!0,0,0,1))}avatar!==this.buttonsAvatarSrc[num]&&(this.updateImageButton(this.buttonsAvatar[num],""!==avatar?"assets/avatars/"+avatar:""),this.buttonsAvatarSrc[num]=avatar),this.buttonsAvatar[num].alt=this.divNicknames[num].innerHTML,this.buttonsAvatar[num].style.visibility="visible",this.divNicknames[num].style.visibility="visible"}callGetAttempt(extraparams){let instance=this;require(["core/ajax"],(function(Ajax){let params={mmogameid:instance.mmogameid,kinduser:instance.kinduser,user:instance.user,nickname:null,colorpaletteid:null,avatarid:null};void 0!==extraparams&&(params=_objectSpread(_objectSpread({},params),extraparams)),Ajax.call([{methodname:"mmogametype_quiz_get_attempt",args:params}])[0].done((function(response){void 0!==extraparams&&void 0!==extraparams.colorpaletteid&&(instance.openGame(),instance.colors=void 0),instance.processGetAttempt(JSON.parse(response))})).fail((function(error){return instance.createDivMessage("mmogame-error",error.message),error}))}))}showError(name,error){const message=(null==error?void 0:error.message)||"An unknown error occurred.";this.createDivMessage("mmogame-error",message)}createDivMessageDo(classnames,left,top,width,height,message,heightmessage){if(void 0===this.divMessageBackground){let div=this.createDiv(this.body,classnames,left,top,width,height);div.style.background=this.getColorHex(this.colorDefinition),this.divMessageBackground=div}if(void 0===this.divMessage){let div=document.createElement("div");div.style.position="absolute",div.style.left=left+"px",div.style.textAlign="center",div.style.width=width-2*this.padding+"px",div.style.paddingLeft=this.padding+"px",div.style.paddingRight=this.padding+"px",div.style.background=this.getColorHex(this.colorDefinition),div.style.color=this.getContrastingColor(this.colorDefinition),this.divMessage=div}this.divMessage.innerHTML=message,this.body.appendChild(this.divMessage),this.autoResizeText(this.divMessage,width,heightmessage,!1,this.minFontSize,this.maxFontSize,.5)}}}));

//# sourceMappingURL=mmogameui.min.js.map