{"version":3,"file":"mmogameui.min.js","sources":["../src/mmogameui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mod_mmogame/mmogame'], function(MmoGame) {\n    return class MmoGameUI extends MmoGame {\n\n        vertical;\n        kindSound; // Type: Number (0 = on, 1 = off, 2 = speak)\n        buttonSound;\n\n        // Other\n        definition;\n        buttonAvatarHeight;\n        buttonAvatarTop;\n        colorBackground;\n\n        constructor() {\n            super();\n        }\n\n        /**\n         * Returns the appropriate file for mute/unmute.\n         * @returns {string} The file path.\n         */\n        getMuteFile() {\n            return this.kindSound === 0 ? 'assets/sound-on-flat.png' : 'assets/sound-off-flat.png';\n        }\n\n        /**\n         * Plays a sound file if sound is enabled.\n         *\n         * @param {HTMLAudioElement} audioElement - The audio element to play.\n         */\n        playAudio(audioElement) {\n            if (this.kindSound !== 0 && audioElement) {\n                if (audioElement.networkState === 1) {\n                    audioElement.play();\n                }\n            }\n        }\n\n        createButtonSound(left, top) {\n            this.buttonSound = this.createButton(\n                this.body,\n                'mmogame-button-sound',\n                left,\n                top,\n                this.iconSize,\n                this.iconSize,\n                this.getMuteFile(),\n                this.getStringM('js_sound')\n            );\n            this.buttonSound.addEventListener(\"click\", () => this.onClickSound(this.buttonSound));\n        }\n\n        /**\n         * Toggles sound on or off when clicked.\n         * @param {HTMLElement} button - The sound toggle button.\n         */\n        onClickSound(button) {\n            this.kindSound = (this.kindSound + 1) % 2;\n            button.src = this.getMuteFile();\n            this.setOptions({kindSound: this.kindSound});\n        }\n\n        gateOpen(mmogameid, pin, kinduser, user, url) {\n            this.url = url;\n            this.minFontSize *= 2;\n            this.maxFontSize *= 2;\n\n            // Saves parameters to class variables.\n            this.mmogameid = mmogameid;\n            this.pin = pin;\n            this.kinduser = kinduser;\n            this.user = user;\n            this.gateComputeSizes();\n\n            this.areaTop = this.padding;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop) - this.padding;\n\n            let instance = this;\n            this.getOptions().then(function(options) {\n                if (!options.hasOwnProperty('kindsound')) {\n                    options.kindsound = 0;\n                }\n                instance.kindSound = options.kindSound === 1 || options.kindSound === 2 ? options.kindSound : 0;\n\n                if (!options.hasOwnProperty('nickname')) {\n                    options.nickname = '';\n                }\n                options.avatarid = options.hasOwnProperty('avatarid') && options.avatarid !== undefined ? options.avatarid : 0;\n                options.paletteid = options.hasOwnProperty('paletteid') ? options.paletteid : 0;\n\n                switch (kinduser) {\n                    case 'moodle':\n                        if (options.nickname !== '' && options.avatarid !== 0 && options.paletteid !== 0) {\n                            instance.gatePlayGame(false, options.nickname, options.paletteid, options.avatarid);\n                            return true;\n                        }\n                        break;\n                    case 'guid':\n                        if (!options.hasOwnProperty('userGUID')) {\n                            options.userGUID = '';\n                        }\n                        if (options.userGUID.length >= 10 && options.nickname !== '' && options.avatarid !== 0 &&\n                            options.paletteid !== 0) {\n                            instance.user = options.userGUID;\n                            instance.gatePlayGame(false, options.nickname, options.paletteid, options.avatarid);\n                            return true;\n                        }\n                        break;\n                }\n                // Call gateCreateScreen to ask user for nickname, colors, avatar.\n                instance.gateCreateScreen();\n                return true;\n            }).catch(error => {\n                instance.showError('gateOpen', error);\n                return false;\n            });\n        }\n\n\n        gatePlayGame(save, nickname, paletteid, avatarid) {\n            if (this.kinduser === 'guid') {\n                if (this.user === '') {\n                    this.uuid4();\n                }\n            }\n\n            if (!save) {\n                this.nickname = nickname;\n                this.paletteid = paletteid;\n                this.avatarid = avatarid;\n                this.callGetAttempt({nickname: nickname, colorpaletteid: paletteid, avatarid: avatarid});\n                return;\n            }\n\n            let options = {nickname: nickname, avatarid: avatarid, paletteid: paletteid};\n\n            let instance = this;\n            this.setOptions(options)\n                .then(function() {\n                    instance.nickname = nickname;\n                    instance.paletteid = paletteid;\n                    instance.avatarid = avatarid;\n                    instance.callGetAttempt();\n                    return true;\n                })\n                .catch(error => {\n                    console.log(error);\n                    instance.showError(error.message);\n                    return false;\n                });\n        }\n\n        gateCreateScreen() {\n            this.vertical = window.innerWidth < window.innerHeight;\nconsole.log('gateCreateScreen verical=' + this.vertical);\n            this.createArea();\n\n            if (this.vertical) {\n                this.gateCreateScreenVertical();\n            } else {\n                console.log('before gateCreateScreenHorizontal');\n                this.gateCreateScreenHorizontal();\n            }\n        }\n\n        gateCreateScreenVertical() {\n            console.log('gateCreateScreenVertical');\n            let maxHeight = this.areaHeight - 5 * this.padding - this.iconSize;\n            let maxWidth = this.areaWidth;\n            let instance = this;\n            let size;\n\n            const labels = [this.getStringM('js_name') + \": \", this.getStringM('js_code'), this.getStringM('js_palette')];\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, function(fontSize) {\n                size = instance.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n                let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n                let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / instance.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                let computedHeight = heightCode + 3 * size[1] + 8 * instance.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            let gridWidthColors = maxWidth - this.padding;\n            let gridWidthAvatars = maxWidth - this.padding;\n            let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n            let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n            let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n            let rest = gridHeightColors - newHeight;\n            gridHeightColors = newHeight;\n            let gridHeightAvatars = (maxHeight - 4 * this.fontSize + rest) * 3 / 5;\n\n            // Creates the \"Code\" field.\n            let bottom;\n            if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n                // A bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n                bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize,\n                    size[0], this.getStringM('js_code') + \": \",\n                    'mmogame-gate-code-label', 'mmogame-gate-code') + 2 * this.padding;\n                this.edtCode = this.edt;\n                this.edtCode.addEventListener(\"keyup\", function() {\n                    instance.gateUpdateSubmit();\n                });\n            } else {\n                bottom = 0;\n            }\n\n            bottom = this.gateCreateLabelEditVertical(0, bottom,\n                newWidth - 2 * this.padding, this.fontSize, size[0],\n                this.getStringM('js_name') + \": \",\n                'mmogame-gate-name-label', 'mmogame-gate-name') + 2 * this.padding;\n            this.edtNickname = this.edt;\n            this.edtNickname.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n\n            this.gateCreateScreenPalette(bottom, gridWidthColors, gridHeightColors,\n                gridWidthAvatars, gridHeightAvatars);\n\n            bottom += this.fontSize + this.padding;\n\n            // Vertical\n            this.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n                gridHeightAvatars);\n\n            let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n\n            this.gateCreateButtonSubmit(maxWidth, bottom2);\n        }\n\n        gateCreateScreenHorizontal() {\n            console.log(\"gateCreateScreenHorizontal\");\n\n            let maxHeight = this.areaHeight - 7 * this.padding - this.iconSize;\n            let maxWidth = this.areaWidth;\n            let instance = this;\n            let size;\n\n            const sName = this.getStringM('js_name') + \": \";\n            let labels = [this.getStringM('js_code'), sName, this.getStringM('js_palette')];\n\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize,\n                function(fontSize) {\n                size = instance.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n                let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n                let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / instance.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                let computedHeight = heightCode + 2 * size[1] + 7 * instance.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            let gridWidthColors = maxWidth - this.padding;\n            let gridWidthAvatars = maxWidth - this.padding;\n            let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n            let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n            let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n            let rest = gridHeightColors - newHeight;\n            gridHeightColors = newHeight;\n            let gridHeightAvatars = Math.floor((maxHeight - 4 * this.fontSize) * 3 / 5 + rest);\n\n            // Creates the \"Code\" field.\n            let bottom;\n            if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n                // B bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n                bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize, size[0],\n                    this.getStringM('js_code')) + 2 * this.padding;\n                this.edtCode = this.edt;\n                this.edtCode.addEventListener(\"keyup\", function() {\n                    instance.gateUpdateSubmit();\n                });\n            } else {\n                bottom = 0;\n            }\n\n            // Creates the \"nickname\" field.\n            let sizeLabel = this.gateComputeLabelSize(this.fontSize, [sName]);\n            bottom = this.gateCreateLabelEditHorizontal(0, bottom,\n                newWidth - 2 * this.padding, this.fontSize,\n                sizeLabel[0], this.getStringM('js_name') + \": \",\n                'mmogame-gate-name-label', 'mmogame-gate-name');\n\n            this.edtNickname = this.edt;\n\n            this.edtNickname.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n\n            let label1 = document.createElement(\"label\");\n            label1.style.position = \"absolute\";\n            label1.style.color = this.getContrastingColor(this.colorBackground);\n            label1.innerHTML = this.getStringM('js_palette');\n            label1.style.font = \"FontAwesome\";\n            label1.style.fontSize = this.fontSize + \"px\";\n            label1.style.width = \"0px\";\n            label1.style.whiteSpace = \"nowrap\";\n            this.area.appendChild(label1);\n\n            // Button refresh color palettes\n            let btn = this.createImageButton(this.area, 'mmogame-button-gate-refresh',\n                label1.scrollWidth + this.padding, bottom, this.iconSize, this.fontSize,\n                'assets/refresh.svg', false, 'refresh');\n            this.addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors,\n                gridWidthAvatars, gridHeightAvatars, true, false);\n\n            label1.style.left = 0;\n            label1.style.color = this.getContrastingColor(this.colorBackground);\n            label1.style.top = bottom + \"px\";\n            bottom += this.fontSize + this.padding;\n\n            let label = document.createElement(\"label\");\n            label.style.position = \"absolute\";\n            label.innerHTML = this.getStringM('js_avatars');\n            label.style.font = \"FontAwesome\";\n            label.style.fontSize = this.fontSize + \"px\";\n            label.style.width = \"0 px\";\n            label.style.whiteSpace = \"nowrap\";\n            this.area.appendChild(label);\n\n            // Button refresh avatars\n            btn = this.createImageButton(this.area, 'mmogame-button-gate-refresh-avatars',\n                label.scrollWidth + this.padding, bottom + gridHeightColors, this.iconSize,\n                this.fontSize, 'assets/refresh.svg', false, 'refresh');\n            btn.addEventListener(\"click\",\n                function() {\n                    let elements = instance.area.getElementsByClassName(\"mmogame_avatar\");\n\n                    while (elements[0]) {\n                        elements[0].parentNode.removeChild(elements[0]);\n                    }\n\n                    instance.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors, 0,\n                        bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                        false, true);\n                }\n            );\n\n            // Avatar\n            label.style.left = \"0 px\";\n            label.style.color = this.getContrastingColor(this.colorBackground);\n            label.style.top = (bottom + gridHeightColors) + \"px\";\n\n            // Horizontal\n            this.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n                gridHeightAvatars);\n\n            let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n            this.btnSubmit = this.createImageButton(this.area, 'mmogame-button-gate-submit',\n                (maxWidth - this.iconSize) / 2, bottom2, 0, this.iconSize,\n                'assets/submit.svg', false, 'submit');\n            this.btnSubmit.style.visibility = 'hidden';\n            this.btnSubmit.addEventListener(\"click\",\n                function() {\n                    if (instance.edtCode !== undefined) {\n                        instance.user = instance.edtCode.value;\n                    }\n                    instance.gatePlayGame(true, instance.edtNickname.value, instance.paletteid, instance.avatarid);\n                }\n            );\n        }\n\n        gateComputeLabelSize(fontSize, aLabel) {\n            let maxWidth = 0;\n            let maxHeight = 0;\n\n            for (let i = 0; i < aLabel.length; i++) {\n                const label = document.createElement(\"label\");\n                label.style.position = \"absolute\";\n                label.innerHTML = aLabel[i];\n                label.style.whiteSpace = \"nowrap\";\n                label.style.font = \"FontAwesome\";\n                label.style.fontSize = fontSize + \"px\";\n                label.style.width = \"0px\";\n                label.style.height = \"0px\";\n                this.area.appendChild(label);\n\n                if (label.scrollWidth > maxWidth) {\n                    maxWidth = label.scrollWidth;\n                }\n\n                if (label.scrollHeight > maxHeight) {\n                    maxHeight = label.scrollHeight;\n                }\n                this.area.removeChild(label);\n            }\n\n            return [maxWidth, maxHeight];\n        }\n\n        gateCreateLabelEditVertical(left, top, width, fontSize, labelWidth, title, classnamesLabel, classnamesEdit) {\n            const label = this.createLabel(this.area, classnamesLabel, left, top, labelWidth, fontSize, title);\n            label.style.color = this.getContrastingColor(this.colorBackground);\n\n            top += label.scrollHeight;\n\n            this.edt = this.gateCreateInput(classnamesEdit, left, top, width, fontSize);\n\n            return top + fontSize + this.padding;\n        }\n\n        gateShowAvatars(left, top, width, height, countX, avatarids, avatars) {\n            if (!avatars || avatars.length === 0) {\n                return; // Exit early if no avatars exist\n            }\n\n            this.avatar = undefined;\n            const count = avatars.length;\n            let leftOriginal = left;\n            let w = Math.round(this.padding / 2) + \"px\";\n            for (let i = 0; i < count; i++) {\n                let avatarImagePath = 'assets/avatars/' + avatars[i];\n                let btn = this.createCenterImageButton(\n                    this.area,\n                    left, top,\n                    this.iconSize - this.padding, this.iconSize - this.padding,\n                    'mmogame-avatar',\n                    avatarImagePath\n                );\n                btn.classList.add(\"mmogame_avatar\");\n                let id = avatarids[i];\n                btn.addEventListener(\"click\", () => {\n                    this.gateUpdateAvatar(btn, id, w);\n                });\n\n                // Move left position after placing the button\n                left += this.iconSize;\n\n                // Reset left and move to the next row after filling countX buttons\n                if ((i + 1) % countX === 0) {\n                    top += this.iconSize;\n                    left = leftOriginal;\n                }\n            }\n        }\n\n        gateSendGetColorsAvatars(leftColors, topColors, gridWidthColors, gridHeightColors, leftAvatars, topAvatars,\n                                 gridWidthAvatars, gridHeightAvatars, updateColors = true, updateAvatars = true) {\n\n            let countXcolors = Math.floor(gridWidthColors / this.iconSize);\n            let countYcolors = Math.floor(gridHeightColors / this.iconSize);\n\n            let countXavatars = Math.floor(gridWidthAvatars / this.iconSize);\n            let countYavatars = Math.floor((gridHeightAvatars + 2 * this.padding) / this.iconSize);\n\n            if (!updateColors) {\n                countXcolors = countXcolors = 0;\n            }\n            if (!updateAvatars) {\n                countXavatars = countYavatars = 0;\n            }\n\n            let instance = this;\n            require(['core/ajax'], function(Ajax) {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: instance.mmogameid,\n                    kinduser: instance.kinduser,\n                    user: instance.user,\n                    avatars: countXavatars * countYavatars,\n                    colorpalettes: countXcolors * countYcolors,\n                };\n\n                // Calling the service through the Moodle AJAX API\n                let getAssets = Ajax.call([{\n                    methodname: 'mod_mmogame_get_assets',\n                    args: params\n                }]);\n\n                // Handling the response\n                getAssets[0].done(function({avatarids, avatars, colorpaletteids, colorpalettes}) {\n                    if (updateColors) {\n                        instance.gateShowColorPalettes(leftColors, topColors, gridWidthColors,\n                            gridHeightColors, countXcolors, countYcolors, colorpaletteids, colorpalettes);\n                    }\n                    if (updateAvatars) {\n                        instance.gateShowAvatars(leftAvatars, topAvatars, gridWidthAvatars, gridHeightAvatars, countXavatars,\n                            avatarids, avatars);\n                    }\n                }).fail(function(error) {\n                    return error;\n                });\n            });\n        }\n\n        gateShowColorPalettes(left, top, width, height, countX, countY, colorpaletteids, colorpalettes) {\n            let i = 0; // Counter for color palettes\n            const count = colorpalettes.length;\n            this.canvasColor = undefined;\n            const canvasSize = this.iconSize - this.padding * 3 / 2;\n            const parsedPalettes = colorpalettes.map(palette =>\n                palette.split(\",\").map(value => parseInt(value, 10) || 0)\n            );\n            for (let iy = 0; iy < countY; iy++) {\n                for (let ix = 0; ix < countX; ix++) {\n                    // Check if we exceed available palettes or encounter invalid data\n                    if (i >= count || !parsedPalettes[i] || !colorpaletteids[i]) {\n                        i++; // Increment and continue if invalid\n                        continue;\n                    }\n\n                    // Create a new canvas element\n                    let canvas = document.createElement('canvas');\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = `${left + ix * this.iconSize}px`;\n                    canvas.style.top = `${top + iy * this.iconSize}px`;\n                    canvas.width = canvasSize;\n                    canvas.height = canvasSize;\n                    canvas.style.cursor = 'pointer';\n                    canvas.classList.add(\"mmogame_color\");\n\n                    // Append canvas to the area\n                    this.area.appendChild(canvas);\n\n                    // Render the color palette on the canvas\n                    this.showColorPalette(canvas, parsedPalettes[i]);\n\n                    // Get the palette ID and attach a click event listener\n                    let id = colorpaletteids[i];\n                    canvas.addEventListener(\"click\", () => {\n                        this.gateUpdateColorPalette(canvas, id);\n                    });\n\n                    i++;\n                }\n            }\n            this.area.classList.add(\"palette\");\n        }\n\n        gateUpdateColorPalette(canvas, id) {\n            if (this.canvasColor !== undefined) {\n                this.canvasColor.style.borderStyle = \"none\";\n            }\n            this.canvasColor = canvas;\n            canvas.style.borderStyle = \"outset\";\n            let w = Math.round(this.padding / 2) + \"px\";\n            canvas.style.borderLeftWidth = w;\n            canvas.style.borderTopWidth = w;\n            canvas.style.borderRightWidth = w;\n            canvas.style.borderBottomWidth = w;\n\n            this.paletteid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        gateUpdateAvatar(avatar, id, w) {\n            if (this.avatar !== undefined) {\n                this.avatar.style.borderStyle = \"none\";\n            }\n            this.avatar = avatar;\n            avatar.style.borderStyle = \"outset\";\n\n            avatar.style.borderLeftWidth = w;\n            avatar.style.borderTopWidth = w;\n            avatar.style.borderRightWidth = w;\n            avatar.style.borderBottomWidth = w;\n\n            this.avatarid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        /**\n         * Updates the visibility of the submit button based on form input validation.\n         *\n         * The method checks the following conditions:\n         * - `avatarid` and `paletteid` must be defined.\n         * - If `edtCode` is defined, its value (parsed as an integer) must be greater than 0.\n         * - The `edtNickname` field must not be empty.\n         *\n         * If all conditions are met, the submit button is made visible; otherwise, it is hidden.\n         */\n        gateUpdateSubmit() {\n            // Check if a valid code exists.\n            const hasCode = this.edtCode?.value ? Number(this.edtCode.value) > 0 : true;\n\n            // Check if all required fields are valid.\n            const hasValidAvatar = this.avatarid !== undefined;\n            const hasValidPalette = this.paletteid !== undefined;\n            const hasValidNickname = this.edtNickname?.value?.length > 0;\n            // Determine button visibility.\n            const isVisible = hasValidAvatar && hasValidPalette && hasCode && hasValidNickname;\n\n            // Update the visibility of the submit button.\n            this.btnSubmit.style.visibility = isVisible ? 'visible' : 'hidden';\n        }\n\n        gateComputeSizes() {\n            this.computeSizes();\n            this.iconSize = Math.round(0.8 * this.iconSize);\n            this.padding = Math.round(0.8 * this.padding);\n        }\n\n\n        gateCreateLabelEditHorizontal(left, top, width, fontSize, labelWidth, title, classnamesLabel, classnamesEdit) {\n            const label = this.createLabel(this.area, classnamesLabel, left, top, labelWidth, fontSize, title);\n            label.style.color = this.getContrastingColor(this.colorBackground);\n\n            console.log(\"gateCreateLabelEditHorizontal color=\" + label.style.color);\n            let ret = top + Math.max(label.scrollHeight, fontSize) + this.padding;\n\n            console.log(\"gateCreateLabelEditHorizontal classnamesLabel=\" + classnamesEdit + \" Edit=\" + classnamesEdit);\n\n            console.log(\"all \" + left + \",\" + top + \",\" + width + \",\" + fontSize + \",\" +\n                labelWidth + \",\" + title + \",\" + classnamesLabel + \",\" + classnamesEdit);\n\n            let leftEdit = (left + labelWidth + this.padding);\n            this.edt = this.gateCreateInput(classnamesEdit, leftEdit, top, width - leftEdit - this.padding, fontSize);\n\n            return ret;\n        }\n\n        gateCreateInput(classnames, left, top, width, fontSize) {\n            console.log(\"gateCreateInput classnames=\" + classnames);\n\n            const div = document.createElement(\"input\");\n            div.style.position = \"absolute\";\n            div.style.width = width + \"px\";\n            div.style.type = \"text\";\n            div.style.fontSize = fontSize + \"px\";\n\n            div.style.left = left + \"px\";\n            div.style.top = top + \"px\";\n            div.autofocus = true;\n\n            div.classList.add(...classnames.split(/\\s+/));\n\n            this.area.appendChild(div);\n            this.edt = div;\n\n            return div;\n        }\n\n        /**\n         * Creates the screen palette UI with a label and a refresh button.\n         * @param {number} bottom - The vertical position for the elements.\n         * @param {number} gridWidthColors - The width of the color grid in pixels.\n         * @param {number} gridHeightColors - The height of the color grid in pixels.\n         * @param {number} gridWidthAvatars - The width of the avatar grid in pixels.\n         * @param {number} gridHeightAvatars - The height of the avatar grid in pixels.\n         */\n        gateCreateScreenPalette(bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars) {\n            // Create and configure the label\n            const label = this.createDOMElement('label', {\n                parent: this.area,\n                styles: {\n                    position: 'absolute',\n                    font: 'FontAwesome',\n                    fontSize: `${this.fontSize}px`,\n                    width: '0px',\n                    whiteSpace: 'nowrap',\n                    color: this.getContrastingColor(this.colorBackground),\n                    top: `${bottom}px`,\n                    left: '0px',\n                },\n                attributes: {\n                    innerHTML: this.getStringM('js_palette'),\n                },\n            });\n\n            // Create the refresh button\n            const btn = this.createImageButton(\n                this.area,\n                'mmogame-gate-palette',\n                label.scrollWidth + this.padding, bottom,\n                this.iconSize, this.fontSize,\n                'assets/refresh.svg',\n                false, 'refresh'\n            );\n\n            // Add event listener to refresh button\n            this.addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars);\n        }\n\n        gateCreateButtonSubmit = (maxWidth, bottom2) => {\n            this.btnSubmit = this.createImageButton(this.area, 'mmogame-gate-submit',\n                (maxWidth - this.iconSize) / 2, bottom2, 0, this.iconSize,\n                'assets/submit.svg', false, 'submit');\n            this.btnSubmit.style.visibility = 'hidden';\n            const instance = this;\n            this.btnSubmit.addEventListener(\"click\", function() {\n                if (instance.edtCode !== undefined) {\n                    instance.user = instance.edtCode.value;\n                }\n                instance.gatePlayGame(true, instance.edtNickname.value, instance.paletteid, instance.avatarid);\n            });\n        };\n\n\n        addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars,\n                                updateColors, updateAvatars) {\n            const instance = this;\n            btn.addEventListener(\"click\",\n                function() {\n                    let elements = instance.area.getElementsByClassName(\"mmogame_color\");\n\n                    while (elements[0]) {\n                        elements[0].parentNode.removeChild(elements[0]);\n                    }\n\n                    instance.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                        0, bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                        updateColors, updateAvatars);\n                }\n            );\n        }\n\n        createArea() {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n            this.removeDivMessage();\n\n            this.area = this.createDiv(this.body, 'mmogame-area', this.padding, this.areaTop, this.areaWidth, this.areaHeight);\n        }\n\n\n        /**\n         * Creates a modal dialog.\n         * @param {string} classnames - The CSS class for the modal.\n         * @param {string} title - The title of the modal.\n         * @param {string} content - The content of the modal.\n         * @returns {HTMLElement} - The modal element.\n         */\n        createModal(classnames, title, content) {\n            const modal = this.createDOMElement('div', {\n                parent: this.body,\n                classnames: `${classnames} modal`,\n                styles: {\n                    position: 'fixed',\n                    top: '50%',\n                    left: '50%',\n                    transform: 'translate(-50%, -50%)',\n                    backgroundColor: '#fff',\n                    boxShadow: '0 4px 8px rgba(0, 0, 0, 0.2)',\n                    padding: '20px',\n                    zIndex: 1000,\n                },\n            });\n\n            const header = this.createDOMElement('div', {\n                parent: modal,\n                classnames: `${classnames}-header`,\n                styles: {\n                    fontWeight: 'bold',\n                    marginBottom: '10px',\n                },\n            });\n            header.innerText = title;\n\n            const body = this.createDOMElement('div', {\n                parent: modal,\n                classnames: `${classnames}-body`,\n            });\n            body.innerHTML = content;\n\n            const closeButton = this.createDOMElement('button', {\n                parent: modal,\n                classnames: `${classnames}-close`,\n                styles: {\n                    marginTop: '10px',\n                    display: 'block',\n                    marginLeft: 'auto',\n                    marginRight: 'auto',\n                },\n                attributes: {type: 'button'},\n            });\n            closeButton.innerText = 'Close';\n\n            closeButton.addEventListener('click', () => {\n                this.body.removeChild(modal);\n            });\n\n            return modal;\n        }\n\n\n        createDivMessage(classnames, message) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            if (this.divMessageHelp !== undefined) {\n                this.body.removeChild(this.divMessageHelp);\n                this.divMessageHelp = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaTop;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n            this.createDivMessageDo(classnames, left, top, width, height, message, height);\n\n            this.divMessage.style.top = (height - this.divMessage.scrollHeight) / 2 + \"px\";\n        }\n\n\n        createButtonsAvatar(num, left, widthNickName = 0, heightNickName = 0) {\n            if (widthNickName === 0) {\n                widthNickName = this.iconSize;\n            }\n            if (heightNickName === 0) {\n                heightNickName = this.iconSize - this.buttonAvatarHeight;\n            }\n            if (this.buttonsAvatarLeft === undefined) {\n                this.buttonsAvatarLeft = [];\n            }\n            this.buttonsAvatarLeft[num] = left;\n\n            if (this.buttonsAvatarSrc === undefined) {\n                this.buttonsAvatarSrc = [];\n            }\n            this.buttonsAvatarSrc[num] = \"\";\n\n            if (this.nicknames === undefined) {\n                this.nicknames = [];\n            }\n            this.nicknames[num] = \"\";\n\n            if (this.buttonsAvatar === undefined) {\n                this.buttonsAvatar = [];\n            }\n            this.buttonsAvatar[num] = this.createImageButton(this.body, 'mmogame-avatar' + num,\n                left, this.avatarTop, this.iconSize, this.iconSize);\n            if (num === 2 && this.avatarTop !== undefined) {\n                this.buttonsAvatar[num].title = this.getStringM('js_opponent');\n            }\n\n            if (this.divNicknames === undefined) {\n                this.divNicknames = [];\n            }\n            if (this.divNicknamesWidth === undefined) {\n                this.divNicknamesWidth = [];\n            }\n            if (this.divNicknamesHeight === undefined) {\n                this.divNicknamesHeight = [];\n            }\n            this.divNicknamesWidth[num] = widthNickName;\n            this.divNicknamesHeight[num] = heightNickName;\n\n            this.divNicknames[num] = this.createDiv(this.body, 'mmogame-gate-nickname',\n                left, this.padding, widthNickName, heightNickName);\n        }\n\n\n        createDivMessageStart(message) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaTop;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n            let height1 = height / 8;\n\n            this.createDivMessageDo('mmogame-message-start', left, top, width, height, message, height1);\n\n            top += (height1 - this.divMessage.scrollHeight) / 2;\n            this.divMessage.style.top = top + \"px\";\n\n            if (this.divMessageHelp === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"left\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.color = this.getContrastingColor(this.colorDefinition);\n                let top = this.iconSize + 3 * this.padding + height1;\n                div.style.top = (top + this.padding) + \"px\";\n                div.style.height = (height - height1) + \"px\";\n                this.divMessageHelp = div;\n                this.body.appendChild(this.divMessageHelp);\n\n                this.showHelpScreen(div, (width - 2 * this.padding), (height - height1));\n            }\n        }\n\n\n        /**\n         * Creates a score display element.\n         * @param {string} classnames - The list of classes.\n         * @param {number} left - The left position in pixels.\n         * @param {number} top - The top position in pixels.\n         * @param {number} width - The width of the score element in pixels.\n         * @param {number} height - The height of the score element in pixels.\n         * @param {number} num - Identifier for the score element.\n         */\n        createAddScore(classnames, left, top, width, height, num) {\n            console.log(\"createAddSCore num=\" + num);\n            const div = this.createDiv(this.body, classnames, left, top, width, height);\n            div.style.textAlign = \"center\";\n            div.style.color = this.getContrastingColor(this.colorScore);\n            div.title = this.getStringM('js_grade_last_question');\n            if (num === 1) {\n                this.labelAddScore = div;\n            } else {\n                this.labelAddScore2 = div;\n            }\n        }\n\n        updateButtonsAvatar(num, avatar, nickname) {\n            if (avatar === undefined) {\n                avatar = \"\";\n            }\n            if (nickname === undefined) {\n                nickname = \"\";\n            }\n\n            if (avatar === \"\" && nickname === \"\") {\n                this.buttonsAvatar[num].style.visibility = 'hidden';\n                this.divNicknames[num].style.visibility = 'hidden';\n                return;\n            }\n\n            if (this.nicknames[num] !== nickname || nickname === \"\") {\n                this.nicknames[num] = nickname;\n                let s = nickname;\n\n                if (nickname.length === 0) {\n                    s = avatar;\n                    let pos = s.lastIndexOf(\"/\");\n                    if (pos >= 0) {\n                        s = s.slice(pos + 1);\n                    }\n                    pos = s.lastIndexOf(\".\");\n                    if (pos >= 0) {\n                        s = s.slice(0, pos);\n                    }\n                    const filenameWithExt = avatar.split('/').pop(); // Extract the file name with its extension\n                    s = filenameWithExt.split('.').slice(0, -1).join('.'); // Remove the extension from the file name\n                }\n                s = this.repairNickname(s);\n                if (this.divNicknames[num] !== undefined && this.divNicknames[num].innerHTML !== s) {\n                    this.divNicknames[num].innerHTML = s;\n                    this.divNicknames[num].style.textAlign = \"center\";\n                    this.divNicknames[num].style.color = this.getContrastingColor(this.colorsBackground);\n                    this.autoResizeText(this.divNicknames[num], this.divNicknamesWidth[num], this.divNicknamesHeight[num], true,\n                        0, 0, 1);\n                }\n            }\n\n            if (avatar !== this.buttonsAvatarSrc[num]) {\n                this.updateImageButton(this.buttonsAvatar[num], avatar !== \"\" ? \"assets/avatars/\" + avatar : \"\");\n                this.buttonsAvatarSrc[num] = avatar;\n            }\n\n            this.buttonsAvatar[num].alt = this.divNicknames[num].innerHTML;\n\n            this.buttonsAvatar[num].style.visibility = 'visible';\n            this.divNicknames[num].style.visibility = 'visible';\n        }\n\n        callGetAttempt(extraparams) {\n            let instance = this;\n            require(['core/ajax'], function(Ajax) {\n                let params = {\n                    mmogameid: instance.mmogameid,\n                    kinduser: instance.kinduser,\n                    user: instance.user,\n                    nickname: null,\n                    colorpaletteid: null,\n                    avatarid: null,\n                };\n                if (extraparams !== undefined) {\n                    params = {...params, ...extraparams};\n                }\n                // Calling the service through the Moodle AJAX API\n                let getAttempt = Ajax.call([{\n                    methodname: 'mmogametype_quiz_get_attempt',\n                    args: params,\n                }]);\n\n                // Handling the response\n                getAttempt[0].done(function(response) {\n                    if (extraparams !== undefined && extraparams.colorpaletteid !== undefined) {\n                        instance.openGame();\n                        instance.colors = undefined;\n                    }\n                    instance.processGetAttempt(JSON.parse(response));\n                }).fail(function(error) {\n                    instance.createDivMessage('mmogame-error', error.message);\n                    return error;\n                });\n            });\n        }\n\n        /**\n         * Displays an error message.\n         * @param {string} name\n         * @param {object} error - The error message to display.\n         */\n        showError(name, error= null) {\n            console.log( name);\n            if( error !== undefined) {\n                console.log(error);\n            }\n            if (error !== null) {\n                this.createDivMessage('mmogame-error', error.message);\n            }\n        }\n};\n});"],"names":["define","MmoGame","constructor","maxWidth","bottom2","btnSubmit","this","createImageButton","area","iconSize","style","visibility","instance","addEventListener","undefined","edtCode","user","value","gatePlayGame","edtNickname","paletteid","avatarid","getMuteFile","kindSound","playAudio","audioElement","networkState","play","createButtonSound","left","top","buttonSound","createButton","body","getStringM","onClickSound","button","src","setOptions","gateOpen","mmogameid","pin","kinduser","url","minFontSize","maxFontSize","gateComputeSizes","areaTop","padding","areaWidth","Math","round","window","innerWidth","areaHeight","innerHeight","getOptions","then","options","hasOwnProperty","kindsound","nickname","userGUID","length","gateCreateScreen","catch","error","showError","save","uuid4","callGetAttempt","colorpaletteid","console","log","message","vertical","createArea","gateCreateScreenVertical","gateCreateScreenHorizontal","size","maxHeight","labels","fontSize","findbest","gateComputeLabelSize","heightCode","heightColors","floor","heightAvatars","gridWidthColors","gridWidthAvatars","gridHeightColors","newHeight","newWidth","rest","bottom","gridHeightAvatars","gateCreateLabelEditVertical","edt","gateUpdateSubmit","gateCreateScreenPalette","gateSendGetColorsAvatars","gateCreateButtonSubmit","sName","sizeLabel","gateCreateLabelEditHorizontal","label1","document","createElement","position","color","getContrastingColor","colorBackground","innerHTML","font","width","whiteSpace","appendChild","btn","scrollWidth","addEventListenerRefresh","label","elements","getElementsByClassName","parentNode","removeChild","aLabel","i","height","scrollHeight","labelWidth","title","classnamesLabel","classnamesEdit","createLabel","gateCreateInput","gateShowAvatars","countX","avatarids","avatars","avatar","count","leftOriginal","w","avatarImagePath","createCenterImageButton","classList","add","id","gateUpdateAvatar","leftColors","topColors","leftAvatars","topAvatars","updateColors","updateAvatars","countXcolors","countYcolors","countXavatars","countYavatars","require","Ajax","params","colorpalettes","call","methodname","args","done","colorpaletteids","gateShowColorPalettes","fail","countY","canvasColor","canvasSize","parsedPalettes","map","palette","split","parseInt","iy","ix","canvas","cursor","showColorPalette","gateUpdateColorPalette","borderStyle","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","hasCode","Number","hasValidAvatar","hasValidPalette","hasValidNickname","isVisible","computeSizes","ret","max","leftEdit","classnames","div","type","autofocus","createDOMElement","parent","styles","attributes","removeDivMessage","createDiv","createModal","content","modal","transform","backgroundColor","boxShadow","zIndex","fontWeight","marginBottom","innerText","closeButton","marginTop","display","marginLeft","marginRight","createDivMessage","divMessageHelp","getCopyrightHeight","createDivMessageDo","divMessage","createButtonsAvatar","num","widthNickName","heightNickName","buttonAvatarHeight","buttonsAvatarLeft","buttonsAvatarSrc","nicknames","buttonsAvatar","avatarTop","divNicknames","divNicknamesWidth","divNicknamesHeight","createDivMessageStart","height1","textAlign","paddingLeft","paddingRight","colorDefinition","showHelpScreen","createAddScore","colorScore","labelAddScore","labelAddScore2","updateButtonsAvatar","s","pos","lastIndexOf","slice","pop","join","repairNickname","colorsBackground","autoResizeText","updateImageButton","alt","extraparams","response","openGame","colors","processGetAttempt","JSON","parse","name"],"mappings":"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"}