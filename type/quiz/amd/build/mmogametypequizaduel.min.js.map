{"version":3,"file":"mmogametypequizaduel.min.js","sources":["../src/mmogametypequizaduel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n        return class MmoGameTypeQuizAduel extends MmoGameTypeQuiz {\n    constructor() {\n        super();\n        this.cIcons = 8;\n        this.hasBasBottom = false;\n        if (window.innerWidth < window.innerHeight) {\n            this.cIcons -= 3;\n            this.hasBasBottom = true;\n        } else {\n             this.cIcons += (this.hasHelp() ? 1 : 0);\n        }\n        this.isWaitOponent = false;\n        this.autosubmit = true;\n        this.type = 'aduel';\n    }\n\n    createIconBar() {\n        let i = 0;\n\n        this.clearBodyChildren();\n\n        let copyrightHeight = 0;\n        this.nickNameHeight = Math.round(this.iconSize / 3);\n\n        this.areaTop = 2 * this.padding + this.iconSize + this.nickNameHeight;\n        this.areaLeft = this.padding;\n        this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n        this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight);\n        if (this.hasBasBottom) {\n            this.areaHeight -= this.iconSize + 2 * this.padding;\n        }\n\n        this.buttonAvatarLeft = this.padding + i * (this.iconSize + this.padding);\n        this.buttonAvatarHeight = this.iconSize + this.nickNameHeight;\n        this.buttonAvatarTop = this.nickNameHeight + this.iconSize - this.buttonAvatarHeight + this.padding;\n        this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, this.nickNameHeight);\n        this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n        this.createDivScorePercent(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight, 1,\n            true);\n\n        this.createButtonsAvatar(2, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, this.nickNameHeight);\n        this.buttonsAvatar[2].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n        this.createDivScore(Math.round(this.padding + (i++) * (this.iconSize + this.padding)), this.padding + this.nickNameHeight,\n            2);\n        this.buttonScore2.style.visibility = \"hidden\";\n\n        this.createDivTimer(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight,\n            this.iconSize);\n        if (this.hasBasBottom === false) {\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n        } else {\n            this.createButtonSound(this.padding, this.areaTop + this.areaHeight);\n        }\n        let instance = this;\n\n        if (this.hasBasBottom === false) {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + i * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, this.iconSize, this.iconSize, 'assets/cutred.svg');\n        } else {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                    this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                this.iconSize, this.iconSize, 'assets/cutred.svg');\n        }\n        this.buttonHighScore.style.visibility = 'hidden';\n        this.buttonHighScore.addEventListener(\"click\", function() {\n            instance.sendGetHighScore();\n        });\n        this.button5050.addEventListener(\"click\", function() {\n            instance.sendGetAttempt(false, \"tool1\");\n        });\n        this.button5050.title = this.getStringM('js_help_5050');\n\n        let left;\n        if (this.hasBasBottom === false) {\n            left = this.padding + (i++) * (this.iconSize + this.padding);\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                left, this.padding + this.nickNameHeight, this.iconSize,\n                this.iconSize, 'assets/skip.svg');\n        } else {\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaTop + this.areaHeight, this.iconSize, this.iconSize, 'assets/skip.svg');\n        }\n        this.buttonSkip.addEventListener(\"click\", function() {\n            instance.sendAnswer(\"tool2\");\n        });\n        this.buttonSkip.title = this.getStringT('js_help_skip');\n\n        if (this.hasBasBottom === false) {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                left, this.padding + this.nickNameHeight, this.iconSize,\n                this.iconSize, 'assets/wizard.svg');\n        } else {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaTop + this.areaHeight, this.iconSize, this.iconSize, 'assets/wizard.svg');\n        }\n        this.buttonWizard.addEventListener(\"click\", function() {\n            instance.sendGetAttempt(false, \"tool3\");\n        });\n        this.buttonWizard.style.visibility = 'hidden';\n        this.buttonWizard.title = this.getStringT('js_wizarg');\n\n        if (this.hasHelp()) {\n            if (this.hasBasBottom === false) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n            } else {\n                this.createButtonHelp(this.padding + 3 * (this.iconSize + this.padding), this.areaTop + this.areaHeight);\n            }\n            this.buttonHelp.addEventListener(\"click\", function() {\n                instance.onClickHelp(instance.buttonHelp);\n             });\n        }\n\n        this.createDivColor(this.body, 0, window.innerHeight - copyrightHeight - 1, window.innerWidth - 1, copyrightHeight,\n            this.getColorGray(this.colorScore2));\n        this.vertical = this.areaHeight > this.areaWidth;\n    }\n            /**\n             * Creates a percentage-based score display with labels for score, rank, and additional information.\n             *\n             * @param {number} left - The horizontal position (in pixels) of the score container.\n             * @param {number} top - The vertical position (in pixels) of the score container.\n             * @param {number} num - Identifier for score type (1 for primary score, 2 for secondary/opponent score).\n             */\n            createDivScore(left, top, num) {\n                let button = this.createDiv(this.area, 'mmogame-score', left, top, this.iconSize, this.iconSize);\n\n                button.style.borderRadius = this.iconSize + \"px\";\n                button.style.border = \"0px solid \" + this.getColorHex(0xFFFFFF);\n                button.style.boxShadow = \"inset 0 0 0.125em rgba(255, 255, 255, 0.75)\";\n                button.title = this.getStringM('js_grade');\n                button.alt = this.getStringM('js_grade');\n                if (num === 1) {\n                    button.style.background = this.getColorHex(this.colorScore);\n                    button.style.color = this.getContrastingColor(this.colorScore);\n                } else {\n                    this.buttonScore2 = button;\n                    button.style.background = this.getColorHex(this.colorScore2);\n                    button.style.color = this.getContrastingColor(this.colorScore2);\n                }\n\n                this.body.appendChild(button);\n\n                button.innerHTML = '100 %';\n                this.autoResizeText(button, this.iconSize, this.iconSize, false, 0, 0, 1);\n                button.innerHTML = '';\n\n                let div = this.createDiv(this.body, \"mmogame-score\", left,\n                    top + this.iconSize / 4, this.iconSize, this.iconSize / 2);\n                div.style.lineHeight = (this.iconSize / 2) + \"px\";\n                div.style.textAlign = \"center\";\n                div.style.color = this.getContrastingColor(this.colorScore);\n                div.title = this.getStringM('js_grade');\n                if (num === 1) {\n                    this.labelScore = div;\n                } else {\n                    this.labelScore2 = div;\n                }\n\n                let h = this.iconSize / 3;\n                div = this.createDiv(this.body, 'mmogame-score', left, top, this.iconSize, h);\n                div.style.textAlign = \"center\";\n                div.style.color = this.getContrastingColor(this.colorScore);\n                button.disabled = true;\n                if (num === 1) {\n                    this.labelScoreRank = div;\n                } else {\n                    this.labelScoreRank2 = div;\n                }\n\n                this.createAddScore('mmogame-addscore', left, top + this.iconSize - h, this.iconSize, h, num);\n            }\n\n    updateButtonTool(btn, tool) {\n        btn.style.visibility = tool !== undefined && tool !== 0 ? \"hidden\" : \"visible\";\n    }\n\n    processGetAttempt(json) {\n        if (this.buttonHighScore !== undefined) {\n            this.buttonHighScore.style.visibility = 'hidden';\n        }\n        this.computeDifClock(json.time, json.timestart, json.timeclose);\n        this.timefastjson = json.timefastjson;\n        this.fastjson = json.fastjson;\n\n        if (json.name !== undefined) {\n            window.document.title = json.name;\n        }\n\n        if (json.helpurl !== undefined) {\n            this.helpUrl = json.helpurl;\n        }\n\n        this.correct = undefined;\n        if (json.state === 0) {\n            json.qtype = '';\n            super.processGetAttempt(json);\n            this.showScore(json);\n            this.onServerGetAttemptHideButtons();\n            this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n            return;\n        }\n\n        this.state = parseInt(json.state);\n\n        // Need for a change on colors.\n        if (this.savedColors === undefined || this.savedColors !== json.colors) {\n            this.savedColors = json.colors;\n            this.colors = undefined;\n        }\n\n        if (this.colors === undefined) {\n            this.setColorsString(json.colors);\n            this.createIconBar();\n        }\n\n        this.updateButtonsAvatar(1, json.avatar, json.nickname);\n        this.updateButtonsAvatar(2, json.aduelAvatar, json.aduelNickname);\n\n        this.updateButtonTool(this.button5050, json.tool1numattempt);\n        if (json.tool3 !== undefined) {\n            json.tool2numattempt = -1;\n        } else {\n            json.tool3numattempt = -1;\n        }\n        this.updateButtonTool(this.buttonSkip, json.tool2numattempt);\n        this.updateButtonTool(this.buttonWizard, json.tool3numattempt);\n\n        this.attempt = json.attempt;\n        this.aduelPlayer = json.aduelPlayer;\n        this.aduelScore = json.aduelScore;\n        this.aduelRank = json.aduelRank;\n\n        if (json.errorcode !== undefined && json.errorcode === 'aduel_no_rivals' || json.attempt === 0) {\n            if (json.param === undefined) {\n                this.waitOponent();\n            }\n            this.hideTools();\n            this.showScore(json);\n            this.onServerGetAttemptRetry();\n            return;\n        }\n\n        this.isWaitOponent = false;\n\n        this.qtype = json.qtype;\n        if (json.qtype === 'multichoice') {\n            this.answers = [];\n            this.answersID = json.answerids;\n\n            json.answers.forEach((answer, index) => {\n                this.answers[index] = this.repairP(answer);\n            });\n        }\n        this.answer = json.answer !== undefined ? json.answer : null;\n        this.definition = this.repairP(json.definition);\n        if (json.aduelAttempt !== undefined) {\n            this.definition = json.aduelAttempt + \". \" + this.definition;\n        }\n        this.single = json.single;\n        this.autosave = json.autosave !== 0;\n        this.errorcode = json.errorcode;\n\n        // A this.readJsonFiles(json);\n        this.createScreen(json, false);\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n\n        this.updateLabelTimer();\n        this.sendFastJSON();\n    }\n\n/*\n    onServerGetAttemptRetry() {\n        let instance = this;\n        this.timeout = setTimeout(function() {\n            instance.sendGetAttempt(true);\n        }, this.timeoutMSEC);\n    }\n*/\n\n\n    onServerGetAttemptHideButtons() {\n        this.button5050.style.visibility = 'hidden';\n        this.buttonSkip.style.visibility = 'hidden';\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n        this.buttonsAvatar[2].style.visibility = 'hidden';\n    }\n\n    onTimeout() {\n        this.labelTimer.innerHTML = '';\n        this.disableInput();\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.display = 'none';\n        }\n\n        this.answer = '';\n        this.answerid = 0;\n        this.callSetAnswer();\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        let instance = this;\n        btn.addEventListener(\"click\", function() {\n            instance.sendGetAttempt(false);\n            instance.area.removeChild(btn);\n        });\n    }\n\n    waitOpponent() {\n        if (this.isWaitOponent) {\n            return;\n        }\n        this.updateButtonsAvatar(2, \"\", \"\");\n        this.createDivMessage('mmomgame-quiz-aduel-wait-opponent',\n            this.getStringT('js_aduel_wait_opponent'));\n        if (this.labelTimer !== undefined) {\n            this.labelTimer.innerHTML = \"\";\n        }\n    }\n\n    hideTools() {\n        this.updateButtonTool(this.button5050, -1);\n        this.updateButtonTool(this.buttonSkip, -1);\n        this.updateButtonTool(this.buttonWizard, -1);\n    }\n\n    processSetAnswer(json) {\n        if (json.submit === 0) {\n            return;\n        }\n\n        this.correct = json.correct;\n\n        if (json.correct !== undefined) {\n            if (this.qtype === \"multichoice\") {\n                this.onServerAnswerMultichoice(json);\n            }\n        }\n\n        this.disableInput();\n        this.buttonHighScore.style.visibility = 'visible';\n\n        this.isWaitOponent = false;\n        if (this.aItemAnswer !== undefined && json.correct !== undefined) {\n            for (let i = 0; i < this.aItemAnswer.length; i++) {\n                this.aItemAnswer[i].classList.add(\"disabled\");\n            }\n        }\n\n        if (this.btnSubmit !== undefined) {\n            this.body.removeChild(this.btnSubmit);\n            this.btnSubmit = undefined;\n        }\n\n        this.showCorrectAnswer(json);\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        let instance = this;\n        btn.addEventListener(\"click\", function() {\n            instance.callGetAttempt();\n            instance.area.removeChild(btn);\n        });\n\n        this.showScore(json);\n\n        this.timeclose = 0;\n\n        if (this.aduelPlayer === 1) {\n            if (json.attempt === 0) {\n                this.timeclose = 0;\n                this.waitOpponent();\n            }\n\n            this.showScore(json);\n        }\n\n        if (this.button5050 !== undefined) {\n            this.button5050.style.visibility = 'hidden';\n            this.buttonSkip.style.visibility = 'hidden';\n        }\n    }\n\n   callSetAnswer() {\n        if (this.correct === undefined) {\n            super.callSetAnswer();\n        }\n    }\n\n    onServerAnswerMultichoice(json) {\n        let foundCorrect = false;\n\n        let aduelAnswers = json.aduelPlayer === 2 && json.aduel_useranswer !== null ? json.aduel_useranswer.split(\",\") : '';\n        let aCorrect = json.correct.split(\",\");\n        for (let i = 0; i < this.answersID.length; i++) {\n            if (this.answersID[i] === '') {\n                continue;\n            }\n\n            let label = this.aItemLabel[i];\n\n            let iscorrect1, iscorrect2;\n\n            let iscorrect = aCorrect.includes(this.answersID[i]);\n\n            if (this.aItemAnswer[i].classList.contains(\"checked\")) {\n                iscorrect1 = aCorrect.includes(this.answersID[i]);\n            }\n            if (iscorrect1) {\n                foundCorrect = true;\n            }\n\n            if (aduelAnswers.includes(this.answersID[i])) {\n                iscorrect2 = aCorrect.includes(this.answersID[i]);\n            }\n\n            if (iscorrect === false && iscorrect1 === undefined && iscorrect2 === undefined) {\n                continue;\n            }\n\n            let width = this.labelWidth;\n            let height = this.aItemLabel[i].scrollHeight;\n\n            let move = (iscorrect2 !== undefined ? 2 : 1) * this.radioSize;\n            if (iscorrect1 === undefined && iscorrect2 === undefined) {\n                move = 0;\n            }\n            width -= move;\n\n            if (move !== 0) {\n                label.style.left = (parseInt(label.style.left) + move) + \"px\";\n            }\n            this.aItemLabel[i].style.width = width + \"px\";\n            this.autoResizeText(this.aItemLabel[i], width, height, true, this.minFontSize, this.maxFontSize, 0.5);\n\n            this.onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2);\n        }\n\n        this.playAudio(foundCorrect ? this.audioYes : this.audioNo);\n    }\n\n    onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2, iscorrect) {\n        if (iscorrect) {\n            this.aItemLabel[i].innerHTML = '<b><u>' + this.aItemLabel[i].innerHTML + '</b></u>';\n        }\n\n        if (iscorrect1 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-quiz-aduel-correct-answer',\n                this.aItemCorrectX[i], t, this.radioSize, this.radioSize);\n            div.title = iscorrect1 ? this.getStringT('js_correct_answer') : this.getStringT('js_wrong_answer');\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect1, this.colorScore, this.colorScore);\n        }\n\n        if (iscorrect2 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, this.aItemCorrectX[i] + this.radioSize, t, this.radioSize, this.radioSize);\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect2, this.colorScore2, this.colorScore2);\n            div.title = iscorrect2 ? this.getStringM('js_correct_answer') : this.getStringM('js_wrong_answer');\n        }\n    }\n\n    showCorrectAnswer({aduel_iscorrect, iscorrect, tool2}) {\n        this.timeclose = 0;\n        this.updateLabelTimer();\n\n        this.strip = this.createDiv(this.area, 'mmogame-quiz-aduel-strip',\n            this.stripLeft, this.nextTop, this.stripWidth, this.stripHeight);\n\n        if (tool2 === undefined || this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player1',\n                this.stripLeft, this.nextTop, this.buttonsAvatar[1].width,\n            this.buttonsAvatar[1].height, this.buttonsAvatar[1].src);\n        }\n\n        if (tool2 === undefined && this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player2',\n                this.stripLeft + this.iconSize, this.nextTop, this.buttonsAvatar[2].width,\n                this.buttonsAvatar[2].height, this.buttonsAvatar[2].src);\n        }\n\n        this.strip.style.top = this.nextTop + \"px\";\n        let s = this.getSVGcorrect(this.iconSize, iscorrect !== 0, this.colorScore, this.colorScore);\n        if (tool2 !== undefined && this.aduelPlayer === 1) {\n            s = '';\n        }\n        if (this.aduelPlayer === 2 && tool2 === undefined) {\n            s += this.getSVGcorrect(this.iconSize, aduel_iscorrect !== 0, this.colorScore2, this.colorScore2);\n        }\n        this.strip.innerHTML = s;\n\n        this.strip.style.zIndex = '1';\n    }\n\n    showScore(json) {\n        let rankc = json.completedrank;\n        if (json.rank !== undefined && rankc !== undefined) {\n            if (parseInt(json.rank) < parseInt(rankc)) {\n                json.completedrank = '';\n                json.rank = '# ' + json.rank;\n            } else {\n                json.rank = '';\n                json.completedrank = '# ' + rankc;\n            }\n        }\n\n        if (json.aduelPlayer === 2) {\n            super.showScore(json);\n        } else {\n            let s = json.sumscore;\n            let sumscore = this.labelScore.innerHTML;\n            super.showScore(json);\n            json.sumscore = s;\n            s = sumscore === undefined ? '' : '<b>' + sumscore + '</b>';\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0, 1);\n            }\n        }\n\n        if (json.aduelPlayer === 1 || json.aduelPlayer === undefined) {\n            this.labelScore2.style.visibility = \"hidden\";\n            this.labelScoreRank2.style.visibility = \"hidden\";\n            this.buttonScore2.style.visibility = \"hidden\";\n            this.labelAddScore2.style.visibility = \"hidden\";\n        } else {\n            this.labelScore2.style.visibility = \"visible\";\n            this.labelScoreRank2.style.visibility = \"visible\";\n            this.buttonScore2.style.visibility = \"visible\";\n            this.labelAddScore2.style.visibility = \"visible\";\n\n            let rank = json.aduelRank;\n            let score = json.aduelScore;\n\n            if (json.aduelRank !== undefined && json.aduelCompletedrank !== undefined) {\n                let rank1 = parseInt(json.aduelRank);\n                let rank2 = parseInt(json.aduelCompletedrank);\n                if (rank1 <= rank2) {\n                    rank = '#' + rank1;\n                    score = json.aduelScore;\n                    this.labelScore2.title = this.getStringM('js_grade');\n                    this.labelScoreRank2.title = this.getStringM('js_position_grade');\n                } else {\n                    rank = '#' + rank2;\n                    score = Math.round(100 * json.aduelCompletedrank) + \"%\";\n                    this.labelScore2.title = this.getStringM('js_percent_opponent');\n                    this.labelScoreRank2.title = this.getStringM('js_position_percent');\n                }\n            }\n            let s = '<b>' + score + '</b>';\n            if (this.labelScore2.innerHTML !== s) {\n                this.labelScore2.innerHTML = s;\n                this.autoResizeText(this.labelScore2, this.iconSize - 2 * this.padding, this.iconSize / 2, false, 0, 0, 1);\n            }\n            this.labelScoreRank2.innerHTML = rank;\n            this.labelScoreRank2.style.lineHeight = (this.iconSize / 3) + \"px\";\n            this.autoResizeText(this.labelScoreRank2, 0.5 * this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n\n            this.labelAddScore2.innerHTML = json.aduelAddscore === undefined ? '' : json.aduelAddscore;\n            this.autoResizeText(this.labelAddScore2, this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n        }\n    }\n\n    onServerFastJson(response) {\n        if (response === '') {\n            this.sendFastJSON();\n            return;\n        }\n\n        let a = response.split('-'); // Are state,timefastjson.\n        let newstate = a.length > 0 ? parseInt(a[0]) : 0;\n        let newTimeFastJSON = a.length > 1 ? a[1] : 0;\n\n        if (this.timefastjson === null) {\n            this.timefastjson = 0;\n        }\n\n        if (newstate !== this.state || newTimeFastJSON !== this.timefastjson) {\n            this.callGetAttempt();\n            return;\n        }\n\n        this.sendFastJSON();\n    }\n\n    sendGetHighScore() {\n        let params = {\n            mmogameid: this.mmogameid,\n            kinduser: this.kinduser,\n            user: this.user,\n            count: 10,\n        };\n\n        let instance = this;\n        require(['core/ajax'], function(Ajax) {\n            // Calling the service through the Moodle AJAX API\n            let getHighScore = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_highscore',\n                args: params\n            }]);\n\n            // Handling the response\n            getHighScore[0].done(function(response) {\n                instance.createScreenHighScore(JSON.parse(response));\n            }).fail(function(error) {\n                return error;\n            });\n        });\n    }\n\n    createScreenHighScore(json) {\n        if (this.highScore !== undefined) {\n            this.body.removeChild(this.highScore);\n            this.highScore = undefined;\n            this.strip.style.visibility = 'visible';\n            this.strip.style.zIndex = '1';\n            return;\n        }\n\n        this.removeDivMessage();\n\n        if (this.vertical) {\n            this.createScreenVerticalHighScore(json);\n        } else {\n            this.createScreenHorizontalHighScore(json);\n        }\n    }\n\n    createScreenHorizontalHighScore(json) {\n        this.createScreenVerticalHighScore(json);\n    }\n\n    createScreenVerticalHighScore(json) {\n        if (json.count === 0) {\n            return;\n        }\n\n        if (this.strip !== undefined) {\n            this.strip.style.visibility = 'hidden';\n        }\n\n        this.highScore = this.createDivColor(this.body, 'mmogame-quiz-aduel-highscore-background',\n            this.areaLeft, this.areaTop,\n            this.areaWidth - this.padding, this.areaHeight - this.padding,\n            this.getColorHex(this.colorBackground));\n\n        let canvas = document.createElement('canvas');\n        canvas.style.left = '0px';\n        canvas.style.top = \"0px\";\n        canvas.width = this.areaWidth;\n        canvas.height = this.areaHeight;\n        canvas.style.zIndex = 8;\n        canvas.style.position = \"absolute\";\n\n        this.highScore.appendChild(canvas);\n\n        let ctx = canvas.getContext(\"2d\");\n        let fontSize = this.minFontSize;\n        ctx.font = fontSize + \"px sans-serif\";\n\n        this.drawHighScore1(json, ctx, fontSize);\n    }\n\n    drawHighScore1(json, ctx, fontSize) {\n        ctx.textAlign = \"center\";\n        let text1 = ctx.measureText(this.getStringT('js_ranking_order'));\n        let width1 = text1.width;\n        let text = ctx.measureText(this.getStringM('js_grade'));\n        let width2 = text.width;\n\n        let col1 = 0;\n        let col2 = col1 + width1 + this.padding;\n        let col3 = col2 + width2 + this.padding;\n        let row = Math.round(3 * fontSize * 1.2);\n\n        let results = JSON.parse(json.results);\n\n        ctx.fillStyle = this.getContrastingColor(this.colorBackground);\n\n        let y = Math.round(fontSize * 1.2);\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.getStringT('js_ranking_order'), col1 + width1 / 2, y);\n\n        ctx.fillText(this.getStringM('js_grade'), col2 + width2 / 2, y);\n\n        ctx.textAlign = \"left\";\n        ctx.fillText(this.getStringM('js_name'), col3, y);\n\n        results.forEach(player => {\n            y += row / 2 + this.padding;\n\n            ctx.textAlign = \"center\";\n            ctx.fillText(player.rank, col1 + width1 / 2, y);\n\n            ctx.fillText(player.score, col2 + width2 / 2, y);\n\n            ctx.textAlign = \"left\";\n            ctx.fillText(player.name, col3 + row - this.padding, y);\n\n            this.createImage(this.highScore, 'mmogame-quiz-aduel-player-avatars',\n                col3, y - row / 2, row - this.padding, row - this.padding,\n                'assets/avatars/' + player.avatar);\n\n            y += row / 2 - this.padding;\n        });\n    }\n\n    showHelpScreen(div) {\n        div.innerHTML = `\n<div>` + this.getStringT('js_aduel_help') + `</div>\n\n<table border=1>\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/cutred.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_cut') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/skip.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_skip') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/wizard.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_wizard') + \\`</td>\n    </tr>\n\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../assets/aduel/example1.png\" alt=\"\" />\n        </td><center>\n\n        <td>` + this.getStringT('js_aduel_example1') + `</td>\n        <td><center>\n            <img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" />\n        </td>\n\n        <td>\\` + this.getStringT( 'js_aduel_example2') + \\`</td>\n    </tr>\n</table>        \n        `;\n    }\n\n    /**\n     * Creates a timer display.\n     * @param {number} left - Left position in pixels.\n     * @param {number} top - Top position in pixels.\n     * @param {number} size - Timer size.\n     */\n    createDivTimer(left, top, size) {\n        const timerDiv = this.createDiv(this.body, 'mmogame-timer', left, top, size, size);\n        timerDiv.style.textAlign = 'center';\n        timerDiv.style.color = this.getContrastingColor(this.colorBackground);\n\n        timerDiv.innerHTML = '23:59';\n        this.autoResizeText(timerDiv, size, size, false, 0, 0, 1);\n        timerDiv.innerHTML = '';\n        timerDiv.title = this.getStringM('js_question_time');\n\n        this.labelTimer = timerDiv;\n    }\n\n};\n});"],"names":["define","MmoGameTypeQuiz","constructor","cIcons","hasBasBottom","window","innerWidth","innerHeight","this","hasHelp","isWaitOponent","autosubmit","type","createIconBar","i","clearBodyChildren","nickNameHeight","Math","round","iconSize","areaTop","padding","areaLeft","areaWidth","areaHeight","buttonAvatarLeft","buttonAvatarHeight","buttonAvatarTop","createButtonsAvatar","buttonsAvatar","style","top","createDivScorePercent","createDivScore","buttonScore2","visibility","createDivTimer","createButtonSound","left","instance","buttonHighScore","createImageButton","body","button5050","addEventListener","sendGetHighScore","sendGetAttempt","title","getStringM","buttonSkip","sendAnswer","getStringT","buttonWizard","createButtonHelp","buttonHelp","onClickHelp","createDivColor","getColorGray","colorScore2","vertical","num","button","createDiv","area","borderRadius","border","getColorHex","boxShadow","alt","background","colorScore","color","getContrastingColor","appendChild","innerHTML","autoResizeText","div","lineHeight","textAlign","labelScore","labelScore2","h","disabled","labelScoreRank","labelScoreRank2","createAddScore","updateButtonTool","btn","tool","undefined","processGetAttempt","json","computeDifClock","time","timestart","timeclose","timefastjson","fastjson","name","document","helpurl","helpUrl","correct","state","qtype","showScore","onServerGetAttemptHideButtons","createDivMessageStart","parseInt","savedColors","colors","setColorsString","updateButtonsAvatar","avatar","nickname","aduelAvatar","aduelNickname","tool1numattempt","tool3","tool2numattempt","tool3numattempt","attempt","aduelPlayer","aduelScore","aduelRank","errorcode","param","waitOponent","hideTools","onServerGetAttemptRetry","answers","answersID","answerids","forEach","answer","index","repairP","definition","aduelAttempt","single","autosave","createScreen","btnSubmit","updateLabelTimer","sendFastJSON","onTimeout","labelTimer","disableInput","display","answerid","callSetAnswer","super","nextLeft","nextTop","removeChild","waitOpponent","createDivMessage","processSetAnswer","submit","onServerAnswerMultichoice","aItemAnswer","length","classList","add","showCorrectAnswer","callGetAttempt","foundCorrect","aduelAnswers","aduel_useranswer","split","aCorrect","iscorrect1","iscorrect2","label","aItemLabel","iscorrect","includes","contains","width","labelWidth","height","scrollHeight","move","radioSize","minFontSize","maxFontSize","onServerAnswerMultichoiceShowCorrect","playAudio","audioYes","audioNo","t","aItemCorrectX","getSVGcorrect","aduel_iscorrect","tool2","strip","stripLeft","stripWidth","stripHeight","createImage","src","s","zIndex","rankc","completedrank","rank","sumscore","labelAddScore2","score","aduelCompletedrank","rank1","rank2","aduelAddscore","onServerFastJson","response","a","newstate","newTimeFastJSON","params","mmogameid","kinduser","user","count","require","Ajax","call","methodname","args","done","createScreenHighScore","JSON","parse","fail","error","highScore","removeDivMessage","createScreenVerticalHighScore","createScreenHorizontalHighScore","colorBackground","canvas","createElement","position","ctx","getContext","fontSize","font","drawHighScore1","width1","measureText","width2","col2","col3","row","results","fillStyle","y","fillText","player","showHelpScreen","size","timerDiv"],"mappings":"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"}