{"version":3,"file":"mmogametypequizsplit.min.js","sources":["../src/mmogametypequizsplit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mod_mmogame/mmogamesplit'], function(MmoGameSplit) {\n    return class MmoGameQuizSplit extends MmoGameSplit {\n\n        splits;\n        lastUpdateTime;\n        durationAnination = 500;\n        timeBeforeShowNextButtonCorrect = 500;\n        timeBeforeShowNextButtonError = 3000;\n\n        gateOpen(mmogameid, pin, kinduser, user, modelparams) {\n            while (this.body.firstChild) {\n                this.body.removeChild(this.body.firstChild);\n            }\n\n            let splitx = 1;\n            let splity = 1;\n            let isaduel = 0;\n\n            if (modelparams !== null) {\n                const params = JSON.parse(modelparams);\n                if (params.splitx !== undefined && params.splitx > 1) {\n                    splitx = params.splitx;\n                }\n                if (params.splity !== undefined && params.splity > 1) {\n                    splity = params.splity;\n                }\n                if (params.isaduel !== undefined && params.isaduel > 1) {\n                    isaduel = params.isaduel;\n                }\n            }\n            this.countX = splitx;\n            this.countY = splity;\n\n            this.countAll = this.countX * this.countY;\n            this.isaduel = (isaduel !== 0);\n            this.computeSizes(0);\n\n            super.gateOpen(mmogameid, pin, kinduser, user, splitx, splity);\n\n            window.addEventListener(\"gamepadconnected\", () => {\n                requestAnimationFrame(() => this.updateGamepads());\n            });\n        }\n\n        play() {\n            this.screen = 1;\n            this.updateDelay = 500;\n            this.computeSizes(0);\n            this.sendGetAttemptsSplit();\n        }\n\n        sendGetAttemptsSplit() {\n            let avatarids = [];\n            const info = this.info;\n            this.avatarfiles = [];\n            let splits = '';\n            for (let i = 0; i < this.splits.length; i++) {\n                const sp = this.splits[i];\n                avatarids.push(sp.avatarid);\n                this.avatarfiles.push(info.avatars[this.gategetavatar(i, sp.avatarpos)]);\n                if (i > 0) {\n                    splits += \",\";\n                }\n                splits += i;\n            }\n\n            require(['core/ajax'], (Ajax) => {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    splits: splits,\n                    avatarids: avatarids.join(','),\n                    subcommand: '',\n                };\n                // Calling the service through the Moodle AJAX API\n                let getAttemptsSplit = Ajax.call([{\n                    methodname: 'mmogametype_quiz_get_attempts_split',\n                    args: params\n                }]);\n\n                // Handling the response\n                getAttemptsSplit[0].done(({avatars, attempts, attemptqueryids, querydefinitions,\n                                              queryanswerids, numattempts, answertexts, aduels,\n                                              aduelavatars, aduelcorrects, auserids, queryanswerids0, grades}) => {\n                    this.info = {\n                        avatars: avatars,\n                        attempts: attempts,\n                        paletteid: this.paletteid,\n                        attemptqueryids: attemptqueryids,\n                        numattempts: numattempts,\n                        querydefinitions: querydefinitions,\n                        queryanswerids: queryanswerids,\n                        answertexts: answertexts,\n                        aduels: aduels,\n                        aduelavatars: aduelavatars,\n                        aduelcorrects: aduelcorrects,\n                        auserids: auserids,\n                        queryanswerids0: queryanswerids0,\n                        grades: grades,\n                    };\n                    if (this.palette !== undefined) {\n                        this.setColors(this.palette);\n                    }\n                    this.createScreen();\n                }).fail((error) => {\n                    return error;\n                });\n            });\n        }\n\n        createScreen() {\n            this.screen = 1;\n            this.split.width = Math.round(document.documentElement.clientWidth / this.countX) - this.padding;\n            while (this.body.firstChild) {\n                this.body.removeChild(this.body.firstChild);\n            }\n\n            const info = this.info;\n            this.splits = [];\n            for (let i = 0; i < this.countX * this.countY; i++) {\n                if (i >= this.countAll) {\n                    break;\n                }\n                const split = {parent: undefined};\n                split.achecked = [];\n                split.answers = info.answertexts;\n                split.answerids = info.queryanswerids;\n                split.avatarfile = info.avatars[i];\n                split.lastUpdateTime = 0;\n                split.score = 0;\n                split.rank = 0;\n                split.rankcache = '';\n                split.isWaitingContinue = false;\n                split.position = this.splits.length;\n                split.server = [];\n                this.splits.push(split);\n            }\n            for (let i = 0; i < this.countAll; i++) {\n                this.copySplitData(i, i);\n            }\n\n            let i = 0;\n            for (let iY = 0; iY < this.countY; iY++) {\n                for (let iX = 0; iX < this.countX; iX++) {\n                    if (i >= this.countAll) {\n                        break;\n                    }\n                    this.createScreenSplit(i, iX, iY);\n                    const sp = this.splits[i];\n                    this.updateScore(sp);\n                    this.checkShowAduel(sp);\n                    i++;\n                }\n            }\n\n            this.createScreenSave();\n\n            this.createScreenKeyboard();\n        }\n\n        createScreenSplit(split, iX, iY) {\n            const sp = this.splits[split];\n            const left = iX * (this.split.width + this.padding);\n            const top = this.split.offsetY + iY * (this.split.height + this.padding);\n            sp.parent = this.createDOMElement('div', {\n                parent: this.body,\n                classnames: 'mmogame-quiz-split',\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${top}px`,\n                    width: `${this.split.width}px`,\n                    height: `${this.split.height}px`,\n                    overflow: 'hidden',\n                }\n            });\n\n            const ishorizontal = this.split.width >= this.split.height;\n            const showRank = this.isaduel || this.countX * this.countY > 1;\n            sp.player = this.createDivScorePercent(sp.parent, this.iconSize + 2 * this.padding, showRank);\n            this.computeFontScorePercent(sp);\n\n            // Avatar.\n            let leftAvatar = Math.round(this.padding + this.iconSize / 2);\n            sp.avatar = this.createDOMElement('img', {\n                classname: `mmogame-quiz-avatar`,\n                parent: sp.parent,\n                styles: {\n                    position: 'absolute',\n                    left: `${leftAvatar}px`,\n                    top: `${this.padding}px`,\n                    height: `${this.iconSize}px`,\n                    maxWidth: `${this.iconSize}px`,\n                    transform: 'translateX(-50%)',\n                },\n                attributes: {\n                    src: 'assets/avatars/' + sp.avatarfile,\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n\n            // Definition.\n            sp.definitionWidth = ishorizontal ?\n                Math.round(this.split.width / 2 - this.padding / 2) :\n                this.split.width - 2 * this.padding;\n            sp.definitionHeight = ishorizontal ?\n                this.split.height - this.iconSize - 2 * this.padding :\n                Math.round(this.split.height / 2 - 2 * this.padding - this.iconSize - this.iconSize / 2);\n            let definitionTop = this.iconSize + 2 * this.padding;\n            sp.definition = this.createDOMElement('div', {\n                parent: sp.parent,\n                classnames: 'mmogame-quiz-aduelsplit-definition',\n                styles: {\n                    position: 'absolute',\n                    left: `${this.padding}px`,\n                    top: `${definitionTop}px`,\n                    width: `${sp.definitionWidth}px`,\n                    height: `${sp.definitionHeight}px`,\n                    overflow: 'hidden',\n                    background: this.colorDefinition,\n                    color:  this.getContrastingColor(this.colorDefinition),\n                    padding: `${this.padding}px`,\n                }\n            });\n            sp.definition.innerHTML = sp.attempts[0].numattempt + \". \" + sp.attempts[0].definition;\n            sp.definition.addEventListener('click', () => {\n                this.continueAnswer(split);\n            });\n\n            const disabled = false;\n\n            sp.answersLeft = ishorizontal ? sp.definitionWidth + 2 * this.padding : this.padding;\n            sp.answersWidth = this.split.width - sp.answersLeft;\n            sp.answersTop = ishorizontal ?\n                this.iconSize + 2 * this.padding :\n                definitionTop + sp.definitionHeight + 2 * this.padding;\n            sp.answersHeight = this.split.height - sp.answersTop - 2 * this.padding;\n\n            this.createAnswerMultichoice(\n                sp.parent,\n                split,\n                sp,\n                disabled);\n\n            this.computeFontSize(split, sp);\n\n            this.endofgame = false;\n        }\n\n        setColors(colors) {\n            super.setColors(colors);\n\n            this.colorDefinition = this.getColorHex(colors[1]);\n            this.colorScore = colors[2];\n        }\n\n        /**\n         * Creates multiple-choice answer options.\n         *\n         * @param {object} parent\n         * @param {number} split\n         * @param {object} sp\n         * @param {boolean} disabled - Whether the answers are disabled.\n         * @returns {number} The total height used by the answer options.\n         */\n        createAnswerMultichoice(parent, split, sp, disabled) {\n            const attempt = sp.attempts[0];\n            const n = attempt.answers.length;\n            let aItemRadio = Array(n);\n            let aItemLabel = Array(n);\n            let aRandom = this.computeRandom(n);\n            // Iterate over each answer\n            for (let i = 0; i < n; i++) {\n                const ans = aRandom[i];\n                const label = this.createDOMElement('label', {\n                    parent: sp.parent,\n                    classnames: 'mmogame-quiz-aduelsplit-label' + i,\n                    styles: {\n                        position: 'absolute',\n                        top: `${top}px`,\n                        color: this.getContrastingColor(this.colorBackground),\n                        align: \"left\",\n                        marginTop: 0,\n                        marginBottom: 0,\n                        overflow: 'visible',\n                        lineHeight: 'normal',\n                    }\n                });\n                label.innerHTML = (i + 1) + \". \" + attempt.answers[ans];\n                label.htmlFor = \"mmogame_quiz_aduelsplit-input\" + i;\n\n                // Create the checkbox\n                // const checked = achecked.includes(attempt.answerids[ans]);\n                const checked = false;\n                const item = this.createRadiobox(parent, 0, this.colorBackground, this.colorScore,\n                    checked, disabled);\n                item.style.position = \"absolute\";\n                item.style.left = sp.answersLeft + \"px\";\n                item.id = \"mmogame_quiz_input\" + i;\n\n                // Event listeners for interactions\n                item.addEventListener('click', () => {\n                    if (!item.classList.contains(\"disabled\")) {\n                        this.onClickRadio(split, i, this.colorBackground2, this.colorScore);\n                        sp.selectedAnswer = i;\n                        this.selectAnswer(split);\n                        this.updateRanks();\n                    }\n                });\n\n                label.addEventListener('click', () => {\n                    if (this.splits[split].stateShowCorrect !== undefined) {\n                        return; // Disabled.\n                    }\n                    this.onClickRadio(split, i, this.colorBackground2, this.colorScore);\n                    sp.selectedAnswer = i;\n                    this.selectAnswer(split);\n                    this.updateRanks();\n                });\n\n                aItemRadio[i] = item;\n                aItemLabel[i] = label;\n            }\n\n            sp.aItemRadio = aItemRadio;\n            sp.aItemLabel = aItemLabel;\n            sp.selectedAnswer = -1;\n            sp.aRandom = aRandom;\n            sp.timestart = Math.round(Math.floor(Date.now() / 1000));\n\n            return top;\n        }\n\n        computeRandom(n) {\n            // Create an array with numbers from 0 to n\n            let aRandom = Array.from({length: n}, (_, i) => i);\n            // Shuffle the array using Fisher-Yates algorithm\n            for (let i = n - 1; i > 0; i--) {\n                let j = Math.floor(Math.random() * (i + 1)); // Generate a random index\n                [aRandom[i], aRandom[j]] = [aRandom[j], aRandom[i]]; // Swap elements\n            }\n            return aRandom;\n        }\n        computeFontSize(split, sp) {\n            const ishorizontal = this.split.width >= this.split.height;\n            let minSize = 10;\n            const bodyFontSize = parseFloat(getComputedStyle(document.documentElement).fontSize);\n            let maxSize = Math.min(2 * bodyFontSize, this.iconSize / 2, sp.answersWidth);\n            let fontSize = minSize;\n            let precision = 0.1; // Defines the precision level (0.1px)\n            const n = sp.aItemLabel.length;\n            const div = sp.definition;\n            const style = div.style;\n            const maxHeight = ishorizontal ?\n                sp.answersHeight - this.padding - this.iconSize / 2 :\n                sp.answersHeight - this.iconSize - this.padding;\n            style.height = 'auto';\n            // Perform a binary search to find the optimal font size\n            while ((maxSize - minSize) > precision) {\n                fontSize = Math.round(10 * (minSize + maxSize) / 2) / 10; // ComputeAverage\n                style.width = sp.definitionWidth + \"px\";\n                style.fontSize = fontSize + \"px\";\n\n                // Check if the text exceeds the container's boundaries (definition)\n                let isbig = (sp.definition.scrollWidth > sp.definitionWidth || sp.definition.scrollHeight > sp.definitionHeight);\n\n                if (!isbig) {\n                    let sum = 0;\n                    const maxWidth = Math.round(sp.answersWidth - fontSize - 3 * this.padding);\n                    for (let i = 0; i < n; i++) {\n                        const elem = sp.aItemLabel[i];\n                        elem.style.fontSize = `${fontSize}px`;\n                        elem.style.width = (maxWidth - 1) + \"px\";\n                        elem.style.height = 'auto';\n                        if (elem.scrollWidth >= maxWidth) {\n                            isbig = true;\n                            break;\n                        }\n                        sum += parseInt(elem.scrollHeight) + this.padding;\n                    }\n                    if (sum >= maxHeight) {\n                        isbig = true;\n                    }\n                }\n                if (isbig) {\n                    maxSize = fontSize - precision;\n                } else {\n                    minSize = fontSize + precision / 4;\n                }\n            }\n            fontSize = minSize;\n            sp.fontSize = fontSize;\n\n            // Set the final font size with 1 decimal precision\n            sp.definition.style.fontSize = fontSize + \"px\";\n            let top = sp.answersTop;\n\n            const leftLabel = sp.answersLeft + Math.round(fontSize) + this.padding;\n            sp.aItemLabelTop = Array(n);\n            for (let i = 0; i < n; i++) {\n                const elem = sp.aItemLabel[i];\n                elem.style.fontSize = `${fontSize}px`;\n                elem.style.top = `${top}px`;\n                elem.style.left = `${leftLabel}px`;\n                elem.style.width = `${Math.round(sp.answersWidth - fontSize - 2 * this.padding)}px`;\n                elem.style.height = 'auto';\n\n                const radio = sp.aItemRadio[i];\n                radio.style.width = `${Math.round(fontSize)}px`;\n                radio.style.height = `${elem.scrollHeight}px`;\n                radio.style.top = `${top}px`;\n                this.drawRadio(radio, 0xFFFFFF, 0x808080);\n\n                sp.aItemLabelTop[i] = top;\n                top += elem.scrollHeight + this.padding;\n            }\n\n            const space = sp.fontSize;\n            if (top + this.iconSize + this.padding + n * space < this.split.height) {\n                for (let i = 1; i < n; i++) {\n                    const elem = sp.aItemLabel[i];\n                    const top = parseInt(elem.style.top) + i * sp.fontSize;\n                    elem.style.top = `${top}px`;\n                    sp.aItemRadio[i].style.top = `${top}px`;\n                }\n                top += (n - 1) * space;\n            }\n\n            if (ishorizontal) {\n                // If we can make a vertical space.\n                if (sp.definition.scrollHeight < top - sp.answersTop) {\n                    sp.definition.style.height = `${top - sp.answersTop}px`;\n                }\n            } else {\n                style.height = `${sp.definitionHeight}px`;\n            }\n\n            return fontSize;\n        }\n\n        copySplitData(splitInfo, split) {\n            const sp = this.splits[split];\n            const info = this.info;\n            // Copy attempt ids.\n            let queryids = info.attemptqueryids[splitInfo].split(\",\");\n\n            const aduelcorrects = info.aduelcorrects[splitInfo].split(',');\n            const numattempts = info.numattempts[splitInfo].split(\",\");\n            sp.auserid = info.auserids[splitInfo];\n            let attempts = info.attempts[splitInfo].split(\",\");\n            sp.attempts = [];\n            sp.score = info.grades[splitInfo];\n\n            for (let i = 0; i < attempts.length; i++) {\n                let item = {attemptid: attempts[i]};\n                item.queryid = queryids[i];\n\n                item.definition = info.querydefinitions[item.queryid];\n                item.answerids = info.queryanswerids[item.queryid].split(\",\");\n                item.answerids0 = info.queryanswerids0[item.queryid].split(\",\");\n                item.answers = [];\n                item.numattempt = numattempts[i];\n                item.aduelcorrect = (parseInt(aduelcorrects[i]) !== 0);\n                for (let j = 0; j < item.answerids.length; j++) {\n                    item.answers.push(info.answertexts[item.answerids[j]]);\n                }\n\n                sp.attempts.push(item);\n            }\n            sp.aduel = this.info.aduels[splitInfo];\n            sp.aduelavatar = this.info.aduelavatars[splitInfo];\n        }\n\n        moveX(timestamp, split, num, direction, steps) {\n            if (this.screen === 0) {\n                super.moveX(timestamp, split, num, direction, steps);\n            }\n        }\n\n        moveY(timestamp, split, num, direction, steps) {\n            if (this.screen === 0) {\n                super.moveY(timestamp, split, num, direction, steps);\n                return;\n            }\n\n            if (this.splits[split].isWaitingContinue) {\n                return;\n            }\n\n            if (direction < 0) {\n                this.moveAnswer(timestamp, split, -1);\n            } else {\n                this.moveAnswer(timestamp, split, 1);\n            }\n        }\n\n        moveAnswer(timestamp, split, move) {\n            let sp = this.splits[split];\n\n            if (timestamp - sp.lastUpdateTime < this.updateDelay) {\n                return;\n            }\n            if (sp.aItemRadio === undefined) {\n                return;\n            }\n            sp.lastUpdateTime = timestamp;\n\n            sp.selectedAnswer = sp.selectedAnswer === -1 ? 0 :\n                (sp.aItemRadio.length + sp.selectedAnswer + move) % sp.aItemRadio.length;\n\n            this.onClickRadio(split, sp.selectedAnswer, this.colorBackground2, this.colorScore);\n        }\n\n        /**\n         * Handles radio button click events for answers.\n         *\n         * @param {number} split\n         * @param {number} index - The index of the clicked radio button.\n         * @param {string} colorBack - The background color for the radio button.\n         * @param {string} color - The color for the radio button when selected.\n         */\n        onClickRadio(split, index, colorBack, color) {\n            let sp = this.splits[split];\n            if (sp.aItemRadio[index].classList.contains(\"disabled\")) {\n                return;\n            }\n\n            // Update the selected radio button and deselect others\n            sp.aItemRadio.forEach((item, i) => {\n                const isDisabled = item.classList.contains(\"disabled\");\n                if (i === index) {\n                    item.classList.add(\"checked\");\n                    sp.answerid = sp.answerids[i];\n                    sp.aItemLabel[i].style.textDecoration = \"underline\";\n                } else {\n                    item.classList.remove(\"checked\");\n                    sp.aItemLabel[i].style.textDecoration = \"none\";\n                }\n\n                this.drawRadio(item, isDisabled ? colorBack : 0xFFFFFF, color);\n            });\n        }\n\n        // Butttons: 8 = Select, 10 = Joystick pressed.\n        updateGamepad(timestamp, split, gamepad) {\n            super.updateGamepad(timestamp, split, gamepad);\n\n            let change = false;\n            if (gamepad.buttons[4].value || gamepad.buttons[5].value || gamepad.buttons[6].value ||\n                gamepad.buttons[7].value || gamepad.buttons[8].value) {\n                // Button select or fire is pressed (means continue).\n                let sp = this.splits[split];\n\n                if (sp.isWaitingContinue && (sp.buttonNext !== undefined)) {\n                    this.continueAnswer(split);\n                }\n            } else if (gamepad.buttons[10].value) { // Button joysticpress is pressed.\n                if (this.selectAnswer(split, this.splits[split].selectedAnswer)) {\n                    change = true;\n                }\n            }\n            if (change) {\n                this.updateRanks();\n            }\n\n            if (this.splits !== undefined && split < this.splits.length) {\n                const sp = this.splits[split];\n                if (sp.aItemLabel !== undefined && !sp.isWaitingContinue) {\n                    const n = Math.min(sp.aItemLabel.length, 4);\n                    // Check if buttons 1..4 is pressed.\n                    for (let i = 0; i < n; i++) {\n                        if (gamepad.buttons[i].pressed) {\n                            this.onClickRadio(split, i, this.colorBackground2, this.colorScore);\n                            sp.selectedAnswer = i;\n                            this.selectAnswer(split);\n                            this.updateRanks();\n                            sp.isWaitingContinue = true;\n                        }\n                    }\n                }\n            }\n        }\n\n        selectAnswer(split) {\n            let change = false;\n            let sp = this.splits[split];\n\n            if (sp.attempts === undefined || sp.attempts.length === 0) {\n                return; // Wait answer from server, so no attempts available.\n            }\n\n          if (sp.selectedAnswer >= 0 && !sp.isWaitingContinue) {\n                sp.isWaitingContinue = true;\n                change = true;\n                const pos = sp.aRandom[sp.selectedAnswer];\n                if (pos === 0) {\n                    // Correct answer.\n                    const addscore = sp.aItemRadio.length - 1;\n                    sp.score += addscore;\n                    if (sp.aduel >= 0) {\n                        if (!sp.attempts[0].aduelcorrect) {\n                            sp.score += sp.aItemRadio.length - 1;\n                        }\n                    }\n                    this.updateScore(sp);\n                    this.showCorrect(sp, true, addscore, 0);\n                    this.sendAnswer(split, true);\n                } else {\n                    // Wrong answer.\n                    let addscore = -Math.min(sp.score, 1);\n                    sp.score += addscore;\n                    this.updateScore(sp);\n\n                    let addscoreaduel = 0;\n                    if (sp.aduel >= 0) {\n                        if (sp.attempts[0].aduelcorrect) {\n                            addscoreaduel = sp.aItemRadio.length - 1;\n                            this.updateScoreOpponent(sp, addscoreaduel);\n                        }\n                    }\n                    this.showCorrect(sp, false, addscore, addscoreaduel);\n                    this.sendAnswer(split, false);\n                }\n            }\n\n            return change;\n        }\n\n        continueAnswer(split) {\n            const sp = this.splits[split];\n            if (!sp.isWaitingContinue) {\n                return;\n            }\n            sp.isWaitingContinue = false;\n            // Remove the question that is used.\n            sp.attempts.shift();\n            this.showNextQuestion(split);\n        }\n\n        updateRanks() {\n            if (this.splits.length === 1) {\n                return;\n            }\n            for (let i = 0; i < this.splits.length; i++) {\n                this.splits[i].rank = 0;\n            }\n            let rank = 1;\n            for (;;) {\n                let found = false;\n                let max = -1;\n                for (let i = 0; i < this.splits.length; i++) {\n                    const sp = this.splits[i];\n                    if (sp.rank === 0) {\n                        found = true;\n                        if (sp.score > max) {\n                            max = sp.score;\n                        }\n                    }\n                }\n                if (!found) {\n                    break; // Finished.\n                }\n                let count = 0;\n                for (let i = 0; i < this.splits.length; i++) {\n                    const sp = this.splits[i];\n                    if (sp.score === max) {\n                        sp.rank = rank;\n                        this.updateRank(sp);\n                        count++;\n                    }\n                }\n                rank += count;\n            }\n        }\n\n        updateRank(sp) {\n            if (this.splits.length === 1 || sp.player === undefined || sp.player.lblRank === undefined) {\n                return;\n            }\n            if (sp.rank === sp.rankcache) {\n                return;\n            }\n            sp.player.lblRank.innerHTML = '#' + sp.rank;\n            sp.rankcache = sp.rank;\n        }\n\n        updateScore(sp) {\n            sp.player.lblScore.innerHTML = sp.score;\n            this.changeScore = true;\n        }\n\n        sendAnswer(split, iscorrect) {\n            const sp = this.splits[split];\n\n            if (sp.attempts.length === 0) {\n                return; // No attempts.\n            }\n\n            const attempt = sp.attempts[0];\n\n            const pos = sp.aRandom[sp.selectedAnswer];\n            const info = {\n                split: split,\n                attemptid: attempt.attemptid,\n                iscorrect: iscorrect,\n                answer: attempt.answerids0[pos],\n                timestart: sp.timestart,\n                timeanswer: Math.round(Math.floor(Date.now() / 1000)),\n            };\n            sp.server.push(info);\n        }\n\n        showCorrect(sp, iscorrect, addscore, addscoreaduel) {\n            const correctPos = sp.aRandom.indexOf(0);\n            const topCorrect = sp.aItemLabelTop[0];\n            const topIcon = topCorrect + this.padding + sp.aItemLabel[correctPos].offsetHeight;\n            const topIncorrect = topIcon + this.iconSize + this.padding;\n            const leftLabel = parseFloat(sp.aItemRadio[0].style.left);\n\n            sp.stateShowCorrect = true;\n            // Move correct answer to position 0.\n            for (let i = 0; i < sp.aItemRadio.length; i++) {\n                this.fadeOut(sp, sp.aItemRadio[i], this.durationAnination);\n                if (i !== correctPos && i !== sp.selectedAnswer) {\n                    this.fadeOut(sp, sp.aItemLabel[i], this.durationAnination);\n                } else {\n                    sp.aItemRadio[i].classList.add(\"disabled\");\n                    sp.aItemLabel[i].classList.add(\"disabled\");\n                }\n            }\n            if (correctPos !== 0) {\n                this.moveElementSmoothly(sp, sp.aItemLabel[correctPos], topCorrect, this.durationAnination);\n            }\n\n            const sizeRadio = Math.round(sp.fontSize);\n            sp.correctSmall = this.createCorrectIcon(\n                sp,\n                sp.parent,\n                leftLabel,\n                sp.aItemLabelTop[sp.selectedAnswer],\n                topCorrect,\n                sizeRadio,\n                true\n            );\n\n            if (iscorrect) {\n                sp.incorrectSmall = undefined;\n            } else {\n                const label = sp.aItemLabel[sp.selectedAnswer];\n\n                label.style.textDecoration = \"none\";\n\n                this.moveElementSmoothly(\n                    sp,\n                    label,\n                    topIncorrect,\n                    this.durationAnination);\n                sp.incorrectSmall = this.createCorrectIcon(\n                    sp,\n                    sp.parent,\n                    leftLabel,\n                    sp.aItemLabelTop[sp.selectedAnswer],\n                    topIncorrect,\n                    sizeRadio,\n                    false\n                );\n            }\n\n            sp.timeoutStrip = setTimeout(() => {\n                sp.timeoutStrip = undefined;\n\n                if (sp.stateShowCorrect === undefined) {\n                    return; // We are in next question.\n                }\n\n                this.showCorrectStrip(sp, topIcon, iscorrect, addscore, addscoreaduel);\n                this.createNextButton(sp, correctPos, topIncorrect);\n\n                sp.aItemLabel[correctPos].style.opacity = \"1\";\n                sp.aItemLabel[correctPos].style.display = \"block\";\n                sp.aItemLabel[sp.selectedAnswer].style.opacity = \"1\";\n                sp.aItemLabel[sp.selectedAnswer].style.display = \"block\";\n            }, this.durationAnination);\n        }\n\n        createCorrectIcon(sp, parent, left, topSource, topDestination, sizeRadio, iscorrect) {\n            const div = this.createDiv(\n                parent,\n                'mmogame-quiz-aduelsplit-iscorrect',\n                left,\n                topSource,\n                sizeRadio,\n                sizeRadio);\n            div.innerHTML = this.getSVGcorrect(sizeRadio, iscorrect, this.colorScore, this.colorScore);\n            div.style.zIndex = '1';\n            if (topSource !== topDestination) {\n                this.moveElementSmoothly(sp, div, topDestination, this.durationAnination);\n            }\n\n            return div;\n        }\n\n        fadeOut(sp, element, duration) {\n            let opacity = 1;\n\n            let interval = setInterval(function() {\n                if (sp.stateShowCorrect === undefined) {\n                    element.style.display = 'block';\n                    element.style.opacity = 1;\n                    return;\n                }\n                if (opacity <= 0) {\n                    clearInterval(interval);\n                    element.style.display = 'none'; // Hide it.\n                } else {\n                    opacity -= 0.05; // Μειώνουμε την αδιαφάνεια\n                    element.style.opacity = opacity; // Εφαρμόζουμε την αδιαφάνεια στο στοιχείο\n                }\n            }, duration / 20); // Ορίζουμε πόσο γρήγορα θα αλλάξει η αδιαφάνεια\n        }\n\n        moveElementSmoothly(sp, element, finalY, duration) {\n            const startY = element.offsetTop; // Αρχική θέση Y\n            const deltaY = finalY - startY; // Διαφορά για Y\n            const startTime = performance.now(); // Ώρα εκκίνησης για υπολογισμό του χρόνου\n\n            const animate = () => {\n                if (sp.stateShowCorrect === undefined) {\n                    return;\n                }\n                const currentTime = performance.now();\n                const elapsedTime = currentTime - startTime;\n\n                // Υπολογισμός της αναλογίας του χρόνου (0 - 1) για τη μετάβαση\n                const progress = Math.min(elapsedTime / duration, 1);\n\n                // Υπολογισμός της νέας θέσης\n                const currentY = startY + deltaY * progress;\n                // Εφαρμογή της νέας θέσης\n                element.style.top = `${currentY}px`;\n\n                // Συνεχίζουμε το animation αν δεν έχουμε φτάσει στη νέα θέση\n                if (progress < 1) {\n                    requestAnimationFrame(animate);\n                } else {\n                    setTimeout(function() {\n                        element.style.display = \"block\";\n                    }, 500);\n                }\n            };\n\n            // Ξεκινάμε την κίνηση\n            animate();\n        }\n\n        getSVGcorrect(size, iscorrect, colorCorrect, colorError) {\n            if (iscorrect) {\n                let c = colorCorrect !== undefined ? this.getColorHex(colorCorrect) : '#398439';\n                return \"<svg aria-hidden=\\\"true\\\" class=\\\"svg-icon iconCheckmarkLg\\\" width=\\\"\" + size + \"\\\" height=\\\"\" + size +\n                    \"\\\" viewBox=\\\"0 0 36 36\\\"><path fill=\\\"\" + c + \"\\\" d=\\\"m6 14 8 8L30 6v8L14 30l-8-8v-8z\\\"></path></svg>\";\n            } else {\n                let c = colorError !== undefined ? this.getColorHex(colorError) : '#398439';\n                return \"<svg width=\\\"\" + size + \"\\\" height=\\\"\" + size +\n                    \"\\\" class=\\\"bi bi-x-lg\\\" viewBox=\\\"0 0 18 18\\\"> <path fill=\\\"\" + c +\n                    `\" d=\"M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 \n                1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z\"/></svg>`;\n            }\n        }\n\n        hideQuestion(sp) {\n            this.removeCorrectIcons(sp);\n\n            for (let i = 0; i < sp.aItemLabel.length; i++) {\n                const label = sp.aItemLabel[i];\n                label.style.display = \"none\";\n\n                const radio = sp.aItemRadio[i];\n                radio.style.display = \"none\";\n            }\n        }\n\n        showNextQuestion(split) {\n\n            const sp = this.splits[split];\n            sp.isWaitingContinue = false;\n            sp.timestart = Math.round(Math.floor(Date.now() / 1000));\n            sp.stateShowCorrect = undefined;\n\n            this.removeCorrectIcons(sp);\n\n            const n = sp.aItemLabel.length;\n\n            sp.aRandom = this.computeRandom(n);\n            for (let i = 0; i < sp.aItemLabel.length; i++) {\n                const label = sp.aItemLabel[i];\n                label.style.top = sp.aItemLabelTop[i];\n                label.style.display = \"block\";\n                label.style.opacity = 1;\n                label.style.textDecoration = \"none\";\n                label.classList.remove(\"disabled\");\n\n                const radio = sp.aItemRadio[i];\n                radio.style.display = \"block\";\n                radio.style.opacity = 1;\n                radio.classList.remove(\"checked\");\n                radio.classList.remove(\"disabled\");\n                this.drawRadio(radio, 0xFFFFFF, this.colorScore);\n                sp.selectedAnswer = -1;\n            }\n\n            if (sp.attempts.length === 0) {\n                sp.definition.innerHTML = '';\n                for (let i = 0; i < sp.aItemLabel.length; i++) {\n                    sp.aItemLabel[i].innerHTML = '';\n                }\n                this.hideQuestion(sp);\n                this.askNextQuestions(sp);\n                return;\n            }\n\n            // Shows the next question.\n            sp.definition.innerHTML = sp.attempts[0].numattempt + \". \" + sp.attempts[0].definition;\n            this.autoResizeText(sp.definition, sp.definitionWidth, sp.definitionHeight, true, 0, 0);\n            const attempt = sp.attempts[0];\n            for (let i = 0; i < sp.aItemLabel.length; i++) {\n                const ans = sp.aRandom[i];\n                sp.aItemLabel[i].innerHTML = (i + 1) + \": \" + attempt.answers[ans];\n            }\n\n            this.computeFontSize(split, sp);\n        }\n\n        askNextQuestions(sp) {\n            if (sp !== undefined && sp.aduelavatarelement !== undefined) {\n                sp.aduelavatarelement.remove();\n                sp.aduelavatarelement = undefined;\n            }\n            let splits = [];\n            let attempts = [];\n            let iscorrects = [];\n            let answers = [];\n            let timestarts = [];\n            let timeanswers = [];\n            let returnsplits = [];\n\n            for (let i = 0; i < this.splits.length; i++) {\n                const sp2 = this.splits[i];\n                if (sp2.attempts.length === 0) {\n                    returnsplits.push(i);\n                }\n                for (let j = 0; j < sp2.server.length; j++) {\n                    const temp = sp2.server[j];\n                    splits.push(temp.split);\n                    attempts.push(temp.attemptid);\n                    iscorrects.push(temp.iscorrect ? 1 : 0);\n                    answers.push(temp.answer);\n                    timestarts.push(temp.timestart);\n                    timeanswers.push(temp.timeanswer);\n                }\n            }\n            if (splits.length === 0) {\n                // Autorepair.\n                for (let i = 0; i < this.splits.length; i++) {\n                    if (this.splits[i].attempts.length === 0) {\n                        splits.push(i);\n                    }\n                }\n                if (splits.length === 0) {\n                    splits.push(0);\n                }\n            }\n            require(['core/ajax'], (Ajax) => {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    splits: splits.join(','),\n                    attempts: attempts.join(','),\n                    iscorrects: iscorrects.join(','),\n                    answers: answers.join(','),\n                    timestarts: timestarts.join(','),\n                    timeanswers: timeanswers.join(','),\n                    returnsplits: returnsplits.join(','),\n                };\n                // Calling the service through the Moodle AJAX API\n                let sendAnswers = Ajax.call([{\n                    methodname: 'mmogametype_quiz_send_answers_split',\n                    args: params\n                }]);\n                // Handling the response\n                sendAnswers[0].done(({avatars, attempts, attemptqueryids, querydefinitions,\n                                              queryanswerids, numattempts, answertexts, aduels,\n                                         aduelavatars, aduelcorrects, auserids, queryanswerids0,\n                                         grades, savedattempts}) => {\n                    this.info = {\n                        avatars: avatars,\n                        attempts: attempts,\n                        paletteid: this.paletteid,\n                        attemptqueryids: attemptqueryids,\n                        numattempts: numattempts,\n                        querydefinitions: querydefinitions,\n                        queryanswerids: queryanswerids,\n                        answertexts: answertexts,\n                        aduels: aduels,\n                        aduelavatars: aduelavatars,\n                        aduelcorrects: aduelcorrects,\n                        auserids: auserids,\n                        queryanswerids0: queryanswerids0,\n                        grades: grades,\n                    };\n                    this.removeFromServer(savedattempts);\n                    for (let i = 0; i < returnsplits.length; i++) {\n                        const split = returnsplits[i];\n                        this.copySplitData(i, split);\n                        this.checkShowAduel(this.splits[split]);\n                        this.showNextQuestion(split);\n                    }\n                }).fail((error) => {\n                    return error;\n                });\n            });\n        }\n\n        computeFontScorePercent(sp) {\n            if (sp.position === 0) {\n                const player = sp.player;\n                player.lblScore.innerHTML = \"99999\";\n                this.autoResizeText(player.lblScore, this.iconSize, player.cellSize, false, 0, 0);\n                const fontSize = player.lblScore.style.fontSize;\n                const lineHeight = Math.round(parseFloat(fontSize));\n                if (player.lblRank !== undefined) {\n                    player.lblRank.style.fontSize = fontSize;\n                    player.lblRank.lineHeight = lineHeight;\n                }\n                player.lblScore.lineHeight = lineHeight;\n                player.lblScore.innerHTML = \"\";\n            } else {\n                const player = sp.player;\n                let fontSize = this.splits[0].player.lblRank.style.fontSize;\n                const lineHeight = Math.round(parseFloat(fontSize));\n                if (player.lblRank !== undefined) {\n                    player.lblRank.style.fontSize = fontSize;\n                    player.lblRank.lineHeight = lineHeight;\n                }\n                player.lblScore.style.fontSize = fontSize;\n                player.lblScore.lineHeight = lineHeight;\n            }\n        }\n\n        removeCorrectIcons(sp) {\n            if (sp.timeoutStrip !== undefined) {\n                clearTimeout(sp.timeoutStrip);\n            }\n\n            if (sp.stripCorrect !== undefined) {\n                sp.stripCorrect.remove();\n                sp.stripCorrect = undefined;\n            }\n\n            if (sp.correctSmall !== undefined) {\n                sp.correctSmall.remove();\n                sp.correctSmall = undefined;\n            }\n\n            if (sp.incorrectSmall !== undefined) {\n                sp.incorrectSmall.remove();\n                sp.incorrectSmall = undefined;\n            }\n\n            if (sp.buttonNext !== undefined) {\n                sp.buttonNext.remove();\n                sp.buttonNext = undefined;\n            }\n        }\n\n        updateScoreOpponent(sp, addscore) {\n\n            const avatar = sp.aduelavatar;\n            for (let i = 0; i < this.splits.length; i++) {\n                if (this.splits[i].avatarfile === avatar) {\n                    const newsplit = this.splits[i];\n                    newsplit.score += addscore;\n                    this.updateScore(newsplit);\n                    break;\n                }\n            }\n        }\n\n        checkShowAduel(sp) {\n            if (sp.aduelavatar === '' || sp.aduelavatar === undefined) {\n                if (sp.aduelavatarelement !== undefined) {\n                    sp.aduelavatarelement.remove();\n                    sp.aduelavatarelement = undefined;\n                }\n                return; // Plays alone\n            }\n            let leftAvatar = Math.round(this.padding + this.iconSize / 2);\n            sp.aduelavatarelement = this.createDOMElement('img', {\n                classname: `mmogame-quiz-avatar`,\n                parent: sp.parent,\n                styles: {\n                    position: 'absolute',\n                    left: `${leftAvatar + 2 * this.iconSize + 2 * this.padding}px`,\n                    top: `${this.padding}px`,\n                    height: `${this.iconSize}px`,\n                    maxWidth: `${this.iconSize}px`,\n                    transform: 'translateX(-50%)',\n                },\n                attributes: {\n                    src: 'assets/avatars/' + sp.aduelavatar,\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n        }\n\n        createAddScore(sp, left, iconSize, addscore) {\n            if (addscore === 0) {\n                return;\n            }\n\n            if (addscore > 0) {\n                addscore = \"+\" + addscore;\n            }\n\n            const label = this.createDOMElement('div', {\n                parent: sp.stripCorrect,\n                classnames: `mmogame-quiz-addscore`,\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    width: `${iconSize}px`,\n                    top: `0`,\n                    height: `${iconSize}px`,\n                    lineHeight: `${iconSize}px`,\n                    textAlign: 'center',\n                    color: this.getContrastingColor(this.colorBackground),\n                    border: \"0px solid \" + this.getColorHex(this.colorBackground),\n                    boxShadow: \"inset 0 0 0.125em rgba(255, 255, 255, 0.75)\",\n                    background: this.getColorHex(this.colorBackground),\n                    borderRadius: `${iconSize}px`,\n                    fontSize: sp.aItemLabel[0].style.fontSize,\n                },\n                attributes: {\n                    title: this.getStringM('js_addscore'),\n                },\n            });\n\n            label.innerHTML = addscore;\n\n            return label;\n        }\n\n        showCorrectStrip(sp, top, iscorrect, addscore, addscoreaduel) {\n            const iconSize = Math.max(1, Math.min(this.iconSize, Math.ceil(sp.answersWidth / 4 - this.padding - this.padding / 4)));\n            sp.stripCorrect = this.createDOMElement('div', {\n                parent: sp.parent,\n                classnames: 'mmogame-quiz-split',\n                styles: {\n                    position: 'absolute',\n                    left: `${parseInt(sp.aItemRadio[0].style.left)}px`,\n                    top: `${top}px`,\n                    width: `${sp.answersWidth}px`,\n                    height: `${iconSize}px`,\n                    overflow: 'hidden',\n                }\n            });\n\n            this.createAddScore(sp, 0, iconSize, addscore);\n\n            this.createDOMElement('img', {\n                classname: `mmogame-quiz-avatar`,\n                parent: sp.stripCorrect,\n                styles: {\n                    position: 'absolute',\n                    left: `${iconSize + this.padding}px`,\n                    top: `0`,\n                    height: `${iconSize}px`,\n                    maxWidth: `${iconSize}px`,\n                },\n                attributes: {\n                    src: 'assets/avatars/' + sp.avatarfile,\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n            this.createCorrectIcon(sp, sp.stripCorrect, iconSize + this.padding, 0, 0, this.iconSize, iscorrect);\n\n            if (sp.aduelavatar !== '') {\n                let leftAduel = 2 * (iconSize + this.padding);\n                this.createDOMElement('img', {\n                    classname: `mmogame-quiz-avatar`,\n                    parent: sp.stripCorrect,\n                    styles: {\n                        position: 'absolute',\n                        left: `${leftAduel}px`,\n                        top: `0`,\n                        height: `${iconSize}px`,\n                        maxWidth: `${iconSize}px`,\n                    },\n                    attributes: {\n                        src: 'assets/avatars/' + sp.aduelavatar,\n                        alt: this.getStringM('js_help'),\n                        role: 'button',\n                    },\n                });\n                const correctAduel = sp.attempts[0].aduelcorrect;\n                this.createCorrectIcon(sp, sp.stripCorrect, leftAduel, 0, 0, iconSize, correctAduel);\n                this.createAddScore(sp, leftAduel + iconSize + this.padding, iconSize, addscoreaduel);\n            }\n        }\n\n        async createNextButton(sp, correctPos, topIncorrect) {\n            const time = correctPos === sp.selectedAnswer ?\n                this.timeBeforeShowNextButtonCorrect : this.timeBeforeShowNextButtonError;\n            sp.aItemLabel[sp.selectedAnswer].style.display = 'block';\n            setTimeout(async() => {\n                if (sp.selectedAnswer < 0 || sp.selectedAnswer >= sp.aItemLabel.length) {\n                    return;\n                }\n                sp.aItemLabel[sp.selectedAnswer].style.opacity = 1;\n                sp.aItemLabel[correctPos].style.opacity = 1;\n                sp.aItemLabel[correctPos].style.display = 'block';\n\n                const h = await this.waitForHeight(sp.aItemLabel[sp.selectedAnswer], 10, 30, this.iconSize);\n                const left = sp.answersLeft + Math.round(sp.answersWidth / 2 - this.iconSize);\n                let top;\n\n                // Computes the height of selected answer.\n                if (correctPos === sp.selectedAnswer) {\n                    top = sp.answersTop + h + 2 * this.padding + this.iconSize;\n                } else {\n                    top = topIncorrect + h + this.padding;\n                }\n                let iconSize = this.iconSize;\n                if (top + this.iconSize > this.split.height) {\n                    // Check if nextButton is out of screen.\n                    iconSize = Math.round(iconSize / 2);\n                    if (top + iconSize > this.split.height) {\n                        top = this.split.height - iconSize;\n                    }\n                }\n                if (sp.buttonNext !== undefined) {\n                    return;\n                }\n                sp.buttonNext = super.createImageButton(sp.parent, 'mmogame-quiz-next',\n                    left, top, 0, iconSize, 'assets/next.svg');\n                sp.buttonNext.title = this.getStringM('js_next_question');\n                sp.buttonNext.addEventListener(\"click\", () => {\n                    this.continueAnswer(sp.position);\n                });\n            }, time);\n        }\n\n        waitForHeight(el, maxRetries = 10, delay = 50, fallbackHeight = 24) {\n            return new Promise((resolve) => {\n                let tries = 0;\n                /**\n                 * Computes getBoundingClientRect.\n                 */\n                function check() {\n                    const h = el.getBoundingClientRect().height;\n                    if (h > 0) {\n                        resolve(h);\n                    } else {\n                        tries++;\n                        if (tries >= maxRetries) {\n                            resolve(fallbackHeight);\n                        } else {\n                            setTimeout(check, delay);\n                        }\n                    }\n                }\n                check();\n            });\n        }\n\n        removeFromServer(savedattempts) {\n            for (let i = 0; i < this.splits.length; i++) {\n                const sp = this.splits[i];\n                let j = 0;\n                while (j < sp.server.length) {\n                    const server = sp.server[j];\n                    const index = savedattempts.indexOf(parseInt(server.attemptid));\n                    if (index !== -1) {\n                        sp.server.splice(j, 1);\n                        savedattempts.splice(index, 1);\n                    } else {\n                        j++;\n                    }\n                }\n            }\n        }\n\n        createScreenSave() {\n            const size = Math.round(this.iconSize / 2);\n            const btn = this.createDOMElement('img', {\n                classname: `mmogame-quiz-save`,\n                parent: this.body,\n                styles: {\n                    position: 'absolute',\n                    left: `${window.innerWidth - this.iconSize}px`,\n                    top: `${this.padding}px`,\n                    height: `${size}px`,\n                    maxWidth: `${size}px`,\n                    transform: 'translateX(-50%)',\n                },\n                attributes: {\n                    src: 'assets/save.svg',\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n            btn.addEventListener('click', () => {\n                this.save();\n            });\n        }\n\n        save() {\n            this.askNextQuestions(undefined);\n        }\n\n        createScreenKeyboard() {\n            let instance = this;\n            document.addEventListener('keydown', function(event) {\n                const validKeys = ['1', '2', '3', '4', '5', '6', '7', '8', '9'];\n                if (validKeys.includes(event.key)) {\n                    let split = -1;\n                    switch (event.location) {\n                        case KeyboardEvent.DOM_KEY_LOCATION_NUMPAD:\n                            split = 1;\n                            break;\n                        case KeyboardEvent.DOM_KEY_LOCATION_STANDARD:\n                            split = 0;\n                            break;\n                    }\n                    if (split >= 0 && split <= instance.splits.length) {\n                        const sp = instance.splits[split];\n                        if (!sp.isWaitingContinue) {\n                            const i = parseInt(event.key) - 1;\n                            if (i < sp.aItemLabel.length) {\n                                instance.onClickRadio(split, i, instance.colorBackground2, instance.colorScore);\n                                sp.selectedAnswer = i;\n                                instance.selectAnswer(split);\n                                instance.updateRanks();\n                                sp.isWaitingContinue = true;\n                            }\n                        }\n                    }\n                }\n\n                // Check for the \"Enter\".\n                if (event.key === 'Enter') {\n                    let split = -1;\n                    switch (event.location) {\n                        case KeyboardEvent.DOM_KEY_LOCATION_STANDARD:\n                            split = 0;\n                            break;\n                        case KeyboardEvent.DOM_KEY_LOCATION_NUMPAD:\n                            split = 1;\n                            break;\n                    }\n\n                    if (split >= 0 && split < instance.splits.length) {\n                        const sp = instance.splits[split];\n                        if (sp.isWaitingContinue && sp.buttonNext !== undefined) {\n                            instance.continueAnswer(split);\n                        }\n                    }\n                }\n            });\n        }\n    };\n});"],"names":["define","MmoGameSplit","splits","lastUpdateTime","durationAnination","timeBeforeShowNextButtonCorrect","timeBeforeShowNextButtonError","gateOpen","mmogameid","pin","kinduser","user","modelparams","this","body","firstChild","removeChild","splitx","splity","isaduel","params","JSON","parse","undefined","countX","countY","countAll","computeSizes","window","addEventListener","requestAnimationFrame","updateGamepads","play","screen","updateDelay","sendGetAttemptsSplit","avatarids","info","avatarfiles","i","length","sp","push","avatarid","avatars","gategetavatar","avatarpos","require","Ajax","join","subcommand","call","methodname","args","done","_ref","attempts","attemptqueryids","querydefinitions","queryanswerids","numattempts","answertexts","aduels","aduelavatars","aduelcorrects","auserids","queryanswerids0","grades","paletteid","palette","setColors","createScreen","fail","error","split","width","Math","round","document","documentElement","clientWidth","padding","parent","answers","answerids","avatarfile","score","rank","rankcache","isWaitingContinue","position","server","copySplitData","iY","iX","createScreenSplit","updateScore","checkShowAduel","createScreenSave","createScreenKeyboard","left","top","offsetY","height","createDOMElement","classnames","styles","overflow","ishorizontal","showRank","player","createDivScorePercent","iconSize","computeFontScorePercent","leftAvatar","avatar","classname","maxWidth","transform","attributes","src","alt","getStringM","role","definitionWidth","definitionHeight","definitionTop","definition","background","colorDefinition","color","getContrastingColor","innerHTML","numattempt","continueAnswer","answersLeft","answersWidth","answersTop","answersHeight","createAnswerMultichoice","computeFontSize","endofgame","colors","getColorHex","colorScore","disabled","attempt","n","aItemRadio","Array","aItemLabel","aRandom","computeRandom","ans","label","colorBackground","align","marginTop","marginBottom","lineHeight","htmlFor","checked","item","createRadiobox","style","id","classList","contains","onClickRadio","colorBackground2","selectedAnswer","selectAnswer","updateRanks","stateShowCorrect","timestart","floor","Date","now","from","_","j","random","minSize","bodyFontSize","parseFloat","getComputedStyle","fontSize","maxSize","min","maxHeight","isbig","scrollWidth","scrollHeight","sum","elem","parseInt","precision","leftLabel","aItemLabelTop","radio","drawRadio","space","splitInfo","queryids","auserid","attemptid","queryid","answerids0","aduelcorrect","aduel","aduelavatar","moveX","timestamp","num","direction","steps","moveY","moveAnswer","move","index","colorBack","forEach","isDisabled","add","answerid","textDecoration","remove","updateGamepad","gamepad","change","buttons","value","buttonNext","pressed","addscore","showCorrect","sendAnswer","addscoreaduel","updateScoreOpponent","shift","showNextQuestion","found","max","count","updateRank","lblRank","lblScore","changeScore","iscorrect","pos","answer","timeanswer","correctPos","indexOf","topCorrect","topIcon","offsetHeight","topIncorrect","fadeOut","moveElementSmoothly","sizeRadio","correctSmall","createCorrectIcon","incorrectSmall","timeoutStrip","setTimeout","showCorrectStrip","createNextButton","opacity","display","topSource","topDestination","div","createDiv","getSVGcorrect","zIndex","element","duration","interval","setInterval","clearInterval","finalY","startY","offsetTop","deltaY","startTime","performance","animate","elapsedTime","progress","currentY","size","colorCorrect","colorError","hideQuestion","removeCorrectIcons","askNextQuestions","autoResizeText","aduelavatarelement","iscorrects","timestarts","timeanswers","returnsplits","sp2","temp","_ref2","savedattempts","removeFromServer","cellSize","clearTimeout","stripCorrect","newsplit","createAddScore","textAlign","border","boxShadow","borderRadius","title","ceil","leftAduel","correctAduel","time","async","h","waitForHeight","super","createImageButton","el","maxRetries","delay","fallbackHeight","Promise","resolve","tries","check","getBoundingClientRect","splice","innerWidth","save","instance","event","includes","key","location","KeyboardEvent","DOM_KEY_LOCATION_NUMPAD","DOM_KEY_LOCATION_STANDARD"],"mappings":"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"}