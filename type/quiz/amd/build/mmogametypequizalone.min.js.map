{"version":3,"file":"mmogametypequizalone.min.js","sources":["../src/mmogametypequizalone.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n    return class MmoGameTypeQuizAlone extends MmoGameTypeQuiz {\n        constructor() {\n            super();\n            this.cIcons = this.hasHelp() ? 5 : 4;\n            this.autosave = true;\n            this.autosubmit = true;\n            this.type = 'alone';\n        }\n\n        createIconBar() {\n            let i = 0;\n\n            this.nickNameHeight = Math.round(this.iconSize / 3);\n\n            this.buttonAvatarLeft = this.padding + i * (this.iconSize + this.padding);\n            this.buttonAvatarHeight = Math.round(this.iconSize - this.iconSize / 3);\n            this.buttonAvatarTop = this.iconSize - this.buttonAvatarHeight + this.padding;\n            this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)));\n            this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n            this.createDivScorePercent(this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, 1);\n\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight);\n            let instance = this;\n            if (this.hasHelp()) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding);\n                this.buttonHelp.addEventListener(\"click\", function() {\n                    instance.onClickHelp(instance.buttonHelp);\n                });\n            }\n\n            let copyrightHeight = this.getCopyrightHeight();\n\n            this.areaTop = 2 * this.padding + this.iconSize + this.nickNameHeight;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight);\n\n            this.createDivColor(this.body, 'mmogame-quiz-alone-color',\n                0, window.innerHeight - copyrightHeight - 1, window.innerWidth - 1, copyrightHeight,\n                this.getColorGray(this.colorCopyright));\n            this.vertical = this.areaHeight > this.areaWidth;\n        }\n\n        processSetAnswer(json) {\n            this.correct = json.correct;\n\n            this.playAudio(json.iscorrect !== 0 ? this.audioYes : this.audioNo);\n\n            if (json.correct !== undefined) {\n                if (this.qtype === \"multichoice\") {\n                    this.updateScreenAfterAnswerMultichoice();\n                }\n            }\n            this.disableInput();\n\n            if (this.btnSubmit !== undefined) {\n                this.body.removeChild(this.btnSubmit);\n                this.btnSubmit = undefined;\n            }\n\n            let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n                this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n            let instance = this;\n            btn.addEventListener(\"click\", function() {\n                instance.callGetAttempt();\n                instance.area.removeChild(btn);\n            });\n\n            this.showScore(json);\n        }\n\n        onServerFastJson(response) {\n            let pos = response.indexOf(\"-\");\n            if (pos >= 0) {\n                let state = parseInt(response.slice(0, pos));\n                let timefastjson = parseInt(response.slice(pos + 1));\n                if (timefastjson !== this.timefastjson || state !== this.state) {\n                    this.sendGetAttempt({mmogameid: this.mmogameid, kinduser: this.kinduser, user: this.user});\n                    return;\n                }\n            }\n\n            this.sendFastJSON();\n        }\n\n        processGetAttempt(json) {\n            if (parseInt(json.state) === 0) {\n                json.qtype = '';\n                if (json.colors !== undefined) {\n                    this.setColorsString(json.colors);\n                    this.createIconBar();\n                }\n                this.showScore(json);\n                this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n                return;\n            }\n\n            super.processGetAttempt(json);\n            if (this.btnSubmit !== undefined) {\n                this.btnSubmit.style.visibility = \"hidden\";\n            }\n        }\n\n        showScore(json) {\n            if (json.rank !== undefined && json.rankc !== undefined) {\n                if (parseInt(json.rank) < parseInt(json.rankc)) {\n                    this.completedrank = '';\n                    this.rank = '# ' + json.rank;\n                } else {\n                    this.rank = '';\n                    this.completedrank = '# ' + json.rankc;\n                }\n            }\n\n            let s = json.sumscore;\n            super.showScore(json);\n            json.sumscore = s;\n            s = json.sumscore === undefined ? '' : '<b>' + json.sumscore + '</b>';\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0, 1);\n            }\n        }\n\n        showHelpScreen(div) {\n            div.innerHTML = `<br>\n<div>` + this.getStringG('js_alone_help') + `</div><br>\n\n<table border=1>\n    <tr>\n        <td><img height=\"83\" src=\"assets/aduel/example2.png\" alt=\"\" /></td>\n        <td>` + this.getStringG('js_aduel_example2') + `</td>\n    </tr>\n</table>\n        `;\n        }\n    };\n});"],"names":["define","MmoGameTypeQuiz","constructor","cIcons","this","hasHelp","autosave","autosubmit","type","createIconBar","i","nickNameHeight","Math","round","iconSize","buttonAvatarLeft","padding","buttonAvatarHeight","buttonAvatarTop","createButtonsAvatar","buttonsAvatar","style","top","createDivScorePercent","createButtonSound","instance","createButtonHelp","buttonHelp","addEventListener","onClickHelp","copyrightHeight","getCopyrightHeight","areaTop","areaWidth","window","innerWidth","areaHeight","innerHeight","createDivColor","body","getColorGray","colorCopyright","vertical","processSetAnswer","json","correct","playAudio","iscorrect","audioYes","audioNo","undefined","qtype","updateScreenAfterAnswerMultichoice","disableInput","btnSubmit","removeChild","btn","super","createImageButton","area","nextLeft","nextTop","callGetAttempt","showScore","onServerFastJson","response","pos","indexOf","state","parseInt","slice","timefastjson","sendGetAttempt","mmogameid","kinduser","user","sendFastJSON","processGetAttempt","colors","setColorsString","createDivMessageStart","getStringM","visibility","rank","rankc","completedrank","s","sumscore","labelScore","innerHTML","autoResizeText","showHelpScreen","div","getStringG"],"mappings":"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"}