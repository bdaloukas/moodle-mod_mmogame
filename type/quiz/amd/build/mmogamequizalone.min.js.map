{"version":3,"file":"mmogamequizalone.min.js","sources":["../src/mmogamequizalone.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogamequiz'], function(mmoGameQuiz) {\n    return class mmoGameQuizAlone extends mmoGameQuiz {\n        constructor() {\n            super();\n            this.cIcons = this.hasHelp() ? 5 : 4;\n            this.autosave = true;\n            this.autosubmit = true;\n            this.type = 'alone';\n        }\n\n        static init(mmogameid, pin, kinduser, user) {\n            return new this(mmogameid, pin, kinduser, user);\n        }\n\n        createIconBar() {\n            let i = 0;\n\n            this.nickNameHeight = Math.round(this.iconSize / 3);\n\n            this.buttonAvatarLeft = this.padding + i * (this.iconSize + this.padding);\n            this.buttonAvatarHeight = Math.round(this.iconSize - this.iconSize / 3);\n            this.buttonAvatarTop = this.iconSize - this.buttonAvatarHeight + this.padding;\n            this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)));\n            this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n            this.divNickname = this.createDiv(this.body, this.buttonAvatarLeft, this.padding, this.iconSize, this.buttonAvatarTop);\n\n            this.createDivScorePercent(this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, 1);\n\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n            let instance = this;\n            if (this.hasHelp()) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding);\n                this.buttonHelp.addEventListener(\"click\", function () {\n                    instance.onClickHelp(instance.buttonHelp);\n                });\n            }\n\n            let copyrightHeight = this.getCopyrightHeight();\n\n            this.areaTop = 2 * this.padding + this.iconSize + this.nickNameHeight;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight);\n\n            this.createDivColor(this.body, 0, window.innerHeight - copyrightHeight - 1, window.innerWidth - 1, copyrightHeight,\n                this.getColorGray(this.colorCopyright));\n            this.vertical = this.areaHeight > this.areaWidth;\n\n            this.maxImageWidth = (this.vertical ? this.areaWidth : this.areaWidth / 2);\n            this.maxImageHeight = (this.vertical ? this.areaHeight / 2 : this.areaWidth);\n        }\n\n        updatePercent(json) {\n            if (this.labelPercent !== undefined) {\n                let s = json.percentcompleted === undefined ? '' : '<b>' + Math.round(100 * json.percentcompleted) + ' %</b>';\n                if (this.labelPercent.innerHTML !== s) {\n                    this.labelPercent.innerHTML = s;\n                    this.autoResizeText(this.labelPercent, this.iconSize - 2 * this.padding, this.iconSize / 2, false, 0, 0, 1);\n                }\n            }\n        }\n\n        onServerAnswer(json) {\n            super.onServerAnswer(json);\n\n            if (json.submit !== 0) {\n                this.updatePercent(json);\n            }\n        }\n\n        onServerFastJson(response) {\n            let pos = response.indexOf(\"-\");\n            if (pos >= 0) {\n                let state = parseInt(response.substr(0, pos));\n                let timefastjson = parseInt(response.substr(pos + 1));\n                if (timefastjson !== this.timefastjson || state !== this.state) {\n                    this.sendGetAttempt();\n                    return;\n                }\n            }\n\n            this.sendFastJSON();\n        }\n\n        onServerGetAttempt(json, param) {\n            if (json.state === 0 && param === undefined) {\n                json.qtype = '';\n                super.onServerGetAttempt(json, param);\n                this.showScore(json);\n\n                this.createDivMessageStart('[LANGM_WAIT_TO_START]');\n                return;\n            }\n\n            super.onServerGetAttempt(json, param);\n            this.updatePercent(json);\n            if (this.btnSubmit !== undefined) {\n                this.btnSubmit.style.visibility = \"hidden\";\n            }\n        }\n\n        showScore(json) {\n            let rank = json.rank;\n            let rankc = json.completedrank;\n            if (rank !== undefined && rankc !== undefined) {\n                if (parseInt(rank) < parseInt(rankc)) {\n                    json.completedrank = '';\n                    json.rank = '# ' + rank;\n                } else {\n                    json.rank = '';\n                    json.completedrank = '# ' + rankc;\n                }\n            }\n\n            let s = json.sumscore;\n            json.sumscore = this.labelScore.innerHTML;\n            super.showScore(json);\n            json.sumscore = s;\n            s = json.sumscore === undefined ? '' : '<b>' + json.sumscore + '</b>';\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0, 1);\n            }\n\n            json.rank = rank;\n            json.completedrank = rankc;\n        }\n\n        showHelpScreen(div) {\n            div.innerHTML = `<br>\n<div>[LANG_ALONE_HELP]</div><br>\n\n<table border=1>\n    <tr>\n        <td><img height=\"90\" src=\"../../assets/aduel/example2.png\" alt=\"\" /></td>\n        <td>[LANG_ADUEL_EXAMPLE2]</td>\n    </tr>\n</table>\n        `;\n        }\n    };\n});"],"names":["define","mmoGameQuiz","constructor","cIcons","this","hasHelp","autosave","autosubmit","type","mmogameid","pin","kinduser","user","createIconBar","i","nickNameHeight","Math","round","iconSize","buttonAvatarLeft","padding","buttonAvatarHeight","buttonAvatarTop","createButtonsAvatar","buttonsAvatar","style","top","divNickname","createDiv","body","createDivScorePercent","createButtonSound","instance","createButtonHelp","buttonHelp","addEventListener","onClickHelp","copyrightHeight","getCopyrightHeight","areaTop","areaWidth","window","innerWidth","areaHeight","innerHeight","createDivColor","getColorGray","colorCopyright","vertical","maxImageWidth","maxImageHeight","updatePercent","json","undefined","labelPercent","s","percentcompleted","innerHTML","autoResizeText","onServerAnswer","submit","onServerFastJson","response","pos","indexOf","state","parseInt","substr","timefastjson","sendGetAttempt","sendFastJSON","onServerGetAttempt","param","qtype","showScore","createDivMessageStart","btnSubmit","visibility","rank","rankc","completedrank","sumscore","labelScore","showHelpScreen","div"],"mappings":"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"}