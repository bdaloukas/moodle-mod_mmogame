{"version":3,"file":"mmogametypequizaduel.min.js","sources":["../src/mmogametypequizaduel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n        return class MmoGameTypeQuizAduel extends MmoGameTypeQuiz {\n\n    player1; // Stores all info for player1\n    player2; // Stores all info for player2\n    isWaitOpponent; // True if wait someone to answer a set of questions\n    nickNameHeight; // Height of nickname\n\n    constructor() {\n        super();\n\n        // Initialize core properties\n        this.cIcons = this.isVertical ? 5 : 8 + (this.hasHelp() ? 1 : 0);\n\n        this.isWaitOpponent = false;\n    }\n\n    createIconBar() {\n        let i = 0;\n        const step = this.iconSize + this.padding;\n\n        const nicknameHeight = Math.round(this.iconSize / 3);\n\n        let nickname, avatar;\n        [nickname, avatar] = this.createNicknameAvatar('mmogame-quiz-alone',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player1 = this.createDivScorePercent('mmogame-quiz-aduel-player1',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), true);\n        this.player1.avatarElement = avatar;\n        this.player1.nicknameElement = nickname;\n        this.player1.cacheAvatar = '';\n        this.player1.cacheNickname = '';\n        this.player1.lblScore.title = this.getStringM('js_grade');\n        this.player1.lblRank.title = this.getStringM('js_position_grade');\n\n        [nickname, avatar] = this.createNicknameAvatar('mmogame-quiz-alone',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player2 = this.createDivScorePercent('mmogame-quiz-aduel-player2',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), false);\n        this.player2.avatarElement = avatar;\n        this.player2.nicknameElement = nickname;\n        this.player2.cacheAvatar = '';\n        this.player2.cacheNickname = '';\n        this.player2.lblScore.title = this.getStringM('js_percent_opponent');\n        this.player2.lblRank.title = this.getStringM('js_position_percent');\n\n        this.createButtonSound(this.padding + (i++) * step,\n            this.padding + nicknameHeight, this.iconSize);\n        if (this.hasHelp()) {\n            this.createButtonHelp(this.padding + (i++) * step, this.padding);\n            this.buttonHelp.addEventListener(\"click\", () => this.onClickHelp(this.buttonHelp));\n        }\n\n        this.areaRect = {\n            left: this.padding,\n            top: 2 * this.padding + this.iconSize + nicknameHeight,\n            width: Math.round(window.innerWidth - 2 * this.padding),\n            height: Math.round(window.innerHeight - 2 * this.padding - nicknameHeight - this.iconSize),\n        };\n\n        if (this.isVertical) {\n            this.areaRect.height -= this.iconSize + 2 * this.padding;\n        }\n/* B\n        this.buttonAvatarHeight = this.iconSize + nicknameHeight;\n        this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, nicknameHeight);\n        this.buttonsAvatar[1].style.top = (this.padding + nicknameHeight) + \"px\";\n*/\n\n/* A\n        this.createButtonsAvatar(2, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, nicknameHeight);\n        this.buttonsAvatar[2].style.top = (this.padding + nicknameHeight) + \"px\";\n*/\n        this.createDivTimer(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.iconSize);\n        if (this.isVertical) {\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n        } else {\n            this.createButtonSound(this.padding, this.areaRect.top + this.areaRect.height);\n        }\n\n        if (this.hasBasBottom === false) {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + i * (this.iconSize + this.padding),\n                this.padding + nicknameHeight, this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + nicknameHeight, this.iconSize, this.iconSize, 'assets/cutred.svg');\n        } else {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                    this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                this.iconSize, this.iconSize, 'assets/cutred.svg');\n        }\n        this.buttonHighScore.style.visibility = 'hidden';\n        this.buttonHighScore.addEventListener(\"click\", () => {\n            this.sendGetHighScore();\n        });\n        this.button5050.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false, \"tool1\");\n        });\n        this.button5050.title = this.getStringM('js_help_5050');\n\n        let left;\n        if (this.isVertical) {\n            left = this.padding + (i++) * (this.iconSize + this.padding);\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                left, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/skip.svg');\n        } else {\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaTop + this.areaHeight, this.iconSize, this.iconSize, 'assets/skip.svg');\n        }\n        this.buttonSkip.addEventListener(\"click\", () => {\n            this.sendAnswer(\"tool2\");\n        });\n        this.buttonSkip.title = this.getStringT('js_help_skip');\n\n        if (!this.isVertical) {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                left, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/wizard.svg');\n        } else {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize, 'assets/wizard.svg');\n        }\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false, \"tool3\");\n        });\n        this.buttonWizard.style.visibility = 'hidden';\n        this.buttonWizard.title = this.getStringT('js_wizarg');\n\n        if (this.hasHelp()) {\n            if (!this.isVertical) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n            } else {\n                this.createButtonHelp(this.padding + 3 * (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height);\n            }\n            this.buttonWizard.addEventListener(\"click\", () => {\n                this.sendGetAttempt(false, \"tool3\");\n            });\n        }\n    }\n\n    updateButtonTool(btn, tool) {\n        btn.style.visibility = tool !== undefined && tool !== 0 ? \"hidden\" : \"visible\";\n    }\n\n    processGetAttempt(json) {\n        if (this.buttonHighScore !== undefined) {\n            this.buttonHighScore.style.visibility = 'hidden';\n        }\n        this.computeDifClock(json.time, json.timestart, json.timeclose);\n        this.timefastjson = json.timefastjson;\n        this.fastjson = json.fastjson;\n\n        if (json.name !== undefined) {\n            window.document.title = json.name;\n        }\n\n        this.correct = undefined;\n        if (json.state === 0) {\n            json.qtype = '';\n            super.processGetAttempt(json);\n            this.showScore(json);\n            this.onServerGetAttemptHideButtons();\n            this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n            return;\n        }\n\n        this.state = parseInt(json.state);\n\n        // Need for a change on colors.\n        if (this.savedColors === undefined || this.savedColors !== json.colors) {\n            this.savedColors = json.colors;\n            this.colors = undefined;\n        }\n\n        if (this.colors === undefined) {\n            this.setColorsString(json.colors);\n            this.createIconBar();\n        }\n\n        const nicknameWidth = 2 * this.iconSize + this.padding;\n        const nicknameHeight = this.iconSize / 3;\n        this.updateAvatarNickname(this.player1, json.avatar, json.nickname, nicknameWidth, nicknameHeight);\n        this.updateAvatarNickname(this.player2, json.aduelAvatar, json.aduelNickname, nicknameWidth, nicknameHeight);\n\n        // This.updateButtonsAvatar(1, json.avatar, json.nickname);\n        // This.updateButtonsAvatar(2, json.aduelAvatar, json.aduelNickname);\n\n        this.updateButtonTool(this.button5050, json.tool1numattempt);\n        if (json.tool3 !== undefined) {\n            json.tool2numattempt = -1;\n        } else {\n            json.tool3numattempt = -1;\n        }\n        this.updateButtonTool(this.buttonSkip, json.tool2numattempt);\n        this.updateButtonTool(this.buttonWizard, json.tool3numattempt);\n\n        this.attempt = json.attempt;\n        this.aduelPlayer = json.aduelPlayer;\n        this.aduelScore = json.aduelScore;\n        this.aduelRank = json.aduelRank;\n\n        if (json.errorcode !== undefined && json.errorcode === 'aduel_no_rivals' || json.attempt === 0) {\n            if (json.param === undefined) {\n                this.waitOponent();\n            }\n            this.hideTools();\n            this.showScore(json);\n            this.onServerGetAttemptRetry();\n            return;\n        }\n\n        this.isWaitOponent = false;\n\n        this.qtype = json.qtype;\n        if (json.qtype === 'multichoice') {\n            this.answers = [];\n            this.answersID = json.answerids;\n\n            json.answers.forEach((answer, index) => {\n                this.answers[index] = this.repairP(answer);\n            });\n        }\n        this.answer = json.answer !== undefined ? json.answer : null;\n        this.definition = this.repairP(json.definition);\n        if (json.aduelAttempt !== undefined) {\n            this.definition = json.aduelAttempt + \". \" + this.definition;\n        }\n        this.single = json.single;\n        this.autosave = json.autosave !== 0;\n        this.errorcode = json.errorcode;\n\n        // A this.readJsonFiles(json);\n        this.createScreen(json, false);\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n\n        //this.updateLabelTimer();\n        this.sendFastJSON();\n    }\n\n    onServerGetAttemptHideButtons() {\n        this.button5050.style.visibility = 'hidden';\n        this.buttonSkip.style.visibility = 'hidden';\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n        this.buttonsAvatar[2].style.visibility = 'hidden';\n    }\n\n    onTimeout() {\n        this.labelTimer.innerHTML = '';\n        this.disableInput();\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.display = 'none';\n        }\n\n        this.answer = '';\n        this.answerid = 0;\n        this.callSetAnswer();\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false);\n            this.area.removeChild(btn);\n        });\n    }\n\n    waitOpponent() {\n        if (this.isWaitOponent) {\n            return;\n        }\n        this.updateAvatarNickname(this.player2, \"\", \"\");\n        this.createDivMessage('mmomgame-quiz-aduel-wait-opponent',\n            this.getStringT('js_aduel_wait_opponent'));\n        if (this.labelTimer !== undefined) {\n            this.labelTimer.innerHTML = \"\";\n        }\n    }\n\n    hideTools() {\n        this.updateButtonTool(this.button5050, -1);\n        this.updateButtonTool(this.buttonSkip, -1);\n        this.updateButtonTool(this.buttonWizard, -1);\n    }\n\n    processSetAnswer(json) {\n        if (json.submit === 0) {\n            return;\n        }\n\n        this.correct = json.correct;\n\n        if (json.correct !== undefined) {\n            if (this.qtype === \"multichoice\") {\n                this.onServerAnswerMultichoice(json);\n            }\n        }\n\n        this.disableInput();\n        this.buttonHighScore.style.visibility = 'visible';\n\n        this.isWaitOponent = false;\n        if (this.aItemAnswer !== undefined && json.correct !== undefined) {\n            for (let i = 0; i < this.aItemAnswer.length; i++) {\n                this.aItemAnswer[i].classList.add(\"disabled\");\n            }\n        }\n\n        if (this.btnSubmit !== undefined) {\n            this.body.removeChild(this.btnSubmit);\n            this.btnSubmit = undefined;\n        }\n\n        this.showCorrectAnswer(json);\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.callGetAttempt();\n            this.area.removeChild(btn);\n        });\n\n        this.showScore(json);\n\n        this.timeclose = 0;\n\n        if (this.aduelPlayer === 1) {\n            if (json.attempt === 0) {\n                this.timeclose = 0;\n                this.waitOpponent();\n            }\n\n            this.showScore(json);\n        }\n\n        if (this.button5050 !== undefined) {\n            this.button5050.style.visibility = 'hidden';\n            this.buttonSkip.style.visibility = 'hidden';\n        }\n    }\n\n   callSetAnswer() {\n        if (this.correct === undefined) {\n            super.callSetAnswer();\n        }\n    }\n\n    onServerAnswerMultichoice(json) {\n        let foundCorrect = false;\n\n        let aduelAnswers = json.aduelPlayer === 2 && json.aduel_useranswer !== null ? json.aduel_useranswer.split(\",\") : '';\n        let aCorrect = json.correct.split(\",\");\n        for (let i = 0; i < this.answersID.length; i++) {\n            if (this.answersID[i] === '') {\n                continue;\n            }\n\n            let label = this.aItemLabel[i];\n\n            let iscorrect1, iscorrect2;\n\n            let iscorrect = aCorrect.includes(this.answersID[i]);\n\n            if (this.aItemAnswer[i].classList.contains(\"checked\")) {\n                iscorrect1 = aCorrect.includes(this.answersID[i]);\n            }\n            if (iscorrect1) {\n                foundCorrect = true;\n            }\n\n            if (aduelAnswers.includes(this.answersID[i])) {\n                iscorrect2 = aCorrect.includes(this.answersID[i]);\n            }\n\n            if (iscorrect === false && iscorrect1 === undefined && iscorrect2 === undefined) {\n                continue;\n            }\n\n            let width = this.labelWidth;\n            let height = this.aItemLabel[i].scrollHeight;\n\n            let move = (iscorrect2 !== undefined ? 2 : 1) * this.radioSize;\n            if (iscorrect1 === undefined && iscorrect2 === undefined) {\n                move = 0;\n            }\n            width -= move;\n\n            if (move !== 0) {\n                label.style.left = (parseInt(label.style.left) + move) + \"px\";\n            }\n            this.aItemLabel[i].style.width = width + \"px\";\n            this.autoResizeText(this.aItemLabel[i], width, height, true, this.minFontSize, this.maxFontSize, 0.5);\n\n            this.onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2);\n        }\n\n        this.playAudio(foundCorrect ? this.audioYes : this.audioNo);\n    }\n\n    onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2, iscorrect) {\n        if (iscorrect) {\n            this.aItemLabel[i].innerHTML = '<b><u>' + this.aItemLabel[i].innerHTML + '</b></u>';\n        }\n\n        if (iscorrect1 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-quiz-aduel-correct-answer',\n                this.aItemCorrectX[i], t, this.radioSize, this.radioSize);\n            div.title = iscorrect1 ? this.getStringT('js_correct_answer') : this.getStringT('js_wrong_answer');\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect1, this.colorScore, this.colorScore);\n        }\n\n        if (iscorrect2 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-aduel-opponent-correct',\n                this.aItemCorrectX[i] + this.radioSize, t, this.radioSize, this.radioSize);\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect2, this.colorScore2, this.colorScore2);\n            div.title = iscorrect2 ? this.getStringM('js_correct_answer') : this.getStringM('js_wrong_answer');\n        }\n    }\n\n    showCorrectAnswer({aduel_iscorrect, iscorrect, tool2}) {\n        this.timeclose = 0;\n        this.updateLabelTimer();\n\n        this.strip = this.createDiv(this.area, 'mmogame-quiz-aduel-strip',\n            this.stripLeft, this.nextTop, this.stripWidth, this.stripHeight);\n\n        if (tool2 === undefined || this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player1',\n                this.stripLeft, this.nextTop, this.buttonsAvatar[1].width,\n            this.buttonsAvatar[1].height, this.buttonsAvatar[1].src);\n        }\n\n        if (tool2 === undefined && this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player2',\n                this.stripLeft + this.iconSize, this.nextTop, this.buttonsAvatar[2].width,\n                this.buttonsAvatar[2].height, this.buttonsAvatar[2].src);\n        }\n\n        this.strip.style.top = this.nextTop + \"px\";\n        let s = this.getSVGcorrect(this.iconSize, iscorrect !== 0, this.colorScore, this.colorScore);\n        if (tool2 !== undefined && this.aduelPlayer === 1) {\n            s = '';\n        }\n        if (this.aduelPlayer === 2 && tool2 === undefined) {\n            s += this.getSVGcorrect(this.iconSize, aduel_iscorrect !== 0, this.colorScore2, this.colorScore2);\n        }\n        this.strip.innerHTML = s;\n\n        this.strip.style.zIndex = '1';\n    }\n\n    showScore(json) {\n        let rankc = json.completedrank;\n        if (json.rank !== undefined && rankc !== undefined) {\n            if (parseInt(json.rank) < parseInt(rankc)) {\n                json.completedrank = '';\n                json.rank = '# ' + json.rank;\n            } else {\n                json.rank = '';\n                json.completedrank = '# ' + rankc;\n            }\n        }\n\n        // Super.showScore(this.player1, json.rank, json.rankc, json.sumscore);\n\n        if (json.aduelPlayer === 1 || json.aduelPlayer === undefined) {\n            // Plays alone\n          /*  This.labelScore2.style.visibility = \"hidden\";\n            this.labelScoreRank2.style.visibility = \"hidden\";\n            this.buttonScore2.style.visibility = \"hidden\";\n            this.labelAddScore2.style.visibility = \"hidden\"; */\n        } else {\n/*            This.labelScore2.style.visibility = \"visible\";\n            this.labelScoreRank2.style.visibility = \"visible\";\n            this.buttonScore2.style.visibility = \"visible\";\n            this.labelAddScore2.style.visibility = \"visible\";\n*/\n            // Super.showScore(this.player1, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, true);\n/* A\n            if (json.aduelRank !== undefined && json.aduelCompletedrank !== undefined) {\n                let rank1 = parseInt(json.aduelRank);\n                let rank2 = parseInt(json.aduelCompletedrank);\n                if (rank1 <= rank2) {\n                    json.aduelRank = rank1;\n                } else {\n                    json.aduelRank = rank2;\n                    json.aduelScore = Math.round(100 * json.aduelCompletedrank) + \"%\";\n                }\n            }*/\n            // Super.showScore(this.player2, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, false);\n/* B\n            let s = '<b>' + score + '</b>';\n            if (this.labelScore2.innerHTML !== s) {\n                this.labelScore2.innerHTML = s;\n                this.autoResizeText(this.labelScore2, this.iconSize - 2 * this.padding, this.iconSize / 2, false, 0, 0, 1);\n            }\n            this.labelScoreRank2.innerHTML = rank;\n            this.labelScoreRank2.style.lineHeight = (this.iconSize / 3) + \"px\";\n            this.autoResizeText(this.labelScoreRank2, 0.5 * this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n*/\n\n            super.showScore(this.player1, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, true);\n            if (json.aduelPlayer === 2) {\n                super.showScore(this.player2, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, true);\n            } else {\n                super.showScore(this.player2, '', 1, '', '', true);\n            }\n\n            this.player1.lblAddScore.innerHTML = json.addscore === undefined ? '' : json.addscore;\n            this.autoResizeText(this.player1.lblAddScore, this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n        }\n    }\n\n    onServerFastJson(response) {\n        if (response === '') {\n            this.sendFastJSON();\n            return;\n        }\n\n        let a = response.split('-'); // Are state,timefastjson.\n        let newstate = a.length > 0 ? parseInt(a[0]) : 0;\n        let newTimeFastJSON = a.length > 1 ? a[1] : 0;\n\n        if (this.timefastjson === null) {\n            this.timefastjson = 0;\n        }\n\n        if (newstate !== this.state || newTimeFastJSON !== this.timefastjson) {\n            this.callGetAttempt();\n            return;\n        }\n\n        this.sendFastJSON();\n    }\n\n    sendGetHighScore() {\n        let params = {\n            mmogameid: this.mmogameid,\n            kinduser: this.kinduser,\n            user: this.user,\n            count: 10,\n        };\n\n        require(['core/ajax'], (Ajax) => {\n            // Calling the service through the Moodle AJAX API\n            let getHighScore = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_highscore',\n                args: params\n            }]);\n\n            // Handling the response\n            getHighScore[0].done((response) => {\n                this.createScreenHighScore(JSON.parse(response));\n            }).fail((error) => {\n                return error;\n            });\n        });\n    }\n\n    createScreenHighScore(json) {\n        if (this.highScore !== undefined) {\n            this.body.removeChild(this.highScore);\n            this.highScore = undefined;\n            this.strip.style.visibility = 'visible';\n            this.strip.style.zIndex = '1';\n            return;\n        }\n\n        this.removeDivMessage();\n\n        if (this.vertical) {\n            this.createScreenVerticalHighScore(json);\n        } else {\n            this.createScreenHorizontalHighScore(json);\n        }\n    }\n\n    createScreenHorizontalHighScore(json) {\n        this.createScreenVerticalHighScore(json);\n    }\n\n    createScreenVerticalHighScore(json) {\n        if (json.count === 0) {\n            return;\n        }\n\n        if (this.strip !== undefined) {\n            this.strip.style.visibility = 'hidden';\n        }\n\n        this.highScore = this.createDivColor(this.body, 'mmogame-quiz-aduel-highscore-background',\n            this.areaLeft, this.areaTop,\n            this.areaWidth - this.padding, this.areaHeight - this.padding,\n            this.getColorHex(this.colorBackground));\n\n        let canvas = document.createElement('canvas');\n        canvas.style.left = '0px';\n        canvas.style.top = \"0px\";\n        canvas.width = this.areaWidth;\n        canvas.height = this.areaHeight;\n        canvas.style.zIndex = 8;\n        canvas.style.position = \"absolute\";\n\n        this.highScore.appendChild(canvas);\n\n        let ctx = canvas.getContext(\"2d\");\n        let fontSize = this.minFontSize;\n        ctx.font = fontSize + \"px sans-serif\";\n\n        this.drawHighScore1(json, ctx, fontSize);\n    }\n\n    drawHighScore1(json, ctx, fontSize) {\n        ctx.textAlign = \"center\";\n        let text1 = ctx.measureText(this.getStringT('js_ranking_order'));\n        let width1 = text1.width;\n        let text = ctx.measureText(this.getStringM('js_grade'));\n        let width2 = text.width;\n\n        let col1 = 0;\n        let col2 = col1 + width1 + this.padding;\n        let col3 = col2 + width2 + this.padding;\n        let row = Math.round(3 * fontSize * 1.2);\n\n        let results = JSON.parse(json.results);\n\n        ctx.fillStyle = this.getContrastingColor(this.colorBackground);\n\n        let y = Math.round(fontSize * 1.2);\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.getStringT('js_ranking_order'), col1 + width1 / 2, y);\n\n        ctx.fillText(this.getStringM('js_grade'), col2 + width2 / 2, y);\n\n        ctx.textAlign = \"left\";\n        ctx.fillText(this.getStringM('js_name'), col3, y);\n\n        results.forEach(player => {\n            y += row / 2 + this.padding;\n\n            ctx.textAlign = \"center\";\n            ctx.fillText(player.rank, col1 + width1 / 2, y);\n\n            ctx.fillText(player.score, col2 + width2 / 2, y);\n\n            ctx.textAlign = \"left\";\n            ctx.fillText(player.name, col3 + row - this.padding, y);\n\n            this.createImage(this.highScore, 'mmogame-quiz-aduel-player-avatars',\n                col3, y - row / 2, row - this.padding, row - this.padding,\n                'assets/avatars/' + player.avatar);\n\n            y += row / 2 - this.padding;\n        });\n    }\n\n    showHelpScreen(div) {\n        div.innerHTML = `\n<div>` + this.getStringT('js_aduel_help') + `</div>\n\n<table border=1>\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/cutred.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_cut') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/skip.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_skip') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/wizard.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_wizard') + \\`</td>\n    </tr>\n\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../assets/aduel/example1.png\" alt=\"\" />\n        </td><center>\n\n        <td>` + this.getStringT('js_aduel_example1') + `</td>\n        <td><center>\n            <img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" />\n        </td>\n\n        <td>\\` + this.getStringT( 'js_aduel_example2') + \\`</td>\n    </tr>\n</table>        \n        `;\n    }\n\n    /**\n     * Creates a timer display.\n     * @param {number} left - Left position in pixels.\n     * @param {number} top - Top position in pixels.\n     * @param {number} size - Timer size.\n     */\n    createDivTimer(left, top, size) {\n        const timerDiv = this.createDiv(this.body, 'mmogame-timer', left, top, size, size);\n        timerDiv.style.textAlign = 'center';\n        timerDiv.style.color = this.getContrastingColor(this.colorBackground);\n\n        timerDiv.innerHTML = '23:59';\n        this.autoResizeText(timerDiv, size, size, false, 0, 0, 1);\n        timerDiv.innerHTML = '';\n        timerDiv.title = this.getStringM('js_question_time');\n\n        this.labelTimer = timerDiv;\n    }\n\n    createScreen(json, disabled) {\n        this.createArea(); // Prepare the main game area\n\n        if (this.endofgame) {\n            // Display end-of-game message and final score\n            this.createDivMessage('mmogame-endofgame', this.getStringM('js_game_over'));\n            this.showScore(json);\n            return;\n        }\n\n        // Render the screen layout based on orientation (vertical or horizontal)\n        if (this.vertical) {\n            this.createScreenVertical(json, disabled);\n        } else {\n            this.createScreenHorizontal(json, disabled);\n        }\n\n        // Display the current score\n        this.showScore(json);\n    }\n\n    createScreenHorizontal(json, disabled) {\n        let maxHeight = this.areaRect.height - 2 * this.padding;\n\n        if (!this.hideSubmit) {\n            maxHeight -= this.iconSize + this.padding; // Reserve space for submit button\n        }\n\n        const width = Math.round((this.areaRect.width - this.padding) / 2);\n        for (let step = 1; step <= 2; step++) {\n            let defSize;\n            this.fontSize = this.findbest(step === 1 ? this.minFontSize : this.minFontSize / 2, this.maxFontSize,\n                (fontSize) => {\n                defSize = this.createDefinition(0, 0, width - this.padding, true, fontSize,\n                    json.definition);\n                if (defSize[0] >= width) {\n                    return 1;\n                }\n                let ansSize = this.createAnswer(0, 0, width - this.padding, true, fontSize, disabled);\n                    if (ansSize[0] >= width) {\n                        return 1;\n                    }\n                    return defSize[1] < maxHeight && ansSize[1] < maxHeight ? -1 : 1;\n                });\n                if (defSize[0] <= width && defSize[1] <= this.areaRect.height) {\n                    break;\n                }\n            }\n\n            this.radioSize = Math.round(this.fontSize);\n            this.createDefinition(0, 0, width - this.padding, false, this.fontSize, json.definition);\n\n            this.nextTop = this.createAnswer(width, 0, width - this.padding, false, this.fontSize, disabled) + this.padding;\n\n            if (!this.hideSubmit) {\n                // Create and position the submit button\n                this.btnSubmit = this.createImageButton(\n                    this.body,\n                    'mmogame-quiz-submit',\n                    width + (width - this.iconSize) / 2,\n                    this.nextTop,\n                    0,\n                    this.iconSize,\n                    'assets/submit.svg',\n                    false,\n                    'submit'\n                );\n                this.btnSubmit.addEventListener('click', () => {\n                    this.sendAnswer();\n                });\n            }\n\n            // Adjust strip dimensions\n            this.stripLeft = width + this.padding;\n            this.stripWidth = 2 * this.iconSize;\n            this.stripHeight = this.iconSize;\n        }\n\n        };\n});"],"names":["define","MmoGameTypeQuiz","player1","player2","isWaitOpponent","nickNameHeight","constructor","super","this","cIcons","isVertical","hasHelp","createIconBar","i","step","iconSize","padding","nicknameHeight","Math","round","nickname","avatar","left","createNicknameAvatar","createDivScorePercent","getContrastingColor","color","avatarElement","nicknameElement","cacheAvatar","cacheNickname","lblScore","title","getStringM","lblRank","createButtonSound","createButtonHelp","buttonHelp","addEventListener","onClickHelp","areaRect","top","width","window","innerWidth","height","innerHeight","createDivTimer","hasBasBottom","buttonHighScore","createImageButton","body","button5050","areaTop","areaHeight","style","visibility","sendGetHighScore","sendGetAttempt","buttonSkip","sendAnswer","getStringT","buttonWizard","updateButtonTool","btn","tool","undefined","processGetAttempt","json","computeDifClock","time","timestart","timeclose","timefastjson","fastjson","name","document","correct","state","qtype","showScore","onServerGetAttemptHideButtons","createDivMessageStart","parseInt","savedColors","colors","setColorsString","nicknameWidth","updateAvatarNickname","aduelAvatar","aduelNickname","tool1numattempt","tool3","tool2numattempt","tool3numattempt","attempt","aduelPlayer","aduelScore","aduelRank","errorcode","param","waitOponent","hideTools","onServerGetAttemptRetry","isWaitOponent","answers","answersID","answerids","forEach","answer","index","repairP","definition","aduelAttempt","single","autosave","createScreen","btnSubmit","sendFastJSON","buttonsAvatar","onTimeout","labelTimer","innerHTML","disableInput","display","answerid","callSetAnswer","area","nextLeft","nextTop","removeChild","waitOpponent","createDivMessage","processSetAnswer","submit","onServerAnswerMultichoice","aItemAnswer","length","classList","add","showCorrectAnswer","callGetAttempt","foundCorrect","aduelAnswers","aduel_useranswer","split","aCorrect","iscorrect1","iscorrect2","label","aItemLabel","iscorrect","includes","contains","labelWidth","scrollHeight","move","radioSize","autoResizeText","minFontSize","maxFontSize","onServerAnswerMultichoiceShowCorrect","playAudio","audioYes","audioNo","t","div","createDiv","aItemCorrectX","getSVGcorrect","colorScore","colorScore2","_ref","aduel_iscorrect","tool2","updateLabelTimer","strip","stripLeft","stripWidth","stripHeight","createImage","src","s","zIndex","rankc","completedrank","rank","aduelPercent","aduelPercentRank","lblAddScore","addscore","onServerFastJson","response","a","newstate","newTimeFastJSON","params","mmogameid","kinduser","user","count","require","Ajax","call","methodname","args","done","createScreenHighScore","JSON","parse","fail","error","highScore","removeDivMessage","vertical","createScreenVerticalHighScore","createScreenHorizontalHighScore","createDivColor","areaLeft","areaWidth","getColorHex","colorBackground","canvas","createElement","position","appendChild","ctx","getContext","fontSize","font","drawHighScore1","textAlign","width1","measureText","width2","col2","col3","row","results","fillStyle","y","fillText","player","score","showHelpScreen","size","timerDiv","disabled","createArea","endofgame","createScreenVertical","createScreenHorizontal","maxHeight","hideSubmit","defSize","findbest","createDefinition","ansSize","createAnswer"],"mappings":"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"}