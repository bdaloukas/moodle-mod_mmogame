function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}define("mod_mmogame/mmogameui",["mod_mmogame/mmogame"],(function(MmoGame){return class extends MmoGame{constructor(){super(),_defineProperty(this,"isVertical",void 0),_defineProperty(this,"kindSound",void 0),_defineProperty(this,"buttonSound",void 0),_defineProperty(this,"colorBackground",16777215),_defineProperty(this,"colorDefinition",void 0),_defineProperty(this,"colorScore",void 0),_defineProperty(this,"definition",void 0),_defineProperty(this,"nickname",void 0),_defineProperty(this,"user",void 0),_defineProperty(this,"paletteid",void 0),_defineProperty(this,"avatarid",void 0),_defineProperty(this,"edtCode",void 0),_defineProperty(this,"edtNickname",void 0),_defineProperty(this,"gateCreateButtonSubmit",((maxWidth,bottom2)=>{this.btnSubmit=this.createImageButton(this.area,"mmogame-gate-submit",(maxWidth-this.iconSize)/2,bottom2,0,this.iconSize,"assets/submit.svg",!1,"submit"),this.btnSubmit.style.visibility="hidden",this.btnSubmit.addEventListener("click",(()=>{void 0!==this.edtCode&&(this.user=this.edtCode.value),this.gatePlayGame(!0,this.edtNickname.value,this.paletteid,this.avatarid)}))})),this.isVertical=window.innerWidth<window.innerHeight}getMuteFile(){return 0===this.kindSound?"assets/sound-on-flat.png":"assets/sound-off-flat.png"}playAudio(audioElement){0!==this.kindSound&&audioElement&&1===audioElement.networkState&&audioElement.play()}createButtonSound(left,top,size){this.buttonSound=this.createDOMElement("img",{parent:this.body,classnames:"mmogame-button-sound",styles:{position:"absolute",left:"".concat(left,"px"),top:"".concat(top,"px"),width:"".concat(size,"px"),height:"".concat(size,"px")},attributes:{src:this.getMuteFile(),alt:this.getStringM("js_sound"),role:"button"}}),this.buttonSound.addEventListener("click",(()=>this.onClickSound(this.buttonSound)))}onClickSound(button){this.kindSound=(this.kindSound+1)%2,button.src=this.getMuteFile(),this.setOptions({kindSound:this.kindSound})}gateOpen(mmogameid,pin,kinduser,user,url){const instance=this;try{this.url=url,this.mmogameid=mmogameid,this.pin=pin,this.kinduser=kinduser,instance.user=user,this.minFontSize*=2,this.maxFontSize*=2,this.gateComputeSizes(),this.areaRect={top:this.padding,width:Math.round(window.innerWidth-2*this.padding),height:Math.round(window.innerHeight-this.areaTop-this.padding)},this.getOptions().then((options=>{options.kindsound=options.kindsound||0,options.nickname=options.nickname||"",options.avatarid=options.avatarid||0,options.paletteid=options.paletteid||0,this.kindSound=[1,2].includes(options.kindSound)?options.kindSound:0;const isReady=options.nickname&&options.avatarid&&options.paletteid;return"moodle"===kinduser&&isReady?this.gatePlayGame(!1,options.nickname,options.paletteid,options.avatarid):"guid"===kinduser?(options.userGUID=options.userGUID||"",options.userGUID.length>=10&&isReady?(instance.user=options.userGUID,this.gatePlayGame(!1,options.nickname,options.paletteid,options.avatarid)):this.gateCreateScreen()):this.gateCreateScreen(),!0})).catch((error=>{this.showError("gateOpen unexpected",error)}))}catch(error){this.showError("gateOpen",error)}}gatePlayGame(save,nickname,paletteid,avatarid){let instance=this;if("guid"===instance.kinduser&&""===instance.user&&this.uuid4(),!save)return instance.nickname=nickname,instance.paletteid=paletteid,instance.avatarid=avatarid,void instance.callGetAttempt({nickname:nickname,colorpaletteid:paletteid,avatarid:avatarid});let options={nickname:nickname,avatarid:avatarid,paletteid:paletteid};this.setOptions(options).then((()=>(this.nickname=nickname,this.paletteid=paletteid,this.avatarid=avatarid,this.callGetAttempt(),!0))).catch((error=>(this.showError(error.message),!1)))}gateCreateScreen(){this.createArea(),this.isVertical?this.gateCreateScreenVertical():this.gateCreateScreenHorizontal()}gateCreateScreenVertical(){const instance=this;let size,maxHeight=instance.areaRect.height-5*instance.padding-instance.iconSize,maxWidth=instance.areaRect.width;const labels=["".concat(instance.getStringM("js_name"),": "),instance.getStringM("js_code"),instance.getStringM("js_palette")];instance.fontSize=instance.findbest(instance.minFontSize,instance.maxFontSize,(fontSize=>{if(size=instance.gateComputeLabelSize(fontSize,labels),size[0]>=maxWidth)return 1;const heightCode="guid"!==instance.kinduser&&"moodle"!==instance.kinduser?size[1]+instance.padding:0,heightColors=2*(maxHeight-4*fontSize)/5;if(0===Math.floor(heightColors/instance.iconSize))return 1;const heightAvatars=3*(maxHeight-4*fontSize+heightColors)/5;return heightCode+3*size[1]+8*instance.padding+heightColors+heightAvatars<maxHeight?-1:1})),instance.gateCreateScreenVerticalDo(maxWidth,maxHeight,size)}gateCreateScreenVerticalDo(maxWidth,maxHeight,size){const instance=this;let gridWidthColors=maxWidth-instance.padding,gridWidthAvatars=maxWidth-instance.padding,gridHeightColors=2*(maxHeight-4*instance.fontSize)/5,newHeight=Math.floor(gridHeightColors/instance.iconSize)*instance.iconSize,newWidth=Math.floor(gridWidthColors/instance.iconSize)*instance.iconSize,rest=gridHeightColors-newHeight;gridHeightColors=newHeight;let bottom,gridHeightAvatars=3*(maxHeight-4*instance.fontSize+rest)/5;"guid"!==instance.kinduser&&"moodle"!==instance.kinduser?(bottom=instance.gateCreateLabelEditVertical(0,0,maxWidth,instance.fontSize,size[0],instance.getStringM("js_code")+": ","mmogame-gate-code-label","mmogame-gate-code")+2*this.padding,instance.edtCode=instance.edt,instance.edtCode.addEventListener("keyup",instance.debounce((()=>instance.gateUpdateSubmit()),300))):bottom=0,bottom=instance.gateCreateLabelEditVertical(0,bottom,newWidth-2*instance.padding,instance.fontSize,size[0],instance.getStringM("js_name")+": ","mmogame-gate-name-label","mmogame-gate-name")+2*instance.padding,instance.edtNickname=instance.edt,instance.edtNickname.addEventListener("keyup",instance.debounce((()=>instance.gateUpdateSubmit()),300)),instance.gateCreateScreenPalette(bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars),bottom+=this.fontSize+instance.padding,instance.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+instance.fontSize+instance.padding,gridWidthAvatars,gridHeightAvatars);const bottom2=bottom+gridHeightColors+instance.fontSize+instance.padding+gridHeightAvatars;instance.gateCreateButtonSubmit(maxWidth,bottom2)}gateCreateScreenHorizontal(){const instance=this;let size,maxHeight=instance.areaHeight-7*instance.padding-instance.iconSize,maxWidth=instance.areaWidth;const sName=instance.getStringM("js_name")+": ";let labels=[instance.getStringM("js_code"),sName,instance.getStringM("js_palette")];instance.fontSize=instance.findbest(instance.minFontSize,instance.maxFontSize,(fontSize=>{if(size=instance.gateComputeLabelSize(fontSize,labels),size[0]>=maxWidth)return 1;let heightCode="guid"!==instance.kinduser&&"moodle"!==instance.kinduser?size[1]+instance.padding:0,heightColors=2*(maxHeight-4*fontSize)/5;if(0===Math.floor(heightColors/instance.iconSize))return 1;let heightAvatars=3*(maxHeight-4*fontSize+heightColors)/5;return heightCode+2*size[1]+7*instance.padding+heightColors+heightAvatars<maxHeight?-1:1})),instance.gateCreateScreenHorizontalDo(maxWidth,maxHeight,size,sName)}gateCreateScreenHorizontalDo(maxWidth,maxHeight,size,sName){const instance=this,gridWidthColors=maxWidth-instance.padding,gridWidthAvatars=maxWidth-instance.padding;let gridHeightColors=2*(maxHeight-4*instance.fontSize)/5;const newHeight=Math.floor(gridHeightColors/instance.iconSize)*instance.iconSize,newWidth=Math.floor(gridWidthColors/instance.iconSize)*instance.iconSize;let rest=gridHeightColors-newHeight;gridHeightColors=newHeight;const gridHeightAvatars=Math.floor(3*(maxHeight-4*instance.fontSize)/5+rest);let bottom;"guid"!==instance.kinduser&&"moodle"!==instance.kinduser?(bottom=instance.gateCreateLabelEditVertical(0,0,maxWidth,instance.fontSize,size[0],instance.getStringM("js_code"))+2*instance.padding,instance.edtCode=instance.edt,instance.edtCode.addEventListener("keyup",instance.debounce((()=>instance.gateUpdateSubmit()),300))):bottom=0;let sizeLabel=instance.gateComputeLabelSize(instance.fontSize,[sName]);bottom=this.gateCreateLabelEditHorizontal(0,bottom,newWidth-2*instance.padding,instance.fontSize,sizeLabel[0],instance.getStringM("js_name")+": ","mmogame-gate-name-label","mmogame-gate-name"),instance.edtNickname=this.edt,instance.edtNickname.addEventListener("keyup",instance.debounce((()=>instance.gateUpdateSubmit()),300));let label1=document.createElement("label");label1.style.position="absolute",label1.style.color=instance.getContrastingColor(instance.colorBackground),label1.innerHTML=instance.getStringM("js_palette"),label1.style.font="FontAwesome",label1.style.fontSize=instance.fontSize+"px",label1.style.width="0px",label1.style.whiteSpace="nowrap",instance.area.appendChild(label1);let btn=instance.createImageButton(instance.area,"mmogame-button-gate-refresh",label1.scrollWidth+instance.padding,bottom,instance.iconSize,instance.fontSize,"assets/refresh.svg",!1,"refresh");instance.addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars,!0,!1),label1.style.left=0,label1.style.color=instance.getContrastingColor(instance.colorBackground),label1.style.top=bottom+"px",bottom+=instance.fontSize+instance.padding;let label=document.createElement("label");label.style.position="absolute",label.innerHTML=instance.getStringM("js_avatars"),label.style.font="FontAwesome",label.style.fontSize=instance.fontSize+"px",label.style.width="0 px",label.style.whiteSpace="nowrap",instance.area.appendChild(label),btn=instance.createImageButton(instance.area,"mmogame-button-gate-refresh-avatars",label.scrollWidth+instance.padding,bottom+gridHeightColors,instance.iconSize,instance.fontSize,"assets/refresh.svg",!1,"refresh"),btn.addEventListener("click",(()=>{let elements=instance.area.getElementsByClassName("mmogame_avatar");for(;elements[0];)elements[0].parentNode.removeChild(elements[0]);instance.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+instance.fontSize+instance.padding,gridWidthAvatars,gridHeightAvatars,!1,!0)})),label.style.left="0 px",label.style.color=instance.getContrastingColor(instance.colorBackground),label.style.top=bottom+gridHeightColors+"px",instance.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+instance.fontSize+instance.padding,gridWidthAvatars,gridHeightAvatars);let bottom2=bottom+gridHeightColors+instance.fontSize+instance.padding+gridHeightAvatars;instance.btnSubmit=instance.createImageButton(instance.area,"mmogame-button-gate-submit",(maxWidth-instance.iconSize)/2,bottom2,0,instance.iconSize,"assets/submit.svg",!1,"submit"),instance.btnSubmit.style.visibility="hidden",instance.btnSubmit.addEventListener("click",(()=>{void 0!==instance.edtCode&&(instance.user=instance.edtCode.value),instance.gatePlayGame(!0,this.edtNickname.value,this.paletteid,this.avatarid)}))}gateComputeLabelSize(fontSize,aLabel){const instance=this;let maxWidth=0,maxHeight=0;for(let i=0;i<aLabel.length;i++){const label=document.createElement("label");label.style.position="absolute",label.innerHTML=aLabel[i],label.style.whiteSpace="nowrap",label.style.font="FontAwesome",label.style.fontSize=fontSize+"px",label.style.width="0px",label.style.height="0px",instance.area.appendChild(label),label.scrollWidth>maxWidth&&(maxWidth=label.scrollWidth),label.scrollHeight>maxHeight&&(maxHeight=label.scrollHeight),instance.area.removeChild(label)}return[maxWidth,maxHeight]}gateCreateLabelEditVertical(left,top,width,fontSize,labelWidth,title,classnamesLabel,classnamesEdit){const label=this.createLabel(this.area,classnamesLabel,left,top,labelWidth,fontSize,title);return label.style.color=this.getContrastingColor(this.colorBackground),top+=label.scrollHeight,this.edt=this.gateCreateInput(classnamesEdit,left,top,width,fontSize),top+fontSize+this.padding}gateShowAvatars(left,top,width,height,countX,avatarids,avatars){const instance=this;if(!avatars||0===avatars.length)return;const fragment=document.createDocumentFragment();instance.avatar=void 0;const count=avatars.length;let leftOriginal=left,w=Math.round(this.padding/2)+"px";for(let i=0;i<count;i++){let avatarImagePath="assets/avatars/"+avatars[i],btn=instance.createCenterImageButton(fragment,left,top,instance.iconSize-instance.padding,instance.iconSize-instance.padding,"mmogame-avatar",avatarImagePath);btn.classList.add("mmogame_avatar");let id=avatarids[i];btn.addEventListener("click",(()=>{instance.gateUpdateAvatar(btn,id,w)})),left+=instance.iconSize,(i+1)%countX==0&&(top+=instance.iconSize,left=leftOriginal)}instance.area.appendChild(fragment)}gateSendGetColorsAvatars(leftColors,topColors,gridWidthColors,gridHeightColors,leftAvatars,topAvatars,gridWidthAvatars,gridHeightAvatars){let updateColors=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],updateAvatars=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const instance=this;let countXcolors=Math.floor(gridWidthColors/instance.iconSize),countYcolors=Math.floor(gridHeightColors/instance.iconSize),countXavatars=Math.floor(gridWidthAvatars/instance.iconSize),countYavatars=Math.floor((gridHeightAvatars+2*instance.padding)/instance.iconSize);updateColors||(countXcolors=countYcolors=0),updateAvatars||(countXavatars=countYavatars=0),require(["core/ajax"],(Ajax=>{let params={mmogameid:instance.mmogameid,kinduser:instance.kinduser,user:instance.user,avatars:countXavatars*countYavatars,colorpalettes:countXcolors*countYcolors};Ajax.call([{methodname:"mod_mmogame_get_assets",args:params}])[0].done((_ref=>{let{avatarids:avatarids,avatars:avatars,colorpaletteids:colorpaletteids,colorpalettes:colorpalettes}=_ref;updateColors&&instance.gateShowColorPalettes(leftColors,topColors,gridWidthColors,gridHeightColors,countXcolors,countYcolors,colorpaletteids,colorpalettes),updateAvatars&&instance.gateShowAvatars(leftAvatars,topAvatars,gridWidthAvatars,gridHeightAvatars,countXavatars,avatarids,avatars)})).fail((error=>error))}))}gateShowColorPalettes(left,top,width,height,countX,countY,colorpaletteids,colorpalettes){const instance=this;let i=0;const count=colorpalettes.length;this.canvasColor=void 0;const canvasSize=instance.iconSize-3*instance.padding/2,parsedPalettes=colorpalettes.map((palette=>palette.split(",").map((value=>parseInt(value,10)||0)))),fragment=document.createDocumentFragment();for(let iy=0;iy<countY;iy++)for(let ix=0;ix<countX;ix++){if(i>=count||!parsedPalettes[i]||!colorpaletteids[i]){i++;continue}let canvas=document.createElement("canvas");canvas.style.position="absolute",canvas.style.left="".concat(left+ix*instance.iconSize,"px"),canvas.style.top="".concat(top+iy*instance.iconSize,"px"),canvas.width=canvasSize,canvas.height=canvasSize,canvas.style.cursor="pointer",canvas.classList.add("mmogame_color"),fragment.appendChild(canvas),instance.showColorPalette(canvas,parsedPalettes[i]);let id=colorpaletteids[i];canvas.addEventListener("click",(()=>{instance.gateUpdateColorPalette(canvas,id)})),i++}instance.area.appendChild(fragment)}gateUpdateColorPalette(canvas,id){const instance=this;void 0!==instance.canvasColor&&(instance.canvasColor.style.borderStyle="none"),this.canvasColor=canvas;let w=Math.round(instance.padding/2)+"px";Object.assign(canvas.style,{borderStyle:"outset",borderLeftWidth:w,borderTopWidth:w,borderRightWidth:w,borderBottomWidth:w}),instance.paletteid=id,instance.gateUpdateSubmit()}gateUpdateAvatar(avatar,id,w){const instance=this;void 0!==instance.avatar&&(instance.avatar.style.borderStyle="none"),instance.avatar=avatar,avatar.style.borderStyle="outset",avatar.style.borderLeftWidth=w,avatar.style.borderTopWidth=w,avatar.style.borderRightWidth=w,avatar.style.borderBottomWidth=w,instance.avatarid=id,instance.gateUpdateSubmit()}gateUpdateSubmit(){var _instance$edtCode,_instance$edtNickname,_instance$edtNickname2;const isCodeValid=null===(_instance$edtCode=this.edtCode)||void 0===_instance$edtCode||!_instance$edtCode.value||Number(this.edtCode.value)>0,hasAvatar=void 0!==this.avatarid,hasPalette=void 0!==this.paletteid,hasNickname=(null===(_instance$edtNickname=this.edtNickname)||void 0===_instance$edtNickname||null===(_instance$edtNickname2=_instance$edtNickname.value)||void 0===_instance$edtNickname2?void 0:_instance$edtNickname2.length)>0;this.btnSubmit.style.visibility=isCodeValid&&hasAvatar&&hasPalette&&hasNickname?"visible":"hidden"}gateComputeSizes(){this.computeSizes(),this.iconSize=Math.round(.8*this.iconSize),this.padding=Math.round(.8*this.padding)}gateCreateLabelEditHorizontal(left,top,width,fontSize,labelWidth,title,classnamesLabel,classnamesEdit){const label=this.createLabel(this.area,classnamesLabel,left,top,labelWidth,fontSize,title);label.style.color=this.getContrastingColor(this.colorBackground);let ret=top+Math.max(label.scrollHeight,fontSize)+this.padding,leftEdit=left+labelWidth+this.padding;return this.edt=this.gateCreateInput(classnamesEdit,leftEdit,top,width-leftEdit-this.padding,fontSize),ret}gateCreateInput(classnames,left,top,width,fontSize){const div=document.createElement("input");return div.style.position="absolute",div.style.width=width+"px",div.style.type="text",div.style.fontSize=fontSize+"px",div.style.left=left+"px",div.style.top=top+"px",div.autofocus=!0,div.classList.add(...classnames.split(/\s+/)),this.area.appendChild(div),div}gateCreateScreenPalette(bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars){const label=this.createDOMElement("label",{parent:this.area,styles:{position:"absolute",font:"FontAwesome",fontSize:"".concat(this.fontSize,"px"),width:"0px",whiteSpace:"nowrap",color:this.getContrastingColor(this.colorBackground),top:"".concat(bottom,"px"),left:"0px"},attributes:{innerHTML:this.getStringM("js_palette")}}),btn=this.createImageButton(this.area,"mmogame-gate-palette",label.scrollWidth+this.padding,bottom,this.iconSize,this.fontSize,"assets/refresh.svg",!1,"refresh");this.addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars,!0,!1)}addEventListenerRefresh(btn,bottom,gridWidthColors,gridHeightColors,gridWidthAvatars,gridHeightAvatars,updateColors,updateAvatars){btn.addEventListener("click",(()=>{Array.from(this.area.getElementsByClassName("mmogame_color")).forEach((element=>element.remove())),this.gateSendGetColorsAvatars(0,bottom,gridWidthColors,gridHeightColors,0,bottom+gridHeightColors+this.fontSize+this.padding,gridWidthAvatars,gridHeightAvatars,updateColors,updateAvatars)}))}createArea(){const instance=this;instance.area&&instance.body.removeChild(instance.area),instance.area=this.createDiv(instance.body,"mmogame-area",instance.padding,instance.areaTop,instance.areaWidth,instance.areaHeight)}createModal(classnames,title,content){const modal=this.createDOMElement("div",{parent:this.body,classnames:"".concat(classnames," modal"),styles:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"#fff",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",padding:"20px",zIndex:1e3}});this.createDOMElement("div",{parent:modal,classnames:"".concat(classnames,"-header"),styles:{fontWeight:"bold",marginBottom:"10px"}}).innerText=title;this.createDOMElement("div",{parent:modal,classnames:"".concat(classnames,"-body")}).innerHTML=content;const closeButton=this.createDOMElement("button",{parent:modal,classnames:"".concat(classnames,"-close"),styles:{marginTop:"10px",display:"block",marginLeft:"auto",marginRight:"auto"},attributes:{type:"button"}});return closeButton.innerText="Close",closeButton.addEventListener("click",(()=>{this.body.removeChild(modal)})),modal}createDivMessage(classnames,message){const instance=this;void 0!==instance.area&&(instance.body.removeChild(instance.area),instance.area=void 0),void 0!==instance.divMessageHelp&&(instance.body.removeChild(instance.divMessageHelp),instance.divMessageHelp=void 0);let left=instance.padding,top=instance.areaTop,width=window.innerWidth-2*instance.padding,height=window.innerHeight-instance.getCopyrightHeight()-instance.padding-top;instance.createDivMessageDo(classnames,left,top,width,height,message,height),instance.divMessage.style.top=(height-instance.divMessage.scrollHeight)/2+"px"}createButtonAvatar(prefixclassname,left,topNickName,widthNickName,heightNickName,topAvatar,widthAvatar,title){return{nickname:this.createDOMElement("div",{classname:"".concat(prefixclassname,"-nickname"),parent:this.body,styles:{left:left,top:topNickName,width:widthNickName},attributes:{title:title}}),avatar:this.createDOMElement("img",{classname:"".concat(prefixclassname,"-avatar"),parent:this.body,styles:{left:left,top:topAvatar,width:widthAvatar},attributes:{title:title}})}}createDivMessageStart(message){const instance=this;void 0!==instance.area&&(instance.body.removeChild(instance.area),instance.area=void 0);let left=instance.padding,top=instance.areaTop,width=window.innerWidth-2*instance.padding,height=window.innerHeight-instance.getCopyrightHeight()-instance.padding-top,height1=height/8;if(instance.createDivMessageDo("mmogame-message-start",left,top,width,height,message,height1),top+=(height1-instance.divMessage.scrollHeight)/2,instance.divMessage.style.top=top+"px",void 0===instance.divMessageHelp){let div=document.createElement("div");div.style.position="absolute",div.style.left=left+"px",div.style.textAlign="left",div.style.width=width-2*this.padding+"px",div.style.paddingLeft=this.padding+"px",div.style.paddingRight=this.padding+"px",div.style.color=instance.getContrastingColor(instance.colorDefinition);let top=instance.iconSize+3*instance.padding+height1;div.style.top=top+instance.padding+"px",div.style.height=height-height1+"px",instance.divMessageHelp=div,instance.body.appendChild(instance.divMessageHelp),instance.showHelpScreen(div,width-2*instance.padding,height-height1)}}updateButtonsAvatar(num,avatar,nickname){if(void 0===avatar&&(avatar=""),void 0===nickname&&(nickname=""),""===avatar&&""===nickname)return this.buttonsAvatar[num].style.visibility="hidden",void(this.divNicknames[num].style.visibility="hidden");if(this.nicknames[num]!==nickname||""===nickname){this.nicknames[num]=nickname;let s=nickname;if(0===nickname.length){s=avatar;let pos=s.lastIndexOf("/");pos>=0&&(s=s.slice(pos+1)),pos=s.lastIndexOf("."),pos>=0&&(s=s.slice(0,pos));s=avatar.split("/").pop().split(".").slice(0,-1).join(".")}s=this.repairNickname(s),void 0!==this.divNicknames[num]&&this.divNicknames[num].innerHTML!==s&&(this.divNicknames[num].innerHTML=s,this.divNicknames[num].style.textAlign="center",this.divNicknames[num].style.color=this.getContrastingColor(this.colorsBackground),this.autoResizeText(this.divNicknames[num],this.divNicknamesWidth[num],this.divNicknamesHeight[num],!0,0,0,1))}avatar!==this.buttonsAvatarSrc[num]&&(this.updateImageButton(this.buttonsAvatar[num],""!==avatar?"assets/avatars/"+avatar:""),this.buttonsAvatarSrc[num]=avatar),this.buttonsAvatar[num].alt=this.divNicknames[num].innerHTML,this.buttonsAvatar[num].style.visibility="visible",this.divNicknames[num].style.visibility="visible"}callGetAttempt(){let extraparams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;require(["core/ajax"],(Ajax=>{let params={mmogameid:this.mmogameid,kinduser:this.kinduser,user:this.user,nickname:null,colorpaletteid:null,avatarid:null};void 0!==extraparams&&(params=_objectSpread(_objectSpread({},params),extraparams)),Ajax.call([{methodname:"mmogametype_quiz_get_attempt",args:params}])[0].done((response=>{void 0!==extraparams&&void 0!==extraparams.colorpaletteid&&(this.openGame(),this.colors=void 0),this.processGetAttempt(JSON.parse(response))})).fail((error=>(this.createDivMessage("mmogame-error",error.message),error)))}))}createDivMessageDo(classnames,left,top,width,height,message,heightmessage){if(void 0===this.divMessageBackground){let div=this.createDiv(this.body,classnames,left,top,width,height);div.style.background=this.getColorHex(this.colorDefinition),this.divMessageBackground=div}if(void 0===this.divMessage){let div=document.createElement("div");div.style.position="absolute",div.style.left=left+"px",div.style.textAlign="center",div.style.width=width-2*this.padding+"px",div.style.paddingLeft=this.padding+"px",div.style.paddingRight=this.padding+"px",div.style.background=this.getColorHex(this.colorDefinition),div.style.color=this.getContrastingColor(this.colorDefinition),this.divMessage=div}this.divMessage.innerHTML=message,this.body.appendChild(this.divMessage),this.autoResizeText(this.divMessage,width,heightmessage,!1,this.minFontSize,this.maxFontSize,.5)}showError(name,error){const message=(null==error?void 0:error.message)||"An unknown error occurred.";this.createDivMessage("mmogame-error",message)}}}));

//# sourceMappingURL=mmogameui.min.js.map