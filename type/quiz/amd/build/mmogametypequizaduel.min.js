define("mmogametype_quiz/mmogametypequizaduel",["mmogametype_quiz/mmogametypequiz"],(function(MmoGameTypeQuiz){return class extends MmoGameTypeQuiz{player1;player2;isWaitOpponent;divTimer;timerTimeout;stripLeft;stripTop;timeoutWaitOpponent=5e3;buttonHighScore;button5050;buttonSkip;buttonWizard;constructor(){super("aduel"),this.cIcons=this.isVertical?5:8,this.isWaitOpponent=!1}createIconBar(){let i=0;const step=this.iconSize+this.padding,nicknameHeight=Math.round(this.iconSize/3),fragment=document.createDocumentFragment();let nickname,avatar,leftButton;[nickname,avatar]=this.createNicknameAvatar(fragment,"mmogame-quiz-aduel",Math.round(this.padding+i++*step),this.padding,2*this.iconSize+this.padding,nicknameHeight,this.padding+nicknameHeight,this.iconSize),this.player1=this.createDivScorePercent(fragment,"mmogame-quiz-aduel-player1",this.padding+i++*(this.iconSize+this.padding),this.padding+nicknameHeight,!0,this.colorScore),this.player1.avatarElement=avatar,this.player1.nicknameElement=nickname,this.player1.cacheAvatar="",this.player1.cacheNickname="",this.player1.lblScore.title=this.getStringM("js_grade"),this.player1.lblRank.title=this.getStringM("js_position_grade"),[nickname,avatar]=this.createNicknameAvatar(fragment,"mmogame-quiz-alone",Math.round(this.padding+i++*step),this.padding,2*this.iconSize+this.padding,nicknameHeight,this.padding+nicknameHeight,this.iconSize),this.player2=this.createDivScorePercent(fragment,"mmogame-quiz-aduel-player2",this.padding+i++*(this.iconSize+this.padding),this.padding+nicknameHeight,!1,this.colorScore2),this.player2.avatarElement=avatar,this.player2.nicknameElement=nickname,this.player2.cacheAvatar="",this.player2.cacheNickname="",this.player2.lblScore.title=this.getStringM("js_percent_opponent"),this.player2.lblRank.title=this.getStringM("js_position_percent"),this.createArea(2*this.padding+this.iconSize+nicknameHeight,this.isVertical?this.iconSize:0),this.createDivTimer(fragment,this.padding+i++*(this.iconSize+this.padding),this.padding+nicknameHeight,this.iconSize),this.isVertical?(i=0,this.createButtonSound(fragment,this.padding+i++*(this.iconSize+this.padding),this.areaRect.top+this.areaRect.height)):this.createButtonSound(fragment,this.padding+i++*(this.iconSize+this.padding),this.padding+nicknameHeight),this.isVertical?(leftButton=this.padding+(this.iconSize+this.padding),this.buttonHighScore=this.createImageButton(fragment,"mmogame-quiz-highscore",leftButton,this.areaRect.top+this.areaRect.height,this.iconSize,this.iconSize,"assets/highscore.svg"),this.button5050=this.createImageButton(fragment,"mmogame-quiz-aduel-5050",leftButton,this.areaRect.top+this.areaRect.height,this.iconSize,this.iconSize,"assets/cutred.svg")):(leftButton=this.padding+i++*(this.iconSize+this.padding),this.buttonHighScore=this.createImageButton(fragment,"mmogame-quiz-highscore",leftButton,this.padding+nicknameHeight,this.iconSize,this.iconSize,"assets/highscore.svg"),this.button5050=this.createImageButton(fragment,"mmogame-quiz-aduel-5050",leftButton,this.padding+nicknameHeight,this.iconSize,this.iconSize,"assets/cutred.svg")),this.buttonHighScore.style.visibility="hidden",this.buttonHighScore.addEventListener("click",(()=>{this.sendGetHighScore()})),this.button5050.addEventListener("click",(()=>{this.callGetAttempt({tool1:1})})),this.button5050.title=this.getStringT("js_help_5050"),leftButton+=this.iconSize+this.padding,this.isVertical?this.buttonSkip=this.createImageButton(fragment,"mmogame-quiz-aduel-skip",leftButton,this.areaRect.top+this.areaRect.height,this.iconSize,this.iconSize,"assets/skip.svg"):this.buttonSkip=this.createImageButton(fragment,"mmogame-quiz-aduel-skip",leftButton,this.padding+nicknameHeight,this.iconSize,this.iconSize,"assets/skip.svg"),this.buttonSkip.addEventListener("click",(()=>{this.callSetAnswer("tool2")})),this.buttonSkip.title=this.getStringT("js_help_skip"),this.isVertical?this.buttonWizard=this.createImageButton(fragment,"mmogame-quiz-aduel-wizard",leftButton,this.areaRect.top+this.areaRect.height,this.iconSize,this.iconSize,"assets/wizard.svg"):this.buttonWizard=this.createImageButton(fragment,"mmogame-quiz-aduel-wizard",leftButton,this.padding+nicknameHeight,this.iconSize,this.iconSize,"assets/wizard.svg"),this.buttonWizard.addEventListener("click",(()=>{this.callGetAttempt({tool3:1})})),this.buttonWizard.style.visibility="hidden",this.buttonWizard.title=this.getStringT("js_wizard"),this.buttonWizard.addEventListener("click",(()=>{this.callGetAttempt({tool3:1})})),this.hasHelp()&&(this.isVertical?this.createButtonHelp(fragment,this.padding+3*(this.iconSize+this.padding),this.areaRect.top+this.areaRect.height):this.createButtonHelp(fragment,leftButton+this.padding+i++*(this.iconSize+this.padding),this.padding+nicknameHeight)),this.body.appendChild(fragment)}updateButtonTool(btn,tool){btn.style.visibility=void 0!==tool&&0!==parseInt(tool)?"hidden":"visible"}processGetAttempt(json){if(super.processGetAttempt(json),void 0!==this.buttonHighScore&&(this.buttonHighScore.style.visibility="hidden"),void 0!==json.name&&(window.document.title=json.name),this.correct=void 0,this.state=parseInt(json.state),0===this.state)return json.qtype="",json.colors&&(this.setColorsString(json.colors),this.createIconBar()),this.showScore(json),this.createDivMessageStart(this.getStringM("js_wait_to_start")),void this.sendFastJSON();this.computeTimeStartClose(json.timestart,json.timeclose),void 0!==this.savedColors&&this.savedColors===json.colors||(this.savedColors=json.colors,this.colors=void 0),json.name&&(document.title=json.name),void 0===this.player1&&(this.setColorsString(json.colors),this.createIconBar()),void 0===this.area&&this.createArea(this.areaRect.top,0);const nicknameWidth=2*this.iconSize+this.padding,nicknameHeight=this.iconSize/3;if(this.updateNicknameAvatar(this.player1,json.avatar,json.nickname,nicknameWidth,nicknameHeight),this.updateNicknameAvatar(this.player2,json.aduelAvatar,json.aduelNickname,nicknameWidth,nicknameHeight),this.updateButtonTool(this.button5050,json.tool1numattempt),void 0!==json.tool3?json.tool2numattempt=-1:json.tool3numattempt=-1,this.updateButtonTool(this.buttonSkip,json.tool2numattempt),this.updateButtonTool(this.buttonWizard,json.tool3numattempt),this.attempt=json.attempt,this.aduelPlayer=json.aduelPlayer,this.aduelScore=json.aduelScore,this.aduelRank=json.aduelRank,void 0!==json.errorcode&&"aduel_no_rivals"===json.errorcode||0===json.attempt)return void 0===json.param&&this.showWaitOpponent(),this.hideTools(),this.showScore(json),void(this.timeout=setTimeout((()=>{this.callGetAttempt()}),this.timeoutWaitOpponent));this.isWaitOpponent=!1,this.qtype=json.qtype,"multichoice"===json.qtype&&(this.answers=[],this.answersID=json.answerids,json.answers.forEach(((answer,index)=>{this.answers[index]=this.repairP(answer)}))),this.answer=void 0!==json.answer?json.answer:null,this.definition=this.repairP(json.definition),void 0!==json.aduelAttempt&&(this.definition=json.aduelAttempt+". "+this.definition),this.single=json.single,this.errorcode=json.errorcode,this.createScreen(json,!1),this.updateDivTimer(),this.sendFastJSON()}onTimeout(){this.divTimer.innerHTML="",this.disableInput(),this.answer="",this.answerid=0,this.callSetAnswer(),this.createNextButton(this.areaRect.width-this.iconSize-this.padding,this.stripTop)}waitOpponent(){this.isWaitOpponent||(this.updateNicknameAvatar(this.player2,"",""),this.createDivMessage("mmomgame-quiz-aduel-wait-opponent",this.getStringT("js_aduel_wait_opponent")),void 0!==this.labelTimer&&(this.labelTimer.innerHTML=""))}hideTools(){this.updateButtonTool(this.button5050,-1),this.updateButtonTool(this.buttonSkip,-1),this.updateButtonTool(this.buttonWizard,-1)}processSetAnswer(json){this.correct=json.correct,void 0!==json.correct&&"multichoice"===this.qtype&&this.onServerAnswerMultichoice(json),this.disableInput(),this.buttonHighScore.style.visibility="visible",this.isWaitOpponent=!1,this.showCorrectAnswer(json),this.createNextButton(this.areaRect.width-this.iconSize-this.padding,this.stripTop),this.showScore(json),this.timeclose=0,1===this.aduelPlayer&&0===json.attempt&&(this.timeclose=0,this.waitOpponent()),void 0!==this.button5050&&(this.button5050.style.visibility="hidden",this.buttonSkip.style.visibility="hidden")}onServerAnswerMultichoice(json){let foundCorrect=!1,aduelAnswers=2===json.aduelPlayer&&null!==json.aduelUseranswer?json.aduelUseranswer.split(","):"",aCorrect=json.correct.split(",");for(let i=0;i<this.answersID.length;i++){if(""===this.answersID[i])continue;let iscorrect1,iscorrect2,label=this.aItemLabel[i],iscorrect=aCorrect.includes(this.answersID[i]);if(this.aItemAnswer[i].classList.contains("checked")&&(iscorrect1=aCorrect.includes(this.answersID[i])),iscorrect1&&(foundCorrect=!0),aduelAnswers.includes(this.answersID[i])&&(iscorrect2=aCorrect.includes(this.answersID[i])),!1===iscorrect&&void 0===iscorrect1&&void 0===iscorrect2)continue;let width=this.labelWidth,height=this.aItemLabel[i].scrollHeight,move=(void 0!==iscorrect2?2:1)*this.radioSize;void 0===iscorrect1&&void 0===iscorrect2&&(move=0),width-=move,0!==move&&(label.style.left=parseInt(label.style.left)+move+"px"),this.aItemLabel[i].style.width=width+"px",this.autoResizeText(this.aItemLabel[i],width,height,!0,this.minFontSize,this.maxFontSize,.5),this.onServerAnswerMultichoiceShowCorrect(i,iscorrect1,iscorrect2)}this.playAudio(foundCorrect?this.audioYes:this.audioNo)}onServerAnswerMultichoiceShowCorrect(i,iscorrect1,iscorrect2,iscorrect){if(iscorrect&&(this.aItemLabel[i].innerHTML="<b><u>"+this.aItemLabel[i].innerHTML+"</b></u>"),void 0!==iscorrect1){let t=parseInt(this.aItemAnswer[i].style.top),div=this.createDiv(this.area,"mmogame-quiz-aduel-correct-answer",this.aItemCorrectX[i],t,this.radioSize,this.radioSize);div.title=iscorrect1?this.getStringT("js_correct_answer"):this.getStringT("js_wrong_answer"),div.innerHTML=this.getSVGcorrect(this.radioSize,iscorrect1,this.colorScore,this.colorScore)}if(void 0!==iscorrect2){let t=parseInt(this.aItemAnswer[i].style.top),div=this.createDiv(this.area,"mmogame-aduel-opponent-correct",this.aItemCorrectX[i]+this.radioSize,t,this.radioSize,this.radioSize);div.innerHTML=this.getSVGcorrect(this.radioSize,iscorrect2,this.colorScore2,this.colorScore2),div.title=iscorrect2?this.getStringM("js_correct_answer"):this.getStringM("js_wrong_answer")}}showCorrectAnswer(_ref){let{iscorrect2:iscorrect2,iscorrect:iscorrect,tool2:tool2}=_ref;if(this.timeclose=0,this.updateDivTimer(),this.strip=this.createDiv(this.area,"mmogame-quiz-aduel-strip",this.stripLeft,this.stripTop,2*this.iconSize+this.padding,this.iconSize),void 0===tool2||2===this.aduelPlayer){this.createImage(this.area,"mmogame-quiz-aduel-player1",this.stripLeft+this.iconSize/2,this.stripTop,this.iconSize,this.iconSize,"assets/avatars/"+this.player1.cacheAvatar).style.transform="translateX(-50%)"}if(void 0===tool2&&2===this.aduelPlayer){this.createImage(this.area,"mmogame-quiz-aduel-player2",this.stripLeft+this.iconSize/2+this.iconSize,this.stripTop,this.iconSize,this.iconSize,"assets/avatars/"+this.player2.cacheAvatar).style.transform="translateX(-50%)"}this.strip.style.top=this.stripTop+"px";let s=this.getSVGcorrect(this.iconSize,0!==iscorrect,this.colorScore,this.colorScore);void 0!==tool2&&1===this.aduelPlayer&&(s=""),2===this.aduelPlayer&&void 0===tool2&&(s+=this.getSVGcorrect(this.iconSize,0!==iscorrect2,this.colorScore2,this.colorScore2)),this.strip.innerHTML=s,this.strip.style.zIndex="1"}showScore(json){super.showScore(this.player1,json.sumscore,json.rank,json.percent,json.percentRank,!0),this.player1.lblAddScore.innerHTML=void 0===json.addscore?"":json.addscore,this.autoResizeText(this.player1.lblAddScore,this.iconSize,this.player1.cellSize,!0,0,0,1),2===json.aduelPlayer?(this.player2.divMain.style.visibility="visible",super.showScore(this.player2,json.aduelScore,json.aduelRank,json.aduelPercent,json.aduelPercentRank,!0)):(this.player2.divMain.style.visibility="hidden",super.showScore(this.player2,"","","","",!1))}sendGetHighScore(){let params={mmogameid:this.mmogameid,kinduser:this.kinduser,user:this.user,count:10};require(["core/ajax"],(Ajax=>{Ajax.call([{methodname:"mmogametype_quiz_get_highscore",args:params}])[0].done((response=>{this.createScreenHighScore(JSON.parse(response))})).fail((error=>error))}))}createScreenHighScore(json){if(void 0!==this.highScore)return this.body.removeChild(this.highScore),this.highScore=void 0,this.strip.style.visibility="visible",void(this.strip.style.zIndex="1");let child;for(this.removeDivMessage();child=this.area.firstChild;)this.area.removeChild(child);this.isVertical?this.createScreenVerticalHighScore(json):this.createScreenHorizontalHighScore(json)}createScreenHorizontalHighScore(json){this.createScreenVerticalHighScore(json)}createScreenVerticalHighScore(json){if(0===json.count)return;void 0!==this.strip&&(this.strip.style.visibility="hidden"),this.highScore=this.createDivColor(this.body,"mmogame-quiz-aduel-highscore-background",this.areaRect.left,this.areaRect.top,this.areaRect.width-this.padding,this.areaRect.height-this.padding,this.getColorHex(this.colorBackground));let canvas=document.createElement("canvas");canvas.style.left="0px",canvas.style.top="0px",canvas.width=this.areaRect.width,canvas.height=this.areaRect.height,canvas.style.zIndex=8,canvas.style.position="absolute",this.highScore.appendChild(canvas);let ctx=canvas.getContext("2d"),fontSize=this.minFontSize;ctx.font=fontSize+"px sans-serif",this.drawHighScore1(json,ctx,fontSize)}drawHighScore1(json,ctx,fontSize){ctx.textAlign="center";let width1=ctx.measureText(this.getStringT("js_ranking_order")).width,width2=ctx.measureText(this.getStringM("js_grade")).width,col2=0+width1+this.padding,col3=col2+width2+this.padding,row=Math.round(3*fontSize*1.2),results=JSON.parse(json.results);ctx.fillStyle=this.getContrastingColor(this.colorBackground);let y=Math.round(1.2*fontSize);ctx.textAlign="center",ctx.fillText(this.getStringT("js_ranking_order"),0+width1/2,y),ctx.fillText(this.getStringM("js_grade"),col2+width2/2,y),ctx.textAlign="left",ctx.fillText(this.getStringM("js_name"),col3,y),results.forEach((player=>{y+=row/2+this.padding,ctx.textAlign="center",ctx.fillText(player.rank,0+width1/2,y),ctx.fillText(player.score,col2+width2/2,y),ctx.textAlign="left",ctx.fillText(player.name,col3+row-this.padding,y),this.createImage(this.highScore,"mmogame-quiz-aduel-player-avatars",col3,y-row/2,row-this.padding,row-this.padding,"assets/avatars/"+player.avatar),y+=row/2-this.padding}))}showHelpScreen(div){div.innerHTML=`<div> ${this.getStringT("js_aduel_help")} </div>\n<table class="mmogame-table-help">\n    <tr>\n        <td class="mmogame-td-help-image">\n            <img height="90" src="assets/cutred.svg" alt="" />\n        </td>\n        <td> ${this.getStringT("js_aduel_cut")} </td>\n        <td class="mmogame-td-help-image">\n            <img height="90" src="assets/skip.svg" alt="" />\n        </td>\n        <td> ${this.getStringT("js_aduel_skip")} </td>\n        <td class="mmogame-td-help-image">\n            <img height="90" src="assets/wizard.svg" alt="" />\n        </td>\n        <td> ${this.getStringT("js_aduel_wizard")} </td>\n    </tr>\n\n    <tr>\n        <td class="mmogame-td-help-image">\n            <img height="90" src="type/quiz/assets/aduel/example1.png" alt="" />\n        </td>\n\n        <td> ${this.getStringT("js_aduel_example1")} </td>\n\n        <td class="mmogame-td-help-image">\n            <img height="83" src="type/quiz/assets/aduel/example2.png" alt="" />\n        </td>\n        <td> ${this.getStringT("js_aduel_example2")} </td>\n    </tr>\n</table>\n        `}createDivTimer(parent,left,top,size){this.divTimer=this.createDOMElement("div",{parent:parent,classnames:"mmogame-quiz-aduel-timer",styles:{position:"absolute",left:`${left}px`,top:`${top}px`,width:`${size}px`,height:`${size}px`,textAlign:"center",color:this.getContrastingColor(this.colorBackground)},attributes:{alt:this.getStringM("js_question_time")}}),this.divTimer.innerHTML="23:59",this.autoResizeText(this.divTimer,size,size,!1,0,0),this.divTimer.innerHTML="",this.divTimer.title=this.getStringM("js_question_time")}updateDivTimer(){if(!this.divTimer||!this.timeclose)return;const now=Date.now()/1e3;let remainingTime=Math.max(0,this.timeclose-now);if(0===remainingTime)return this.divTimer.innerHTML="",void this.onTimeout();const minutes=Math.floor(remainingTime/60),seconds=String(Math.floor(remainingTime%60)).padStart(2,"0");this.divTimer.innerHTML=`${minutes}:${seconds}`,this.timerTimeout=setTimeout((()=>this.updateDivTimer()),500)}createScreen(json,disabled){if(this.endofgame)return this.createDivMessage("mmogame-endofgame",this.getStringM("js_game_over")),void this.showScore(json);this.removeAreaChildren(),this.isVertical?this.createScreenVertical(json,disabled):this.createScreenHorizontal(json,disabled),this.showScore(json)}createScreenHorizontal(json,disabled){const[width]=this.computeBestFontSize(json);this.radioSize=Math.round(this.fontSize),this.stripTop=this.createAnswer(width,0,width-this.padding,!1,this.fontSize,disabled),this.createDefinition(0,0,width-this.padding,this.stripTop-this.padding,!1,this.fontSize,json.definition),this.stripLeft=width+this.padding}createScreenVertical(json,disabled){this.computeBestFontSize(json),this.radioSize=Math.round(this.fontSize);const defSize=this.createDefinition(0,0,this.areaRect.width,0,!1,this.fontSize,json.definition);this.stripTop=this.createAnswer(0,defSize[1]+this.padding,this.areaRect.width,!1,this.fontSize,disabled),this.stripLeft=0}showWaitOpponent(){this.isWaitOpponent||(this.updateNicknameAvatar(this.player2,"","",0,0),this.createDivMessage(this.getStringT("js_aduel_wait_opponent")),void 0!==this.divTimer&&(this.divTimer.innerHTML=""))}}}));

//# sourceMappingURL=mmogametypequizaduel.min.js.map