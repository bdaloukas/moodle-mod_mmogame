{"version":3,"file":"mmogametypequizalone.min.js","sources":["../src/mmogametypequizalone.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(mmoGameTypeQuiz) {\n    return class mmoGameTypeQuizAlone extends mmoGameTypeQuiz {\n        constructor() {\n            super();\n            this.cIcons = this.hasHelp() ? 5 : 4;\n            this.autosave = true;\n            this.autosubmit = true;\n            this.type = 'alone';\n        }\n\n        createIconBar() {\n            let i = 0;\n\n            this.nickNameHeight = Math.round(this.iconSize / 3);\n\n            this.buttonAvatarLeft = this.padding + i * (this.iconSize + this.padding);\n            this.buttonAvatarHeight = Math.round(this.iconSize - this.iconSize / 3);\n            this.buttonAvatarTop = this.iconSize - this.buttonAvatarHeight + this.padding;\n            this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)));\n            this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n            this.createDiv(this.body, this.buttonAvatarLeft, this.padding, this.iconSize, this.buttonAvatarTop);\n\n            this.createDivScorePercent(this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, 1);\n\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n            let instance = this;\n            if (this.hasHelp()) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding);\n                this.buttonHelp.addEventListener(\"click\", function() {\n                    instance.onClickHelp(instance.buttonHelp);\n                });\n            }\n\n            let copyrightHeight = this.getCopyrightHeight();\n\n            this.areaTop = 2 * this.padding + this.iconSize + this.nickNameHeight;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight);\n\n            this.createDivColor(this.body, 0, window.innerHeight - copyrightHeight - 1, window.innerWidth - 1, copyrightHeight,\n                this.getColorGray(this.colorCopyright));\n            this.vertical = this.areaHeight > this.areaWidth;\n        }\n\n        updatePercent(json) {\n            if (this.labelPercent !== undefined) {\n                let s = json.percentcompleted === undefined ? '' : '<b>' + Math.round(100 * json.percentcompleted) + ' %</b>';\n                if (this.labelPercent.innerHTML !== s) {\n                    this.labelPercent.innerHTML = s;\n                    this.autoResizeText(this.labelPercent, this.iconSize - 2 * this.padding, this.iconSize / 2, false, 0, 0, 1);\n                }\n            }\n        }\n\n        onServerAnswer(json) {\n            super.onServerAnswer(json);\n\n            if (json.submit !== 0) {\n                this.updatePercent(json);\n            }\n        }\n\n        onServerFastJson(response) {\n            let pos = response.indexOf(\"-\");\n            if (pos >= 0) {\n                let state = parseInt(response.slice(0, pos));\n                let timefastjson = parseInt(response.slice(pos + 1));\n                if (timefastjson !== this.timefastjson || state !== this.state) {\n                    this.sendGetAttempt();\n                    return;\n                }\n            }\n\n            this.sendFastJSON();\n        }\n\n        onServerGetAttempt(json, param) {\n            if (json.state === 0 && param === undefined) {\n                json.qtype = '';\n                super.onServerGetAttempt(json, param);\n                this.showScore(json);\n\n                this.createDivMessageStart('[LANGM_WAIT_TO_START]');\n                return;\n            }\n\n            super.onServerGetAttempt(json, param);\n            this.updatePercent(json);\n            if (this.btnSubmit !== undefined) {\n                this.btnSubmit.style.visibility = \"hidden\";\n            }\n        }\n\n        showScore(json) {\n            let rank = json.rank;\n            let rankc = json.completedrank;\n            if (rank !== undefined && rankc !== undefined) {\n                if (parseInt(rank) < parseInt(rankc)) {\n                    json.completedrank = '';\n                    json.rank = '# ' + rank;\n                } else {\n                    json.rank = '';\n                    json.completedrank = '# ' + rankc;\n                }\n            }\n\n            let s = json.sumscore;\n            json.sumscore = this.labelScore.innerHTML;\n            super.showScore(json);\n            json.sumscore = s;\n            s = json.sumscore === undefined ? '' : '<b>' + json.sumscore + '</b>';\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0, 1);\n            }\n\n            json.rank = rank;\n            json.completedrank = rankc;\n        }\n\n        showHelpScreen(div) {\n            div.innerHTML = `<br>\n<div>[LANG_ALONE_HELP]</div><br>\n\n<table border=1>\n    <tr>\n        <td><img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" /></td>\n        <td>` + this.getStringG('js_aduel_example2') + `</td>\n    </tr>\n</table>\n        `;\n        }\n    };\n});"],"names":["define","mmoGameTypeQuiz","constructor","cIcons","this","hasHelp","autosave","autosubmit","type","createIconBar","i","nickNameHeight","Math","round","iconSize","buttonAvatarLeft","padding","buttonAvatarHeight","buttonAvatarTop","createButtonsAvatar","buttonsAvatar","style","top","createDiv","body","createDivScorePercent","createButtonSound","instance","createButtonHelp","buttonHelp","addEventListener","onClickHelp","copyrightHeight","getCopyrightHeight","areaTop","areaWidth","window","innerWidth","areaHeight","innerHeight","createDivColor","getColorGray","colorCopyright","vertical","updatePercent","json","undefined","labelPercent","s","percentcompleted","innerHTML","autoResizeText","onServerAnswer","submit","onServerFastJson","response","pos","indexOf","state","parseInt","slice","timefastjson","sendGetAttempt","sendFastJSON","onServerGetAttempt","param","qtype","showScore","createDivMessageStart","btnSubmit","visibility","rank","rankc","completedrank","sumscore","labelScore","showHelpScreen","div","getStringG"],"mappings":"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"}