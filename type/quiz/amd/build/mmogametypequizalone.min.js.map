{"version":3,"file":"mmogametypequizalone.min.js","sources":["../src/mmogametypequizalone.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n    return class MmoGameTypeQuizAlone extends MmoGameTypeQuiz {\n        constructor() {\n            super();\n            this.cIcons = this.hasHelp() ? 5 : 4;\n            this.autosave = true;\n            this.autosubmit = true;\n            this.type = 'alone';\n        }\n\n        createIconBar() {\n            let i = 0;\n            const step = this.iconSize + this.padding;\n\n            this.nickNameHeight = Math.round(this.iconSize / 3);\n\n            // Α this.buttonAvatarLeft = this.padding + i * step;\n            this.buttonAvatarHeight = Math.round(this.iconSize - this.iconSize / 3);\n            // Α this.buttonAvatarTop = this.iconSize - this.buttonAvatarHeight + this.padding;\n            this.createButtonsAvatar(1, Math.round(this.padding + (i++) * step));\n            this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n            this.createDivScorePercent('mmogame-quiz-alone', this.padding + (i++) * step,\n                this.padding + this.nickNameHeight, this.getConstrastingColor(this.color), true);\n\n            this.createButtonSound(this.padding + (i++) * step,\n                this.padding + this.nickNameHeight);\n            if (this.hasHelp()) {\n                this.createButtonHelp(this.padding + (i++) * step, this.padding);\n                this.buttonHelp.addEventListener(\"click\", () => this.onClickHelp(this.buttonHelp));\n            }\n\n            let copyrightHeight = this.getCopyrightHeight();\n\n            this.areaTop = 2 * this.padding + this.iconSize + this.nickNameHeight;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight);\n\n            this.createDivColor(\n                this.body,\n                'mmogame-quiz-alone-color',\n                0,\n                window.innerHeight - copyrightHeight - 1,\n                window.innerWidth - 1,\n                copyrightHeight,\n                this.getColorGray(this.colorCopyright)\n            );\n\n            this.vertical = this.areaHeight > this.areaWidth;\n        }\n\n        processSetAnswer(json) {\n            this.correct = json.correct;\n\n            this.playAudio(json.iscorrect !== 0 ? this.audioYes : this.audioNo);\n\n            if (json.correct !== undefined && this.qtype === \"multichoice\") {\n                this.updateScreenAfterAnswerMultichoice();\n            }\n\n            this.disableInput();\n\n            if (this.btnSubmit) {\n                this.body.removeChild(this.btnSubmit);\n                this.btnSubmit = undefined;\n            }\n\n            const btn = super.createImageButton(\n                this.area,\n                'mmogame-quiz-next',\n                this.nextLeft,\n                this.nextTop,\n                0,\n                this.iconSize,\n                'assets/next.svg'\n            );\n            btn.addEventListener(\"click\", () => {\n                this.callGetAttempt();\n                this.area.removeChild(btn);\n            });\n\n            this.showScore(json);\n        }\n\n        onServerFastJson(response) {\n            const [state, timefastjson] = response.split(\"-\").map(Number);\n            if (timefastjson !== this.timefastjson || state !== this.state) {\n                this.sendGetAttempt({mmogameid: this.mmogameid, kinduser: this.kinduser, user: this.user});\n                return;\n            }\n\n            this.sendFastJSON();\n        }\n\n        processGetAttempt(json) {\n            if (parseInt(json.state) === 0) {\n                json.qtype = '';\n                if (json.colors) {\n                    this.setColorsString(json.colors);\n                    this.createIconBar();\n                }\n                this.showScore(json);\n                this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n                return;\n            }\n\n            super.processGetAttempt(json);\n            if (this.btnSubmit) {\n                this.btnSubmit.style.visibility = \"hidden\";\n            }\n        }\n\n        showScore({rank, rankc, sumscore}) {\n            if (rank !== undefined && rankc !== undefined) {\n                if (parseInt(rank) < parseInt(rankc)) {\n                    this.completedrank = '';\n                    this.rank = `# ${rank}`;\n                } else {\n                    this.rank = '';\n                    this.completedrank = `# ${rankc}`;\n                }\n            }\n\n            const s = sumscore === undefined ? '' : `<b>${sumscore}</b>`;\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0, 1);\n            }\n        }\n\n        showHelpScreen(div) {\n            div.innerHTML = `\n                <br>\n                <div>${this.getStringG('js_alone_help')}</div><br>\n\n                <table border=1>\n                    <tr>\n                        <td><img height=\"83\" src=\"assets/aduel/example2.png\" alt=\"\" /></td>\n                        <td>${this.getStringG('js_aduel_example2')}</td>\n                    </tr>\n                </table>\n            `;\n        }\n    };\n});"],"names":["define","MmoGameTypeQuiz","constructor","super","this","cIcons","hasHelp","autosave","autosubmit","type","createIconBar","i","step","iconSize","padding","nickNameHeight","Math","round","buttonAvatarHeight","createButtonsAvatar","buttonsAvatar","style","top","createDivScorePercent","getConstrastingColor","color","createButtonSound","createButtonHelp","buttonHelp","addEventListener","onClickHelp","copyrightHeight","getCopyrightHeight","areaTop","areaWidth","window","innerWidth","areaHeight","innerHeight","createDivColor","body","getColorGray","colorCopyright","vertical","processSetAnswer","json","correct","playAudio","iscorrect","audioYes","audioNo","undefined","qtype","updateScreenAfterAnswerMultichoice","disableInput","btnSubmit","removeChild","btn","createImageButton","area","nextLeft","nextTop","callGetAttempt","showScore","onServerFastJson","response","state","timefastjson","split","map","Number","sendFastJSON","sendGetAttempt","mmogameid","kinduser","user","processGetAttempt","parseInt","colors","setColorsString","createDivMessageStart","getStringM","visibility","_ref","rank","rankc","sumscore","completedrank","concat","s","labelScore","innerHTML","autoResizeText","showHelpScreen","div","getStringG"],"mappings":"AAeAA,+CAAO,CAAC,qCACJ,SAASC,iBACT,OAAO,cAAmCA,gBACtCC,WAAAA,GACIC,QACAC,KAAKC,OAASD,KAAKE,UAAY,EAAI,EACnCF,KAAKG,UAAW,EAChBH,KAAKI,YAAa,EAClBJ,KAAKK,KAAO,OAChB,CAEAC,aAAAA,GACI,IAAIC,EAAI,EACR,MAAMC,KAAOR,KAAKS,SAAWT,KAAKU,QAElCV,KAAKW,eAAiBC,KAAKC,MAAMb,KAAKS,SAAW,GAGjDT,KAAKc,mBAAqBF,KAAKC,MAAMb,KAAKS,SAAWT,KAAKS,SAAW,GAErET,KAAKe,oBAAoB,EAAGH,KAAKC,MAAMb,KAAKU,QAAWH,IAAOC,OAC9DR,KAAKgB,cAAc,GAAGC,MAAMC,IAAOlB,KAAKU,QAAUV,KAAKW,eAAkB,KAEzEX,KAAKmB,sBAAsB,qBAAsBnB,KAAKU,QAAWH,IAAOC,KACpER,KAAKU,QAAUV,KAAKW,eAAgBX,KAAKoB,qBAAqBpB,KAAKqB,QAAQ,GAE/ErB,KAAKsB,kBAAkBtB,KAAKU,QAAWH,IAAOC,KAC1CR,KAAKU,QAAUV,KAAKW,gBACpBX,KAAKE,YACLF,KAAKuB,iBAAiBvB,KAAKU,QAAWH,IAAOC,KAAMR,KAAKU,SACxDV,KAAKwB,WAAWC,iBAAiB,SAAS,IAAMzB,KAAK0B,YAAY1B,KAAKwB,eAG1E,IAAIG,gBAAkB3B,KAAK4B,qBAE3B5B,KAAK6B,QAAU,EAAI7B,KAAKU,QAAUV,KAAKS,SAAWT,KAAKW,eACvDX,KAAK8B,UAAYlB,KAAKC,MAAMkB,OAAOC,WAAa,EAAIhC,KAAKU,SAEzDV,KAAKiC,WAAarB,KAAKC,MAAMkB,OAAOG,YAAclC,KAAK6B,QAAUF,iBAEjE3B,KAAKmC,eACDnC,KAAKoC,KACL,2BACA,EACAL,OAAOG,YAAcP,gBAAkB,EACvCI,OAAOC,WAAa,EACpBL,gBACA3B,KAAKqC,aAAarC,KAAKsC,iBAG3BtC,KAAKuC,SAAWvC,KAAKiC,WAAajC,KAAK8B,SAC3C,CAEAU,gBAAAA,CAAiBC,MACbzC,KAAK0C,QAAUD,KAAKC,QAEpB1C,KAAK2C,UAA6B,IAAnBF,KAAKG,UAAkB5C,KAAK6C,SAAW7C,KAAK8C,cAEtCC,IAAjBN,KAAKC,SAAwC,gBAAf1C,KAAKgD,OACnChD,KAAKiD,qCAGTjD,KAAKkD,eAEDlD,KAAKmD,YACLnD,KAAKoC,KAAKgB,YAAYpD,KAAKmD,WAC3BnD,KAAKmD,eAAYJ,GAGrB,MAAMM,IAAMtD,MAAMuD,kBACdtD,KAAKuD,KACL,oBACAvD,KAAKwD,SACLxD,KAAKyD,QACL,EACAzD,KAAKS,SACL,mBAEJ4C,IAAI5B,iBAAiB,SAAS,KAC1BzB,KAAK0D,iBACL1D,KAAKuD,KAAKH,YAAYC,IAAI,IAG9BrD,KAAK2D,UAAUlB,KACnB,CAEAmB,gBAAAA,CAAiBC,UACb,MAAOC,MAAOC,cAAgBF,SAASG,MAAM,KAAKC,IAAIC,QAClDH,eAAiB/D,KAAK+D,cAAgBD,QAAU9D,KAAK8D,MAKzD9D,KAAKmE,eAJDnE,KAAKoE,eAAe,CAACC,UAAWrE,KAAKqE,UAAWC,SAAUtE,KAAKsE,SAAUC,KAAMvE,KAAKuE,MAK5F,CAEAC,iBAAAA,CAAkB/B,MACd,GAA6B,IAAzBgC,SAAShC,KAAKqB,OAQd,OAPArB,KAAKO,MAAQ,GACTP,KAAKiC,SACL1E,KAAK2E,gBAAgBlC,KAAKiC,QAC1B1E,KAAKM,iBAETN,KAAK2D,UAAUlB,WACfzC,KAAK4E,sBAAsB5E,KAAK6E,WAAW,qBAI/C9E,MAAMyE,kBAAkB/B,MACpBzC,KAAKmD,YACLnD,KAAKmD,UAAUlC,MAAM6D,WAAa,SAE1C,CAEAnB,SAAAA,CAASoB,MAA0B,IAAzBC,KAACA,KAAIC,MAAEA,MAAKC,SAAEA,UAASH,UAChBhC,IAATiC,WAAgCjC,IAAVkC,QAClBR,SAASO,MAAQP,SAASQ,QAC1BjF,KAAKmF,cAAgB,GACrBnF,KAAKgF,KAAI,KAAAI,OAAQJ,QAEjBhF,KAAKgF,KAAO,GACZhF,KAAKmF,cAAa,KAAAC,OAAQH,SAIlC,MAAMI,OAAiBtC,IAAbmC,SAAyB,GAAEE,MAAAA,OAASF,SAAc,QACxDlF,KAAKsF,WAAWC,YAAcF,IAC9BrF,KAAKsF,WAAWC,UAAYF,EAC5BrF,KAAKwF,eAAexF,KAAKsF,WAAY,GAAMtF,KAAKS,SAAW,EAAGT,KAAKS,SAAW,GAAG,EAAO,EAAG,EAAG,GAEtG,CAEAgF,cAAAA,CAAeC,KACXA,IAAIH,UAASH,gDAAAA,OAEFpF,KAAK2F,WAAW,iBAAgBP,uMAAAA,OAKzBpF,KAAK2F,WAAW,qBAGjC,2EACL,EAER"}