{"version":3,"file":"mmogameui.min.js","sources":["../src/mmogameui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mod_mmogame/mmogame'], function(MmoGame) {\n    return class MmoGameUI extends MmoGame {\n\n        vertical;\n        kindSound; // Type: Number (0 = on, 1 = off, 2 = speak)\n        buttonSound;\n        colorDefinition = 0;\n        colorScore;\n\n        // Other\n        definition;\n        buttonAvatarHeight;\n        buttonAvatarTop;\n        colorBackground = 0xFFFFFF;\n\n        url;\n        mmogameid;\n        pin;\n        user;\n\n        constructor() {\n            super();\n        }\n\n        /**\n         * Returns the appropriate file for mute/unmute.\n         * @returns {string} The file path.\n         */\n        getMuteFile() {\n            return this.kindSound === 0 ? 'assets/sound-on-flat.png' : 'assets/sound-off-flat.png';\n        }\n\n        /**\n         * Plays a sound file if sound is enabled.\n         *\n         * @param {HTMLAudioElement} audioElement - The audio element to play.\n         */\n        playAudio(audioElement) {\n            if (this.kindSound !== 0 && audioElement) {\n                if (audioElement.networkState === 1) {\n                    audioElement.play();\n                }\n            }\n        }\n\n        createButtonSound(left, top) {\n            this.buttonSound = this.createButton(\n                this.body,\n                'mmogame-button-sound',\n                left,\n                top,\n                this.iconSize,\n                this.iconSize,\n                this.getMuteFile(),\n                this.getStringM('js_sound')\n            );\n            this.buttonSound.addEventListener(\"click\", () => this.onClickSound(this.buttonSound));\n        }\n\n        /**\n         * Toggles sound on or off when clicked.\n         * @param {HTMLElement} button - The sound toggle button.\n         */\n        onClickSound(button) {\n            this.kindSound = (this.kindSound + 1) % 2;\n            button.src = this.getMuteFile();\n            this.setOptions({kindSound: this.kindSound});\n        }\n\n        /**\n         * Opens the gate UI, computes sizes, and initializes settings based on the user type.\n         * @param {number} mmogameid - The game ID.\n         * @param {string} pin - The game PIN.\n         * @param {string} kinduser - The type of user (e.g., \"moodle\" or \"guid\").\n         * @param {string} user - The user identifier.\n         * @param {string} url - The game URL.\n         */\n        gateOpen(mmogameid, pin, kinduser, user, url) {\n            this.url = url;\n            this.minFontSize *= 2;\n            this.maxFontSize *= 2;\n\n            // Saves parameters to class variables.\n            this.mmogameid = mmogameid;\n            this.pin = pin;\n            this.kinduser = kinduser;\n            this.user = user;\n            this.gateComputeSizes();\n\n            this.areaTop = this.padding;\n            this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n            this.areaHeight = Math.round(window.innerHeight - this.areaTop) - this.padding;\n\n            let instance = this;\n            this.getOptions().then(function(options) {\n                options.kindsound = options.kindsound || 0;\n                options.nickname = options.nickname || '';\n                options.avatarid = options.avatarid || 0;\n                options.paletteid = options.paletteid || 0;\n                instance.kindSound = [1, 2].includes(options.kindSound) ? options.kindSound : 0;\n\n                const isReady =\n                    options.nickname &&\n                    options.avatarid !== 0 &&\n                    options.paletteid !== 0;\n\n                if (kinduser === 'moodle' && isReady) {\n                    instance.gatePlayGame(false, options.nickname, options.paletteid, options.avatarid);\n                    return;\n                }\n\n                if (kinduser === 'guid') {\n                    options.userGUID = options.userGUID || '';\n\n                    if (options.userGUID.length >= 10 && isReady) {\n                        instance.user = options.userGUID;\n                        instance.gatePlayGame(false, options.nickname, options.paletteid, options.avatarid);\n                        return;\n                    }\n                }\n                instance.gateCreateScreen();\n            })\n            /*.catch((error) => {\n                this.showError('gateOpen', error);\n            }) */;\n        }\n\n        gatePlayGame(save, nickname, paletteid, avatarid) {\n            if (this.kinduser === 'guid') {\n                if (this.user === '') {\n                    this.uuid4();\n                }\n            }\n\n            if (!save) {\n                this.nickname = nickname;\n                this.paletteid = paletteid;\n                this.avatarid = avatarid;\n                this.callGetAttempt({nickname: nickname, colorpaletteid: paletteid, avatarid: avatarid});\n                return;\n            }\n\n            let options = {nickname: nickname, avatarid: avatarid, paletteid: paletteid};\n\n            let instance = this;\n            this.setOptions(options)\n                .then(function() {\n                    instance.nickname = nickname;\n                    instance.paletteid = paletteid;\n                    instance.avatarid = avatarid;\n                    instance.callGetAttempt();\n                    return true;\n                })\n                .catch(error => {\n                    instance.showError(error.message);\n                    return false;\n                });\n        }\n\n        gateCreateScreen() {\n            this.vertical = window.innerWidth < window.innerHeight;\n            this.createArea();\n\n            if (this.vertical) {\n                this.gateCreateScreenVertical();\n            } else {\n                this.gateCreateScreenHorizontal();\n            }\n        }\n\n        gateCreateScreenVertical() {\n            let maxHeight = this.areaHeight - 5 * this.padding - this.iconSize;\n            let maxWidth = this.areaWidth;\n            let instance = this;\n            let size;\n\n            const labels = [this.getStringM('js_name') + \": \", this.getStringM('js_code'), this.getStringM('js_palette')];\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, function(fontSize) {\n                size = instance.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n                let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n                let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / instance.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                let computedHeight = heightCode + 3 * size[1] + 8 * instance.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            let gridWidthColors = maxWidth - this.padding;\n            let gridWidthAvatars = maxWidth - this.padding;\n            let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n            let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n            let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n            let rest = gridHeightColors - newHeight;\n            gridHeightColors = newHeight;\n            let gridHeightAvatars = (maxHeight - 4 * this.fontSize + rest) * 3 / 5;\n\n            // Creates the \"Code\" field.\n            let bottom;\n            if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n                // A bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n                bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize,\n                    size[0], this.getStringM('js_code') + \": \",\n                    'mmogame-gate-code-label', 'mmogame-gate-code') + 2 * this.padding;\n                this.edtCode = this.edt;\n                this.edtCode.addEventListener(\"keyup\", function() {\n                    instance.gateUpdateSubmit();\n                });\n            } else {\n                bottom = 0;\n            }\n\n            bottom = this.gateCreateLabelEditVertical(0, bottom,\n                newWidth - 2 * this.padding, this.fontSize, size[0],\n                this.getStringM('js_name') + \": \",\n                'mmogame-gate-name-label', 'mmogame-gate-name') + 2 * this.padding;\n            this.edtNickname = this.edt;\n            this.edtNickname.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n\n            this.gateCreateScreenPalette(bottom, gridWidthColors, gridHeightColors,\n                gridWidthAvatars, gridHeightAvatars);\n\n            bottom += this.fontSize + this.padding;\n\n            // Vertical\n            this.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n                gridHeightAvatars);\n\n            let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n\n            this.gateCreateButtonSubmit(maxWidth, bottom2);\n        }\n\n        gateCreateScreenHorizontal() {\n            let maxHeight = this.areaHeight - 7 * this.padding - this.iconSize;\n            let maxWidth = this.areaWidth;\n            let instance = this;\n            let size;\n\n            const sName = this.getStringM('js_name') + \": \";\n            let labels = [this.getStringM('js_code'), sName, this.getStringM('js_palette')];\n\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize,\n                function(fontSize) {\n                size = instance.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n                let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n                let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / instance.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                let computedHeight = heightCode + 2 * size[1] + 7 * instance.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            let gridWidthColors = maxWidth - this.padding;\n            let gridWidthAvatars = maxWidth - this.padding;\n            let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n            let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n            let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n            let rest = gridHeightColors - newHeight;\n            gridHeightColors = newHeight;\n            let gridHeightAvatars = Math.floor((maxHeight - 4 * this.fontSize) * 3 / 5 + rest);\n\n            // Creates the \"Code\" field.\n            let bottom;\n            if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n                // B bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n                bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize, size[0],\n                    this.getStringM('js_code')) + 2 * this.padding;\n                this.edtCode = this.edt;\n                this.edtCode.addEventListener(\"keyup\", function() {\n                    instance.gateUpdateSubmit();\n                });\n            } else {\n                bottom = 0;\n            }\n\n            // Creates the \"nickname\" field.\n            let sizeLabel = this.gateComputeLabelSize(this.fontSize, [sName]);\n            bottom = this.gateCreateLabelEditHorizontal(0, bottom,\n                newWidth - 2 * this.padding, this.fontSize,\n                sizeLabel[0], this.getStringM('js_name') + \": \",\n                'mmogame-gate-name-label', 'mmogame-gate-name');\n\n            this.edtNickname = this.edt;\n\n            this.edtNickname.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n\n            let label1 = document.createElement(\"label\");\n            label1.style.position = \"absolute\";\n            label1.style.color = this.getContrastingColor(this.colorBackground);\n            label1.innerHTML = this.getStringM('js_palette');\n            label1.style.font = \"FontAwesome\";\n            label1.style.fontSize = this.fontSize + \"px\";\n            label1.style.width = \"0px\";\n            label1.style.whiteSpace = \"nowrap\";\n            this.area.appendChild(label1);\n\n            // Button refresh color palettes\n            let btn = this.createImageButton(this.area, 'mmogame-button-gate-refresh',\n                label1.scrollWidth + this.padding, bottom, this.iconSize, this.fontSize,\n                'assets/refresh.svg', false, 'refresh');\n            this.addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors,\n                gridWidthAvatars, gridHeightAvatars, true, false);\n\n            label1.style.left = 0;\n            label1.style.color = this.getContrastingColor(this.colorBackground);\n            label1.style.top = bottom + \"px\";\n            bottom += this.fontSize + this.padding;\n\n            let label = document.createElement(\"label\");\n            label.style.position = \"absolute\";\n            label.innerHTML = this.getStringM('js_avatars');\n            label.style.font = \"FontAwesome\";\n            label.style.fontSize = this.fontSize + \"px\";\n            label.style.width = \"0 px\";\n            label.style.whiteSpace = \"nowrap\";\n            this.area.appendChild(label);\n\n            // Button refresh avatars\n            btn = this.createImageButton(this.area, 'mmogame-button-gate-refresh-avatars',\n                label.scrollWidth + this.padding, bottom + gridHeightColors, this.iconSize,\n                this.fontSize, 'assets/refresh.svg', false, 'refresh');\n            btn.addEventListener(\"click\",\n                function() {\n                    let elements = instance.area.getElementsByClassName(\"mmogame_avatar\");\n\n                    while (elements[0]) {\n                        elements[0].parentNode.removeChild(elements[0]);\n                    }\n\n                    instance.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors, 0,\n                        bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                        false, true);\n                }\n            );\n\n            // Avatar\n            label.style.left = \"0 px\";\n            label.style.color = this.getContrastingColor(this.colorBackground);\n            label.style.top = (bottom + gridHeightColors) + \"px\";\n\n            // Horizontal\n            this.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n                gridHeightAvatars);\n\n            let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n            this.btnSubmit = this.createImageButton(this.area, 'mmogame-button-gate-submit',\n                (maxWidth - this.iconSize) / 2, bottom2, 0, this.iconSize,\n                'assets/submit.svg', false, 'submit');\n            this.btnSubmit.style.visibility = 'hidden';\n            this.btnSubmit.addEventListener(\"click\",\n                function() {\n                    if (instance.edtCode !== undefined) {\n                        instance.user = instance.edtCode.value;\n                    }\n                    instance.gatePlayGame(true, instance.edtNickname.value, instance.paletteid, instance.avatarid);\n                }\n            );\n        }\n\n        gateComputeLabelSize(fontSize, aLabel) {\n            let maxWidth = 0;\n            let maxHeight = 0;\n\n            for (let i = 0; i < aLabel.length; i++) {\n                const label = document.createElement(\"label\");\n                label.style.position = \"absolute\";\n                label.innerHTML = aLabel[i];\n                label.style.whiteSpace = \"nowrap\";\n                label.style.font = \"FontAwesome\";\n                label.style.fontSize = fontSize + \"px\";\n                label.style.width = \"0px\";\n                label.style.height = \"0px\";\n                this.area.appendChild(label);\n\n                if (label.scrollWidth > maxWidth) {\n                    maxWidth = label.scrollWidth;\n                }\n\n                if (label.scrollHeight > maxHeight) {\n                    maxHeight = label.scrollHeight;\n                }\n                this.area.removeChild(label);\n            }\n\n            return [maxWidth, maxHeight];\n        }\n\n        gateCreateLabelEditVertical(left, top, width, fontSize, labelWidth, title, classnamesLabel, classnamesEdit) {\n            const label = this.createLabel(this.area, classnamesLabel, left, top, labelWidth, fontSize, title);\n            label.style.color = this.getContrastingColor(this.colorBackground);\n\n            top += label.scrollHeight;\n\n            this.edt = this.gateCreateInput(classnamesEdit, left, top, width, fontSize);\n\n            return top + fontSize + this.padding;\n        }\n\n        gateShowAvatars(left, top, width, height, countX, avatarids, avatars) {\n            if (!avatars || avatars.length === 0) {\n                return; // Exit early if no avatars exist\n            }\n\n            this.avatar = undefined;\n            const count = avatars.length;\n            let leftOriginal = left;\n            let w = Math.round(this.padding / 2) + \"px\";\n            for (let i = 0; i < count; i++) {\n                let avatarImagePath = 'assets/avatars/' + avatars[i];\n                let btn = this.createCenterImageButton(\n                    this.area,\n                    left, top,\n                    this.iconSize - this.padding, this.iconSize - this.padding,\n                    'mmogame-avatar',\n                    avatarImagePath\n                );\n                btn.classList.add(\"mmogame_avatar\");\n                let id = avatarids[i];\n                btn.addEventListener(\"click\", () => {\n                    this.gateUpdateAvatar(btn, id, w);\n                });\n\n                // Move left position after placing the button\n                left += this.iconSize;\n\n                // Reset left and move to the next row after filling countX buttons\n                if ((i + 1) % countX === 0) {\n                    top += this.iconSize;\n                    left = leftOriginal;\n                }\n            }\n        }\n\n        gateSendGetColorsAvatars(leftColors, topColors, gridWidthColors, gridHeightColors, leftAvatars, topAvatars,\n                                 gridWidthAvatars, gridHeightAvatars, updateColors = true, updateAvatars = true) {\n\n            let countXcolors = Math.floor(gridWidthColors / this.iconSize);\n            let countYcolors = Math.floor(gridHeightColors / this.iconSize);\n\n            let countXavatars = Math.floor(gridWidthAvatars / this.iconSize);\n            let countYavatars = Math.floor((gridHeightAvatars + 2 * this.padding) / this.iconSize);\n\n            if (!updateColors) {\n                countXcolors = countXcolors = 0;\n            }\n            if (!updateAvatars) {\n                countXavatars = countYavatars = 0;\n            }\n\n            let instance = this;\n            require(['core/ajax'], function(Ajax) {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: instance.mmogameid,\n                    kinduser: instance.kinduser,\n                    user: instance.user,\n                    avatars: countXavatars * countYavatars,\n                    colorpalettes: countXcolors * countYcolors,\n                };\n\n                // Calling the service through the Moodle AJAX API\n                let getAssets = Ajax.call([{\n                    methodname: 'mod_mmogame_get_assets',\n                    args: params\n                }]);\n\n                // Handling the response\n                getAssets[0].done(function({avatarids, avatars, colorpaletteids, colorpalettes}) {\n                    if (updateColors) {\n                        instance.gateShowColorPalettes(leftColors, topColors, gridWidthColors,\n                            gridHeightColors, countXcolors, countYcolors, colorpaletteids, colorpalettes);\n                    }\n                    if (updateAvatars) {\n                        instance.gateShowAvatars(leftAvatars, topAvatars, gridWidthAvatars, gridHeightAvatars, countXavatars,\n                            avatarids, avatars);\n                    }\n                }).fail(function(error) {\n                    return error;\n                });\n            });\n        }\n\n        gateShowColorPalettes(left, top, width, height, countX, countY, colorpaletteids, colorpalettes) {\n            let i = 0; // Counter for color palettes\n            const count = colorpalettes.length;\n            this.canvasColor = undefined;\n            const canvasSize = this.iconSize - this.padding * 3 / 2;\n            const parsedPalettes = colorpalettes.map(palette =>\n                palette.split(\",\").map(value => parseInt(value, 10) || 0)\n            );\n            for (let iy = 0; iy < countY; iy++) {\n                for (let ix = 0; ix < countX; ix++) {\n                    // Check if we exceed available palettes or encounter invalid data\n                    if (i >= count || !parsedPalettes[i] || !colorpaletteids[i]) {\n                        i++; // Increment and continue if invalid\n                        continue;\n                    }\n\n                    // Create a new canvas element\n                    let canvas = document.createElement('canvas');\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = `${left + ix * this.iconSize}px`;\n                    canvas.style.top = `${top + iy * this.iconSize}px`;\n                    canvas.width = canvasSize;\n                    canvas.height = canvasSize;\n                    canvas.style.cursor = 'pointer';\n                    canvas.classList.add(\"mmogame_color\");\n\n                    // Append canvas to the area\n                    this.area.appendChild(canvas);\n\n                    // Render the color palette on the canvas\n                    this.showColorPalette(canvas, parsedPalettes[i]);\n\n                    // Get the palette ID and attach a click event listener\n                    let id = colorpaletteids[i];\n                    canvas.addEventListener(\"click\", () => {\n                        this.gateUpdateColorPalette(canvas, id);\n                    });\n\n                    i++;\n                }\n            }\n            this.area.classList.add(\"palette\");\n        }\n\n        gateUpdateColorPalette(canvas, id) {\n            if (this.canvasColor !== undefined) {\n                this.canvasColor.style.borderStyle = \"none\";\n            }\n            this.canvasColor = canvas;\n            canvas.style.borderStyle = \"outset\";\n            let w = Math.round(this.padding / 2) + \"px\";\n            canvas.style.borderLeftWidth = w;\n            canvas.style.borderTopWidth = w;\n            canvas.style.borderRightWidth = w;\n            canvas.style.borderBottomWidth = w;\n\n            this.paletteid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        gateUpdateAvatar(avatar, id, w) {\n            if (this.avatar !== undefined) {\n                this.avatar.style.borderStyle = \"none\";\n            }\n            this.avatar = avatar;\n            avatar.style.borderStyle = \"outset\";\n\n            avatar.style.borderLeftWidth = w;\n            avatar.style.borderTopWidth = w;\n            avatar.style.borderRightWidth = w;\n            avatar.style.borderBottomWidth = w;\n\n            this.avatarid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        /**\n         * Updates the visibility of the submit button based on form input validation.\n         */\n        gateUpdateSubmit() {\n            const isCodeValid = this.edtCode?.value ? Number(this.edtCode.value) > 0 : true;\n            const hasAvatar = this.avatarid !== undefined;\n            const hasPalette = this.paletteid !== undefined;\n            const hasNickname = this.edtNickname?.value?.length > 0;\n\n            this.btnSubmit.style.visibility =\n                isCodeValid && hasAvatar && hasPalette && hasNickname\n                    ? 'visible'\n                    : 'hidden';\n        }\n\n        gateComputeSizes() {\n            this.computeSizes();\n            this.iconSize = Math.round(0.8 * this.iconSize);\n            this.padding = Math.round(0.8 * this.padding);\n        }\n\n        gateCreateLabelEditHorizontal(left, top, width, fontSize, labelWidth, title, classnamesLabel, classnamesEdit) {\n            const label = this.createLabel(this.area, classnamesLabel, left, top, labelWidth, fontSize, title);\n            label.style.color = this.getContrastingColor(this.colorBackground);\n\n            let ret = top + Math.max(label.scrollHeight, fontSize) + this.padding;\n\n            let leftEdit = (left + labelWidth + this.padding);\n            this.edt = this.gateCreateInput(classnamesEdit, leftEdit, top, width - leftEdit - this.padding, fontSize);\n\n            return ret;\n        }\n\n        gateCreateInput(classnames, left, top, width, fontSize) {\n            const div = document.createElement(\"input\");\n            div.style.position = \"absolute\";\n            div.style.width = width + \"px\";\n            div.style.type = \"text\";\n            div.style.fontSize = fontSize + \"px\";\n\n            div.style.left = left + \"px\";\n            div.style.top = top + \"px\";\n            div.autofocus = true;\n\n            div.classList.add(...classnames.split(/\\s+/));\n\n            this.area.appendChild(div);\n            this.edt = div;\n\n            return div;\n        }\n\n        /**\n         * Creates the screen palette UI with a label and a refresh button.\n         * @param {number} bottom - The vertical position for the elements.\n         * @param {number} gridWidthColors - The width of the color grid in pixels.\n         * @param {number} gridHeightColors - The height of the color grid in pixels.\n         * @param {number} gridWidthAvatars - The width of the avatar grid in pixels.\n         * @param {number} gridHeightAvatars - The height of the avatar grid in pixels.\n         */\n        gateCreateScreenPalette(bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars) {\n            // Create and configure the label\n            const label = this.createDOMElement('label', {\n                parent: this.area,\n                styles: {\n                    position: 'absolute',\n                    font: 'FontAwesome',\n                    fontSize: `${this.fontSize}px`,\n                    width: '0px',\n                    whiteSpace: 'nowrap',\n                    color: this.getContrastingColor(this.colorBackground),\n                    top: `${bottom}px`,\n                    left: '0px',\n                },\n                attributes: {\n                    innerHTML: this.getStringM('js_palette'),\n                },\n            });\n\n            // Create the refresh button\n            const btn = this.createImageButton(\n                this.area,\n                'mmogame-gate-palette',\n                label.scrollWidth + this.padding, bottom,\n                this.iconSize, this.fontSize,\n                'assets/refresh.svg',\n                false, 'refresh'\n            );\n\n            // Add event listener to refresh button\n            this.addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars);\n        }\n\n        gateCreateButtonSubmit = (maxWidth, bottom2) => {\n            this.btnSubmit = this.createImageButton(this.area, 'mmogame-gate-submit',\n                (maxWidth - this.iconSize) / 2, bottom2, 0, this.iconSize,\n                'assets/submit.svg', false, 'submit');\n            this.btnSubmit.style.visibility = 'hidden';\n            const instance = this;\n            this.btnSubmit.addEventListener(\"click\", function() {\n                if (instance.edtCode !== undefined) {\n                    instance.user = instance.edtCode.value;\n                }\n                instance.gatePlayGame(true, instance.edtNickname.value, instance.paletteid, instance.avatarid);\n            });\n        };\n\n\n        addEventListenerRefresh(btn, bottom, gridWidthColors, gridHeightColors, gridWidthAvatars, gridHeightAvatars,\n                                updateColors, updateAvatars) {\n            const instance = this;\n            btn.addEventListener(\"click\",\n                function() {\n                    let elements = instance.area.getElementsByClassName(\"mmogame_color\");\n\n                    while (elements[0]) {\n                        elements[0].parentNode.removeChild(elements[0]);\n                    }\n\n                    instance.gateSendGetColorsAvatars(0, bottom, gridWidthColors, gridHeightColors,\n                        0, bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                        updateColors, updateAvatars);\n                }\n            );\n        }\n\n        /**\n         * Creates the main game area.\n         */\n        createArea() {\n            if (this.area) {\n                this.body.removeChild(this.area);\n            }\n\n            this.area = this.createDiv(\n                this.body,\n                'mmogame-area',\n                this.padding,\n                this.areaTop,\n                this.areaWidth,\n                this.areaHeight\n            );\n        }\n\n        /**\n         * Creates a modal dialog.\n         * @param {string} classnames - The CSS class for the modal.\n         * @param {string} title - The title of the modal.\n         * @param {string} content - The content of the modal.\n         * @returns {HTMLElement} - The modal element.\n         */\n        createModal(classnames, title, content) {\n            const modal = this.createDOMElement('div', {\n                parent: this.body,\n                classnames: `${classnames} modal`,\n                styles: {\n                    position: 'fixed',\n                    top: '50%',\n                    left: '50%',\n                    transform: 'translate(-50%, -50%)',\n                    backgroundColor: '#fff',\n                    boxShadow: '0 4px 8px rgba(0, 0, 0, 0.2)',\n                    padding: '20px',\n                    zIndex: 1000,\n                },\n            });\n\n            const header = this.createDOMElement('div', {\n                parent: modal,\n                classnames: `${classnames}-header`,\n                styles: {\n                    fontWeight: 'bold',\n                    marginBottom: '10px',\n                },\n            });\n            header.innerText = title;\n\n            const body = this.createDOMElement('div', {\n                parent: modal,\n                classnames: `${classnames}-body`,\n            });\n            body.innerHTML = content;\n\n            const closeButton = this.createDOMElement('button', {\n                parent: modal,\n                classnames: `${classnames}-close`,\n                styles: {\n                    marginTop: '10px',\n                    display: 'block',\n                    marginLeft: 'auto',\n                    marginRight: 'auto',\n                },\n                attributes: {type: 'button'},\n            });\n            closeButton.innerText = 'Close';\n\n            closeButton.addEventListener('click', () => {\n                this.body.removeChild(modal);\n            });\n\n            return modal;\n        }\n\n\n        createDivMessage(classnames, message) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            if (this.divMessageHelp !== undefined) {\n                this.body.removeChild(this.divMessageHelp);\n                this.divMessageHelp = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaTop;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n            this.createDivMessageDo(classnames, left, top, width, height, message, height);\n\n            this.divMessage.style.top = (height - this.divMessage.scrollHeight) / 2 + \"px\";\n        }\n\n\n        createButtonsAvatar(num, left, widthNickName = 0, heightNickName = 0) {\n            if (widthNickName === 0) {\n                widthNickName = this.iconSize;\n            }\n            if (heightNickName === 0) {\n                heightNickName = this.iconSize - this.buttonAvatarHeight;\n            }\n            if (this.buttonsAvatarLeft === undefined) {\n                this.buttonsAvatarLeft = [];\n            }\n            this.buttonsAvatarLeft[num] = left;\n\n            if (this.buttonsAvatarSrc === undefined) {\n                this.buttonsAvatarSrc = [];\n            }\n            this.buttonsAvatarSrc[num] = \"\";\n\n            if (this.nicknames === undefined) {\n                this.nicknames = [];\n            }\n            this.nicknames[num] = \"\";\n\n            if (this.buttonsAvatar === undefined) {\n                this.buttonsAvatar = [];\n            }\n            this.buttonsAvatar[num] = this.createImageButton(this.body, 'mmogame-avatar' + num,\n                left, this.avatarTop, this.iconSize, this.iconSize);\n            if (num === 2 && this.avatarTop !== undefined) {\n                this.buttonsAvatar[num].title = this.getStringM('js_opponent');\n            }\n\n            if (this.divNicknames === undefined) {\n                this.divNicknames = [];\n            }\n            if (this.divNicknamesWidth === undefined) {\n                this.divNicknamesWidth = [];\n            }\n            if (this.divNicknamesHeight === undefined) {\n                this.divNicknamesHeight = [];\n            }\n            this.divNicknamesWidth[num] = widthNickName;\n            this.divNicknamesHeight[num] = heightNickName;\n\n            this.divNicknames[num] = this.createDiv(this.body, 'mmogame-gate-nickname',\n                left, this.padding, widthNickName, heightNickName);\n        }\n\n\n        createDivMessageStart(message) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaTop;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n            let height1 = height / 8;\n\n            this.createDivMessageDo('mmogame-message-start', left, top, width, height, message, height1);\n\n            top += (height1 - this.divMessage.scrollHeight) / 2;\n            this.divMessage.style.top = top + \"px\";\n\n            if (this.divMessageHelp === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"left\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.color = this.getContrastingColor(this.colorDefinition);\n                let top = this.iconSize + 3 * this.padding + height1;\n                div.style.top = (top + this.padding) + \"px\";\n                div.style.height = (height - height1) + \"px\";\n                this.divMessageHelp = div;\n                this.body.appendChild(this.divMessageHelp);\n\n                this.showHelpScreen(div, (width - 2 * this.padding), (height - height1));\n            }\n        }\n\n\n        /**\n         * Creates a score display element.\n         * @param {string} classnames - The list of classes.\n         * @param {number} left - The left position in pixels.\n         * @param {number} top - The top position in pixels.\n         * @param {number} width - The width of the score element in pixels.\n         * @param {number} height - The height of the score element in pixels.\n         * @param {number} num - Identifier for the score element.\n         */\n        createAddScore(classnames, left, top, width, height, num) {\n            const div = this.createDiv(this.body, classnames, left, top, width, height);\n            div.style.textAlign = \"center\";\n            div.style.color = this.getContrastingColor(this.colorScore);\n            div.title = this.getStringM('js_grade_last_question');\n            if (num === 1) {\n                this.labelAddScore = div;\n            } else {\n                this.labelAddScore2 = div;\n            }\n        }\n\n        updateButtonsAvatar(num, avatar, nickname) {\n            if (avatar === undefined) {\n                avatar = \"\";\n            }\n            if (nickname === undefined) {\n                nickname = \"\";\n            }\n\n            if (avatar === \"\" && nickname === \"\") {\n                this.buttonsAvatar[num].style.visibility = 'hidden';\n                this.divNicknames[num].style.visibility = 'hidden';\n                return;\n            }\n\n            if (this.nicknames[num] !== nickname || nickname === \"\") {\n                this.nicknames[num] = nickname;\n                let s = nickname;\n\n                if (nickname.length === 0) {\n                    s = avatar;\n                    let pos = s.lastIndexOf(\"/\");\n                    if (pos >= 0) {\n                        s = s.slice(pos + 1);\n                    }\n                    pos = s.lastIndexOf(\".\");\n                    if (pos >= 0) {\n                        s = s.slice(0, pos);\n                    }\n                    const filenameWithExt = avatar.split('/').pop(); // Extract the file name with its extension\n                    s = filenameWithExt.split('.').slice(0, -1).join('.'); // Remove the extension from the file name\n                }\n                s = this.repairNickname(s);\n                if (this.divNicknames[num] !== undefined && this.divNicknames[num].innerHTML !== s) {\n                    this.divNicknames[num].innerHTML = s;\n                    this.divNicknames[num].style.textAlign = \"center\";\n                    this.divNicknames[num].style.color = this.getContrastingColor(this.colorsBackground);\n                    this.autoResizeText(this.divNicknames[num], this.divNicknamesWidth[num], this.divNicknamesHeight[num], true,\n                        0, 0, 1);\n                }\n            }\n\n            if (avatar !== this.buttonsAvatarSrc[num]) {\n                this.updateImageButton(this.buttonsAvatar[num], avatar !== \"\" ? \"assets/avatars/\" + avatar : \"\");\n                this.buttonsAvatarSrc[num] = avatar;\n            }\n\n            this.buttonsAvatar[num].alt = this.divNicknames[num].innerHTML;\n\n            this.buttonsAvatar[num].style.visibility = 'visible';\n            this.divNicknames[num].style.visibility = 'visible';\n        }\n\n        callGetAttempt(extraparams) {\n            let instance = this;\n            require(['core/ajax'], function(Ajax) {\n                let params = {\n                    mmogameid: instance.mmogameid,\n                    kinduser: instance.kinduser,\n                    user: instance.user,\n                    nickname: null,\n                    colorpaletteid: null,\n                    avatarid: null,\n                };\n                if (extraparams !== undefined) {\n                    params = {...params, ...extraparams};\n                }\n                // Calling the service through the Moodle AJAX API\n                let getAttempt = Ajax.call([{\n                    methodname: 'mmogametype_quiz_get_attempt',\n                    args: params,\n                }]);\n\n                // Handling the response\n                getAttempt[0].done(function(response) {\n                    if (extraparams !== undefined && extraparams.colorpaletteid !== undefined) {\n                        instance.openGame();\n                        instance.colors = undefined;\n                    }\n                    instance.processGetAttempt(JSON.parse(response));\n                }).fail(function(error) {\n                    instance.createDivMessage('mmogame-error', error.message);\n                    return error;\n                });\n            });\n        }\n\n        /**\n         * Displays an error message on the screen.\n         * @param {string} name - The name of the error context.\n         * @param {Error} [error] - The error object to display.\n         */\n        showError(name, error) {\n            const message = error?.message || 'An unknown error occurred.';\n            this.createDivMessage('mmogame-error', message);\n        }\n\n        createDivMessageDo(classnames, left, top, width, height, message, heightmessage) {\n            if (this.divMessageBackground === undefined) {\n                let div = this.createDiv(this.body, classnames, left, top, width, height);\n                div.style.background = this.getColorHex(this.colorDefinition);\n                this.divMessageBackground = div;\n            }\n\n            if (this.divMessage === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"center\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.background = this.getColorHex(this.colorDefinition);\n                div.style.color = this.getContrastingColor(this.colorDefinition);\n                this.divMessage = div;\n            }\n            this.divMessage.innerHTML = message;\n            this.body.appendChild(this.divMessage);\n            this.autoResizeText(this.divMessage, width, heightmessage, false, this.minFontSize, this.maxFontSize, 0.5);\n        }\n};\n});"],"names":["define","MmoGame","constructor","maxWidth","bottom2","btnSubmit","this","createImageButton","area","iconSize","style","visibility","instance","addEventListener","undefined","edtCode","user","value","gatePlayGame","edtNickname","paletteid","avatarid","getMuteFile","kindSound","playAudio","audioElement","networkState","play","createButtonSound","left","top","buttonSound","createButton","body","getStringM","onClickSound","button","src","setOptions","gateOpen","mmogameid","pin","kinduser","url","minFontSize","maxFontSize","gateComputeSizes","areaTop","padding","areaWidth","Math","round","window","innerWidth","areaHeight","innerHeight","getOptions","then","options","kindsound","nickname","includes","isReady","userGUID","length","gateCreateScreen","save","uuid4","callGetAttempt","colorpaletteid","catch","error","showError","message","vertical","createArea","gateCreateScreenVertical","gateCreateScreenHorizontal","size","maxHeight","labels","fontSize","findbest","gateComputeLabelSize","heightCode","heightColors","floor","heightAvatars","gridWidthColors","gridWidthAvatars","gridHeightColors","newHeight","newWidth","rest","bottom","gridHeightAvatars","gateCreateLabelEditVertical","edt","gateUpdateSubmit","gateCreateScreenPalette","gateSendGetColorsAvatars","gateCreateButtonSubmit","sName","sizeLabel","gateCreateLabelEditHorizontal","label1","document","createElement","position","color","getContrastingColor","colorBackground","innerHTML","font","width","whiteSpace","appendChild","btn","scrollWidth","addEventListenerRefresh","label","elements","getElementsByClassName","parentNode","removeChild","aLabel","i","height","scrollHeight","labelWidth","title","classnamesLabel","classnamesEdit","createLabel","gateCreateInput","gateShowAvatars","countX","avatarids","avatars","avatar","count","leftOriginal","w","avatarImagePath","createCenterImageButton","classList","add","id","gateUpdateAvatar","leftColors","topColors","leftAvatars","topAvatars","updateColors","updateAvatars","countXcolors","countYcolors","countXavatars","countYavatars","require","Ajax","params","colorpalettes","call","methodname","args","done","colorpaletteids","gateShowColorPalettes","fail","countY","canvasColor","canvasSize","parsedPalettes","map","palette","split","parseInt","iy","ix","canvas","cursor","showColorPalette","gateUpdateColorPalette","borderStyle","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","isCodeValid","Number","hasAvatar","hasPalette","hasNickname","computeSizes","ret","max","leftEdit","classnames","div","type","autofocus","createDOMElement","parent","styles","attributes","createDiv","createModal","content","modal","transform","backgroundColor","boxShadow","zIndex","fontWeight","marginBottom","innerText","closeButton","marginTop","display","marginLeft","marginRight","createDivMessage","divMessageHelp","getCopyrightHeight","createDivMessageDo","divMessage","createButtonsAvatar","num","widthNickName","heightNickName","buttonAvatarHeight","buttonsAvatarLeft","buttonsAvatarSrc","nicknames","buttonsAvatar","avatarTop","divNicknames","divNicknamesWidth","divNicknamesHeight","createDivMessageStart","height1","textAlign","paddingLeft","paddingRight","colorDefinition","showHelpScreen","createAddScore","colorScore","labelAddScore","labelAddScore2","updateButtonsAvatar","s","pos","lastIndexOf","slice","pop","join","repairNickname","colorsBackground","autoResizeText","updateImageButton","alt","extraparams","response","openGame","colors","processGetAttempt","JSON","parse","name","heightmessage","divMessageBackground","background","getColorHex"],"mappings":"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"}