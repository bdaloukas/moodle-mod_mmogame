define("mmogametype_quiz/mmogametypequiz",["mod_mmogame/mmogameui"],(function(MmoGameUI){return class extends MmoGameUI{kinduser;user;url;pin;labelTimer;timeForSendAnswer;colorScore;colorScore2;
/**
     * Base class for Quiz mmmogame
     *
     * @module mmogametype_quiz
     * @copyright 2024 Vasilis Daloukas
     * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
     */
constructor(){super(),this.timeForSendAnswer=1e4}openGame(){super.openGame(),this.audioYes=new Audio("assets/yes1.mp3"),this.audioYes.load(),this.audioNo=new Audio("assets/no1.mp3"),this.audioNo.load()}createAnswer(left,top,width,onlyMetrics,fontSize,disabled){return this.createAnswerMultichoice(left,top,width,onlyMetrics,fontSize,disabled)}createAnswerMultichoice(left,top,width,onlyMetrics,fontSize,disabled){const n=this.answers?this.answers.length:0,aChecked=this.answer?.split(",").filter(Boolean)||[],fragment=document.createDocumentFragment(),retSize=[0,0],checkboxSize=Math.round(fontSize);this.aItemAnswer=Array(n),this.aItemLabel=Array(n),this.aItemCorrectX=new Array(n);for(let i=0;i<n;i++){const label=this.createDOMElement("label",{parent:null,classnames:"mmogame-quiz-label"+i,styles:{position:"absolute",width:width-fontSize-this.padding+"px",fontSize:`${fontSize}px`,color:this.getContrastingColor(this.colorBackground)}});if(label.innerHTML=this.answers[i],onlyMetrics){this.area.appendChild(label);const newSize=label.scrollWidth+fontSize+this.padding;retSize[0]=Math.max(retSize[0],newSize),retSize[1]+=Math.max(label.scrollHeight,fontSize)+this.padding,this.area.removeChild(label);continue}label.htmlFor="mmogame_quiz_input"+i,label.style.left=`${left+fontSize+this.padding}px`,label.style.top=`${top}px`,label.style.align="left",label.style.color=this.getContrastingColor(this.colorBackground);const checked=aChecked.includes(this.answersID[i]),item=this.createRadiobox(this.body,checkboxSize,this.colorBackground2,this.colorScore,checked,disabled);item.style.position="absolute",item.style.left=`${left}px`,item.style.top=`${top}px`,item.id="mmogame_quiz_input"+i,item.addEventListener("click",(()=>{item.classList.contains("disabled")||this.onClickRadio(i,this.colorBackground2,this.colorScore,!0)})),label.addEventListener("click",(()=>{this.onClickRadio(i,this.colorBackground2,this.colorScore,!0)})),fragment.appendChild(item),fragment.appendChild(label),this.aItemAnswer[i]=item,this.aItemCorrectX[i]=left+fontSize+this.padding,this.aItemLabel[i]=label,top+=Math.max(label.scrollHeight,fontSize)+this.padding}return this.area.appendChild(fragment),onlyMetrics?retSize:top}onClickRadio(index,colorBack,color,callSendAnswer){this.aItemAnswer[index].classList.contains("disabled")||(this.aItemAnswer.forEach(((item,i)=>{const isDisabled=item.classList.contains("disabled");i===index?(item.classList.add("checked"),this.answerid=this.answersID[i]):item.classList.remove("checked"),this.drawRadio(item,isDisabled?colorBack:16777215,color)})),this.autosave&&callSendAnswer&&this.callSetAnswer())}getSVGcorrect(size,iscorrect,colorCorrect,colorError){if(iscorrect){return'<svg aria-hidden="true" class="svg-icon iconCheckmarkLg" width="'+size+'" height="'+size+'" viewBox="0 0 36 36"><path fill="'+(void 0!==colorCorrect?this.getColorHex(colorCorrect):"#398439")+'" d="m6 14 8 8L30 6v8L14 30l-8-8v-8z"></path></svg>'}return'<svg width="'+size+'" height="'+size+'" class="bi bi-x-lg" viewBox="0 0 18 18"> <path fill="'+(void 0!==colorError?this.getColorHex(colorError):"#398439")+'" d="M1.293 1.293a1 1 0 0 1 1.414 0L8 6.586l5.293-5.293a1 1 0 1 1 1.414 1.414L9.414 8l5.293 5.293a1 1 0 0 \n                1-1.414 1.414L8 9.414l-5.293 5.293a1 1 0 0 1-1.414-1.414L6.586 8 1.293 2.707a1 1 0 0 1 0-1.414z"/></svg>'}updateScreenAfterAnswerMultichoice(){const correctAnswers=this.correct.split(",");for(let i=0;i<this.answersID.length;i++){const label=this.aItemLabel[i],isChecked=this.aItemAnswer[i].classList.contains("checked"),isCorrect=correctAnswers.includes(this.answersID[i]);if(!isCorrect&&!isChecked)continue;const labelWidth=label.scrollWidth-this.radioSize;label.style.left=`${parseInt(label.style.left)+this.radioSize}px`,label.style.width=`${labelWidth}px`,isCorrect&&(label.innerHTML=`<b>${label.innerHTML}</b>`);const top=parseInt(this.aItemAnswer[i].style.top);this.createDiv(this.area,"mmogame-quiz-correct",this.aItemCorrectX[i],top,this.radioSize,this.radioSize).innerHTML=this.getSVGcorrect(this.radioSize,isCorrect,this.colorScore,this.colorScore)}}disableInput(){this.aItemAnswer&&this.aItemAnswer.forEach((item=>{item.classList.add("disabled"),item.setAttribute("disabled","true"),this.drawRadio(item,this.colorScore,this.colorBackground2)}))}async sendFastJSON(){this.timeoutFastJSON&&clearTimeout(this.timeoutFastJSON),this.timeoutFastJSON=setTimeout((async()=>{try{const response=await fetch(`${this.url}/state.php`,{method:"POST",body:JSON.stringify({fastjson:this.fastjson,type:this.type})});if(response.ok){const data=await response.text();this.onServerFastJson(data)}}catch(error){this.showError("Error sending Fast JSON:",error)}}),this.timeForSendAnswer)}getStringT(name){return M.util.get_string(name,"mmogametype_quiz")}createDivScorePercent(parent,prefixclassname,left,top,createAddScore,colorBackground){const colorText=this.getContrastingColor(colorBackground),divMain=this.createDOMElement("div",{parent:parent,classnames:`${prefixclassname}-main`,styles:{position:"absolute",left:`${left}px`,top:`${top}px`,width:`${this.iconSize}px`,height:`${this.iconSize}px`,border:"0px solid "+this.getColorHex(colorBackground),boxShadow:"inset 0 0 0.125em rgba(255, 255, 255, 0.75)",background:this.getColorHex(colorBackground),color:colorText,borderRadius:createAddScore?0:`${this.iconSize}px`},attributes:{disabled:!0,innerHTML:""}});let heightLine1,heightLine2,heightLine3;if(createAddScore){const maxHeight=this.iconSize;heightLine1=Math.round(maxHeight/2),heightLine2=heightLine3=Math.round((maxHeight-heightLine1)/2)}else{const maxHeight=this.iconSize;heightLine1=heightLine2=Math.round(maxHeight/2),heightLine3=maxHeight-heightLine1-heightLine2}const topLine2=top+heightLine1,topLine3=topLine2+heightLine2,rankLabel=this.createDOMElement("div",{parent:parent,classnames:`${prefixclassname}-rank`,styles:{position:"absolute",left:`${left}px`,width:`${this.iconSize}px`,top:`${top}px`,height:`${heightLine1}px`,textAlign:"center",color:colorText},attributes:{title:this.getStringM("js_ranking_grade")}}),scoreLabel=this.createDOMElement("div",{parent:parent,classnames:`${prefixclassname}-score`,styles:{position:"absolute",left:`${left}px`,width:`${createAddScore?this.iconSize/2:this.iconSize}px`,top:`${topLine2}px`,height:`${heightLine2}px`,lineHeight:this.iconSize/2+"px",textAlign:"center",color:colorText},attributes:{title:this.getStringM("js_grade")}});let percentLabel,addScoreLabel;return createAddScore&&(percentLabel=this.createDOMElement("div",{parent:parent,classnames:`${prefixclassname}-percent`,styles:{position:"absolute",left:`${left+this.iconSize/2}px`,width:this.iconSize/2+"px",top:`${topLine2}px`,height:`${heightLine2}px`,textAlign:"center",fontSize:this.iconSize/3+"px",lineHeight:this.iconSize/3+"px",color:colorText},attributes:{title:this.getStringM("js_percent")}})),createAddScore&&(addScoreLabel=this.createDOMElement("div",{parent:parent,classnames:`${prefixclassname}-addscore`,styles:{position:"absolute",left:`${left+this.iconSize/2}px`,width:this.iconSize/2+"px",top:`${topLine3}px`,height:`${heightLine3}px`,textAlign:"center",fontWeight:"bold",color:colorText},attributes:{title:this.getStringM("js_percent")}})),{divMain:divMain,lblRank:rankLabel,lblScore:scoreLabel,lblPercent:percentLabel,lblAddScore:addScoreLabel,heightLine1:heightLine1,heightLine2:heightLine2,heightLine3:heightLine3}}showScore(player,score,rank,percent,rankpercent,showPercent){let showScore=!0;void 0!==rank&&void 0!==rankpercent&&parseInt(rankpercent)<parseInt(rank)&&(showScore=!1),""!==rank?(player.lblRank.innerHTML=`# ${rank}`,this.autoResizeText(player.lblRank,.8*this.iconSize,player.heightLine1,!1,0,0)):player.lblRank.innerHTML="";let s=showScore?`<b>${score}</b>`:"";void 0===player.lblPercent&&0!==parseInt(percent)&&showPercent&&(s=`<b>${percent} %</b>`),player.cacheScore!==s&&(player.cacheScore=s,player.lblScore.innerHTML=s,this.autoResizeText(player.lblScore,.9*this.iconSize/2,player.heightLine2,!1,0,0)),void 0!==player.lblPercent&&(s=!showScore||showPercent&&0!==parseInt(percent)?`<b>${percent} %</b>`:"",player.cachePercent!==s&&(player.cachePercent=s,player.lblPercent.innerHTML=s,this.autoResizeText(player.lblPercent,.9*this.iconSize/2,player.heightLine2,!1,0,0)))}createDefinition(left,top,width,height,onlyMetrics,fontSize,definition){const definitionDiv=this.createDOMElement("div",{parent:null,classnames:"mmogame-quiz-definition",styles:{position:"absolute",width:`${width}px`,fontSize:`${fontSize}px`}});if(definitionDiv.innerHTML=definition,onlyMetrics){document.body.appendChild(definitionDiv);const size=[definitionDiv.scrollWidth,definitionDiv.scrollHeight];return document.body.removeChild(definitionDiv),size}return definitionDiv.style.background=this.getColorHex(this.colorBackground2),definitionDiv.style.color=this.getContrastingColor(this.colorBackground2),definitionDiv.style.left=`${left}px`,definitionDiv.style.top=`${top}px`,0!==height&&(definitionDiv.style.height=`${height}px`),definitionDiv.style.padding=`0 ${this.padding}px`,this.area.appendChild(definitionDiv),[definitionDiv.scrollWidth,definitionDiv.scrollHeight]}callSetAnswer(){let subcommand=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";void 0!==this.timerTimeout&&clearTimeout(this.timerTimeout),this.timerTimeout=void 0,require(["core/ajax"],(Ajax=>{const params={mmogameid:this.mmogameid,kinduser:this.kinduser,user:this.user,attempt:this.attempt,answer:this.answer||null,answerid:this.answerid||null,subcommand:subcommand};Ajax.call([{methodname:"mmogametype_quiz_set_answer",args:params}])[0].done((response=>{this.processSetAnswer(JSON.parse(response))})).fail((error=>{this.showError(error)}))}))}setColors(colors){super.setColors(colors),this.colorScore=colors[2],this.colorScore2=colors[4]}updateNicknameAvatar(player,avatarSrc,nickname,nicknameWidth,nicknameHeight){if(void 0===avatarSrc&&(avatarSrc=""),void 0===nickname&&(nickname=""),""===avatarSrc&&""===nickname)return player.avatarElement.style.visibility="hidden",void(player.nicknameElement.style.visibility="hidden");if(player.cacheNickname!==nickname||""===nickname){player.cacheNickname=nickname;let s=nickname;if(0===nickname.length){const filenameWithExt=avatarSrc.split("/").pop();s=filenameWithExt.split(".").slice(0,-1).join(".")||filenameWithExt}s=this.repairNickname(s),player.nicknameElement.innerHTML=s,player.nicknameElement.style.textAlign="center",player.nicknameElement.style.color=this.getContrastingColor(this.colorBackground),this.autoResizeText(player.nicknameElement,nicknameWidth,nicknameHeight,!0,0,0)}avatarSrc!==player.cacheAvatar&&(player.avatarElement.src=""!==avatarSrc?"assets/avatars/"+avatarSrc:"",player.cacheAvatar=avatarSrc),player.avatarElement.alt=player.cacheNickname,player.avatarElement.style.visibility="visible",player.nicknameElement.style.visibility="visible"}computeBestFontSize(json){let maxHeight,definitionWidth;maxHeight=this.areaRect.height-this.iconSize-3*this.padding,definitionWidth=this.isVertical?this.areaRect.width:Math.round((this.areaRect.width-this.padding)/2);for(let step=1;step<=2;step++){let defSize;if(this.fontSize=this.findbest(1===step?this.minFontSize:this.minFontSize/2,this.maxFontSize,(fontSize=>{if(defSize=this.createDefinition(0,0,definitionWidth,0,!0,fontSize,json),defSize[0]>definitionWidth)return 1;let ansSize=this.createAnswer(0,0,definitionWidth,!0,fontSize,!1);return ansSize[0]>definitionWidth?1:this.isVertical?defSize[1]+ansSize[1]<maxHeight?-1:1:defSize[1]<maxHeight&&ansSize[1]<maxHeight?-1:1})),defSize[0]<=definitionWidth&&defSize[1]<=this.areaRect.height)break}return[definitionWidth]}createNextButton(left,top){let btn=super.createImageButton(this.area,"mmogame-quiz-next",left,top,0,this.iconSize,"assets/next.svg");btn.title=this.getStringM("js_next_question"),btn.addEventListener("click",(()=>{this.callGetAttempt(),this.area.removeChild(btn)}))}}}));

//# sourceMappingURL=mmogametypequiz.min.js.map