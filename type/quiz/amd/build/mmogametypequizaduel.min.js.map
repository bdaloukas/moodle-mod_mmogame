{"version":3,"file":"mmogametypequizaduel.min.js","sources":["../src/mmogametypequizaduel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n        return class MmoGameTypeQuizAduel extends MmoGameTypeQuiz {\n\n    isVertical; // If height > width\n    player1; // Stores all info for player1\n    player2; // Stores all info for player2\n    cIcons; // How many icons there are\n    isWaitOpponent; // True if wait someone to answer a set of questions\n    nickNameHeight; // Height of nickname\n    iconSize;\n\n    constructor() {\n        super();\n\n        // Initialize core properties\n        this.cIcons = this.isVertical ? 5 : 8 + (this.hasHelp() ? 1 : 0);\n        // B this.hasBasBottom = this.isVertical;\n\n        this.isWaitOpponent = false;\n        // this.autosubmit = true;\n        // this.type = 'aduel';\n    }\n\n    createIconBar() {\n        let i = 0;\n\n        this.clearBodyChildren();\n\n        let copyrightHeight = this.getCopyrightHeight();\n        this.nickNameHeight = Math.round(this.iconSize / 3);\n\n        this.areaRect = {\n            left: this.padding,\n            top: 2 * this.padding + this.iconSize + this.nickNameHeight,\n            width: this.areaWidth = Math.round(window.innerWidth - 2 * this.padding),\n            height: this.areaHeight = Math.round(window.innerHeight - this.areaTop - copyrightHeight),\n        };\n        if (this.isVertical) {\n            this.areaRect.height -= this.iconSize + 2 * this.padding;\n        }\n\n        this.buttonAvatarHeight = this.iconSize + this.nickNameHeight;\n        this.createButtonsAvatar(1, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, this.nickNameHeight);\n        this.buttonsAvatar[1].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n        this.player1 = this.createDivScorePercent('mmogame-quiz-aduel-player1',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight,\n            this.getContrastingColor(this.color), true);\n\n        this.player2 = this.createDivScorePercent('mmogame-quiz-aduel-player2',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight,\n            this.getContrastingColor(this.color), false);\n\n        this.createButtonsAvatar(2, Math.round(this.padding + (i++) * (this.iconSize + this.padding)),\n            2 * this.iconSize + this.padding, this.nickNameHeight);\n        this.buttonsAvatar[2].style.top = (this.padding + this.nickNameHeight) + \"px\";\n\n        this.createDivTimer(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight,\n            this.iconSize);\n        if (this.hasBasBottom === false) {\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n        } else {\n            this.createButtonSound(this.padding, this.areaTop + this.areaHeight);\n        }\n\n        if (this.hasBasBottom === false) {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + i * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + this.nickNameHeight, this.iconSize, this.iconSize, 'assets/cutred.svg');\n        } else {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                    this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (this.iconSize + this.padding), this.areaTop + this.areaHeight,\n                this.iconSize, this.iconSize, 'assets/cutred.svg');\n        }\n        this.buttonHighScore.style.visibility = 'hidden';\n        this.buttonHighScore.addEventListener(\"click\", () => {\n            this.sendGetHighScore();\n        });\n        this.button5050.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false, \"tool1\");\n        });\n        this.button5050.title = this.getStringM('js_help_5050');\n\n        let left;\n        if (this.hasBasBottom === false) {\n            left = this.padding + (i++) * (this.iconSize + this.padding);\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                left, this.padding + this.nickNameHeight, this.iconSize,\n                this.iconSize, 'assets/skip.svg');\n        } else {\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaTop + this.areaHeight, this.iconSize, this.iconSize, 'assets/skip.svg');\n        }\n        this.buttonSkip.addEventListener(\"click\", () => {\n            this.sendAnswer(\"tool2\");\n        });\n        this.buttonSkip.title = this.getStringT('js_help_skip');\n\n        if (this.hasBasBottom === false) {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                left, this.padding + this.nickNameHeight, this.iconSize,\n                this.iconSize, 'assets/wizard.svg');\n        } else {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaTop + this.areaHeight, this.iconSize, this.iconSize, 'assets/wizard.svg');\n        }\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false, \"tool3\");\n        });\n        this.buttonWizard.style.visibility = 'hidden';\n        this.buttonWizard.title = this.getStringT('js_wizarg');\n\n        if (this.hasHelp()) {\n            if (this.hasBasBottom === false) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding + this.nickNameHeight);\n            } else {\n                this.createButtonHelp(this.padding + 3 * (this.iconSize + this.padding), this.areaTop + this.areaHeight);\n            }\n            this.buttonWizard.addEventListener(\"click\", () => {\n                this.sendGetAttempt(false, \"tool3\");\n            });\n        }\n\n        this.createDivColor(this.body, 'mmogame-aduel-copyright',\n            0, window.innerHeight - copyrightHeight - 1, window.innerWidth - 1, copyrightHeight,\n            this.getColorGray(this.colorScore2));\n        this.vertical = this.areaHeight > this.areaWidth;\n    }\n\n    updateButtonTool(btn, tool) {\n        btn.style.visibility = tool !== undefined && tool !== 0 ? \"hidden\" : \"visible\";\n    }\n\n    processGetAttempt(json) {\n        if (this.buttonHighScore !== undefined) {\n            this.buttonHighScore.style.visibility = 'hidden';\n        }\n        this.computeDifClock(json.time, json.timestart, json.timeclose);\n        this.timefastjson = json.timefastjson;\n        this.fastjson = json.fastjson;\n\n        if (json.name !== undefined) {\n            window.document.title = json.name;\n        }\n\n        if (json.helpurl !== undefined) {\n            this.helpUrl = json.helpurl;\n        }\n\n        this.correct = undefined;\n        if (json.state === 0) {\n            json.qtype = '';\n            super.processGetAttempt(json);\n            this.showScore(json);\n            this.onServerGetAttemptHideButtons();\n            this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n            return;\n        }\n\n        this.state = parseInt(json.state);\n\n        // Need for a change on colors.\n        if (this.savedColors === undefined || this.savedColors !== json.colors) {\n            this.savedColors = json.colors;\n            this.colors = undefined;\n        }\n\n        if (this.colors === undefined) {\n            this.setColorsString(json.colors);\n            this.createIconBar();\n        }\n\n        this.updateButtonsAvatar(1, json.avatar, json.nickname);\n        this.updateButtonsAvatar(2, json.aduelAvatar, json.aduelNickname);\n\n        this.updateButtonTool(this.button5050, json.tool1numattempt);\n        if (json.tool3 !== undefined) {\n            json.tool2numattempt = -1;\n        } else {\n            json.tool3numattempt = -1;\n        }\n        this.updateButtonTool(this.buttonSkip, json.tool2numattempt);\n        this.updateButtonTool(this.buttonWizard, json.tool3numattempt);\n\n        this.attempt = json.attempt;\n        this.aduelPlayer = json.aduelPlayer;\n        this.aduelScore = json.aduelScore;\n        this.aduelRank = json.aduelRank;\n\n        if (json.errorcode !== undefined && json.errorcode === 'aduel_no_rivals' || json.attempt === 0) {\n            if (json.param === undefined) {\n                this.waitOponent();\n            }\n            this.hideTools();\n            this.showScore(json);\n            this.onServerGetAttemptRetry();\n            return;\n        }\n\n        this.isWaitOponent = false;\n\n        this.qtype = json.qtype;\n        if (json.qtype === 'multichoice') {\n            this.answers = [];\n            this.answersID = json.answerids;\n\n            json.answers.forEach((answer, index) => {\n                this.answers[index] = this.repairP(answer);\n            });\n        }\n        this.answer = json.answer !== undefined ? json.answer : null;\n        this.definition = this.repairP(json.definition);\n        if (json.aduelAttempt !== undefined) {\n            this.definition = json.aduelAttempt + \". \" + this.definition;\n        }\n        this.single = json.single;\n        this.autosave = json.autosave !== 0;\n        this.errorcode = json.errorcode;\n\n        // A this.readJsonFiles(json);\n        this.createScreen(json, false);\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n\n        this.updateLabelTimer();\n        this.sendFastJSON();\n    }\n\n    onServerGetAttemptHideButtons() {\n        this.button5050.style.visibility = 'hidden';\n        this.buttonSkip.style.visibility = 'hidden';\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n        this.buttonsAvatar[2].style.visibility = 'hidden';\n    }\n\n    onTimeout() {\n        this.labelTimer.innerHTML = '';\n        this.disableInput();\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.display = 'none';\n        }\n\n        this.answer = '';\n        this.answerid = 0;\n        this.callSetAnswer();\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false);\n            this.area.removeChild(btn);\n        });\n    }\n\n    waitOpponent() {\n        if (this.isWaitOponent) {\n            return;\n        }\n        this.updateButtonsAvatar(2, \"\", \"\");\n        this.createDivMessage('mmomgame-quiz-aduel-wait-opponent',\n            this.getStringT('js_aduel_wait_opponent'));\n        if (this.labelTimer !== undefined) {\n            this.labelTimer.innerHTML = \"\";\n        }\n    }\n\n    hideTools() {\n        this.updateButtonTool(this.button5050, -1);\n        this.updateButtonTool(this.buttonSkip, -1);\n        this.updateButtonTool(this.buttonWizard, -1);\n    }\n\n    processSetAnswer(json) {\n        if (json.submit === 0) {\n            return;\n        }\n\n        this.correct = json.correct;\n\n        if (json.correct !== undefined) {\n            if (this.qtype === \"multichoice\") {\n                this.onServerAnswerMultichoice(json);\n            }\n        }\n\n        this.disableInput();\n        this.buttonHighScore.style.visibility = 'visible';\n\n        this.isWaitOponent = false;\n        if (this.aItemAnswer !== undefined && json.correct !== undefined) {\n            for (let i = 0; i < this.aItemAnswer.length; i++) {\n                this.aItemAnswer[i].classList.add(\"disabled\");\n            }\n        }\n\n        if (this.btnSubmit !== undefined) {\n            this.body.removeChild(this.btnSubmit);\n            this.btnSubmit = undefined;\n        }\n\n        this.showCorrectAnswer(json);\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.callGetAttempt();\n            this.area.removeChild(btn);\n        });\n\n        this.showScore(json);\n\n        this.timeclose = 0;\n\n        if (this.aduelPlayer === 1) {\n            if (json.attempt === 0) {\n                this.timeclose = 0;\n                this.waitOpponent();\n            }\n\n            this.showScore(json);\n        }\n\n        if (this.button5050 !== undefined) {\n            this.button5050.style.visibility = 'hidden';\n            this.buttonSkip.style.visibility = 'hidden';\n        }\n    }\n\n   callSetAnswer() {\n        if (this.correct === undefined) {\n            super.callSetAnswer();\n        }\n    }\n\n    onServerAnswerMultichoice(json) {\n        let foundCorrect = false;\n\n        let aduelAnswers = json.aduelPlayer === 2 && json.aduel_useranswer !== null ? json.aduel_useranswer.split(\",\") : '';\n        let aCorrect = json.correct.split(\",\");\n        for (let i = 0; i < this.answersID.length; i++) {\n            if (this.answersID[i] === '') {\n                continue;\n            }\n\n            let label = this.aItemLabel[i];\n\n            let iscorrect1, iscorrect2;\n\n            let iscorrect = aCorrect.includes(this.answersID[i]);\n\n            if (this.aItemAnswer[i].classList.contains(\"checked\")) {\n                iscorrect1 = aCorrect.includes(this.answersID[i]);\n            }\n            if (iscorrect1) {\n                foundCorrect = true;\n            }\n\n            if (aduelAnswers.includes(this.answersID[i])) {\n                iscorrect2 = aCorrect.includes(this.answersID[i]);\n            }\n\n            if (iscorrect === false && iscorrect1 === undefined && iscorrect2 === undefined) {\n                continue;\n            }\n\n            let width = this.labelWidth;\n            let height = this.aItemLabel[i].scrollHeight;\n\n            let move = (iscorrect2 !== undefined ? 2 : 1) * this.radioSize;\n            if (iscorrect1 === undefined && iscorrect2 === undefined) {\n                move = 0;\n            }\n            width -= move;\n\n            if (move !== 0) {\n                label.style.left = (parseInt(label.style.left) + move) + \"px\";\n            }\n            this.aItemLabel[i].style.width = width + \"px\";\n            this.autoResizeText(this.aItemLabel[i], width, height, true, this.minFontSize, this.maxFontSize, 0.5);\n\n            this.onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2);\n        }\n\n        this.playAudio(foundCorrect ? this.audioYes : this.audioNo);\n    }\n\n    onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2, iscorrect) {\n        if (iscorrect) {\n            this.aItemLabel[i].innerHTML = '<b><u>' + this.aItemLabel[i].innerHTML + '</b></u>';\n        }\n\n        if (iscorrect1 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-quiz-aduel-correct-answer',\n                this.aItemCorrectX[i], t, this.radioSize, this.radioSize);\n            div.title = iscorrect1 ? this.getStringT('js_correct_answer') : this.getStringT('js_wrong_answer');\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect1, this.colorScore, this.colorScore);\n        }\n\n        if (iscorrect2 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-aduel-opponent-correct',\n                this.aItemCorrectX[i] + this.radioSize, t, this.radioSize, this.radioSize);\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect2, this.colorScore2, this.colorScore2);\n            div.title = iscorrect2 ? this.getStringM('js_correct_answer') : this.getStringM('js_wrong_answer');\n        }\n    }\n\n    showCorrectAnswer({aduel_iscorrect, iscorrect, tool2}) {\n        this.timeclose = 0;\n        this.updateLabelTimer();\n\n        this.strip = this.createDiv(this.area, 'mmogame-quiz-aduel-strip',\n            this.stripLeft, this.nextTop, this.stripWidth, this.stripHeight);\n\n        if (tool2 === undefined || this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player1',\n                this.stripLeft, this.nextTop, this.buttonsAvatar[1].width,\n            this.buttonsAvatar[1].height, this.buttonsAvatar[1].src);\n        }\n\n        if (tool2 === undefined && this.aduelPlayer === 2) {\n            this.createImage(this.area, 'mmogame-quiz-aduel-player2',\n                this.stripLeft + this.iconSize, this.nextTop, this.buttonsAvatar[2].width,\n                this.buttonsAvatar[2].height, this.buttonsAvatar[2].src);\n        }\n\n        this.strip.style.top = this.nextTop + \"px\";\n        let s = this.getSVGcorrect(this.iconSize, iscorrect !== 0, this.colorScore, this.colorScore);\n        if (tool2 !== undefined && this.aduelPlayer === 1) {\n            s = '';\n        }\n        if (this.aduelPlayer === 2 && tool2 === undefined) {\n            s += this.getSVGcorrect(this.iconSize, aduel_iscorrect !== 0, this.colorScore2, this.colorScore2);\n        }\n        this.strip.innerHTML = s;\n\n        this.strip.style.zIndex = '1';\n    }\n\n    showScore(json) {\n        let rankc = json.completedrank;\n        if (json.rank !== undefined && rankc !== undefined) {\n            if (parseInt(json.rank) < parseInt(rankc)) {\n                json.completedrank = '';\n                json.rank = '# ' + json.rank;\n            } else {\n                json.rank = '';\n                json.completedrank = '# ' + rankc;\n            }\n        }\n\n        if (json.aduelPlayer === 2) {\n            super.showScore(json);\n        } else {\n            let s = json.sumscore;\n            let sumscore = this.labelScore.innerHTML;\n            super.showScore(json);\n            json.sumscore = s;\n            s = sumscore === undefined ? '' : '<b>' + sumscore + '</b>';\n            if (this.labelScore.innerHTML !== s) {\n                this.labelScore.innerHTML = s;\n                this.autoResizeText(this.labelScore, 0.8 * this.iconSize / 2, this.iconSize / 2, false, 0, 0);\n            }\n        }\n\n        if (json.aduelPlayer === 1 || json.aduelPlayer === undefined) {\n            this.labelScore2.style.visibility = \"hidden\";\n            this.labelScoreRank2.style.visibility = \"hidden\";\n            this.buttonScore2.style.visibility = \"hidden\";\n            this.labelAddScore2.style.visibility = \"hidden\";\n        } else {\n            this.labelScore2.style.visibility = \"visible\";\n            this.labelScoreRank2.style.visibility = \"visible\";\n            this.buttonScore2.style.visibility = \"visible\";\n            this.labelAddScore2.style.visibility = \"visible\";\n\n            let rank = json.aduelRank;\n            let score = json.aduelScore;\n\n            if (json.aduelRank !== undefined && json.aduelCompletedrank !== undefined) {\n                let rank1 = parseInt(json.aduelRank);\n                let rank2 = parseInt(json.aduelCompletedrank);\n                if (rank1 <= rank2) {\n                    rank = '#' + rank1;\n                    score = json.aduelScore;\n                    this.labelScore2.title = this.getStringM('js_grade');\n                    this.labelScoreRank2.title = this.getStringM('js_position_grade');\n                } else {\n                    rank = '#' + rank2;\n                    score = Math.round(100 * json.aduelCompletedrank) + \"%\";\n                    this.labelScore2.title = this.getStringM('js_percent_opponent');\n                    this.labelScoreRank2.title = this.getStringM('js_position_percent');\n                }\n            }\n            let s = '<b>' + score + '</b>';\n            if (this.labelScore2.innerHTML !== s) {\n                this.labelScore2.innerHTML = s;\n                this.autoResizeText(this.labelScore2, this.iconSize - 2 * this.padding, this.iconSize / 2, false, 0, 0, 1);\n            }\n            this.labelScoreRank2.innerHTML = rank;\n            this.labelScoreRank2.style.lineHeight = (this.iconSize / 3) + \"px\";\n            this.autoResizeText(this.labelScoreRank2, 0.5 * this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n\n            this.labelAddScore2.innerHTML = json.aduelAddscore === undefined ? '' : json.aduelAddscore;\n            this.autoResizeText(this.labelAddScore2, this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n        }\n    }\n\n    onServerFastJson(response) {\n        if (response === '') {\n            this.sendFastJSON();\n            return;\n        }\n\n        let a = response.split('-'); // Are state,timefastjson.\n        let newstate = a.length > 0 ? parseInt(a[0]) : 0;\n        let newTimeFastJSON = a.length > 1 ? a[1] : 0;\n\n        if (this.timefastjson === null) {\n            this.timefastjson = 0;\n        }\n\n        if (newstate !== this.state || newTimeFastJSON !== this.timefastjson) {\n            this.callGetAttempt();\n            return;\n        }\n\n        this.sendFastJSON();\n    }\n\n    sendGetHighScore() {\n        let params = {\n            mmogameid: this.mmogameid,\n            kinduser: this.kinduser,\n            user: this.user,\n            count: 10,\n        };\n\n        require(['core/ajax'], (Ajax) => {\n            // Calling the service through the Moodle AJAX API\n            let getHighScore = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_highscore',\n                args: params\n            }]);\n\n            // Handling the response\n            getHighScore[0].done((response) => {\n                this.createScreenHighScore(JSON.parse(response));\n            }).fail((error) => {\n                return error;\n            });\n        });\n    }\n\n    createScreenHighScore(json) {\n        if (this.highScore !== undefined) {\n            this.body.removeChild(this.highScore);\n            this.highScore = undefined;\n            this.strip.style.visibility = 'visible';\n            this.strip.style.zIndex = '1';\n            return;\n        }\n\n        this.removeDivMessage();\n\n        if (this.vertical) {\n            this.createScreenVerticalHighScore(json);\n        } else {\n            this.createScreenHorizontalHighScore(json);\n        }\n    }\n\n    createScreenHorizontalHighScore(json) {\n        this.createScreenVerticalHighScore(json);\n    }\n\n    createScreenVerticalHighScore(json) {\n        if (json.count === 0) {\n            return;\n        }\n\n        if (this.strip !== undefined) {\n            this.strip.style.visibility = 'hidden';\n        }\n\n        this.highScore = this.createDivColor(this.body, 'mmogame-quiz-aduel-highscore-background',\n            this.areaLeft, this.areaTop,\n            this.areaWidth - this.padding, this.areaHeight - this.padding,\n            this.getColorHex(this.colorBackground));\n\n        let canvas = document.createElement('canvas');\n        canvas.style.left = '0px';\n        canvas.style.top = \"0px\";\n        canvas.width = this.areaWidth;\n        canvas.height = this.areaHeight;\n        canvas.style.zIndex = 8;\n        canvas.style.position = \"absolute\";\n\n        this.highScore.appendChild(canvas);\n\n        let ctx = canvas.getContext(\"2d\");\n        let fontSize = this.minFontSize;\n        ctx.font = fontSize + \"px sans-serif\";\n\n        this.drawHighScore1(json, ctx, fontSize);\n    }\n\n    drawHighScore1(json, ctx, fontSize) {\n        ctx.textAlign = \"center\";\n        let text1 = ctx.measureText(this.getStringT('js_ranking_order'));\n        let width1 = text1.width;\n        let text = ctx.measureText(this.getStringM('js_grade'));\n        let width2 = text.width;\n\n        let col1 = 0;\n        let col2 = col1 + width1 + this.padding;\n        let col3 = col2 + width2 + this.padding;\n        let row = Math.round(3 * fontSize * 1.2);\n\n        let results = JSON.parse(json.results);\n\n        ctx.fillStyle = this.getContrastingColor(this.colorBackground);\n\n        let y = Math.round(fontSize * 1.2);\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.getStringT('js_ranking_order'), col1 + width1 / 2, y);\n\n        ctx.fillText(this.getStringM('js_grade'), col2 + width2 / 2, y);\n\n        ctx.textAlign = \"left\";\n        ctx.fillText(this.getStringM('js_name'), col3, y);\n\n        results.forEach(player => {\n            y += row / 2 + this.padding;\n\n            ctx.textAlign = \"center\";\n            ctx.fillText(player.rank, col1 + width1 / 2, y);\n\n            ctx.fillText(player.score, col2 + width2 / 2, y);\n\n            ctx.textAlign = \"left\";\n            ctx.fillText(player.name, col3 + row - this.padding, y);\n\n            this.createImage(this.highScore, 'mmogame-quiz-aduel-player-avatars',\n                col3, y - row / 2, row - this.padding, row - this.padding,\n                'assets/avatars/' + player.avatar);\n\n            y += row / 2 - this.padding;\n        });\n    }\n\n    showHelpScreen(div) {\n        div.innerHTML = `\n<div>` + this.getStringT('js_aduel_help') + `</div>\n\n<table border=1>\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/cutred.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_cut') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/skip.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_skip') + \\`</td>\n        <td><center>\n            <img height=\"90\" src=\"../../../../assets/wizard.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_wizard') + \\`</td>\n    </tr>\n\n    <tr>\n        <td><center>\n            <img height=\"90\" src=\"../../assets/aduel/example1.png\" alt=\"\" />\n        </td><center>\n\n        <td>` + this.getStringT('js_aduel_example1') + `</td>\n        <td><center>\n            <img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" />\n        </td>\n\n        <td>\\` + this.getStringT( 'js_aduel_example2') + \\`</td>\n    </tr>\n</table>        \n        `;\n    }\n\n    /**\n     * Creates a timer display.\n     * @param {number} left - Left position in pixels.\n     * @param {number} top - Top position in pixels.\n     * @param {number} size - Timer size.\n     */\n    createDivTimer(left, top, size) {\n        const timerDiv = this.createDiv(this.body, 'mmogame-timer', left, top, size, size);\n        timerDiv.style.textAlign = 'center';\n        timerDiv.style.color = this.getContrastingColor(this.colorBackground);\n\n        timerDiv.innerHTML = '23:59';\n        this.autoResizeText(timerDiv, size, size, false, 0, 0, 1);\n        timerDiv.innerHTML = '';\n        timerDiv.title = this.getStringM('js_question_time');\n\n        this.labelTimer = timerDiv;\n    }\n\n};\n});"],"names":["define","MmoGameTypeQuiz","constructor","super","_defineProperty","this","cIcons","isVertical","hasHelp","isWaitOpponent","createIconBar","i","clearBodyChildren","left","copyrightHeight","getCopyrightHeight","nickNameHeight","Math","round","iconSize","areaRect","padding","top","width","areaWidth","window","innerWidth","height","areaHeight","innerHeight","areaTop","buttonAvatarHeight","createButtonsAvatar","buttonsAvatar","style","player1","createDivScorePercent","getContrastingColor","color","player2","createDivTimer","hasBasBottom","createButtonSound","buttonHighScore","createImageButton","body","button5050","visibility","addEventListener","sendGetHighScore","sendGetAttempt","title","getStringM","buttonSkip","sendAnswer","getStringT","buttonWizard","createButtonHelp","createDivColor","getColorGray","colorScore2","vertical","updateButtonTool","btn","tool","undefined","processGetAttempt","json","computeDifClock","time","timestart","timeclose","timefastjson","fastjson","name","document","helpurl","helpUrl","correct","state","qtype","showScore","onServerGetAttemptHideButtons","createDivMessageStart","parseInt","savedColors","colors","setColorsString","updateButtonsAvatar","avatar","nickname","aduelAvatar","aduelNickname","tool1numattempt","tool3","tool2numattempt","tool3numattempt","attempt","aduelPlayer","aduelScore","aduelRank","errorcode","param","waitOponent","hideTools","onServerGetAttemptRetry","isWaitOponent","answers","answersID","answerids","forEach","answer","index","repairP","definition","aduelAttempt","single","autosave","createScreen","btnSubmit","updateLabelTimer","sendFastJSON","onTimeout","labelTimer","innerHTML","disableInput","display","answerid","callSetAnswer","area","nextLeft","nextTop","removeChild","waitOpponent","createDivMessage","processSetAnswer","submit","onServerAnswerMultichoice","aItemAnswer","length","classList","add","showCorrectAnswer","callGetAttempt","foundCorrect","aduelAnswers","aduel_useranswer","split","aCorrect","iscorrect1","iscorrect2","label","aItemLabel","iscorrect","includes","contains","labelWidth","scrollHeight","move","radioSize","autoResizeText","minFontSize","maxFontSize","onServerAnswerMultichoiceShowCorrect","playAudio","audioYes","audioNo","t","div","createDiv","aItemCorrectX","getSVGcorrect","colorScore","_ref","aduel_iscorrect","tool2","strip","stripLeft","stripWidth","stripHeight","createImage","src","s","zIndex","rankc","completedrank","rank","sumscore","labelScore","labelScore2","labelScoreRank2","buttonScore2","labelAddScore2","score","aduelCompletedrank","rank1","rank2","lineHeight","aduelAddscore","onServerFastJson","response","a","newstate","newTimeFastJSON","params","mmogameid","kinduser","user","count","require","Ajax","call","methodname","args","done","createScreenHighScore","JSON","parse","fail","error","highScore","removeDivMessage","createScreenVerticalHighScore","createScreenHorizontalHighScore","areaLeft","getColorHex","colorBackground","canvas","createElement","position","appendChild","ctx","getContext","fontSize","font","drawHighScore1","textAlign","width1","measureText","width2","col2","col3","row","results","fillStyle","y","fillText","player","showHelpScreen","size","timerDiv"],"mappings":"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"}