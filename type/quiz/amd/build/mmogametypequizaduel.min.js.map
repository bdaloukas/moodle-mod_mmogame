{"version":3,"file":"mmogametypequizaduel.min.js","sources":["../src/mmogametypequizaduel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n        return class MmoGameTypeQuizAduel extends MmoGameTypeQuiz {\n\n    player1; // Stores all info for player1\n    player2; // Stores all info for player2\n    isWaitOpponent; // True if wait someone to answer a set of questions.\n\n    // Timer variables.\n    divTimer;\n    timerTimeout;\n\n    nextLeft; // Left position of next button.\n    nextTop; // Top position of next button.\n\n    constructor() {\n        super();\n\n        // Initialize core properties\n        this.cIcons = this.isVertical ? 5 : 8;\n\n        this.isWaitOpponent = false;\n    }\n\n    createIconBar() {\n        let i = 0;\n        const step = this.iconSize + this.padding;\n\n        const nicknameHeight = Math.round(this.iconSize / 3);\n\n        let nickname, avatar;\n        [nickname, avatar] = this.createNicknameAvatar('mmogame-quiz-alone',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player1 = this.createDivScorePercent('mmogame-quiz-aduel-player1',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), true);\n        this.player1.avatarElement = avatar;\n        this.player1.nicknameElement = nickname;\n        this.player1.cacheAvatar = '';\n        this.player1.cacheNickname = '';\n        this.player1.lblScore.title = this.getStringM('js_grade');\n        this.player1.lblRank.title = this.getStringM('js_position_grade');\n\n        [nickname, avatar] = this.createNicknameAvatar('mmogame-quiz-alone',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player2 = this.createDivScorePercent('mmogame-quiz-aduel-player2',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), false);\n        this.player2.avatarElement = avatar;\n        this.player2.nicknameElement = nickname;\n        this.player2.cacheAvatar = '';\n        this.player2.cacheNickname = '';\n        this.player2.lblScore.title = this.getStringM('js_percent_opponent');\n        this.player2.lblRank.title = this.getStringM('js_position_percent');\n\n        this.createArea(2 * this.padding + this.iconSize + nicknameHeight);\n\n        if (this.isVertical) {\n            this.areaRect.height -= this.iconSize + 2 * this.padding;\n        }\n\n        this.createDivTimer(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.iconSize);\n\n        if (this.isVertical) {\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n        } else {\n            this.createButtonSound(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n        }\n\n        if (!this.isVertical) {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height,\n                this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height,\n                this.iconSize, this.iconSize, 'assets/cutred.svg');\n        } else {\n            this.buttonHighScore = this.createImageButton(this.body, 'mmogame-quiz-highscore',\n                this.padding + i * (this.iconSize + this.padding),\n                this.padding + nicknameHeight, this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(this.body, 'mmogame-quiz-aduel-5050',\n                this.padding + (i++) * (this.iconSize + this.padding),\n                this.padding + nicknameHeight, this.iconSize, this.iconSize, 'assets/cutred.svg');\n        }\n        this.buttonHighScore.style.visibility = 'hidden';\n        this.buttonHighScore.addEventListener(\"click\", () => {\n            this.sendGetHighScore();\n        });\n        this.button5050.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool1: 1});\n        });\n        this.button5050.title = this.getStringM('js_help_5050');\n\n        let left;\n        if (this.isVertical) {\n            left = this.padding + (i++) * (this.iconSize + this.padding);\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                left, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/skip.svg');\n        } else {\n            this.buttonSkip = this.createImageButton(this.body, 'mmogame-quiz-aduel-skip',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize, 'assets/skip.svg');\n        }\n        this.buttonSkip.addEventListener(\"click\", () => {\n            this.sendAnswer(\"tool2\");\n        });\n        this.buttonSkip.title = this.getStringT('js_help_skip');\n\n        if (!this.isVertical) {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                left, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/wizard.svg');\n        } else {\n            this.buttonWizard = this.createImageButton(this.body, 'mmogame-quiz-aduel-wizard',\n                this.padding + 2 * (this.iconSize + this.padding),\n                this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize, 'assets/wizard.svg');\n        }\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool3: 1});\n        });\n        this.buttonWizard.style.visibility = 'hidden';\n        this.buttonWizard.title = this.getStringT('js_wizarg');\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool3: 1});\n        });\n\n        if (this.hasHelp()) {\n            if (!this.isVertical) {\n                this.createButtonHelp(this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n            } else {\n                this.createButtonHelp(this.padding + 3 * (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height);\n            }\n        }\n    }\n\n    updateButtonTool(btn, tool) {\n        btn.style.visibility = tool !== undefined && tool !== 0 ? \"hidden\" : \"visible\";\n    }\n\n    processGetAttempt(json) {\n        if (this.buttonHighScore !== undefined) {\n            this.buttonHighScore.style.visibility = 'hidden';\n        }\n        this.computeDifClock(json.time, json.timestart, json.timeclose);\n        this.timefastjson = json.timefastjson;\n        this.fastjson = json.fastjson;\n\n        if (json.name !== undefined) {\n            window.document.title = json.name;\n        }\n\n        this.correct = undefined;\n        if (json.state === 0) {\n            json.qtype = '';\n            super.processGetAttempt(json);\n            this.showScore(json);\n            this.onServerGetAttemptHideButtons();\n            this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n            return;\n        }\n\n        this.state = parseInt(json.state);\n\n        // Need for a change on colors.\n        if (this.savedColors === undefined || this.savedColors !== json.colors) {\n            this.savedColors = json.colors;\n            this.colors = undefined;\n        }\n\n        // Update the window title if a name is provided\n        if (json.name) {\n            document.title = json.name;\n        }\n\n        if (this.player1 === undefined) {\n            this.setColorsString(json.colors);\n            this.createIconBar();\n        }\n\n        const nicknameWidth = 2 * this.iconSize + this.padding;\n        const nicknameHeight = this.iconSize / 3;\n        this.updateNicknameAvatar(this.player1, json.avatar, json.nickname, nicknameWidth, nicknameHeight);\n        this.updateNicknameAvatar(this.player2, json.aduelAvatar, json.aduelNickname, nicknameWidth, nicknameHeight);\n\n        this.updateButtonTool(this.button5050, json.tool1numattempt);\n        if (json.tool3 !== undefined) {\n            json.tool2numattempt = -1;\n        } else {\n            json.tool3numattempt = -1;\n        }\n        this.updateButtonTool(this.buttonSkip, json.tool2numattempt);\n        this.updateButtonTool(this.buttonWizard, json.tool3numattempt);\n\n        this.attempt = json.attempt;\n        this.aduelPlayer = json.aduelPlayer;\n        this.aduelScore = json.aduelScore;\n        this.aduelRank = json.aduelRank;\n\n        if (json.errorcode !== undefined && json.errorcode === 'aduel_no_rivals' || json.attempt === 0) {\n            if (json.param === undefined) {\n                this.waitOponent();\n            }\n            this.hideTools();\n            this.showScore(json);\n            this.onServerGetAttemptRetry();\n            return;\n        }\n\n        this.isWaitOponent = false;\n\n        this.qtype = json.qtype;\n        if (json.qtype === 'multichoice') {\n            this.answers = [];\n            this.answersID = json.answerids;\n\n            json.answers.forEach((answer, index) => {\n                this.answers[index] = this.repairP(answer);\n            });\n        }\n        this.answer = json.answer !== undefined ? json.answer : null;\n        this.definition = this.repairP(json.definition);\n        if (json.aduelAttempt !== undefined) {\n            this.definition = json.aduelAttempt + \". \" + this.definition;\n        }\n        this.single = json.single;\n        this.autosave = json.autosave !== 0;\n        this.errorcode = json.errorcode;\n\n        // A this.readJsonFiles(json);\n        this.createScreen(json, false);\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n        this.updateDivTimer();\n        this.sendFastJSON();\n    }\n\n    onServerGetAttemptHideButtons() {\n        this.button5050.style.visibility = 'hidden';\n        this.buttonSkip.style.visibility = 'hidden';\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.visibility = \"hidden\";\n        }\n        this.player2.avatarElement.style.visibility = 'hidden';\n    }\n\n    onTimeout() {\n        this.divTimer.innerHTML = '';\n        this.disableInput();\n        if (this.btnSubmit !== undefined) {\n            this.btnSubmit.style.display = 'none';\n        }\n\n        this.answer = '';\n        this.answerid = 0;\n        this.callSetAnswer();\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.sendGetAttempt(false);\n            this.area.removeChild(btn);\n        });\n    }\n\n    waitOpponent() {\n        if (this.isWaitOponent) {\n            return;\n        }\n        this.updateAvatarNickname(this.player2, \"\", \"\");\n        this.createDivMessage('mmomgame-quiz-aduel-wait-opponent',\n            this.getStringT('js_aduel_wait_opponent'));\n        if (this.labelTimer !== undefined) {\n            this.labelTimer.innerHTML = \"\";\n        }\n    }\n\n    hideTools() {\n        this.updateButtonTool(this.button5050, -1);\n        this.updateButtonTool(this.buttonSkip, -1);\n        this.updateButtonTool(this.buttonWizard, -1);\n    }\n\n    processSetAnswer(json) {\n        if (json.submit === 0) {\n            return;\n        }\n\n        this.correct = json.correct;\n\n        if (json.correct !== undefined) {\n            if (this.qtype === \"multichoice\") {\n                this.onServerAnswerMultichoice(json);\n            }\n        }\n\n        this.disableInput();\n        this.buttonHighScore.style.visibility = 'visible';\n\n        this.isWaitOponent = false;\n        if (this.aItemAnswer !== undefined && json.correct !== undefined) {\n            for (let i = 0; i < this.aItemAnswer.length; i++) {\n                this.aItemAnswer[i].classList.add(\"disabled\");\n            }\n        }\n\n        if (this.btnSubmit !== undefined) {\n            this.body.removeChild(this.btnSubmit);\n            this.btnSubmit = undefined;\n        }\n\n        this.showCorrectAnswer(json);\n\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.callGetAttempt();\n            this.area.removeChild(btn);\n        });\n\n        this.showScore(json);\n\n        this.timeclose = 0;\n\n        if (this.aduelPlayer === 1) {\n            if (json.attempt === 0) {\n                this.timeclose = 0;\n                this.waitOpponent();\n            }\n\n            this.showScore(json);\n        }\n\n        if (this.button5050 !== undefined) {\n            this.button5050.style.visibility = 'hidden';\n            this.buttonSkip.style.visibility = 'hidden';\n        }\n    }\n\n   callSetAnswer() {\n        if (this.correct === undefined) {\n            super.callSetAnswer();\n        }\n    }\n\n    onServerAnswerMultichoice(json) {\n        let foundCorrect = false;\n\n        let aduelAnswers = json.aduelPlayer === 2 && json.aduelUseranswer !== null ? json.aduelUseranswer.split(\",\") : '';\n        let aCorrect = json.correct.split(\",\");\n        for (let i = 0; i < this.answersID.length; i++) {\n            if (this.answersID[i] === '') {\n                continue;\n            }\n\n            let label = this.aItemLabel[i];\n\n            let iscorrect1, iscorrect2;\n\n            let iscorrect = aCorrect.includes(this.answersID[i]);\n\n            if (this.aItemAnswer[i].classList.contains(\"checked\")) {\n                iscorrect1 = aCorrect.includes(this.answersID[i]);\n            }\n            if (iscorrect1) {\n                foundCorrect = true;\n            }\n\n            if (aduelAnswers.includes(this.answersID[i])) {\n                iscorrect2 = aCorrect.includes(this.answersID[i]);\n            }\n\n            if (iscorrect === false && iscorrect1 === undefined && iscorrect2 === undefined) {\n                continue;\n            }\n\n            let width = this.labelWidth;\n            let height = this.aItemLabel[i].scrollHeight;\n\n            let move = (iscorrect2 !== undefined ? 2 : 1) * this.radioSize;\n            if (iscorrect1 === undefined && iscorrect2 === undefined) {\n                move = 0;\n            }\n            width -= move;\n\n            if (move !== 0) {\n                label.style.left = (parseInt(label.style.left) + move) + \"px\";\n            }\n            this.aItemLabel[i].style.width = width + \"px\";\n            this.autoResizeText(this.aItemLabel[i], width, height, true, this.minFontSize, this.maxFontSize, 0.5);\n\n            this.onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2);\n        }\n\n        this.playAudio(foundCorrect ? this.audioYes : this.audioNo);\n    }\n\n    onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2, iscorrect) {\n        if (iscorrect) {\n            this.aItemLabel[i].innerHTML = '<b><u>' + this.aItemLabel[i].innerHTML + '</b></u>';\n        }\n\n        if (iscorrect1 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-quiz-aduel-correct-answer',\n                this.aItemCorrectX[i], t, this.radioSize, this.radioSize);\n            div.title = iscorrect1 ? this.getStringT('js_correct_answer') : this.getStringT('js_wrong_answer');\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect1, this.colorScore, this.colorScore);\n        }\n\n        if (iscorrect2 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-aduel-opponent-correct',\n                this.aItemCorrectX[i] + this.radioSize, t, this.radioSize, this.radioSize);\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect2, this.colorScore2, this.colorScore2);\n            div.title = iscorrect2 ? this.getStringM('js_correct_answer') : this.getStringM('js_wrong_answer');\n        }\n    }\n\n    showCorrectAnswer({iscorrect2, iscorrect, tool2}) {\n        this.timeclose = 0;\n        this.updateDivTimer();\n\n        this.strip = this.createDiv(this.area, 'mmogame-quiz-aduel-strip',\n            this.stripLeft, this.nextTop, this.stripWidth, this.stripHeight);\n\n        if (tool2 === undefined || this.aduelPlayer === 2) {\n                const btn = this.createImage(this.area, 'mmogame-quiz-aduel-player1',\n                this.stripLeft + this.iconSize / 2, this.nextTop, this.iconSize,\n            this.iconSize, \"assets/avatars/\" + this.player1.cacheAvatar);\n            btn.style.transform = 'translateX(-50%)';\n        }\n\n        if (tool2 === undefined && this.aduelPlayer === 2) {\n            const btn = this.createImage(this.area, 'mmogame-quiz-aduel-player2',\n                this.stripLeft + this.iconSize / 2 + this.iconSize, this.nextTop, this.iconSize,\n                this.iconSize, \"assets/avatars/\" + this.player2.cacheAvatar);\n            btn.style.transform = 'translateX(-50%)';\n        }\n\n        this.strip.style.top = this.nextTop + \"px\";\n        let s = this.getSVGcorrect(this.iconSize, iscorrect !== 0, this.colorScore, this.colorScore);\n        if (tool2 !== undefined && this.aduelPlayer === 1) {\n            s = '';\n        }\n        if (this.aduelPlayer === 2 && tool2 === undefined) {\n            s += this.getSVGcorrect(this.iconSize, iscorrect2 !== 0, this.colorScore2, this.colorScore2);\n        }\n        this.strip.innerHTML = s;\n\n        this.strip.style.zIndex = '1';\n    }\n\n    showScore(json) {\n        super.showScore(this.player1, json.sumscore, json.rank, json.percent, json.percentRank, true);\n        this.player1.lblAddScore.innerHTML = json.addscore === undefined ? '' : json.addscore;\n        this.autoResizeText(this.player1.lblAddScore, this.iconSize, this.player1.heightLine3, true, 0, 0, 1);\n\n        if (json.aduelPlayer === 2) {\n            this.player2.divMain.style.visibility = 'visible';\n            super.showScore(this.player2, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, true);\n        } else {\n            this.player2.divMain.style.visibility = 'hidden';\n            super.showScore(this.player2, '', '', '', '', false);\n        }\n    }\n\n    onServerFastJson(response) {\n        if (response === '') {\n            this.sendFastJSON();\n            return;\n        }\n\n        let a = response.split('-'); // Are state,timefastjson.\n        let newstate = a.length > 0 ? parseInt(a[0]) : 0;\n        let newTimeFastJSON = a.length > 1 ? a[1] : 0;\n\n        if (this.timefastjson === null) {\n            this.timefastjson = 0;\n        }\n\n        if (newstate !== this.state || newTimeFastJSON !== this.timefastjson) {\n            this.callGetAttempt();\n            return;\n        }\n\n        this.sendFastJSON();\n    }\n\n    sendGetHighScore() {\n        let params = {\n            mmogameid: this.mmogameid,\n            kinduser: this.kinduser,\n            user: this.user,\n            count: 10,\n        };\n\n        require(['core/ajax'], (Ajax) => {\n            // Calling the service through the Moodle AJAX API\n            let getHighScore = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_highscore',\n                args: params\n            }]);\n\n            // Handling the response\n            getHighScore[0].done((response) => {\n                this.createScreenHighScore(JSON.parse(response));\n            }).fail((error) => {\n                return error;\n            });\n        });\n    }\n\n    createScreenHighScore(json) {\n        if (this.highScore !== undefined) {\n            this.body.removeChild(this.highScore);\n            this.highScore = undefined;\n            this.strip.style.visibility = 'visible';\n            this.strip.style.zIndex = '1';\n            return;\n        }\n\n        this.removeDivMessage();\n\n        let child;\n        while ((child = this.area.firstChild)) {\n            this.area.removeChild(child);\n        }\n\n        if (this.vertical) {\n            this.createScreenVerticalHighScore(json);\n        } else {\n            this.createScreenHorizontalHighScore(json);\n        }\n    }\n\n    createScreenHorizontalHighScore(json) {\n        this.createScreenVerticalHighScore(json);\n    }\n\n    createScreenVerticalHighScore(json) {\n        if (json.count === 0) {\n            return;\n        }\n\n        if (this.strip !== undefined) {\n            this.strip.style.visibility = 'hidden';\n        }\n\n        this.highScore = this.createDivColor(this.body, 'mmogame-quiz-aduel-highscore-background',\n            this.areaRect.left, this.areaRect.top,\n            this.areaRect.width - this.padding, this.areaRect.height - this.padding,\n            this.getColorHex(this.colorBackground));\n\n        let canvas = document.createElement('canvas');\n        canvas.style.left = '0px';\n        canvas.style.top = \"0px\";\n        canvas.width = this.areaRect.width;\n        canvas.height = this.areaRect.height;\n        canvas.style.zIndex = 8;\n        canvas.style.position = \"absolute\";\n\n        this.highScore.appendChild(canvas);\n\n        let ctx = canvas.getContext(\"2d\");\n        let fontSize = this.minFontSize;\n        ctx.font = fontSize + \"px sans-serif\";\n\n        this.drawHighScore1(json, ctx, fontSize);\n    }\n\n    drawHighScore1(json, ctx, fontSize) {\n        ctx.textAlign = \"center\";\n        let text1 = ctx.measureText(this.getStringT('js_ranking_order'));\n        let width1 = text1.width;\n        let text = ctx.measureText(this.getStringM('js_grade'));\n        let width2 = text.width;\n\n        let col1 = 0;\n        let col2 = col1 + width1 + this.padding;\n        let col3 = col2 + width2 + this.padding;\n        let row = Math.round(3 * fontSize * 1.2);\n\n        let results = JSON.parse(json.results);\n\n        ctx.fillStyle = this.getContrastingColor(this.colorBackground);\n\n        let y = Math.round(fontSize * 1.2);\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.getStringT('js_ranking_order'), col1 + width1 / 2, y);\n\n        ctx.fillText(this.getStringM('js_grade'), col2 + width2 / 2, y);\n\n        ctx.textAlign = \"left\";\n        ctx.fillText(this.getStringM('js_name'), col3, y);\n\n        results.forEach(player => {\n            y += row / 2 + this.padding;\n\n            ctx.textAlign = \"center\";\n            ctx.fillText(player.rank, col1 + width1 / 2, y);\n\n            ctx.fillText(player.score, col2 + width2 / 2, y);\n\n            ctx.textAlign = \"left\";\n            ctx.fillText(player.name, col3 + row - this.padding, y);\n\n            this.createImage(this.highScore, 'mmogame-quiz-aduel-player-avatars',\n                col3, y - row / 2, row - this.padding, row - this.padding,\n                'assets/avatars/' + player.avatar);\n\n            y += row / 2 - this.padding;\n        });\n    }\n\n    showHelpScreen(div) {\n        div.innerHTML = `\n<div>` + this.getStringT('js_aduel_help') + `</div>\n\n<table class=\"mmogame-table-help\">\n    <tr>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/cutred.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_cut') + \\`</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/skip.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_skip') + \\`</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/wizard.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_wizard') + \\`</td>\n    </tr>\n\n    <tr>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../assets/aduel/example1.png\" alt=\"\" />\n        </td>\n\n        <td>` + this.getStringT('js_aduel_example1') + `</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" />\n        </td>\n\n        <td>\\` + this.getStringT( 'js_aduel_example2') + \\`</td>\n    </tr>\n</table>        \n        `;\n    }\n\n    /**\n     * Creates a timer display.\n     * @param {number} left - Left position in pixels.\n     * @param {number} top - Top position in pixels.\n     * @param {number} size - Timer size.\n     */\n    createDivTimer(left, top, size) {\n        this.divTimer = this.createDOMElement('div', {\n            parent: this.body,\n            classnames: 'mmogame-button-sound',\n            styles: {\n                position: 'absolute',\n                left: `${left}px`,\n                top: `${top}px`,\n                width: `${size}px`,\n                height: `${size}px`,\n                textAlign: 'center',\n                color: this.getContrastingColor(this.colorBackground),\n            },\n            attributes: {\n                src: this.getMuteFile(),\n                alt: this.getStringM('js_sound'),\n                role: 'button',\n            },\n        });\n\n        this.divTimer.innerHTML = '23:59';\n        this.autoResizeText(this.divTimer, size, size, false, 0, 0);\n        this.divTimer.innerHTML = '';\n        this.divTimer.title = this.getStringM('js_question_time');\n    }\n\n    updateDivTimer() {\n        // Exit if labelTimer or timeclose are undefined\n        if (!this.divTimer || !this.timeclose) {\n            return;\n        }\n\n        // Calculate the remaining time in seconds\n        const now = Date.now() / 1000; // Get current time in seconds\n        let remainingTime = Math.max(0, this.timeclose - now);\n\n        // If no time is remaining, clear the label and handle timeout\n        if (remainingTime === 0) {\n            this.divTimer.innerHTML = '';\n            this.onTimeout();\n            return;\n        }\n\n        // Format the remaining time as mm:ss\n        const minutes = Math.floor(remainingTime / 60);\n        const seconds = String(Math.floor(remainingTime % 60)).padStart(2, '0');\n        this.divTimer.innerHTML = `${minutes}:${seconds}`;\n\n        // Set a timeout to update the timer every 500ms\n        this.timerTimeout = setTimeout(() => this.updateDivTimer(), 500);\n    }\n    createScreen(json, disabled) {\n        if (this.endofgame) {\n            // Display end-of-game message and final score\n            this.createDivMessage('mmogame-endofgame', this.getStringM('js_game_over'));\n            this.showScore(json);\n            return;\n        }\n\n        let child;\n        while ((child = this.area.firstChild)) {\n            this.area.removeChild(child);\n        }\n\n        // Render the screen layout based on orientation (vertical or horizontal)\n        if (this.vertical) {\n            this.createScreenVertical(json, disabled);\n        } else {\n            this.createScreenHorizontal(json, disabled);\n        }\n\n        // Display the current score\n        this.showScore(json);\n    }\n\n    createScreenHorizontal(json, disabled) {\n        let maxHeight = this.areaRect.height - 2 * this.padding;\n\n        if (!this.hideSubmit) {\n            maxHeight -= this.iconSize + this.padding; // Reserve space for submit button\n        }\n        const width = Math.round((this.areaRect.width - this.padding) / 2);\n        for (let step = 1; step <= 2; step++) {\n            let defSize;\n            this.fontSize = this.findbest(step === 1 ? this.minFontSize : this.minFontSize / 2, this.maxFontSize,\n                (fontSize) => {\n                defSize = this.createDefinition(0, 0, width - this.padding, 0, true, fontSize,\n                    json.definition);\n                if (defSize[0] >= width) {\n                    return 1;\n                }\n                let ansSize = this.createAnswer(0, 0, width - this.padding, true, fontSize, disabled);\n                    if (ansSize[0] >= width) {\n                        return 1;\n                    }\n                    return defSize[1] < maxHeight && ansSize[1] < maxHeight ? -1 : 1;\n            });\n            if (defSize[0] <= width && defSize[1] <= this.areaRect.height) {\n                break;\n            }\n        }\n\n        this.radioSize = Math.round(this.fontSize);\n        const heightAnswer = this.createAnswer(width, 0, width - this.padding, false, this.fontSize, disabled);\n\n        this.createDefinition(0, 0, width - this.padding, heightAnswer, false, this.fontSize, json.definition);\n\n        this.nextTop = heightAnswer + this.padding;\n\n        if (!this.hideSubmit) {\n            // Create and position the submit button\n            this.btnSubmit = this.createImageButton(\n                this.body,\n                'mmogame-quiz-submit',\n                width + (width - this.iconSize) / 2,\n                this.nextTop,\n                0,\n                this.iconSize,\n                'assets/submit.svg',\n                false,\n                'submit'\n            );\n            this.btnSubmit.addEventListener('click', () => {\n                this.sendAnswer();\n            });\n        }\n\n        // Adjust strip dimensions\n        this.stripLeft = width + this.padding;\n        this.stripWidth = 2 * this.iconSize;\n        this.stripHeight = this.iconSize;\n    }\n\n        };\n});"],"names":["define","MmoGameTypeQuiz","player1","player2","isWaitOpponent","divTimer","timerTimeout","nextLeft","nextTop","constructor","super","this","cIcons","isVertical","createIconBar","i","step","iconSize","padding","nicknameHeight","Math","round","nickname","avatar","left","createNicknameAvatar","createDivScorePercent","getContrastingColor","color","avatarElement","nicknameElement","cacheAvatar","cacheNickname","lblScore","title","getStringM","lblRank","createArea","areaRect","height","createDivTimer","createButtonSound","buttonHighScore","createImageButton","body","button5050","top","style","visibility","addEventListener","sendGetHighScore","callGetAttempt","tool1","buttonSkip","sendAnswer","getStringT","buttonWizard","tool3","hasHelp","createButtonHelp","updateButtonTool","btn","tool","undefined","processGetAttempt","json","computeDifClock","time","timestart","timeclose","timefastjson","fastjson","name","window","document","correct","state","qtype","showScore","onServerGetAttemptHideButtons","createDivMessageStart","parseInt","savedColors","colors","setColorsString","nicknameWidth","updateNicknameAvatar","aduelAvatar","aduelNickname","tool1numattempt","tool2numattempt","tool3numattempt","attempt","aduelPlayer","aduelScore","aduelRank","errorcode","param","waitOponent","hideTools","onServerGetAttemptRetry","isWaitOponent","answers","answersID","answerids","forEach","answer","index","repairP","definition","aduelAttempt","single","autosave","createScreen","btnSubmit","updateDivTimer","sendFastJSON","onTimeout","innerHTML","disableInput","display","answerid","callSetAnswer","area","sendGetAttempt","removeChild","waitOpponent","updateAvatarNickname","createDivMessage","labelTimer","processSetAnswer","submit","onServerAnswerMultichoice","aItemAnswer","length","classList","add","showCorrectAnswer","foundCorrect","aduelAnswers","aduelUseranswer","split","aCorrect","iscorrect1","iscorrect2","label","aItemLabel","iscorrect","includes","contains","width","labelWidth","scrollHeight","move","radioSize","autoResizeText","minFontSize","maxFontSize","onServerAnswerMultichoiceShowCorrect","playAudio","audioYes","audioNo","t","div","createDiv","aItemCorrectX","getSVGcorrect","colorScore","colorScore2","_ref","tool2","strip","stripLeft","stripWidth","stripHeight","createImage","transform","s","zIndex","sumscore","rank","percent","percentRank","lblAddScore","addscore","heightLine3","divMain","aduelPercent","aduelPercentRank","onServerFastJson","response","a","newstate","newTimeFastJSON","params","mmogameid","kinduser","user","count","require","Ajax","call","methodname","args","done","createScreenHighScore","JSON","parse","fail","error","highScore","child","removeDivMessage","firstChild","vertical","createScreenVerticalHighScore","createScreenHorizontalHighScore","createDivColor","getColorHex","colorBackground","canvas","createElement","position","appendChild","ctx","getContext","fontSize","font","drawHighScore1","textAlign","width1","measureText","width2","col2","col3","row","results","fillStyle","y","fillText","player","score","showHelpScreen","size","createDOMElement","parent","classnames","styles","attributes","src","getMuteFile","alt","role","now","Date","remainingTime","max","minutes","floor","seconds","String","padStart","setTimeout","disabled","endofgame","createScreenVertical","createScreenHorizontal","maxHeight","hideSubmit","defSize","findbest","createDefinition","ansSize","createAnswer","heightAnswer"],"mappings":"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"}