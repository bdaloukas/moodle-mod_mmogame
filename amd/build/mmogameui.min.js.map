{"version":3,"file":"mmogameui.min.js","sources":["../src/mmogameui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mod_mmogame/mmogame'], function(MmoGame) {\n    return class MmoGameUI extends MmoGame {\n\n        isVertical;\n        kindSound; // Type: Number (0 = on, 1 = off, 2 = speak)\n        buttonSound;\n        colorBackground2;\n\n        // Other\n        nickname;\n        user;\n        paletteid;\n        avatarid;\n        iconSize;\n        padding;\n\n        // Area\n        area;\n        areaRect;\n\n        // Form fields\n        edtNickname;\n\n        // Gate variables\n        mmogameid;\n\n        // Messages\n        divMessage;\n        divMessageHelp;\n        divMessageBackground;\n\n        constructor() {\n            super();\n            this.isVertical = window.innerWidth < window.innerHeight;\n            this.area = undefined;\n        }\n\n        /**\n         * Returns the appropriate file for mute/unmute.\n         * @returns {string} The file path.\n         */\n        getSoundFile() {\n            return this.kindSound === 0 ? 'assets/sound-on-flat.png' : 'assets/sound-off-flat.png';\n        }\n\n        /**\n         * Plays a sound file if sound is enabled.\n         *\n         * @param {HTMLAudioElement} audioElement - The audio element to play.\n         */\n        async playSound(audioElement) {\n            if (this.kindSound !== 0 && audioElement) {\n                try {\n                    await audioElement.play();\n                } catch (error) {\n                    this.showError(\"Playback failed:\", error);\n                }\n            }\n        }\n\n        createButtonSound(parent, left, top) {\n            this.buttonSound = this.createDOMElement('img', {\n                parent: parent,\n                classnames: 'mmogame-button-sound',\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${top}px`,\n                    width: `${this.iconSize}px`,\n                    height: `${this.iconSize}px`,\n                },\n                attributes: {\n                    src: this.getSoundFile(),\n                    alt: this.getStringM('js_sound'),\n                    role: 'button',\n                },\n            });\n            this.buttonSound.addEventListener(\"click\", () => this.onClickSound(this.buttonSound));\n        }\n\n        /**\n         * Toggles sound on or off when clicked.\n         * @param {HTMLElement} button - The sound toggle button.\n         */\n        onClickSound(button) {\n            this.kindSound = (this.kindSound + 1) % 2;\n            button.src = this.getSoundFile();\n            this.setOption('kindSound', {value: this.kindSound});\n        }\n\n        /**\n         * Opens the gate UI, computes sizes, and initializes settings based on the user type.\n         * @param {number} mmogameid - The game ID.\n         * @param {string} pin - The game PIN.\n         * @param {string} kinduser - The type of user (e.g., \"moodle\" or \"guid\").\n         * @param {string} user - The user identifier.\n         * @param {string} url - The game URL.\n         */\n        /*async gateOpen(mmogameid, pin, kinduser, user, url) {\n            super.gateOpen(mmogameid, pin, kinduser, user, url);\n\n            await this.callGetAttempt();\n        }*/\n        async gateOpen(mmogameid, pin, kinduser, user, modelparams, url) {\n            this.mmogameid = mmogameid;\n            this.pin = pin;\n            this.kinduser = kinduser;\n            this.screen = 0;\n            this.url = url;\n\n            if (this.kinduser === 'guid') {\n                const option = await this.getOption('guid' + mmogameid);\n                if (option === null) {\n                    this.user = crypto.randomUUID();\n                    this.setOption('guid' + mmogameid, {value: this.user});\n                } else {\n                    this.user = option.value;\n                }\n            } else {\n                this.kinduser = user;\n            }\n            this.gateCreateScreen();\n            //console.log(\"this.gateSendGetAssets\");\n            //this.gateSendGetAssets();\n        }\n\n        gateSendGetAssets() {\n            console.log(\"gateSendGetAssets\");\n            require(['core/ajax'], (Ajax) => {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    countsplit: 1,\n                    countpalettes: this.countPalettes,\n                    countavatars: this.countXavatars * this.countYavatars,\n                };\n                console.log(\"params=\",params);\n                // Calling the service through the Moodle AJAX API\n                let getAssets = Ajax.call([{\n                    methodname: 'mod_mmogame_get_assets_split',\n                    args: params\n                }]);\n                console.log(\"before done\");\n                // Handling the response\n                getAssets[0].done(({avatarids, avatars, colorpaletteids, colorpalettes, numavatars}) => {\n                    this.info = {\n                        avatarids: avatarids,\n                        avatars: avatars,\n                        colorpaletteids: colorpaletteids,\n                        colorpalettes: colorpalettes,\n                        numavatars: numavatars,\n                    };\n                    console.log(this.info);\n                    this.gateCreateScreen();\n                }).fail((error) => {\n                    console.log(\"fail \", error);\n                    return error;\n                });\n            });\n        }\n\n\n        gateCreateScreen() {\n            while (this.body.firstChild) {\n                this.body.removeChild(this.body.firstChild);\n            }\n            this.area = undefined;\n\n            this.gateCompute();\n\n            let maxHeight = this.areaRect.height - 5 * this.padding - this.iconSize;\n            let maxWidth = this.areaRect.width;\n            let size;\n            const labels = [\n                `${this.getStringM('js_name')}: `,\n                this.getStringM('js_code'),\n                this.getStringM('js_palette')\n            ];\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, (fontSize) => {\n                size = this.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n\n                const heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / this.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                const heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                const computedHeight = 3 * size[1] + 8 * this.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            this.gateCreateScreenDo(maxWidth, maxHeight);\n        }\n\n        gateCreateScreenDo(maxWidth, maxHeight) {\n            console.log(\"gateCreateScreenDo\");\n            // Creates the \"nickname\" field.\n            let top = this.gateCreateNickname(0, maxWidth) + this.padding;\n            this.edtNickname.focus();\n\n            // Palette\n            const [lblPalette, btnPalette] = this.gateCreateLabelRefresh(top, this.getStringM('js_palette'),\n                'mmogame-gate-palette-label', 'mmogame-gate-palette-refresh', 'assets/refresh.svg');\n            top += lblPalette.scrollHeight + this.padding;\n            const topGridPalette = top;\n            let gridHeightPalette = (maxHeight - topGridPalette - lblPalette.scrollHeight) * 2 / 5;\n            const countX = Math.floor((maxWidth - this.padding) / this.iconSize);\n            const countYpalette = Math.floor(gridHeightPalette / this.iconSize);\n            gridHeightPalette = countYpalette * this.iconSize;\n            top += gridHeightPalette + this.padding;\n            // Label Avatars\n            const [lblAvatars, btnAvatars] = this.gateCreateLabelRefresh(top, this.getStringM('js_avatars'),\n                'mmogame-gate-avatars-label', 'mmogame-gate-avatars-refresh', 'assets/refresh.svg');\n\n            top += lblAvatars.scrollHeight + this.padding;\n\n            const countYavatars = Math.floor(Math.floor(maxHeight - top - this.padding) / this.iconSize);\n            const gridHeightAvatars = countYavatars * this.iconSize;\n\n            this.addEventListenerRefresh(btnPalette, topGridPalette, countX, countYpalette,\n                top, countX, countYavatars, true, false);\n\n            this.addEventListenerRefresh(btnAvatars, topGridPalette, countX, countYpalette,\n                top, countX, countYavatars, false, true);\n\n            // Horizontal\n            this.gateSendGetColorsAvatars(0, topGridPalette, countX, countYpalette,\n                0, top, countX, countYavatars, true, true);\n\n            this.gateCreateSubmit(top + gridHeightAvatars + 2 * this.padding, maxWidth);\n        }\n\n        gateCreateNickname(top, maxWidth) {\n            const lblNickname = this.createDOMElement('label', {\n                parent: this.area,\n                classnames: 'mmogame-gate-name-label',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: '0',\n                    top: `${top}px`,\n                    width: '0',\n                    color: this.getContrastingColor(this.colorBackground),\n                },\n            });\n            lblNickname.innerHTML = this.getStringM('js_name') + \": \";\n\n            if (this.isVertical) {\n                top += lblNickname.scrollHeight + this.padding;\n            }\n\n            const leftEdit = this.isVertical ? 0 : lblNickname.scrollWidth + this.padding;\n            const width = this.isVertical ? maxWidth : maxWidth - 2 * this.padding;\n            this.edtNickname = this.createDOMElement('input', {\n                parent: this.area,\n                classnames: 'mmogame-gate-name',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${leftEdit}px`,\n                    top: `${top}px`,\n                    width: `${width - leftEdit - this.padding}px`\n                },\n            });\n            this.edtNickname.addEventListener(\"keyup\", this.debounce(() => this.gateUpdateSubmit(), 300));\n            top += this.padding + (this.isVertical ? this.fontSize : Math.max(lblNickname.scrollHeight, this.fontSize));\n\n            return top;\n        }\n\n        gateCreateSubmit(top, maxWidth) {\n            this.btnSubmit = this.createDOMElement('img', {\n                parent: this.area,\n                classnames: 'mmogame-button-gate-submit',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${(maxWidth - this.iconSize) / 2}px`,\n                    top: `${top}px`,\n                    height: `${this.iconSize}px`,\n                    color: this.getContrastingColor(this.colorBackground),\n                    cursor: 'pointer',\n                    visibility: 'hidden',\n                },\n                attributes: {\n                    src: 'assets/submit.svg',\n                }\n            });\n            this.btnSubmit.addEventListener(\"click\", () => {\n                // This.gatePlayGame(true, this.edtNickname.value, this.paletteid, this.avatarid);\n                this.callGetAttempt(\n                    {nickname: this.edtNickname.value, colorpaletteid: this.paletteid, avatarid: this.avatarid},\n                );\n            });\n        }\n\n        gateComputeLabelSize(fontSize, aLabel) {\n            let maxWidth = 0;\n            let maxHeight = 0;\n\n            for (let i = 0; i < aLabel.length; i++) {\n                const label = document.createElement(\"label\");\n                label.style.position = \"absolute\";\n                label.innerHTML = aLabel[i];\n                label.style.whiteSpace = \"nowrap\";\n                label.style.font = \"FontAwesome\";\n                label.style.fontSize = fontSize + \"px\";\n                label.style.width = \"0px\";\n                label.style.height = \"0px\";\n                this.area.appendChild(label);\n\n                if (label.scrollWidth > maxWidth) {\n                    maxWidth = label.scrollWidth;\n                }\n\n                if (label.scrollHeight > maxHeight) {\n                    maxHeight = label.scrollHeight;\n                }\n                this.area.removeChild(label);\n            }\n\n            return [maxWidth, maxHeight];\n        }\n\n        gateShowAvatars(left, top, countX, countY, avatarids, avatars) {\n            if (!avatars || avatars.length === 0) {\n                return; // Exit early if no avatars exist\n            }\n\n            // Delete all previous avatar icons.\n            const elements = document.querySelectorAll('.mmogame-avatar');\n            elements.forEach(element => element.remove());\n\n            const fragment = document.createDocumentFragment();\n\n            this.avatar = undefined;\n            const count = avatars.length;\n            let leftOriginal = left;\n            let w = Math.round(this.padding / 2) + \"px\";\n            for (let i = 0; i < count; i++) {\n                let avatarImagePath = 'assets/avatars/' + avatars[i];\n                let btn = this.createCenterImageButton(\n                    fragment,\n                    left, top,\n                    this.iconSize - this.padding, this.iconSize - this.padding,\n                    'mmogame-avatar',\n                    avatarImagePath\n                );\n                btn.classList.add(\"mmogame-avatar\");\n                let id = avatarids[i];\n                btn.addEventListener(\"click\", () => {\n                    this.gateUpdateAvatar(btn, id, w);\n                });\n\n                // Move left position after placing the button\n                left += this.iconSize;\n\n                // Reset left and move to the next row after filling countX buttons\n                if ((i + 1) % countX === 0) {\n                    top += this.iconSize;\n                    left = leftOriginal;\n                }\n            }\n            this.area.appendChild(fragment);\n        }\n\n        gateSendGetColorsAvatars(leftPalette, topPalette, countXpalette, countYpalette,\n                                 leftAvatars, topAvatars, countXavatars, countYavatars,\n                                 updatePalette = true, updateAvatars = true) {\n            require(['core/ajax'], (Ajax) => {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    avatars: updateAvatars ? countXavatars * countYavatars : 0,\n                    colorpalettes: updatePalette ? countXpalette * countYpalette : 0,\n                };\n                // Calling the service through the Moodle AJAX API\n                let getAssets = Ajax.call([{\n                    methodname: 'mod_mmogame_get_assets',\n                    args: params\n                }]);\n\n                // Handling the response\n                getAssets[0].done(({avatarids, avatars, colorpaletteids, colorpalettes}) => {\n                    if (updatePalette) {\n                        this.gateShowColorPalettes(this.area, leftPalette, topPalette, countXpalette, countYpalette,\n                            colorpaletteids, colorpalettes);\n                    }\n                    if (updateAvatars) {\n                        this.gateShowAvatars(leftAvatars, topAvatars, countXavatars, countYavatars,\n                            avatarids, avatars);\n                    }\n                }).fail((error) => {\n                    console.log(\"fail\", error);\n                    return error;\n                });\n            });\n        }\n\n        gateShowColorPalettes(parent, left, top, countX, countY, colorpaletteids, colorpalettes) {\n            let i = 0; // Counter for color palettes\n            const count = colorpalettes.length;\n            this.canvasColor = undefined;\n            const canvasSize = this.iconSize - this.padding * 3 / 2;\n            const parsedPalettes = colorpalettes.map(palette =>\n                palette.split(\",\").map(value => parseInt(value, 10) || 0)\n            );\n            let acanvas = [];\n            const fragment = document.createDocumentFragment();\n            for (let iy = 0; iy < countY; iy++) {\n                for (let ix = 0; ix < countX; ix++) {\n                    // Check if we exceed available palettes or encounter invalid data\n                    if (i >= count || !parsedPalettes[i] || !colorpaletteids[i]) {\n                        i++; // Increment and continue if invalid\n                        continue;\n                    }\n\n                    // Create a new canvas element\n                    let canvas = document.createElement('canvas');\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = `${left + ix * this.iconSize}px`;\n                    canvas.style.top = `${top + iy * this.iconSize}px`;\n                    canvas.width = canvasSize;\n                    canvas.height = canvasSize;\n                    canvas.style.cursor = 'pointer';\n                    canvas.classList.add(\"mmogame_color\");\n\n                    acanvas.push(canvas);\n\n                    // Append canvas to the area\n                    fragment.appendChild(canvas);\n\n                    // Render the color palette on the canvas\n                    this.showColorPalette(canvas, parsedPalettes[i]);\n\n                    // Get the palette ID and attach a click event listener\n                    let id = colorpaletteids[i];\n                    canvas.addEventListener(\"click\", () => {\n                        this.gateUpdateColorPalette(canvas, id);\n                    });\n\n                    i++;\n                }\n            }\n            parent.appendChild(fragment);\n\n            return acanvas;\n        }\n\n        gateUpdateColorPalette(canvas, id) {\n            if (this.canvasColor !== undefined) {\n                this.canvasColor.style.borderStyle = \"none\";\n            }\n            this.canvasColor = canvas;\n            let w = Math.round(this.padding / 2) + \"px\";\n\n            Object.assign(canvas.style, {\n                borderStyle: \"outset\",\n                borderLeftWidth: w,\n                borderTopWidth: w,\n                borderRightWidth: w,\n                borderBottomWidth: w,\n            });\n            this.paletteid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        gateUpdateAvatar(avatar, id, w) {\n            if (this.avatar !== undefined) {\n                this.avatar.style.borderStyle = \"none\";\n            }\n            this.avatar = avatar;\n            avatar.style.borderStyle = \"outset\";\n\n            avatar.style.borderLeftWidth = w;\n            avatar.style.borderTopWidth = w;\n            avatar.style.borderRightWidth = w;\n            avatar.style.borderBottomWidth = w;\n\n            this.avatarid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        /**\n         * Updates the visibility of the submit button based on form input validation.\n         */\n        gateUpdateSubmit() {\n            const hasAvatar = this.avatarid !== undefined;\n            const hasPalette = this.paletteid !== undefined;\n            const hasNickname = this.edtNickname?.value?.length > 0;\n\n            this.btnSubmit.style.visibility = hasAvatar && hasPalette && hasNickname ? 'visible' : 'hidden';\n        }\n\n        gateComputeSizes() {\n            this.computeSizes();\n            this.iconSize = Math.round(0.8 * this.iconSize);\n            this.padding = Math.round(0.8 * this.padding);\n        }\n\n        /**\n         * Creates the screen palette UI with a label and a refresh button.\n         * @param {number} top - The vertical position for the elements.\n         * @param {string} title\n         * @param {string} classLabel\n         * @param {string} classButton\n         * @param {string} src\n         */\n        gateCreateLabelRefresh(top, title, classLabel, classButton, src) {\n            // Create and configure the label\n            const label = this.createDOMElement('label', {\n                parent: this.area,\n                classnames: classLabel,\n                styles: {\n                    position: 'absolute',\n                    font: 'FontAwesome',\n                    fontSize: `${this.fontSize}px`,\n                    width: '0px',\n                    whiteSpace: 'nowrap',\n                    color: this.getContrastingColor(this.colorBackground),\n                    top: `${top}px`,\n                    left: '0px',\n                },\n            });\n            label.innerHTML = title;\n\n            // Button refresh color palettes\n            let button = this.createDOMElement('img', {\n                parent: this.area,\n                classnames: classButton,\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${label.scrollWidth + this.padding}px`,\n                    top: `${top}px`,\n                    height: `${label.scrollHeight}px`,\n                    color: this.getContrastingColor(this.colorBackground),\n                    cursor: 'pointer',\n                },\n                attributes: {\n                    src: src,\n                }\n            });\n\n            return [label, button];\n        }\n\n        /**\n         * Adds an event listener to refresh colors and avatars.\n         *\n         * @param {HTMLElement} btn - The button to attach the event listener to.\n         * @param {number} topPalette - The Y-coordinate offset for grid positioning.\n         * @param {number} countXpalette - Width of the color grid.\n         * @param {number} countYpalette - Height of the color grid.\n         * @param {number} topAvatars - The Y-coordinate offset for grid positioning.\n         * @param {number} countXavatars - Width of the avatar grid.\n         * @param {number} countYavatars - Height of the avatar grid.\n         * @param {boolean} updateColors - Callback to update colors.\n         * @param {boolean} updateAvatars - Callback to update avatars.\n         */\n        addEventListenerRefresh(btn, topPalette, countXpalette, countYpalette, topAvatars,\n                                countXavatars, countYavatars, updateColors, updateAvatars) {\n            btn.addEventListener(\"click\", () => {\n                const elements = Array.from(this.area.getElementsByClassName(\"mmogame-color\"));\n                elements.forEach(element => element.remove());\n\n                this.gateSendGetColorsAvatars(0, topPalette, countXpalette, countYpalette,\n                    0, topAvatars, countXavatars, countYavatars,\n                    updateColors, updateAvatars);\n            });\n        }\n\n        removeAreaChildren() {\n            if (this.area === undefined) {\n                return;\n            }\n            while (this.area.firstChild) {\n                this.area.removeChild(this.area.firstChild);\n            }\n        }\n\n        createDivMessage(classnames, message) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            if (this.divMessageHelp !== undefined) {\n                this.body.removeChild(this.divMessageHelp);\n                this.divMessageHelp = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaRect !== undefined ? this.areaRect.top : 0;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.padding - top;\n\n            this.createDivMessageDo(classnames, left, top, width, height, message, height);\n\n            this.divMessage.style.top = (height - this.divMessage.scrollHeight) / 2 + \"px\";\n        }\n\n        createNicknameAvatar(parent, prefixclassname, left, topNickname, widthNickname, heightNickname, topAvatar, widthAvatar) {\n            const nickname = this.createDOMElement('div', {\n                parent: parent,\n                classname: `${prefixclassname}-nickname`,\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${topNickname}px`,\n                    width: `${widthNickname}px`,\n                }\n            });\n\n            let leftAvatar = Math.round(left + this.iconSize / 2);\n            const avatar = this.createDOMElement('img', {\n                classname: `${prefixclassname}-avatar`,\n                parent: this.body,\n                styles: {\n                    position: 'absolute',\n                    left: `${leftAvatar}px`,\n                    top: `${topAvatar}px`,\n                    height: `${widthAvatar}px`,\n                    maxWidth: `${widthAvatar}px`,\n                    transform: 'translateX(-50%)',\n                }\n            });\n\n            return [nickname, avatar];\n        }\n\n\n        createDivMessageStart(message) {\n            if (this.divMessageHelp !== undefined) {\n                return;\n            }\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n                this.area = undefined;\n            }\n\n            let left = this.padding;\n            let top = this.areaRect.top;\n            let width = window.innerWidth - 2 * this.padding;\n            let height = window.innerHeight - this.padding - top;\n\n            let height1 = height / 8;\n\n            this.createDivMessageDo('mmogame-message-start', left, top, width, height, message, height1);\n\n            top += (height1 - this.divMessage.scrollHeight) / 2;\n            this.divMessage.style.top = top + \"px\";\n\n            let div = document.createElement(\"div\");\n            div.style.position = \"absolute\";\n            div.style.left = left + \"px\";\n            div.style.textAlign = \"left\";\n            div.style.width = (width - 2 * this.padding) + \"px\";\n            div.style.paddingLeft = this.padding + \"px\";\n            div.style.paddingRight = this.padding + \"px\";\n\n            div.style.color = this.getContrastingColor(this.colorBackground2);\n            top = this.iconSize + 3 * this.padding + height1;\n            div.style.top = (top + this.padding) + \"px\";\n            div.style.height = (height - height1) + \"px\";\n            this.divMessageHelp = div;\n            this.body.appendChild(this.divMessageHelp);\n\n            this.showHelpScreen(div, (width - 2 * this.padding), (height - height1));\n        }\n\n        /**\n         * Calls the Moodle Web Service 'mmogametype_quiz_get_attempt' and processes the response.\n         *\n         * @param {Object} extraparams - Additional parameters to override default ones.\n         */\n        async callGetAttempt(extraparams = undefined) {\n\n            if (this.kindSound === undefined) {\n                const option = await this.getOption(\"kindSound\");\n                this.kindSound = option !== null ? option.value : 1;\n            }\n\n            require(['core/ajax'], (Ajax) => {\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    nickname: null,\n                    colorpaletteid: null,\n                    avatarid: null,\n                    subcommand: '',\n                };\n                if (extraparams !== undefined) {\n                    params = {...params, ...extraparams};\n                }\n                // Calling the service through the Moodle AJAX API\n                let getAttempt = Ajax.call([{\n                    methodname: 'mmogametype_quiz_get_attempt',\n                    args: params,\n                }]);\n\n                // Handling the response\n                getAttempt[0].done((response) => {\n                    const json = JSON.parse(response);\n                    if (json.errorcode === 'no_user') {\n                        this.gateCreateScreen();\n                        return;\n                    }\n                    if (this.area !== undefined) {\n                        this.body.removeChild(this.area);\n                        this.area = undefined;\n                    }\n                    if (this.iconSize === undefined) {\n                        this.openGame();\n                    }\n\n                    this.processGetAttempt(json);\n                }).fail((error) => {\n                    this.createDivMessage('mmogame-error', error.message);\n                    return error;\n                });\n            });\n        }\n\n        createDivMessageDo(classnames, left, top, width, height, message, heightmessage) {\n            if (this.divMessageBackground === undefined) {\n                let div = this.createDiv(this.body, classnames, left, top, width, height);\n                div.style.background = this.getColorHex(this.colorBackground2);\n                this.divMessageBackground = div;\n            }\n\n            if (this.divMessage === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"center\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.background = this.getColorHex(this.colorBackground2);\n                div.style.color = this.getContrastingColor(this.colorBackground2);\n                this.divMessage = div;\n            }\n            this.divMessage.innerHTML = message;\n            this.body.appendChild(this.divMessage);\n            this.autoResizeText(this.divMessage, width, heightmessage, false, this.minFontSize, this.maxFontSize, 0.5);\n        }\n\n        removeMessageDivs() {\n            if (this.divMessage !== undefined) {\n                this.body.removeChild(this.divMessage);\n                this.divMessage = undefined;\n            }\n            if (this.divMessageHelp !== undefined) {\n                this.body.removeChild(this.divMessageHelp);\n                this.divMessageHelp = undefined;\n            }\n            if (this.divMessageBackground !== undefined) {\n                this.body.removeChild(this.divMessageBackground);\n                this.divMessageBackground = undefined;\n            }\n        }\n\n        setColors(colors) {\n            super.setColors(colors);\n            this.colorBackground2 = colors[1];\n        }\n\n        /**\n         * Displays an error message on the screen.\n         * @param {string} name - The name of the error context.\n         * @param {Error} [error] - The error object to display.\n         */\n        showError(name, error) {\n            console.log(name, error);\n            const message = error?.message || 'An unknown error occurred.';\n            this.createDivMessage('mmogame-error', message);\n        }\n\n        createButtonHelp(parent, left, top) {\n            return this.createDOMElement('img', {\n                parent: parent,\n                classnames: 'mmogame-button-help',\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${top}px`,\n                    width: `${this.iconSize}px`,\n                    height: `${this.iconSize}px`,\n                },\n                attributes: {\n                    src: 'assets/help.svg',\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n        }\n\n        onClickHelp() {\n            if (this.divMessageHelp === undefined) {\n                this.createDivMessageStart('Help');\n            } else {\n                this.removeMessageDivs();\n                this.callGetAttempt();\n            }\n        }\n\n        gateCompute() {\n            // Adjust font sizes\n            this.minFontSize *= 2;\n            this.maxFontSize *= 2;\n\n            // Compute sizes and layout\n            this.gateComputeSizes();\n            this.createArea(this.padding, 0);\n        }\n\n        removeDivMessage() {\n            if (this.divMessage !== undefined) {\n                this.body.removeChild(this.divMessage);\n                this.divMessage = undefined;\n            }\n            if (this.divMessageHelp !== undefined) {\n                this.body.removeChild(this.divMessageHelp);\n                this.divMessageHelp = undefined;\n            }\n            if (this.divMessageBackground !== undefined) {\n                this.divMessageBackground.remove();\n                this.divMessageBackground = undefined;\n            }\n        }\n\n        hasHelp() {\n            return false;\n        }\n\n        /**\n         * Calls the Moodle Web Service 'mmogame_get_state' and returns the response.\n         */\n        async callGetState() {\n            return new Promise((resolve, reject) => {\n                // Calling the service through the Moodle AJAX API\n                require(['core/ajax'], (Ajax) => {\n                    let getState = Ajax.call([{\n                        methodname: 'mod_mmogame_get_state',\n                        args: {mmogameid: this.mmogameid},\n                    }]);\n\n                    getState[0]\n                        .done((response) => resolve(response))\n                        .fail((error) => {\n                            this.createDivMessage('mmogame-error', error.message);\n                            reject(error);\n                        });\n                });\n            });\n        }\n\n    };\n});"],"names":["define","MmoGame","isVertical","kindSound","buttonSound","colorBackground2","nickname","user","paletteid","avatarid","iconSize","padding","area","areaRect","edtNickname","mmogameid","divMessage","divMessageHelp","divMessageBackground","constructor","window","innerWidth","innerHeight","undefined","getSoundFile","this","audioElement","play","error","showError","createButtonSound","parent","left","top","createDOMElement","classnames","styles","position","width","height","attributes","src","alt","getStringM","role","addEventListener","onClickSound","button","setOption","value","pin","kinduser","modelparams","url","screen","option","getOption","crypto","randomUUID","gateCreateScreen","gateSendGetAssets","console","log","require","Ajax","params","countsplit","countpalettes","countPalettes","countavatars","countXavatars","countYavatars","getAssets","call","methodname","args","done","_ref","avatarids","avatars","colorpaletteids","colorpalettes","numavatars","info","fail","body","firstChild","removeChild","gateCompute","size","maxHeight","maxWidth","labels","fontSize","findbest","minFontSize","maxFontSize","gateComputeLabelSize","heightColors","Math","floor","heightAvatars","gateCreateScreenDo","gateCreateNickname","focus","lblPalette","btnPalette","gateCreateLabelRefresh","scrollHeight","topGridPalette","gridHeightPalette","countX","countYpalette","lblAvatars","btnAvatars","gridHeightAvatars","addEventListenerRefresh","gateSendGetColorsAvatars","gateCreateSubmit","lblNickname","color","getContrastingColor","colorBackground","innerHTML","leftEdit","scrollWidth","debounce","gateUpdateSubmit","max","btnSubmit","cursor","visibility","callGetAttempt","colorpaletteid","aLabel","i","length","label","document","createElement","style","whiteSpace","font","appendChild","gateShowAvatars","countY","querySelectorAll","forEach","element","remove","fragment","createDocumentFragment","avatar","count","leftOriginal","w","round","avatarImagePath","btn","createCenterImageButton","classList","add","id","gateUpdateAvatar","leftPalette","topPalette","countXpalette","leftAvatars","topAvatars","updatePalette","updateAvatars","_ref2","gateShowColorPalettes","canvasColor","canvasSize","parsedPalettes","map","palette","split","parseInt","acanvas","iy","ix","canvas","push","showColorPalette","gateUpdateColorPalette","borderStyle","Object","assign","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","hasAvatar","hasPalette","hasNickname","gateComputeSizes","computeSizes","title","classLabel","classButton","updateColors","Array","from","getElementsByClassName","removeAreaChildren","createDivMessage","message","createDivMessageDo","createNicknameAvatar","prefixclassname","topNickname","widthNickname","heightNickname","topAvatar","widthAvatar","classname","leftAvatar","transform","createDivMessageStart","height1","div","textAlign","paddingLeft","paddingRight","showHelpScreen","extraparams","subcommand","response","json","JSON","parse","errorcode","openGame","processGetAttempt","heightmessage","createDiv","background","getColorHex","autoResizeText","removeMessageDivs","setColors","colors","name","createButtonHelp","onClickHelp","createArea","removeDivMessage","hasHelp","Promise","resolve","reject"],"mappings":"AA6BAA,+BAAO,CAAC,wBAAwB,SAASC,gBAC9B,cAAwBA,QAE3BC,WACAC,UACAC,YACAC,iBAGAC,SACAC,KACAC,UACAC,SACAC,SACAC,QAGAC,KACAC,SAGAC,YAGAC,UAGAC,WACAC,eACAC,qBAEAC,2BAESjB,WAAakB,OAAOC,WAAaD,OAAOE,iBACxCV,UAAOW,EAOhBC,sBAC8B,IAAnBC,KAAKtB,UAAkB,2BAA6B,4CAQ/CuB,iBACW,IAAnBD,KAAKtB,WAAmBuB,uBAEdA,aAAaC,OACrB,MAAOC,YACAC,UAAU,mBAAoBD,QAK/CE,kBAAkBC,OAAQC,KAAMC,UACvB7B,YAAcqB,KAAKS,iBAAiB,MAAO,CAC5CH,OAAQA,OACRI,WAAY,uBACZC,OAAQ,CACJC,SAAU,WACVL,KAAO,GAAEA,SACTC,IAAM,GAAEA,QACRK,MAAQ,GAAEb,KAAKf,aACf6B,OAAS,GAAEd,KAAKf,cAEpB8B,WAAY,CACRC,IAAKhB,KAAKD,eACVkB,IAAKjB,KAAKkB,WAAW,YACrBC,KAAM,iBAGTxC,YAAYyC,iBAAiB,SAAS,IAAMpB,KAAKqB,aAAarB,KAAKrB,eAO5E0C,aAAaC,aACJ5C,WAAasB,KAAKtB,UAAY,GAAK,EACxC4C,OAAON,IAAMhB,KAAKD,oBACbwB,UAAU,YAAa,CAACC,MAAOxB,KAAKtB,2BAgB9BY,UAAWmC,IAAKC,SAAU5C,KAAM6C,YAAaC,aACnDtC,UAAYA,eACZmC,IAAMA,SACNC,SAAWA,cACXG,OAAS,OACTD,IAAMA,IAEW,SAAlB5B,KAAK0B,SAAqB,OACpBI,aAAe9B,KAAK+B,UAAU,OAASzC,WAC9B,OAAXwC,aACKhD,KAAOkD,OAAOC,kBACdV,UAAU,OAASjC,UAAW,CAACkC,MAAOxB,KAAKlB,aAE3CA,KAAOgD,OAAON,gBAGlBE,SAAW5C,UAEfoD,mBAKTC,oBACIC,QAAQC,IAAI,qBACZC,QAAQ,CAAC,cAAeC,WAEhBC,OAAS,CACTlD,UAAWU,KAAKV,UAChBoC,SAAU1B,KAAK0B,SACf5C,KAAMkB,KAAKlB,KACX2D,WAAY,EACZC,cAAe1C,KAAK2C,cACpBC,aAAc5C,KAAK6C,cAAgB7C,KAAK8C,eAE5CV,QAAQC,IAAI,UAAUG,YAElBO,UAAYR,KAAKS,KAAK,CAAC,CACvBC,WAAY,+BACZC,KAAMV,UAEVJ,QAAQC,IAAI,eAEZU,UAAU,GAAGI,MAAKC,WAACC,UAACA,UAADC,QAAYA,QAAZC,gBAAqBA,gBAArBC,cAAsCA,cAAtCC,WAAqDA,sBAC/DC,KAAO,CACRL,UAAWA,UACXC,QAASA,QACTC,gBAAiBA,gBACjBC,cAAeA,cACfC,WAAYA,YAEhBrB,QAAQC,IAAIrC,KAAK0D,WACZxB,sBACNyB,MAAMxD,QACLiC,QAAQC,IAAI,QAASlC,OACdA,YAMnB+B,wBACWlC,KAAK4D,KAAKC,iBACRD,KAAKE,YAAY9D,KAAK4D,KAAKC,iBAE/B1E,UAAOW,OAEPiE,kBAIDC,KAFAC,UAAYjE,KAAKZ,SAAS0B,OAAS,EAAId,KAAKd,QAAUc,KAAKf,SAC3DiF,SAAWlE,KAAKZ,SAASyB,YAEvBsD,OAAS,CACV,GAAEnE,KAAKkB,WAAW,eACnBlB,KAAKkB,WAAW,WAChBlB,KAAKkB,WAAW,oBAEfkD,SAAWpE,KAAKqE,SAASrE,KAAKsE,YAAatE,KAAKuE,aAAcH,cAC/DJ,KAAOhE,KAAKwE,qBAAqBJ,SAAUD,QAEvCH,KAAK,IAAME,gBACJ,QAGLO,aAA4C,GAA5BR,UAAY,EAAIG,UAAgB,KAE5C,IADFM,KAAKC,MAAMF,aAAezE,KAAKf,iBAE5B,QAEL2F,cAA4D,GAA3CX,UAAY,EAAIG,SAAWK,cAAoB,SAC/C,EAAIT,KAAK,GAAK,EAAIhE,KAAKd,QAAUuF,aAAeG,cAE/CX,WAAa,EAAI,UAGxCY,mBAAmBX,SAAUD,WAGtCY,mBAAmBX,SAAUD,WACzB7B,QAAQC,IAAI,0BAER7B,IAAMR,KAAK8E,mBAAmB,EAAGZ,UAAYlE,KAAKd,aACjDG,YAAY0F,cAGVC,WAAYC,YAAcjF,KAAKkF,uBAAuB1E,IAAKR,KAAKkB,WAAW,cAC9E,6BAA8B,+BAAgC,sBAClEV,KAAOwE,WAAWG,aAAenF,KAAKd,cAChCkG,eAAiB5E,QACnB6E,kBAA6E,GAAxDpB,UAAYmB,eAAiBJ,WAAWG,cAAoB,QAC/EG,OAASZ,KAAKC,OAAOT,SAAWlE,KAAKd,SAAWc,KAAKf,UACrDsG,cAAgBb,KAAKC,MAAMU,kBAAoBrF,KAAKf,UAC1DoG,kBAAoBE,cAAgBvF,KAAKf,SACzCuB,KAAO6E,kBAAoBrF,KAAKd,cAEzBsG,WAAYC,YAAczF,KAAKkF,uBAAuB1E,IAAKR,KAAKkB,WAAW,cAC9E,6BAA8B,+BAAgC,sBAElEV,KAAOgF,WAAWL,aAAenF,KAAKd,cAEhC4D,cAAgB4B,KAAKC,MAAMD,KAAKC,MAAMV,UAAYzD,IAAMR,KAAKd,SAAWc,KAAKf,UAC7EyG,kBAAoB5C,cAAgB9C,KAAKf,cAE1C0G,wBAAwBV,WAAYG,eAAgBE,OAAQC,cAC7D/E,IAAK8E,OAAQxC,eAAe,GAAM,QAEjC6C,wBAAwBF,WAAYL,eAAgBE,OAAQC,cAC7D/E,IAAK8E,OAAQxC,eAAe,GAAO,QAGlC8C,yBAAyB,EAAGR,eAAgBE,OAAQC,cACrD,EAAG/E,IAAK8E,OAAQxC,eAAe,GAAM,QAEpC+C,iBAAiBrF,IAAMkF,kBAAoB,EAAI1F,KAAKd,QAASgF,UAGtEY,mBAAmBtE,IAAK0D,gBACd4B,YAAc9F,KAAKS,iBAAiB,QAAS,CAC/CH,OAAQN,KAAKb,KACbuB,WAAY,0BACZC,OAAQ,CACJC,SAAU,WACVwD,SAAW,GAAEpE,KAAKoE,aAClB7D,KAAM,IACNC,IAAM,GAAEA,QACRK,MAAO,IACPkF,MAAO/F,KAAKgG,oBAAoBhG,KAAKiG,oBAG7CH,YAAYI,UAAYlG,KAAKkB,WAAW,WAAa,KAEjDlB,KAAKvB,aACL+B,KAAOsF,YAAYX,aAAenF,KAAKd,eAGrCiH,SAAWnG,KAAKvB,WAAa,EAAIqH,YAAYM,YAAcpG,KAAKd,QAChE2B,MAAQb,KAAKvB,WAAayF,SAAWA,SAAW,EAAIlE,KAAKd,oBAC1DG,YAAcW,KAAKS,iBAAiB,QAAS,CAC9CH,OAAQN,KAAKb,KACbuB,WAAY,oBACZC,OAAQ,CACJC,SAAU,WACVwD,SAAW,GAAEpE,KAAKoE,aAClB7D,KAAO,GAAE4F,aACT3F,IAAM,GAAEA,QACRK,MAAUA,MAAQsF,SAAWnG,KAAKd,QAA1B,aAGXG,YAAY+B,iBAAiB,QAASpB,KAAKqG,UAAS,IAAMrG,KAAKsG,oBAAoB,MACxF9F,KAAOR,KAAKd,SAAWc,KAAKvB,WAAauB,KAAKoE,SAAWM,KAAK6B,IAAIT,YAAYX,aAAcnF,KAAKoE,WAKrGyB,iBAAiBrF,IAAK0D,eACbsC,UAAYxG,KAAKS,iBAAiB,MAAO,CAC1CH,OAAQN,KAAKb,KACbuB,WAAY,6BACZC,OAAQ,CACJC,SAAU,WACVwD,SAAW,GAAEpE,KAAKoE,aAClB7D,MAAU2D,SAAWlE,KAAKf,UAAY,EAA/B,KACPuB,IAAM,GAAEA,QACRM,OAAS,GAAEd,KAAKf,aAChB8G,MAAO/F,KAAKgG,oBAAoBhG,KAAKiG,iBACrCQ,OAAQ,UACRC,WAAY,UAEhB3F,WAAY,CACRC,IAAK,4BAGRwF,UAAUpF,iBAAiB,SAAS,UAEhCuF,eACD,CAAC9H,SAAUmB,KAAKX,YAAYmC,MAAOoF,eAAgB5G,KAAKjB,UAAWC,SAAUgB,KAAKhB,cAK9FwF,qBAAqBJ,SAAUyC,YACvB3C,SAAW,EACXD,UAAY,MAEX,IAAI6C,EAAI,EAAGA,EAAID,OAAOE,OAAQD,IAAK,OAC9BE,MAAQC,SAASC,cAAc,SACrCF,MAAMG,MAAMvG,SAAW,WACvBoG,MAAMd,UAAYW,OAAOC,GACzBE,MAAMG,MAAMC,WAAa,SACzBJ,MAAMG,MAAME,KAAO,cACnBL,MAAMG,MAAM/C,SAAWA,SAAW,KAClC4C,MAAMG,MAAMtG,MAAQ,MACpBmG,MAAMG,MAAMrG,OAAS,WAChB3B,KAAKmI,YAAYN,OAElBA,MAAMZ,YAAclC,WACpBA,SAAW8C,MAAMZ,aAGjBY,MAAM7B,aAAelB,YACrBA,UAAY+C,MAAM7B,mBAEjBhG,KAAK2E,YAAYkD,aAGnB,CAAC9C,SAAUD,WAGtBsD,gBAAgBhH,KAAMC,IAAK8E,OAAQkC,OAAQnE,UAAWC,aAC7CA,SAA8B,IAAnBA,QAAQyD,cAKPE,SAASQ,iBAAiB,mBAClCC,SAAQC,SAAWA,QAAQC,iBAE9BC,SAAWZ,SAASa,8BAErBC,YAASjI,QACRkI,MAAQ1E,QAAQyD,WAClBkB,aAAe1H,KACf2H,EAAIxD,KAAKyD,MAAMnI,KAAKd,QAAU,GAAK,SAClC,IAAI4H,EAAI,EAAGA,EAAIkB,MAAOlB,IAAK,KACxBsB,gBAAkB,kBAAoB9E,QAAQwD,GAC9CuB,IAAMrI,KAAKsI,wBACXT,SACAtH,KAAMC,IACNR,KAAKf,SAAWe,KAAKd,QAASc,KAAKf,SAAWe,KAAKd,QACnD,iBACAkJ,iBAEJC,IAAIE,UAAUC,IAAI,sBACdC,GAAKpF,UAAUyD,GACnBuB,IAAIjH,iBAAiB,SAAS,UACrBsH,iBAAiBL,IAAKI,GAAIP,MAInC3H,MAAQP,KAAKf,UAGR6H,EAAI,GAAKxB,QAAW,IACrB9E,KAAOR,KAAKf,SACZsB,KAAO0H,mBAGV9I,KAAKmI,YAAYO,UAG1BjC,yBAAyB+C,YAAaC,WAAYC,cAAetD,cACxCuD,YAAaC,WAAYlG,cAAeC,mBACxCkG,yEAAsBC,yEAC3C3G,QAAQ,CAAC,cAAeC,WAEhBC,OAAS,CACTlD,UAAWU,KAAKV,UAChBoC,SAAU1B,KAAK0B,SACf5C,KAAMkB,KAAKlB,KACXwE,QAAS2F,cAAgBpG,cAAgBC,cAAgB,EACzDU,cAAewF,cAAgBH,cAAgBtD,cAAgB,GAGnDhD,KAAKS,KAAK,CAAC,CACvBC,WAAY,yBACZC,KAAMV,UAIA,GAAGW,MAAK+F,YAAC7F,UAACA,UAADC,QAAYA,QAAZC,gBAAqBA,gBAArBC,cAAsCA,qBACjDwF,oBACKG,sBAAsBnJ,KAAKb,KAAMwJ,YAAaC,WAAYC,cAAetD,cAC1EhC,gBAAiBC,eAErByF,oBACK1B,gBAAgBuB,YAAaC,WAAYlG,cAAeC,cACzDO,UAAWC,YAEpBK,MAAMxD,QACLiC,QAAQC,IAAI,OAAQlC,OACbA,YAKnBgJ,sBAAsB7I,OAAQC,KAAMC,IAAK8E,OAAQkC,OAAQjE,gBAAiBC,mBAClEsD,EAAI,QACFkB,MAAQxE,cAAcuD,YACvBqC,iBAActJ,QACbuJ,WAAarJ,KAAKf,SAA0B,EAAfe,KAAKd,QAAc,EAChDoK,eAAiB9F,cAAc+F,KAAIC,SACrCA,QAAQC,MAAM,KAAKF,KAAI/H,OAASkI,SAASlI,MAAO,KAAO,UAEvDmI,QAAU,SACR9B,SAAWZ,SAASa,6BACrB,IAAI8B,GAAK,EAAGA,GAAKpC,OAAQoC,SACrB,IAAIC,GAAK,EAAGA,GAAKvE,OAAQuE,KAAM,IAE5B/C,GAAKkB,QAAUsB,eAAexC,KAAOvD,gBAAgBuD,GAAI,CACzDA,iBAKAgD,OAAS7C,SAASC,cAAc,UACpC4C,OAAO3C,MAAMvG,SAAW,WACxBkJ,OAAO3C,MAAM5G,KAAQ,GAAEA,KAAOsJ,GAAK7J,KAAKf,aACxC6K,OAAO3C,MAAM3G,IAAO,GAAEA,IAAMoJ,GAAK5J,KAAKf,aACtC6K,OAAOjJ,MAAQwI,WACfS,OAAOhJ,OAASuI,WAChBS,OAAO3C,MAAMV,OAAS,UACtBqD,OAAOvB,UAAUC,IAAI,iBAErBmB,QAAQI,KAAKD,QAGbjC,SAASP,YAAYwC,aAGhBE,iBAAiBF,OAAQR,eAAexC,QAGzC2B,GAAKlF,gBAAgBuD,GACzBgD,OAAO1I,iBAAiB,SAAS,UACxB6I,uBAAuBH,OAAQrB,OAGxC3B,WAGRxG,OAAOgH,YAAYO,UAEZ8B,QAGXM,uBAAuBH,OAAQrB,SACF3I,IAArBE,KAAKoJ,mBACAA,YAAYjC,MAAM+C,YAAc,aAEpCd,YAAcU,WACf5B,EAAIxD,KAAKyD,MAAMnI,KAAKd,QAAU,GAAK,KAEvCiL,OAAOC,OAAON,OAAO3C,MAAO,CACxB+C,YAAa,SACbG,gBAAiBnC,EACjBoC,eAAgBpC,EAChBqC,iBAAkBrC,EAClBsC,kBAAmBtC,SAElBnJ,UAAY0J,QAEZnC,mBAGToC,iBAAiBX,OAAQU,GAAIP,QACLpI,IAAhBE,KAAK+H,cACAA,OAAOZ,MAAM+C,YAAc,aAE/BnC,OAASA,OACdA,OAAOZ,MAAM+C,YAAc,SAE3BnC,OAAOZ,MAAMkD,gBAAkBnC,EAC/BH,OAAOZ,MAAMmD,eAAiBpC,EAC9BH,OAAOZ,MAAMoD,iBAAmBrC,EAChCH,OAAOZ,MAAMqD,kBAAoBtC,OAE5BlJ,SAAWyJ,QAEXnC,mBAMTA,qEACUmE,eAA8B3K,IAAlBE,KAAKhB,SACjB0L,gBAAgC5K,IAAnBE,KAAKjB,UAClB4L,4CAAmBtL,0FAAamC,oEAAOuF,QAAS,OAEjDP,UAAUW,MAAMT,WAAa+D,WAAaC,YAAcC,YAAc,UAAY,SAG3FC,wBACSC,oBACA5L,SAAWyF,KAAKyD,MAAM,GAAMnI,KAAKf,eACjCC,QAAUwF,KAAKyD,MAAM,GAAMnI,KAAKd,SAWzCgG,uBAAuB1E,IAAKsK,MAAOC,WAAYC,YAAahK,WAElDgG,MAAQhH,KAAKS,iBAAiB,QAAS,CACzCH,OAAQN,KAAKb,KACbuB,WAAYqK,WACZpK,OAAQ,CACJC,SAAU,WACVyG,KAAM,cACNjD,SAAW,GAAEpE,KAAKoE,aAClBvD,MAAO,MACPuG,WAAY,SACZrB,MAAO/F,KAAKgG,oBAAoBhG,KAAKiG,iBACrCzF,IAAM,GAAEA,QACRD,KAAM,gBAGdyG,MAAMd,UAAY4E,MAoBX,CAAC9D,MAjBKhH,KAAKS,iBAAiB,MAAO,CACtCH,OAAQN,KAAKb,KACbuB,WAAYsK,YACZrK,OAAQ,CACJC,SAAU,WACVwD,SAAW,GAAEpE,KAAKoE,aAClB7D,KAAO,GAAEyG,MAAMZ,YAAcpG,KAAKd,YAClCsB,IAAM,GAAEA,QACRM,OAAS,GAAEkG,MAAM7B,iBACjBY,MAAO/F,KAAKgG,oBAAoBhG,KAAKiG,iBACrCQ,OAAQ,WAEZ1F,WAAY,CACRC,IAAKA,QAoBjB2E,wBAAwB0C,IAAKO,WAAYC,cAAetD,cAAewD,WAC/ClG,cAAeC,cAAemI,aAAchC,eAChEZ,IAAIjH,iBAAiB,SAAS,KACT8J,MAAMC,KAAKnL,KAAKb,KAAKiM,uBAAuB,kBACpD1D,SAAQC,SAAWA,QAAQC,gBAE/BhC,yBAAyB,EAAGgD,WAAYC,cAAetD,cACxD,EAAGwD,WAAYlG,cAAeC,cAC9BmI,aAAchC,kBAI1BoC,6BACsBvL,IAAdE,KAAKb,UAGFa,KAAKb,KAAK0E,iBACR1E,KAAK2E,YAAY9D,KAAKb,KAAK0E,YAIxCyH,iBAAiB5K,WAAY6K,cACPzL,IAAdE,KAAKb,YACAyE,KAAKE,YAAY9D,KAAKb,WACtBA,UAAOW,QAGYA,IAAxBE,KAAKR,sBACAoE,KAAKE,YAAY9D,KAAKR,qBACtBA,oBAAiBM,OAGtBS,KAAOP,KAAKd,QACZsB,SAAwBV,IAAlBE,KAAKZ,SAAyBY,KAAKZ,SAASoB,IAAM,EACxDK,MAAQlB,OAAOC,WAAa,EAAII,KAAKd,QACrC4B,OAASnB,OAAOE,YAAcG,KAAKd,QAAUsB,SAE5CgL,mBAAmB9K,WAAYH,KAAMC,IAAKK,MAAOC,OAAQyK,QAASzK,aAElEvB,WAAW4H,MAAM3G,KAAOM,OAASd,KAAKT,WAAW4F,cAAgB,EAAI,KAG9EsG,qBAAqBnL,OAAQoL,gBAAiBnL,KAAMoL,YAAaC,cAAeC,eAAgBC,UAAWC,mBACjGlN,SAAWmB,KAAKS,iBAAiB,MAAO,CAC1CH,OAAQA,OACR0L,UAAY,GAAEN,2BACd/K,OAAQ,CACJC,SAAU,WACVL,KAAO,GAAEA,SACTC,IAAM,GAAEmL,gBACR9K,MAAQ,GAAE+K,yBAIdK,WAAavH,KAAKyD,MAAM5H,KAAOP,KAAKf,SAAW,SAc5C,CAACJ,SAbOmB,KAAKS,iBAAiB,MAAO,CACxCuL,UAAY,GAAEN,yBACdpL,OAAQN,KAAK4D,KACbjD,OAAQ,CACJC,SAAU,WACVL,KAAO,GAAE0L,eACTzL,IAAM,GAAEsL,cACRhL,OAAS,GAAEiL,gBACX7H,SAAW,GAAE6H,gBACbG,UAAW,uBAQvBC,sBAAsBZ,iBACUzL,IAAxBE,KAAKR,2BAGSM,IAAdE,KAAKb,YACAyE,KAAKE,YAAY9D,KAAKb,WACtBA,UAAOW,OAGZS,KAAOP,KAAKd,QACZsB,IAAMR,KAAKZ,SAASoB,IACpBK,MAAQlB,OAAOC,WAAa,EAAII,KAAKd,QACrC4B,OAASnB,OAAOE,YAAcG,KAAKd,QAAUsB,IAE7C4L,QAAUtL,OAAS,OAElB0K,mBAAmB,wBAAyBjL,KAAMC,IAAKK,MAAOC,OAAQyK,QAASa,SAEpF5L,MAAQ4L,QAAUpM,KAAKT,WAAW4F,cAAgB,OAC7C5F,WAAW4H,MAAM3G,IAAMA,IAAM,SAE9B6L,IAAMpF,SAASC,cAAc,OACjCmF,IAAIlF,MAAMvG,SAAW,WACrByL,IAAIlF,MAAM5G,KAAOA,KAAO,KACxB8L,IAAIlF,MAAMmF,UAAY,OACtBD,IAAIlF,MAAMtG,MAASA,MAAQ,EAAIb,KAAKd,QAAW,KAC/CmN,IAAIlF,MAAMoF,YAAcvM,KAAKd,QAAU,KACvCmN,IAAIlF,MAAMqF,aAAexM,KAAKd,QAAU,KAExCmN,IAAIlF,MAAMpB,MAAQ/F,KAAKgG,oBAAoBhG,KAAKpB,kBAChD4B,IAAMR,KAAKf,SAAW,EAAIe,KAAKd,QAAUkN,QACzCC,IAAIlF,MAAM3G,IAAOA,IAAMR,KAAKd,QAAW,KACvCmN,IAAIlF,MAAMrG,OAAUA,OAASsL,QAAW,UACnC5M,eAAiB6M,SACjBzI,KAAK0D,YAAYtH,KAAKR,qBAEtBiN,eAAeJ,IAAMxL,MAAQ,EAAIb,KAAKd,QAAW4B,OAASsL,oCAQ9CM,wEAAc5M,UAERA,IAAnBE,KAAKtB,UAAyB,OACxBoD,aAAe9B,KAAK+B,UAAU,kBAC/BrD,UAAuB,OAAXoD,OAAkBA,OAAON,MAAQ,EAGtDc,QAAQ,CAAC,cAAeC,WAChBC,OAAS,CACTlD,UAAWU,KAAKV,UAChBoC,SAAU1B,KAAK0B,SACf5C,KAAMkB,KAAKlB,KACXD,SAAU,KACV+H,eAAgB,KAChB5H,SAAU,KACV2N,WAAY,SAEI7M,IAAhB4M,cACAlK,OAAS,IAAIA,UAAWkK,cAGXnK,KAAKS,KAAK,CAAC,CACxBC,WAAY,+BACZC,KAAMV,UAIC,GAAGW,MAAMyJ,iBACVC,KAAOC,KAAKC,MAAMH,UACD,YAAnBC,KAAKG,gBAISlN,IAAdE,KAAKb,YACAyE,KAAKE,YAAY9D,KAAKb,WACtBA,UAAOW,QAEMA,IAAlBE,KAAKf,eACAgO,gBAGJC,kBAAkBL,YAXd3K,sBAYVyB,MAAMxD,aACAmL,iBAAiB,gBAAiBnL,MAAMoL,SACtCpL,YAKnBqL,mBAAmB9K,WAAYH,KAAMC,IAAKK,MAAOC,OAAQyK,QAAS4B,uBAC5BrN,IAA9BE,KAAKP,qBAAoC,KACrC4M,IAAMrM,KAAKoN,UAAUpN,KAAK4D,KAAMlD,WAAYH,KAAMC,IAAKK,MAAOC,QAClEuL,IAAIlF,MAAMkG,WAAarN,KAAKsN,YAAYtN,KAAKpB,uBACxCa,qBAAuB4M,YAGRvM,IAApBE,KAAKT,WAA0B,KAC3B8M,IAAMpF,SAASC,cAAc,OACjCmF,IAAIlF,MAAMvG,SAAW,WACrByL,IAAIlF,MAAM5G,KAAOA,KAAO,KACxB8L,IAAIlF,MAAMmF,UAAY,SACtBD,IAAIlF,MAAMtG,MAASA,MAAQ,EAAIb,KAAKd,QAAW,KAC/CmN,IAAIlF,MAAMoF,YAAcvM,KAAKd,QAAU,KACvCmN,IAAIlF,MAAMqF,aAAexM,KAAKd,QAAU,KAExCmN,IAAIlF,MAAMkG,WAAarN,KAAKsN,YAAYtN,KAAKpB,kBAC7CyN,IAAIlF,MAAMpB,MAAQ/F,KAAKgG,oBAAoBhG,KAAKpB,uBAC3CW,WAAa8M,SAEjB9M,WAAW2G,UAAYqF,aACvB3H,KAAK0D,YAAYtH,KAAKT,iBACtBgO,eAAevN,KAAKT,WAAYsB,MAAOsM,eAAe,EAAOnN,KAAKsE,YAAatE,KAAKuE,YAAa,IAG1GiJ,yBAC4B1N,IAApBE,KAAKT,kBACAqE,KAAKE,YAAY9D,KAAKT,iBACtBA,gBAAaO,QAEMA,IAAxBE,KAAKR,sBACAoE,KAAKE,YAAY9D,KAAKR,qBACtBA,oBAAiBM,QAEQA,IAA9BE,KAAKP,4BACAmE,KAAKE,YAAY9D,KAAKP,2BACtBA,0BAAuBK,GAIpC2N,UAAUC,cACAD,UAAUC,aACX9O,iBAAmB8O,OAAO,GAQnCtN,UAAUuN,KAAMxN,OACZiC,QAAQC,IAAIsL,KAAMxN,aACZoL,SAAUpL,MAAAA,aAAAA,MAAOoL,UAAW,kCAC7BD,iBAAiB,gBAAiBC,SAG3CqC,iBAAiBtN,OAAQC,KAAMC,YACpBR,KAAKS,iBAAiB,MAAO,CAChCH,OAAQA,OACRI,WAAY,sBACZC,OAAQ,CACJC,SAAU,WACVL,KAAO,GAAEA,SACTC,IAAM,GAAEA,QACRK,MAAQ,GAAEb,KAAKf,aACf6B,OAAS,GAAEd,KAAKf,cAEpB8B,WAAY,CACRC,IAAK,kBACLC,IAAKjB,KAAKkB,WAAW,WACrBC,KAAM,YAKlB0M,mBACgC/N,IAAxBE,KAAKR,oBACA2M,sBAAsB,cAEtBqB,yBACA7G,kBAIb5C,mBAESO,aAAe,OACfC,aAAe,OAGfqG,wBACAkD,WAAW9N,KAAKd,QAAS,GAGlC6O,wBAC4BjO,IAApBE,KAAKT,kBACAqE,KAAKE,YAAY9D,KAAKT,iBACtBA,gBAAaO,QAEMA,IAAxBE,KAAKR,sBACAoE,KAAKE,YAAY9D,KAAKR,qBACtBA,oBAAiBM,QAEQA,IAA9BE,KAAKP,4BACAA,qBAAqBmI,cACrBnI,0BAAuBK,GAIpCkO,iBACW,8BAOA,IAAIC,SAAQ,CAACC,QAASC,UAEzB7L,QAAQ,CAAC,cAAeC,OACLA,KAAKS,KAAK,CAAC,CACtBC,WAAY,wBACZC,KAAM,CAAC5D,UAAWU,KAAKV,cAGlB,GACJ6D,MAAMyJ,UAAasB,QAAQtB,YAC3BjJ,MAAMxD,aACEmL,iBAAiB,gBAAiBnL,MAAMoL,SAC7C4C,OAAOhO"}