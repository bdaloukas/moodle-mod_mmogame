{"version":3,"file":"mmogame.min.js","sources":["../src/mmogame.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine([''], function() {\n    return class MmoGame {\n    kindSound = 0;\n    state = 0;\n    body;\n    minFontSize;\n    maxFontSize;\n    fontSize;\n    avatarTop;\n    colorsBackground;\n    buttonAvatarTop;\n    buttonAvatarHeight;\n    colorScore;\n    colorScore2;\n    definition;\n    colorDefinition;\n    /**\n     * Basic class for games.\n     *\n     * @module mmogame\n     * @copyright 2024 Vasilis Daloukas\n     * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n     */\n    constructor() {\n        this.body = document.getElementsByTagName(\"body\")[0];\n        this.kindSound = window.localStorage.getItem('kindSound');\n        if (isNaN(this.kindSound)) {\n            this.kindSound = 0;\n        }\n        if (this.kindSound !== 0 && this.kindSound !== 1 && this.kindSound !== 2) {\n            this.kindSound = 0;\n        }\n\n        let size = parseFloat(window.getComputedStyle(document.documentElement).getPropertyValue('font-size'));\n        this.minFontSize = size;\n        this.maxFontSize = 2 * size;\n        this.fontSize = size;\n    }\n\n    hasHelp() {\n        return false;\n    }\n\n    removeBodyChilds() {\n        this.removeDivMessage();\n\n        while (this.body.firstChild) {\n            this.body.removeChild(this.body.lastChild);\n        }\n        this.area = undefined;\n    }\n\n    openGame() {\n        this.removeBodyChilds();\n        this.area = undefined;\n        this.computeSizes();\n    }\n\n        createImageButton(parent, left, top, width, height, classname, filename, wrap, alt) {\n            let button = this.createImage(parent, left, top, width, height, filename);\n\n            if (alt !== undefined && alt !== '') {\n                button.alt = alt;\n            }\n            button.classList.add(\"mmogame_imgbutton\");\n            button.setAttribute(\"role\", \"button\");\n\n            return button;\n        }\n    createImage(parent, left, top, width, height, filename) {\n        let button = document.createElement(\"img\");\n\n        button.tabIndex = 0;\n        button.style.position = \"absolute\";\n        button.style.left = left + \"px\";\n        button.style.top = top + \"px\";\n        button.draggable = false;\n\n        if (width !== 0) {\n            button.style.width = width + \"px\";\n        }\n        if (height !== 0) {\n            button.style.height = height + \"px\";\n        }\n        button.style.fontSize = height + \"px\";\n        if (filename !== undefined && filename !== '') {\n            button.src = filename;\n        }\n        parent.appendChild(button);\n\n        return button;\n    }\n\n    createCenterImageButton(parent, left, top, width, height, classname, filename) {\n        let button = document.createElement(\"img\");\n        button.classList.add(\"mmogame_imgbutton\");\n        button.style.position = \"absolute\";\n        button.draggable = false;\n\n        const img = new Image();\n        img.onload = function() {\n            if (this.width === 0 || this.height === 0) {\n                this.width = this.height = 1;\n            }\n\n            if (this.width > 0 && this.height > 0) {\n                let mul = Math.min(width / this.width, height / this.height);\n                let w = Math.round(this.width * mul);\n                let h = Math.round(this.height * mul);\n\n                button.style.width = w + \"px\";\n                button.style.height = h + \"px\";\n                button.style.left = (left + width / 2 - w / 2) + \"px\";\n                button.style.top = (top + height / 2 - h / 2) + \"px\";\n\n                button.src = filename;\n                button.innerHTML = filename;\n                button.style.fontSize = height + \"px\";\n            }\n        };\n        if (filename !== undefined && filename !== \"\") {\n            img.style.left = left + \"px\";\n            img.style.top = top + \"px\";\n            img.style.visibility = 'hidden';\n            img.src = filename;\n        }\n        button.tabIndex = 0;\n        parent.appendChild(button);\n\n        return button;\n    }\n\n    updateImageButton(button, left, top, width, height, filename) {\n        button.src = filename;\n    }\n\n    createDiv(parent, left, top, width, height) {\n        let div = document.createElement(\"div\");\n        div.style.position = \"absolute\";\n        div.style.left = left + \"px\";\n        div.style.top = top + \"px\";\n        div.style.width = width + \"px\";\n        div.style.height = height + \"px\";\n\n        parent.appendChild(div);\n\n        return div;\n    }\n\n    createDivColor(parent, left, top, width, height, color) {\n        let div = this.createDiv(parent, left, top, width, height);\n        div.style.background = this.getColorHex(color);\n\n        return div;\n    }\n\n    getMuteFile() {\n        if (this.kindSound === 0) {\n            return 'assets/sound-on-flat.png';\n        } else if (this.kindSound === 1) {\n            return 'assets/sound-off-flat.png';\n        } else if (this.kindSound === 2) {\n            return 'assets/speak.svg';\n        } else {\n            return 'assets/sound-on-flat.png';\n        }\n    }\n\n    playAudio(audio) {\n        if (this.kindSound !== 0 && audio !== null) {\n            if (audio.networkState === 1) {\n                audio.play();\n            }\n        }\n    }\n\n    autoResizeText(item, width, height, wrap, minFontSize, maxFontSize, minRatio) {\n        let minHeight = 0.9 * height;\n        let low = Math.max(1, minFontSize);\n        width = Math.round(width);\n        height = Math.round(height);\n        let up = maxFontSize === 0 || maxFontSize === undefined ? Math.min(width, height) : maxFontSize;\n\n        let fitSize = low;\n        let fitHeight = 0;\n        let newHeight = 0;\n        let newWidth = 0;\n\n        for (let i = 0; i <= 10; i++) {\n            let el = document.createElement(\"div\");\n            el.style.left = 0;\n            el.style.top = 0;\n            el.style.width = width + \"px\";\n            el.style.height = 0;\n            el.visibility = \"visible\";\n            if (!wrap) {\n                el.style.whiteSpace = \"nowrap\";\n            }\n            el.innerHTML = item.innerHTML;\n            this.body.appendChild(el);\n\n            let fontSize = (low + up) / 2;\n\n            el.style.fontSize = fontSize + \"px\";\n            newHeight = el.scrollHeight;\n            newWidth = el.scrollWidth - 1;\n\n            this.body.removeChild(el);\n\n            if (newWidth > width || newHeight > height) {\n                up = fontSize;\n            } else {\n                low = fontSize;\n                if (Math.abs(fitHeight - newHeight) <= 2) {\n                    break;\n                }\n                fitHeight = newHeight;\n                fitSize = fontSize;\n                if (newHeight > minHeight) {\n                    break;\n                }\n            }\n        }\n        item.style.fontSize = fitSize + \"px\";\n\n        if (newWidth > width || newHeight > height) {\n            this.autoResizeTextBr(item);\n            newWidth = item.scrollWidth;\n            newHeight = item.scrollHeight;\n            this.autoResizeTextImage(item, newWidth > width ? newWidth - width : 0, newHeight > height ? newHeight - height : 0,\n                minRatio);\n        } else {\n            return [item.scrollWidth - 1, item.scrollHeight];\n        }\n\n        let el = document.createElement(\"div\");\n        el.style.width = width + \"px\";\n        el.style.height = 0;\n        el.visibility = \"hidden\";\n        if (!wrap) {\n            el.style.whiteSpace = \"nowrap\";\n        }\n        el.innerHTML = item.innerHTML;\n        this.body.appendChild(el);\n        el.style.fontSize = item.style.fontSize;\n        let size = [el.scrollWidth - 1, el.scrollHeight];\n        this.body.removeChild(el);\n\n        return size;\n    }\n\n    autoResizeTextBr(item) {\n        let s = item.innerHTML;\n        let change = false;\n        while (s.startsWith('<br>')) {\n            s = s.substring(4);\n            change = true;\n        }\n        let pos1 = s.indexOf('<br>');\n        for (; ;) {\n            let pos = s.indexOf('<br>', pos1 + 4);\n            if (pos < 0) {\n                break;\n            }\n            let s2 = s.substring(pos1 + 4, pos);\n            if (!s2.trim()) {\n                s = s.substring(0, pos1 + 4) + s.substring(pos + 4);\n                change = true;\n                pos = pos1;\n            }\n            pos1 = pos;\n        }\n\n        if (change) {\n            item.innerHTML = s;\n        }\n    }\n\n    autoResizeTextImage(item, subwidth, subheight, minRatio) {\n        if (subwidth === 0 && subheight === 0) {\n            return;\n        }\n        let s = item.innerHTML;\n\n        for (let pos = 0; ;) {\n            let pos2 = s.indexOf(\"<img \", pos);\n            if (pos2 < 0) {\n                break;\n            }\n            let pos3 = s.indexOf(\">\", pos2);\n            if (pos3 < 0) {\n                break;\n            }\n            let s2 = s.substring(pos2, pos3) + \" \";\n\n            let width = 0;\n            let height = 0;\n            let posw = s2.indexOf(\"width=\");\n            if (posw >= 0) {\n                let posw2 = s2.indexOf(\" \", posw);\n                if (posw2 >= 0) {\n                    let num = s2.slice(posw + 6, posw2).replace(/\"/g, \"\");\n                    width = parseInt(num);\n                    s2 = s2.slice(0, posw) + s2.slice(posw2);\n                }\n            }\n\n            posw = s2.indexOf(\"height=\");\n            if (posw >= 0) {\n                let posw2 = s2.indexOf(\" \", posw);\n                if (posw2 >= 0) {\n                    let num = s2.slice(posw + 7, posw2).replace(/\"/g, \"\");\n                    height = parseInt(num);\n                    s2 = s2.slice(0, posw) + s2.slice(posw2);\n                }\n            }\n            if (width > 0 && height > 0) {\n                let newWidth = width - subwidth > 0 ? width - subwidth : width / 2;\n                let newHeight = height - subheight > 0 ? height - subheight : height / 2;\n                let ratio = Math.max(minRatio, Math.min(newWidth / width, newHeight / height));\n                s2 = s2 + \" width=\\\"\" + Math.round(ratio * width) + \"\\\" height=\\\"\" + Math.round(height * ratio) + \"\\\" \";\n            }\n            s = s.slice(0, pos2) + s2 + s.slice(pos3);\n            pos = pos3;\n        }\n        item.innerHTML = s;\n    }\n\n    getUserGUID() {\n        let guid = window.localStorage.getItem('UserGUID');\n        if (guid === null || guid === '') {\n            guid = this.uuid4();\n            window.localStorage.setItem(\"UserGUID\", guid);\n        }\n\n        return guid;\n    }\n\n    pad(num, size) {\n        let s = num + \"\";\n        while (s.length < size) {\n            s = \"0\" + s;\n        }\n        return s;\n    }\n\n    uuid4() {\n        const uuid = new Array(36);\n\n        for (let i = 0; i < 36; i++) {\n            uuid[i] = Math.floor(Math.random() * 16);\n        }\n        uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n\n        return uuid.map((x) => x.toString(16)).join('');\n    }\n\n    computeSizes() {\n        if (this.cIcons < 5 || this.cIcons === undefined) {\n            this.cIcons = 5;\n        }\n        this.iconSize = Math.min(window.innerWidth / this.cIcons, window.innerHeight / 5);\n\n        this.iconSize = Math.round(this.iconSize - this.iconSize / 10 / this.cIcons);\n\n        this.padding = Math.round(this.iconSize / 10);\n        this.iconSize -= this.padding;\n    }\n\n    getIconSize() {\n        return this.iconSize;\n    }\n\n    getCopyrightHeight() {\n        return Math.round(this.getIconSize() / 3);\n    }\n\n    getPadding() {\n        return this.padding;\n    }\n\n    getColorHex(x) {\n        return '#' + ('0000' + x.toString(16).toUpperCase()).slice(-6);\n    }\n\n    getContrast(x) {\n        let r = Math.floor(x / 0x1000000) % 256, // Red.\n            g = Math.floor(x / 0x10000) % 256, // Green.\n            b = Math.floor(x / 0x100) % 256; // Blue.\n\n        return ((r * 299) + (g * 587) + (b * 114)) / 1000;\n    }\n\n    getColorGray(x) {\n        let r = Math.floor(x / 0x1000000) % 256, // Red.\n            g = Math.floor(x / 0x10000) % 256, // Green.\n            b = Math.floor(x / 0x100) % 256, // Blue.\n            yiq = (r * 299) + g * 587 + b * 114,\n            m = 255 * 299 + 255 * 587 + 255 * 114,\n            gray = Math.round(yiq * 255 / m);\n\n        return (gray * 0x10000) + (gray * 0x100) + gray;\n    }\n\n    getColorContrast(x) {\n        return (this.getContrast(x) >= 128) ? '#000000' : '#ffffff';\n    }\n\n    repairColors(colors) {\n\n        this.colors = colors;\n        let instance = this;\n        this.colors.sort(function(a, b) {\n            return instance.getContrast(a) - instance.getContrast(b);\n        });\n\n        this.colorBackground = this.colors[0];\n        this.body.style.background = this.getColorHex(this.colorBackground);\n\n        return this.colors;\n    }\n/* A\n    repairHTML(s, mapFiles, mapFilesWidth, mapFilesHeight) {\n        if (s === undefined) {\n            return '';\n        }\n        while (s.slice(0, 4) === '<br>') {\n            s = s.slice(4).trim();\n        }\n        for (; ;) {\n            let pos = s.indexOf(\"@@GUID@@\");\n            if (pos < 0) {\n                break;\n            }\n            let pos2 = s.indexOf(\"\\\"\", pos);\n            if (pos2 > 0) {\n                let s2 = s.slice(pos2 + 1);\n                let posw = s2.indexOf(\"width=\");\n                if (posw !== 0) {\n                    let posw2 = s2.slice(posw + 1, posw + 2) === \"\\\"\"\n                        ? s2.indexOf(\"\\\"\", posw + 2)\n                        : s2.indexOf(\" \", posw + 2);\n                    if (posw2 !== 0) {\n                        s2 = s2.slice(0, posw) + s2.slice(posw2 + 1);\n                    }\n                }\n                posw = s2.indexOf(\"height=\");\n                if (posw !== 0) {\n                    let posw2 = s2.slice(posw + 1, posw + 2) === \"\\\"\"\n                        ? s2.indexOf(\"\\\"\", posw + 2)\n                        : s2.indexOf(\" \", posw + 2);\n                    if (posw2 !== 0) {\n                        s2 = s2.slice(0, posw) + s2.slice(posw2 + 1);\n                    }\n                }\n\n                let key = s.substring(pos + 8, pos2);\n                s2 = \" width=\\\"\" + mapFilesWidth.get(key) + \"\\\" \" + s2;\n                s2 = \" height=\\\"\" + mapFilesHeight.get(key) + \"\\\" \" + s2;\n\n                s = s.substring(0, pos) + \"data:image/png;base64, \" + mapFiles.get(key) + \"\\\"\" + s2;\n            }\n        }\n\n        return s;\n    }\n*/\n    repairP(s) {\n        if (s === undefined) {\n            return \"\";\n        }\n\n        // Remove <p> tags and replace </p> with <br />\n        let s2 = s.replace(/<p[^>]*>/g, '').replace(/<\\/p>/g, '<br/>').trim();\n\n        // Remove <br> or <br/> at the end of the string\n        s2 = s2.replace(/<br\\s*\\/?>$/g, '');\n\n        // Remove the <ol><br></ol> sequence if it exists\n        let pos = s2.indexOf('<ol><br></ol>');\n        if (pos >= 0) {\n            s2 = s2.slice(0, pos) + s2.slice(pos + 13);\n        }\n\n        return s2;\n    }\n\n    createDivScorePercent(left, top, num) {\n        let button = document.createElement(\"button\");\n        button.style.position = \"absolute\";\n        button.classList.add(\"mmogame_button\");\n        button.style.left = left + \"px\";\n        button.style.top = top + \"px\";\n        button.style.width = this.iconSize + \"px\";\n        button.style.height = this.iconSize + \"px\";\n        button.style.lineHeight = this.iconSize + \"px\";\n        button.style.textAlign = \"center\";\n        button.style.border = \"0px solid \" + this.getColorHex(0xFFFFFF);\n        button.style.boxShadow = \"inset 0 0 0.125em rgba(255, 255, 255, 0.75)\";\n        if (num === 1) {\n            button.style.background = this.getColorHex(this.colorScore);\n            button.style.color = this.getColorContrast(this.colorScore);\n            button.title = this.getStringM('js_grade');\n        } else {\n            button.style.background = this.getColorHex(this.colorScore2);\n            button.style.color = this.getColorContrast(this.colorScore2);\n        }\n\n        this.body.appendChild(button);\n\n        button.innerHTML = '';\n        button.disabled = true;\n\n        let div = this.createDiv(this.body, left, top + this.iconSize / 4, this.iconSize / 2, this.iconSize / 2);\n        div.style.lineHeight = (this.iconSize / 2) + \"px\";\n        div.style.textAlign = \"center\";\n        div.style.color = this.getColorContrast(this.colorScore);\n        if (num === 1) {\n            this.labelScore = div;\n            div.title = this.getStringM('js_grade');\n        } else {\n            this.labelScore2 = div;\n            div.title = this.getStringM('js_grade_opponent');\n        }\n\n        let h = this.iconSize / 3;\n        div = this.createDiv(this.body, left, top, this.iconSize / 2, h);\n        div.style.textAlign = \"center\";\n        div.style.color = this.getColorContrast(this.colorScore);\n        div.title = this.getStringM('js_ranking_grade');\n        if (num === 1) {\n            this.labelScoreRank = div;\n        } else {\n            this.labelScoreRank2 = div;\n        }\n\n        div = this.createDiv(this.body, left, top + this.iconSize - h, this.iconSize / 2, h);\n        div.style.textAlign = \"center\";\n        div.style.color = this.getColorContrast(this.colorScore);\n        div.title = this.getStringM('js_grade_last_question');\n        button.disabled = true;\n        if (num === 1) {\n            this.labelAddScore = div;\n        } else {\n            this.labelAddScore2 = div;\n        }\n\n        let label = num === 1 ? this.labelScoreRank : this.labelScoreRank2;\n\n        div = this.createDiv(this.body, left + this.iconSize / 2, top, this.iconSize / 2, h);\n        div.style.textAlign = \"center\";\n        div.style.fontName = label.style.fontName;\n        div.style.fontSize = h + \"px\";\n        div.style.lineHeight = h + \"px\";\n        div.style.color = label.style.color;\n        div.title = this.getStringM('js_ranking_percent');\n        if (num === 1) {\n            this.labelScoreRankB = div;\n        }\n\n        label = num === 1 ? this.labelAddScore : this.labelAddScore2;\n        div = this.createDiv(this.body, left + this.iconSize / 2, parseFloat(this.labelScore.style.top), this.iconSize / 2,\n            this.iconSize / 2);\n        div.style.textAlign = \"center\";\n        div.style.lineHeight = Math.round(this.iconSize / 2) + \"px\";\n        div.style.fontName = label.style.fontName;\n        div.style.fontSize = label.style.fontSize;\n        div.style.fontWeight = 'bold';\n        div.style.color = label.style.color;\n        div.title = this.getStringM('js_percent');\n        this.autoResizeText(div, this.iconSize / 2, this.iconSize / 2, false);\n        if (num === 1) {\n            this.labelScoreB = div;\n        }\n    }\n\n    createDivTimer(left, top, sizeIcon) {\n        let div = document.createElement(\"div\");\n        div.style.position = \"absolute\";\n        div.style.left = left + \"px\";\n        div.style.top = top + \"px\";\n        div.style.width = sizeIcon + \"px\";\n        div.style.height = sizeIcon + \"px\";\n        div.style.whiteSpace = \"nowrap\";\n        div.style.lineHeight = sizeIcon + \"px\";\n        div.style.textAlign = \"center\";\n        div.style.background = this.getColorHex(this.colorBackground); // \"#234025\"\n        div.style.color = this.getColorContrast(this.colorBackground); // \"#DCBFDA\"\n        div.name = \"timer\";\n        this.body.appendChild(div);\n        this.labelTimer = div;\n\n        div.innerHTML = '23:59';\n        this.autoResizeText(div, sizeIcon, sizeIcon, false, 0, 0, 1);\n        div.innerHTML = '';\n        div.title = this.getStringM('js_question_time');\n    }\n\n    createButtonSound(left, top) {\n        this.buttonSound = this.createImageButton(this.body, left, top, this.iconSize, this.iconSize, \"mmogame_button_red\",\n            this.getMuteFile());\n        this.buttonSound.alt = this.getStringM('js_sound');\n        let instance = this;\n        this.buttonSound.addEventListener(\"click\", function() {\n            instance.onClickSound(instance.buttonSound);\n        });\n\n        this.buttonSound.title = this.getStringM('js_sound');\n    }\n\n    onClickSound(btn) {\n        window.title = btn.src;\n        this.kindSound = (this.kindSound + 1) % 2;\n        window.localStorage.setItem(\"kindSound\", toString(this.kindSound));\n        btn.src = this.getMuteFile();\n    }\n\n    createButtonHelp(left, top) {\n        this.buttonHelp = this.createImageButton(this.body, left, top, this.iconSize, this.iconSize, \"\", 'assets/help.svg');\n        this.buttonHelp.alt = this.getStringM('js_help');\n    }\n\n    findbest(low, up, fn) {\n        if (low < 1) {\n            low = 1;\n        }\n\n        let prevSize;\n        let fitSize = low;\n        let testSize;\n        for (let i = 0; i <= 10; i++) {\n            prevSize = low;\n            testSize = (low + up) / 2;\n\n            let cmp = fn(testSize);\n            if (cmp <= 0) {\n                fitSize = testSize;\n                low = testSize;\n            } else {\n                up = testSize;\n            }\n            if (Math.abs((testSize - prevSize) / testSize) < 0.01) {\n                break;\n            }\n        }\n\n        return fitSize;\n    }\n\n    createDefinition(left, top, width, onlyMetrics, fontSize) {\n\n        width -= 2 * this.padding;\n        let div = document.createElement(\"div\");\n\n        div.style.position = \"absolute\";\n        div.style.width = width + \"px\";\n\n        div.style.fontSize = fontSize + \"px\";\n        // A div.innerHTML = this.repairHTML(this.definition, this.mapFiles, this.mapFilesWidth, this.mapFilesHeight);\n        div.innerHTML = this.definition;\n        div.style.textAlign = \"left\";\n\n        if (onlyMetrics) {\n            this.body.appendChild(div);\n            let ret = [div.scrollWidth - 1, div.scrollHeight];\n            this.body.removeChild(div);\n            return ret;\n        }\n\n        div.style.background = this.getColorHex(this.colorDefinition);\n        div.style.color = this.getColorContrast(this.colorDefinition);\n        div.style.left = left + \"px\";\n        div.style.top = top + \"px\";\n        div.style.paddingLeft = this.padding + \"px\";\n        div.style.paddingRight = this.padding + \"px\";\n        div.id = \"definition\";\n\n        this.area.appendChild(div);\n        let height = div.scrollHeight + this.padding;\n        div.style.height = height + \"px\";\n\n        this.definitionHeight = height;\n        this.divDefinition = div;\n\n        return [div.scrollWidth - 1, div.scrollHeight];\n    }\n\n    updateLabelTimer() {\n        if (this.labelTimer === undefined) {\n            return;\n        }\n        if (this.timeclose === 0 || this.timestart === 0) {\n            this.labelTimer.innerHTML = '';\n            return;\n        }\n\n        let dif = Math.round(this.timeclose - ((new Date()).getTime()) / 1000);\n        if (dif <= 0) {\n            dif = 0;\n            this.sendTimeout();\n        }\n        const minutes = Math.floor(Math.abs(dif) / 60);\n        const seconds = Math.abs(dif) % 60;\n        const prefix = dif < 0 ? \"-\" : \"\";\n        this.labelTimer.innerHTML = `${prefix}${minutes}:${seconds.toString().padStart(2, '0')}`;\n\n        if (dif === 0) {\n            return;\n        }\n\n        let instance = this;\n        setTimeout(function() {\n            instance.updateLabelTimer();\n        }, 500);\n    }\n\n    createDivMessage(message) {\n        if (this.area !== undefined) {\n            this.body.removeChild(this.area);\n            this.area = undefined;\n        }\n\n        if (this.divMessageHelp !== undefined) {\n            this.body.removeChild(this.divMessageHelp);\n            this.divMessageHelp = undefined;\n        }\n\n        let left = this.padding;\n        let top = this.areaTop;\n        let width = window.innerWidth - 2 * this.padding;\n        let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n        if (this.divMessageBackground === undefined) {\n            let div = this.createDiv(this.divMessageBackground, left, top, width, height);\n            div.style.background = this.getColorHex(this.colorDefinition);\n            this.divMessageBackground = div;\n        }\n\n        if (this.divMessage === undefined) {\n            let div = document.createElement(\"div\");\n            div.style.position = \"absolute\";\n            div.style.left = left + \"px\";\n            div.style.textAlign = \"center\";\n            div.style.width = (width - 2 * this.padding) + \"px\";\n            div.style.paddingLeft = this.padding + \"px\";\n            div.style.paddingRight = this.padding + \"px\";\n\n            div.style.background = this.getColorHex(this.colorDefinition);\n            div.style.color = this.getColorContrast(this.colorDefinition);\n            this.divMessage = div;\n        }\n        this.divMessage.innerHTML = message;\n        this.body.appendChild(this.divMessage);\n        this.divMessage.style.top = (height - this.divMessage.scrollHeight) / 2 + \"px\";\n\n        this.autoResizeText(this.divMessage, width, height, false, this.minFontSize, this.maxFontSize, 0.5);\n    }\n\n    createDivMessageStart(message) {\n        if (this.area !== undefined) {\n            this.body.removeChild(this.area);\n            this.area = undefined;\n        }\n\n        let left = this.padding;\n        let top = this.areaTop;\n        let width = window.innerWidth - 2 * this.padding;\n        let height = window.innerHeight - this.getCopyrightHeight() - this.padding - top;\n\n        let height1 = height / 8;\n\n        if (this.divMessageBackground === undefined) {\n            let div = this.createDiv(this.divMessageBackground, left, top, width, height);\n            div.style.background = this.getColorHex(this.colorDefinition);\n            this.divMessageBackground = div;\n        }\n\n        if (this.divMessage === undefined) {\n            let div = document.createElement(\"div\");\n            div.style.position = \"absolute\";\n            div.style.left = left + \"px\";\n            div.style.textAlign = \"center\";\n            div.style.width = (width - 2 * this.padding) + \"px\";\n            div.style.paddingLeft = this.padding + \"px\";\n            div.style.paddingRight = this.padding + \"px\";\n\n            div.style.background = this.getColorHex(this.colorDefinition);\n            div.style.color = this.getColorContrast(this.colorDefinition);\n            this.divMessage = div;\n        }\n        this.divMessage.innerHTML = message;\n        this.body.appendChild(this.divMessage);\n\n        this.autoResizeText(this.divMessage, width, height1, false, this.minFontSize, this.maxFontSize, 0.5);\n        top += (height1 - this.divMessage.scrollHeight) / 2;\n        this.divMessage.style.top = top + \"px\";\n\n        if (this.divMessageHelp === undefined) {\n            let div = document.createElement(\"div\");\n            div.style.position = \"absolute\";\n            div.style.left = left + \"px\";\n            div.style.textAlign = \"left\";\n            div.style.width = (width - 2 * this.padding) + \"px\";\n            div.style.paddingLeft = this.padding + \"px\";\n            div.style.paddingRight = this.padding + \"px\";\n\n            div.style.color = this.getColorContrast(this.colorDefinition);\n            let top = this.iconSize + 3 * this.padding + height1;\n            div.style.top = (top + this.padding) + \"px\";\n            div.style.height = (height - height1) + \"px\";\n            this.divMessageHelp = div;\n            this.body.appendChild(this.divMessageHelp);\n\n            this.showHelpScreen(div, (width - 2 * this.padding), (height - height1));\n        }\n    }\n\n    removeDivMessage() {\n        if (this.divMessage !== undefined) {\n            this.body.removeChild(this.divMessage);\n            this.divMessage = undefined;\n        }\n        if (this.divMessageHelp !== undefined) {\n            this.body.removeChild(this.divMessageHelp);\n            this.divMessageHelp = undefined;\n        }\n        if (this.divMessageBackground !== undefined) {\n            this.divMessageBackground.remove();\n            this.divMessageBackground = undefined;\n        }\n    }\n\n    disableButtons(buttons, disabled) {\n        for (let i = 0; i < buttons.length; i++) {\n            let btn = buttons[i];\n            if (btn !== undefined) {\n                if (disabled) {\n                    btn.classList.add(\"mmogame_imgbutton_disabled\");\n                } else {\n                    btn.classList.remove(\"mmogame_imgbutton_disabled\");\n                }\n            }\n        }\n    }\n\n    repairNickname(nickname) {\n        if (nickname === undefined) {\n            return '';\n        }\n\n        let s = nickname;\n        if (s !== '') {\n            while (s.indexOf('_') !== -1) {\n                s = s.replace('_', ' ');\n            }\n        }\n\n        return s;\n    }\n\n    showScore(json) {\n        let s = json.sumscore === undefined ? '' : '<b>' + json.sumscore + '</b>';\n        if (this.labelScore.innerHTML !== s) {\n            this.labelScore.innerHTML = s;\n            let w = this.iconSize - 2 * this.padding;\n            this.autoResizeText(this.labelScore, w, this.iconSize / 2, false, 0, 0, 1);\n        }\n\n        if (this.labelScoreRank.innerHTML !== json.rank) {\n            this.labelScoreRank.innerHTML = json.rank !== undefined ? json.rank : '';\n            this.autoResizeText(this.labelScoreRank, this.iconSize, this.iconSize / 3, true, 0, 0, 1);\n        }\n\n        if (json.name !== undefined) {\n            window.document.title = (json.usercode !== undefined ? json.usercode : \"\") + \" \" + json.name;\n        }\n\n        s = json.addscore === undefined ? '' : json.addscore;\n        if (this.labelAddScore.innerHTML !== s) {\n            this.labelAddScore.innerHTML = s;\n            this.autoResizeText(this.labelAddScore, this.iconSize - 2 * this.padding, this.iconSize / 3, false, 0, 0, 1);\n        }\n\n        if (this.labelScoreRankB.innerHTML !== json.completedrank) {\n            this.labelScoreRankB.innerHTML = json.completedrank !== undefined ? json.completedrank : '';\n            this.autoResizeText(this.labelScoreRankB, 0.9 * this.iconSize / 2, this.iconSize / 3, true, 0, 0, 1);\n        }\n\n        s = json.percentcompleted !== undefined ? Math.round(100 * json.percentcompleted) + '%' : '';\n        if (this.labelScoreB.innerHTML !== s) {\n            this.labelScoreB.innerHTML = s;\n            this.autoResizeText(this.labelScoreB, 0.8 * this.iconSize / 2, this.iconSize / 3, true, 0, 0, 1);\n        }\n    }\n\n    showColorPalette(canvas, colors) {\n        let ctx = canvas.getContext(\"2d\");\n        let width = canvas.width;\n        let height = canvas.height;\n        let strip = width / 5;\n        let instance = this;\n\n        colors.sort(function(a, b) {\n            return instance.getContrast(a) - instance.getContrast(b);\n        });\n        for (let i = 0; i < 5; i++) {\n            ctx.fillStyle = this.getColorHex(colors[i]);\n            ctx.fillRect(i * strip, 0, (i + 1) * strip, height);\n        }\n\n        ctx.strokeStyle = \"#FFFFFF\";\n        ctx.lineWidth = 1;\n        ctx.strokeRect(0, 0, width, height);\n    }\n\n    setColorsString(s) {\n        let a = [0x9B7ED9, 0x79F2F2, 0x67BF5A, 0xD0F252, 0xBF5B21];\n        if (s !== undefined && s.length >= 0) {\n            let b = s.split(\",\");\n            if (b.length === 5) {\n                a = b;\n                for (let i = 0; i < 5; i++) {\n                    a[i] = parseInt(a[i]);\n                }\n            }\n        }\n        this.setColors(a);\n    }\n    computeDifClock(json) {\n        if (json.time !== undefined) {\n            this.difClock = ((new Date()).getTime() - json.time) / 1000;\n        }\n\n        this.computeTimeStartClose(json);\n    }\n\n    computeTimeStartClose(json) {\n        if (json.timestart !== undefined) {\n            this.timestart = parseInt(json.timestart) !== 0 ? parseInt(json.timestart) + this.difClock : 0;\n            this.timeclose = parseInt(json.timeclose) !== 0 ? parseInt(json.timeclose) + this.difClock : 0;\n        } else {\n            this.timestart = 0;\n            this.timeclose = 0;\n        }\n    }\n\n    drawRadio(canvas, color1, color2) {\n        let ctx = canvas.getContext(\"2d\");\n        let size = canvas.width;\n        ctx.clearRect(0, 0, size, canvas.height);\n\n        ctx.beginPath();\n        ctx.arc(size / 2, size / 2, size / 2, 0, 2 * Math.PI, false);\n        ctx.fillStyle = this.getColorHex(color1);\n        ctx.fill();\n\n        let checked = canvas.classList.contains(\"checked\");\n        if (checked) {\n            ctx.beginPath();\n            ctx.arc(size / 2, size / 2, size / 4, 0, 2 * Math.PI, false);\n            ctx.fillStyle = this.getColorHex(color2);\n            ctx.fill();\n        }\n    }\n\n    createRadiobox(parent, size, color1, color2, checked, disabled) {\n        let canvas = document.createElement('canvas');\n        canvas.style.position = \"absolute\";\n        canvas.width = size;\n        canvas.height = size;\n        parent.appendChild(canvas);\n        if (checked) {\n            canvas.classList.add(\"checked\");\n        }\n        if (disabled) {\n            canvas.classList.add(\"disabled\");\n        }\n\n        this.drawRadio(canvas, disabled ? color1 : 0xFFFFFF, color2);\n\n        return canvas;\n    }\n\n    createButtonsAvatar(num, left, widthNickName = 0, heightNickName = 0) {\n        if (widthNickName === 0) {\n            widthNickName = this.iconSize;\n        }\n        if (heightNickName === 0) {\n            heightNickName = this.iconSize - this.buttonAvatarHeight;\n        }\n        if (this.buttonsAvatarLeft === undefined) {\n            this.buttonsAvatarLeft = [];\n        }\n        this.buttonsAvatarLeft[num] = left;\n\n        if (this.buttonsAvatarSrc === undefined) {\n            this.buttonsAvatarSrc = [];\n        }\n        this.buttonsAvatarSrc[num] = \"\";\n\n        if (this.nicknames === undefined) {\n            this.nicknames = [];\n        }\n        this.nicknames[num] = \"\";\n\n        if (this.buttonsAvatar === undefined) {\n            this.buttonsAvatar = [];\n        }\n        this.buttonsAvatar[num] = this.createImageButton(this.body, left, this.avatarTop, this.iconSize, this.iconSize, \"\", \"\");\n        if (num === 2 && this.avatarTop !== undefined) {\n            this.buttonsAvatar[num].title = this.getStringM('js_opponent');\n        }\n\n        if (this.divNicknames === undefined) {\n            this.divNicknames = [];\n        }\n        if (this.divNicknamesWidth === undefined) {\n            this.divNicknamesWidth = [];\n        }\n        if (this.divNicknamesHeight === undefined) {\n            this.divNicknamesHeight = [];\n        }\n        this.divNicknamesWidth[num] = widthNickName;\n        this.divNicknamesHeight[num] = heightNickName;\n\n        this.divNicknames[num] = this.createDiv(this.body, left, this.padding, widthNickName, heightNickName);\n    }\n\n    updateButtonsAvatar(num, avatar, nickname) {\n        if (avatar === undefined) {\n            avatar = \"\";\n        }\n        if (nickname === undefined) {\n            nickname = \"\";\n        }\n\n        if (avatar === \"\" && nickname === \"\") {\n            this.buttonsAvatar[num].style.visibility = 'hidden';\n            this.divNicknames[num].style.visibility = 'hidden';\n            return;\n        }\n\n        if (this.nicknames[num] !== nickname || nickname === \"\") {\n            this.nicknames[num] = nickname;\n            let s = nickname;\n\n            if (nickname.length === 0) {\n                s = avatar;\n                let pos = s.lastIndexOf(\"/\");\n                if (pos >= 0) {\n                    s = s.slice(pos + 1);\n                }\n                pos = s.lastIndexOf(\".\");\n                if (pos >= 0) {\n                    s = s.slice(0, pos);\n                }\n                const filenameWithExt = avatar.split('/').pop(); // Extract the file name with its extension\n                s = filenameWithExt.split('.').slice(0, -1).join('.'); // Remove the extension from the file name\n            }\n            s = this.repairNickname(s);\n            if (this.divNicknames[num] !== undefined && this.divNicknames[num].innerHTML !== s) {\n                this.divNicknames[num].innerHTML = s;\n                this.divNicknames[num].style.textAlign = \"center\";\n                this.divNicknames[num].style.color = this.getColorContrast(this.colorsBackground);\n                this.autoResizeText(this.divNicknames[num], this.divNicknamesWidth[num], this.divNicknamesHeight[num], true,\n                    0, 0, 1);\n            }\n        }\n\n        if (avatar !== this.buttonsAvatarSrc[num]) {\n            this.updateImageButton(this.buttonsAvatar[num], this.buttonsAvatarLeft[num], this.buttonAvatarTop, this.iconSize,\n                this.buttonAvatarHeight, avatar !== \"\" ? \"assets/avatars/\" + avatar : \"\");\n            this.buttonsAvatarSrc[num] = avatar;\n        }\n\n        this.buttonsAvatar[num].alt = this.divNicknames[num].innerHTML;\n\n        this.buttonsAvatar[num].style.visibility = 'visible';\n        this.divNicknames[num].style.visibility = 'visible';\n    }\n\n    // Gate\n    gateOpen(mmogameid, pin, kinduser, auserid, url) {\n        this.url = url;\n        this.minFontSize *= 2;\n        this.maxFontSize *= 2;\n\n        this.mmogameid = mmogameid;\n        this.pin = pin;\n        this.auserid = auserid;\n        this.kinduser = kinduser;\n        this.gateComputeSizes();\n        this.areaTop = this.padding;\n\n        this.areaWidth = Math.round(window.innerWidth - 2 * this.padding);\n        this.areaHeight = Math.round(window.innerHeight - this.areaTop) - this.padding;\n\n        switch (kinduser) {\n            case 'moodle':\n                if (localStorage.getItem(\"nickname\") !== null && localStorage.getItem(\"avatarid\") !== null\n                    && localStorage.getItem(\"paletteid\") !== null) {\n                    let avatarid = parseInt(localStorage.getItem(\"avatarid\"));\n                    let paletteid = parseInt(localStorage.getItem(\"paletteid\"));\n                    this.gatePlayGame(auserid, localStorage.getItem(\"nickname\"), paletteid, avatarid);\n                    return;\n                }\n                break;\n            case 'guid':\n                if (localStorage.getItem(\"auserid\") !== null && localStorage.getItem(\"nickname\") !== null\n                    && localStorage.getItem(\"avatarid\") !== null && localStorage.getItem(\"paletteid\") !== null) {\n                    let avatarid = parseInt(localStorage.getItem(\"avatarid\"));\n                    let paletteid = parseInt(localStorage.getItem(\"paletteid\"));\n                    this.gatePlayGame(localStorage.getItem(\"auserid\"), localStorage.getItem(\"nickname\"), paletteid, avatarid);\n                    return;\n                }\n                break;\n        }\n\n        this.gateCreateScreen();\n    }\n\n    gatePlayGame(user, nickname, paletteid, avatarid) {\n        if (user === 0 && this.kinduser === 'guid') {\n            user = this.getUserGUID();\n        }\n        localStorage.setItem(\"auserid\", user);\n        localStorage.setItem(\"nickname\", nickname);\n        localStorage.setItem(\"paletteid\", paletteid);\n        localStorage.setItem(\"avatarid\", avatarid);\n\n        let instance = this;\n        require(['core/ajax'], function(Ajax) {\n            // Defining the parameters to be passed to the service\n            let params = {\n                mmogameid: instance.mmogameid,\n                kinduser: instance.kinduser,\n                user: user,\n                nickname: nickname,\n                avatarid: avatarid,\n                colorpaletteid: paletteid,\n            };\n\n            // Calling the service through the Moodle AJAX API\n            let getAttempt = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_attempt',\n                args: params\n            }]);\n\n            // Handling the response\n            getAttempt[0].done(function(response) {\n                let json = {}; // Create an empty object r\n                response.ret.forEach(function(item) {\n                    json[item.key] = item.value; // Assign the value of each key-value pair to the object r\n                });\n                instance.openGame();\n                instance.colors = undefined;\n                instance.onServerGetAttempt(json, '');\n            }).fail(function(error) {\n                return error;\n            });\n        });\n    }\n\n    gateCreateScreen() {\n        this.vertical = window.innerWidth < window.innerHeight;\n\n        if (this.area !== undefined) {\n            this.body.removeChild(this.area);\n            this.area = undefined;\n        }\n        this.removeDivMessage();\n\n        this.area = this.createDiv(this.body, this.padding, this.areaTop, this.areaWidth, this.areaHeight);\n\n        if (this.vertical) {\n            this.gateCreateScreenVertical();\n        } else {\n            this.gateCreateScreenHorizontal();\n        }\n    }\n\n    gateCreateScreenVertical() {\n        let maxHeight = this.areaHeight - 5 * this.padding - this.iconSize;\n        let maxWidth = this.areaWidth;\n        let instance = this;\n        let size;\n\n        const labels = [this.getStringM('js_name') + \": \", this.getStringM('js_code'), this.getStringM('js_palette')];\n        this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, function(fontSize) {\n            size = instance.gateComputeLabelSize(fontSize, labels);\n\n            if (size[0] >= maxWidth) {\n                return 1;\n            }\n            let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n            let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n            let n = Math.floor(heightColors / instance.iconSize);\n            if (n === 0) {\n                return 1;\n            }\n            let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n            let computedHeight = heightCode + 3 * size[1] + 8 * instance.padding + heightColors + heightAvatars;\n\n            return computedHeight < maxHeight ? -1 : 1;\n        });\n\n        let gridWidthColors = maxWidth - this.padding;\n        let gridWidthAvatars = maxWidth - this.padding;\n        let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n        let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n        let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n        let rest = gridHeightColors - newHeight;\n        gridHeightColors = newHeight;\n        let gridHeightAvatars = (maxHeight - 4 * this.fontSize + rest) * 3 / 5;\n\n        let bottom;\n        if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n            // A bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n            bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize, size[0],\n                this.getStringM('js_code') + \": \") + 2 * this.padding;\n            this.edtCode = this.edt;\n            this.edtCode.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n        } else {\n            bottom = 0;\n        }\n\n        bottom = this.gateCreateLabelEditVertical(0, bottom, newWidth - 2 * this.padding, this.fontSize, size[0],\n            this.getStringM('js_name') + \": \") + 2 * this.padding;\n        this.edtNickname = this.edt;\n        this.edtNickname.addEventListener(\"keyup\", function() {\n            instance.gateUpdateSubmit();\n        });\n\n        let label1 = document.createElement(\"label\");\n        label1.style.position = \"absolute\";\n        label1.innerHTML = this.getStringM('js_palette');\n        label1.style.font = \"FontAwesome\";\n        label1.style.fontSize = this.fontSize + \"px\";\n        label1.style.width = \"0px\";\n        label1.style.whiteSpace = \"nowrap\";\n        this.area.appendChild(label1);\n\n        let btn = this.createImageButton(this.area, label1.scrollWidth + this.padding, bottom, this.iconSize, this.fontSize,\n            '', 'assets/refresh.svg', false, 'refresh');\n        btn.addEventListener(\"click\",\n            function() {\n                let elements = instance.area.getElementsByClassName(\"mmogame_color\");\n\n                while (elements[0]) {\n                    elements[0].parentNode.removeChild(elements[0]);\n                }\n\n                instance.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors,\n                    0, bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                    true, false);\n            }\n        );\n        label1.style.left = 0;\n        label1.style.color = this.getColorContrast(this.colorBackground);\n        label1.style.top = bottom + \"px\";\n        bottom += this.fontSize + this.padding;\n\n        let label = document.createElement(\"label\");\n        label.style.position = \"absolute\";\n        label.innerHTML = this.getStringM('js_avatars');\n        label.style.font = \"FontAwesome\";\n        label.style.fontSize = this.fontSize + \"px\";\n        label.style.width = \"0 px\";\n        label.style.whiteSpace = \"nowrap\";\n        this.area.appendChild(label);\n        btn = this.createImageButton(this.area, label.scrollWidth + this.padding, bottom + gridHeightColors, this.iconSize,\n            this.fontSize, '', 'assets/refresh.svg', false, 'refresh');\n        btn.addEventListener(\"click\",\n            function() {\n                let elements = instance.area.getElementsByClassName(\"mmogame_avatar\");\n\n                while (elements[0]) {\n                    elements[0].parentNode.removeChild(elements[0]);\n                }\n\n                instance.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors,\n                    0, bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                    false, true);\n            }\n        );\n\n        label.style.left = \"0 px\";\n        label.style.color = this.getColorContrast(this.colorBackground);\n        label.style.top = (bottom + gridHeightColors) + \"px\";\n\n        // Vertical\n        this.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors,\n            0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n            gridHeightAvatars);\n\n        let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n        this.btnSubmit = this.createImageButton(this.area, (maxWidth - this.iconSize) / 2, bottom2, 0,\n            this.iconSize, \"\", 'assets/submit.svg', false, 'submit');\n        this.btnSubmit.style.visibility = 'hidden';\n        this.btnSubmit.addEventListener(\"click\", function() {\n            instance.gatePlayGame(instance.edtCode === undefined ? instance.auserid : instance.edtCode.value,\n                instance.edtNickname.value, instance.paletteid, instance.avatarid);\n        });\n    }\n\n    gateCreateScreenHorizontal() {\n        let maxHeight = this.areaHeight - 7 * this.padding - this.iconSize;\n        let maxWidth = this.areaWidth;\n        let instance = this;\n        let size;\n\n        const sName = this.getStringM('js_name') + \": \";\n        let labels = [this.getStringM('js_code'), sName, this.getStringM('js_palette')];\n\n        this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, function(fontSize) {\n            size = instance.gateComputeLabelSize(fontSize, labels);\n\n            if (size[0] >= maxWidth) {\n                return 1;\n            }\n            let heightCode = instance.kinduser !== 'guid' && instance.kinduser !== 'moodle' ? size[1] + instance.padding : 0;\n\n            let heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n            let n = Math.floor(heightColors / instance.iconSize);\n            if (n === 0) {\n                return 1;\n            }\n            let heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n            let computedHeight = heightCode + 2 * size[1] + 7 * instance.padding + heightColors + heightAvatars;\n\n            return computedHeight < maxHeight ? -1 : 1;\n        });\n\n        let gridWidthColors = maxWidth - this.padding;\n        let gridWidthAvatars = maxWidth - this.padding;\n        let gridHeightColors = (maxHeight - 4 * this.fontSize) * 2 / 5;\n        let newHeight = Math.floor(gridHeightColors / instance.iconSize) * instance.iconSize;\n        let newWidth = Math.floor(gridWidthColors / instance.iconSize) * instance.iconSize;\n        let rest = gridHeightColors - newHeight;\n        gridHeightColors = newHeight;\n        let gridHeightAvatars = Math.floor((maxHeight - 4 * this.fontSize) * 3 / 5 + rest);\n\n        let bottom;\n        if (this.kinduser !== 'guid' && this.kinduser !== 'moodle') {\n            // B bottom = this.gateCreateCode(0, 0, maxWidth, this.fontSize, size[0]);\n            bottom = this.gateCreateLabelEditVertical(0, 0, maxWidth, this.fontSize, size[0],\n                this.getStringM('js_code')) + 2 * this.padding;\n            this.edtCode = this.edt;\n            this.edtCode.addEventListener(\"keyup\", function() {\n                instance.gateUpdateSubmit();\n            });\n        } else {\n            bottom = 0;\n        }\n        let sizeLabel = this.gateComputeLabelSize(this.fontSize, [sName]);\n        bottom = this.gateCreateLabelEditHorizontal(0, bottom, newWidth - 2 * this.padding,\n            this.fontSize, sizeLabel[0], this.getStringM('js_name') + \": \");\n\n        this.edtNickname = this.edt;\n        this.edtNickname.addEventListener(\"keyup\", function() {\n            instance.gateUpdateSubmit();\n        });\n\n        let label1 = document.createElement(\"label\");\n        label1.style.position = \"absolute\";\n        label1.innerHTML = this.getStringM('js_palette');\n        label1.style.font = \"FontAwesome\";\n        label1.style.fontSize = this.fontSize + \"px\";\n        label1.style.width = \"0px\";\n        label1.style.whiteSpace = \"nowrap\";\n        this.area.appendChild(label1);\n\n        // Button refresh color palettes\n        let btn = this.createImageButton(this.area, label1.scrollWidth + this.padding, bottom, this.iconSize, this.fontSize,\n            '', 'assets/refresh.svg', false, 'refresh');\n        btn.addEventListener(\"click\",\n            function() {\n                let elements = instance.area.getElementsByClassName(\"mmogame_color\");\n\n                while (elements[0]) {\n                    elements[0].parentNode.removeChild(elements[0]);\n                }\n\n                instance.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors, 0,\n                    bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                    true, false);\n            }\n        );\n        label1.style.left = 0;\n        label1.style.color = this.getColorContrast(this.colorBackground);\n        label1.style.top = bottom + \"px\";\n        bottom += this.fontSize + this.padding;\n\n        let label = document.createElement(\"label\");\n        label.style.position = \"absolute\";\n        label.innerHTML = this.getStringM('js_avatars');\n        label.style.font = \"FontAwesome\";\n        label.style.fontSize = this.fontSize + \"px\";\n        label.style.width = \"0 px\";\n        label.style.whiteSpace = \"nowrap\";\n        this.area.appendChild(label);\n\n        // Button refresh avatars\n        btn = this.createImageButton(this.area, label.scrollWidth + this.padding, bottom + gridHeightColors, this.iconSize,\n            this.fontSize, '', 'assets/refresh.svg', false, 'refresh');\n        btn.addEventListener(\"click\",\n            function() {\n                let elements = instance.area.getElementsByClassName(\"mmogame_avatar\");\n\n                while (elements[0]) {\n                    elements[0].parentNode.removeChild(elements[0]);\n                }\n\n                instance.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors, 0,\n                    bottom + gridHeightColors + instance.fontSize + instance.padding, gridWidthAvatars, gridHeightAvatars,\n                    false, true);\n            }\n        );\n\n        // Avatar\n        label.style.left = \"0 px\";\n        label.style.color = this.getColorContrast(this.colorBackground);\n        label.style.top = (bottom + gridHeightColors) + \"px\";\n\n        // Horizontal\n        this.gateSendGetColorsAvatarsVertical(0, bottom, gridWidthColors, gridHeightColors,\n            0, bottom + gridHeightColors + this.fontSize + this.padding, gridWidthAvatars,\n            gridHeightAvatars);\n\n        let bottom2 = bottom + gridHeightColors + this.fontSize + this.padding + gridHeightAvatars;\n        this.btnSubmit = this.createImageButton(this.area, (maxWidth - this.iconSize) / 2, bottom2, 0,\n            this.iconSize, \"\", 'assets/submit.svg', false, 'submit');\n        this.btnSubmit.style.visibility = 'hidden';\n        this.btnSubmit.addEventListener(\"click\",\n            function() {\n                instance.gatePlayGame(instance.edtCode === undefined ? instance.auserid : instance.edtCode.value,\n                    instance.edtNickname.value, instance.paletteid, instance.avatarid);\n            });\n    }\n\n    gateComputeLabelSize(fontSize, aLabel) {\n        let maxWidth = 0;\n        let maxHeight = 0;\n\n        for (let i = 0; i < aLabel.length; i++) {\n            const label = document.createElement(\"label\");\n            label.style.position = \"absolute\";\n            label.innerHTML = aLabel[i];\n            label.style.whiteSpace = \"nowrap\";\n            label.style.font = \"FontAwesome\";\n            label.style.fontSize = fontSize + \"px\";\n            label.style.width = \"0px\";\n            label.style.height = \"0px\";\n            this.area.appendChild(label);\n\n            if (label.scrollWidth > maxWidth) {\n                maxWidth = label.scrollWidth;\n            }\n\n            if (label.scrollHeight > maxHeight) {\n                maxHeight = label.scrollHeight;\n            }\n            this.area.removeChild(label);\n        }\n\n        return [maxWidth, maxHeight];\n    }\n\n    gateCreateLabelEditVertical(left, top, width, fontSize, labelWidth, title) {\n        const label = document.createElement(\"label\");\n        label.style.position = \"absolute\";\n\n        label.innerHTML = title;\n\n        label.style.font = \"FontAwesome\";\n        label.style.fontSize = fontSize + \"px\";\n\n        this.area.appendChild(label);\n\n        label.style.position = \"absolute\";\n        label.style.left = left + \"px\";\n        label.style.top = top + \"px\";\n        label.style.width = labelWidth + \"px\";\n        label.style.align = \"left\";\n        label.style.color = this.getColorContrast(this.colorBackground);\n\n        top += label.scrollHeight;\n\n        let leftEdit = left + 'px';\n        let div = document.createElement(\"input\");\n        this.divShortAnswer = div;\n        div.style.position = \"absolute\";\n        div.style.width = width + \"px\";\n        div.style.type = \"text\";\n        div.style.fontSize = fontSize + \"px\";\n\n        div.style.left = leftEdit + \"px\";\n        div.style.top = top + \"px\";\n        div.autofocus = true;\n\n        this.area.appendChild(div);\n        this.edt = div;\n\n        return top + fontSize + this.padding;\n    }\n\n    gateShowAvatars(response, left, top, width, height, countX) {\n        if (!response.avatars || response.avatars.length === 0) {\n            return; // Exit early if no avatars exist\n        }\n\n        this.avatar = undefined;\n        const count = response.avatars.length;\n        let leftOriginal = left;\n        let w = Math.round(this.padding / 2) + \"px\";\n        for (let i = 0; i < count; i++) {\n            let avatarImagePath = 'assets/avatars/' + response.avatars[i];\n            let btn = this.createCenterImageButton(\n                this.area,\n                left, top,\n                this.iconSize - this.padding, this.iconSize - this.padding,\n                \"\",\n                avatarImagePath\n            );\n            btn.classList.add(\"mmogame_avatar\");\n            let id = response.avatarids[i];\n            btn.addEventListener(\"click\", () => {\n                this.gateUpdateAvatar(btn, id, w);\n            });\n\n            // Move left position after placing the button\n            left += this.iconSize;\n\n            // Reset left and move to the next row after filling countX buttons\n            if ((i + 1) % countX === 0) {\n                top += this.iconSize;\n                left = leftOriginal;\n            }\n        }\n    }\n\n    gateSendGetColorsAvatarsVertical(leftColors, topColors, gridWidthColors, gridHeightColors, leftAvatars, topAvatars,\n                                     gridWidthAvatars, gridHeightAvatars, updateColors = true, updateAvatars = true) {\n\n        let countXcolors = Math.floor(gridWidthColors / this.iconSize);\n        let countYcolors = Math.floor(gridHeightColors / this.iconSize);\n\n        let countXavatars = Math.floor(gridWidthAvatars / this.iconSize);\n        let countYavatars = Math.floor((gridHeightAvatars + 2 * this.padding) / this.iconSize);\n\n        if (!updateColors) {\n            countXcolors = countXcolors = 0;\n        }\n        if (!updateAvatars) {\n            countXavatars = countYavatars = 0;\n        }\n\n        let instance = this;\n        require(['core/ajax'], function(Ajax) {\n            // Defining the parameters to be passed to the service\n            let params = {\n                mmogameid: instance.mmogameid,\n                kinduser: instance.kinduser,\n                user: instance.auserid,\n                avatars: countXavatars * countYavatars,\n                colorpalettes: countXcolors * countYcolors,\n            };\n\n            // Calling the service through the Moodle AJAX API\n            let getAssets = Ajax.call([{\n                methodname: 'mod_mmogame_get_assets',\n                args: params\n            }]);\n\n            // Handling the response\n            getAssets[0].done(function(response) {\n                if (updateColors) {\n                    instance.gateShowColorPalettes(response, leftColors, topColors, gridWidthColors, gridHeightColors,\n                        countXcolors, countYcolors);\n                }\n                if (updateAvatars) {\n                    instance.gateShowAvatars(response, leftAvatars, topAvatars, gridWidthAvatars, gridHeightAvatars, countXavatars);\n                }\n            }).fail(function(error) {\n                return error;\n            });\n        });\n    }\n\n    gateShowColorPalettes(response, left, top, width, height, countX, countY) {\n        let i = 0; // Counter for color palettes\n        const count = response.colorpalettes.length;\n        this.canvasColor = undefined;\n        const canvasSize = this.iconSize - this.padding * 3 / 2;\n        const parsedPalettes = response.colorpalettes.map(palette =>\n            palette.split(\",\").map(value => parseInt(value, 10) || 0)\n        );\n        for (let iy = 0; iy < countY; iy++) {\n            for (let ix = 0; ix < countX; ix++) {\n                // Check if we exceed available palettes or encounter invalid data\n                if (i >= count || !parsedPalettes[i] || !response.colorpaletteids[i]) {\n                    i++; // Increment and continue if invalid\n                    continue;\n                }\n\n                // Create a new canvas element\n                let canvas = document.createElement('canvas');\n                canvas.style.position = \"absolute\";\n                canvas.style.left = `${left + ix * this.iconSize}px`;\n                canvas.style.top = `${top + iy * this.iconSize}px`;\n                canvas.width = canvasSize;\n                canvas.height = canvasSize;\n                canvas.style.cursor = 'pointer';\n                canvas.classList.add(\"mmogame_color\");\n\n                // Append canvas to the area\n                this.area.appendChild(canvas);\n\n                // Render the color palette on the canvas\n                this.showColorPalette(canvas, parsedPalettes[i]);\n\n                // Get the palette ID and attach a click event listener\n                let id = response.colorpaletteids[i];\n                canvas.addEventListener(\"click\", ()=> {\n                    this.gateUpdateColorPalete(canvas, id);\n                });\n\n                i++;\n            }\n        }\n        this.area.classList.add(\"palete\");\n    }\n\n    gateUpdateColorPalete(canvas, id) {\n        if (this.canvasColor !== undefined) {\n            this.canvasColor.style.borderStyle = \"none\";\n        }\n        this.canvasColor = canvas;\n        canvas.style.borderStyle = \"outset\";\n        let w = Math.round(this.padding / 2) + \"px\";\n        canvas.style.borderLeftWidth = w;\n        canvas.style.borderTopWidth = w;\n        canvas.style.borderRightWidth = w;\n        canvas.style.borderBottomWidth = w;\n\n        this.paletteid = id;\n\n        this.gateUpdateSubmit();\n    }\n\n    gateUpdateAvatar(avatar, id, w) {\n        if (this.avatar !== undefined) {\n            this.avatar.style.borderStyle = \"none\";\n        }\n        this.avatar = avatar;\n        avatar.style.borderStyle = \"outset\";\n\n        avatar.style.borderLeftWidth = w;\n        avatar.style.borderTopWidth = w;\n        avatar.style.borderRightWidth = w;\n        avatar.style.borderBottomWidth = w;\n\n        this.avatarid = id;\n\n        this.gateUpdateSubmit();\n    }\n\n    gateUpdateSubmit() {\n        let hasCode = this.edtCode === undefined ? true : parseInt(this.edtCode.value) > 0;\n        let visible = this.avatarid !== undefined && this.paletteid !== undefined && hasCode && this.edtNickname.value.length > 0;\n\n        this.btnSubmit.style.visibility = visible ? 'visible' : 'hidden';\n    }\n    gateComputeSizes() {\n        this.computeSizes();\n        this.iconSize = Math.round(0.8 * this.iconSize);\n        this.padding = Math.round(0.8 * this.padding);\n    }\n    getStringM(name) {\n        return M.util.get_string(name, 'mmogame');\n        }\n\n    gateCreateLabelEditHorizontal(left, top, width, fontSize, labelWidth, title) {\n        let label = document.createElement(\"label\");\n        label.style.position = \"absolute\";\n\n        label.innerHTML = title;\n\n        label.style.font = \"FontAwesome\";\n        label.style.fontSize = fontSize + \"px\";\n\n        this.area.appendChild(label);\n\n        label.style.position = \"absolute\";\n        label.style.left = left + \"px\";\n        label.style.top = top + \"px\";\n        label.style.width = labelWidth + \"px\";\n        label.style.align = \"left\";\n        label.style.color = this.getColorContrast(this.colorBackground);\n\n        let ret = top + Math.max(label.scrollHeight, fontSize) + this.padding;\n\n        let leftEdit = (left + labelWidth + this.padding);\n        const div = document.createElement(\"input\");\n        div.style.position = \"absolute\";\n        div.style.width = (width - leftEdit - this.padding) + \"px\";\n        div.style.type = \"text\";\n        div.style.fontSize = fontSize + \"px\";\n\n        div.style.left = leftEdit + \"px\";\n        div.style.top = top + \"px\";\n        div.autofocus = true;\n\n        this.area.appendChild(div);\n        this.edt = div;\n\n        return ret;\n    }\n\n    };\n});"],"names":["define","constructor","body","document","getElementsByTagName","kindSound","window","localStorage","getItem","isNaN","this","size","parseFloat","getComputedStyle","documentElement","getPropertyValue","minFontSize","maxFontSize","fontSize","hasHelp","removeBodyChilds","removeDivMessage","firstChild","removeChild","lastChild","area","undefined","openGame","computeSizes","createImageButton","parent","left","top","width","height","classname","filename","wrap","alt","button","createImage","classList","add","setAttribute","createElement","tabIndex","style","position","draggable","src","appendChild","createCenterImageButton","img","Image","onload","mul","Math","min","w","round","h","innerHTML","visibility","updateImageButton","createDiv","div","createDivColor","color","background","getColorHex","getMuteFile","playAudio","audio","networkState","play","autoResizeText","item","minRatio","minHeight","low","max","up","fitSize","fitHeight","newHeight","newWidth","i","el","whiteSpace","scrollHeight","scrollWidth","abs","autoResizeTextBr","autoResizeTextImage","s","change","startsWith","substring","pos1","indexOf","pos","trim","subwidth","subheight","pos2","pos3","s2","posw","posw2","num","slice","replace","parseInt","ratio","getUserGUID","guid","uuid4","setItem","pad","length","uuid","Array","floor","random","map","x","toString","join","cIcons","iconSize","innerWidth","innerHeight","padding","getIconSize","getCopyrightHeight","getPadding","toUpperCase","getContrast","getColorGray","yiq","gray","getColorContrast","repairColors","colors","instance","sort","a","b","colorBackground","repairP","createDivScorePercent","lineHeight","textAlign","border","boxShadow","colorScore","title","getStringM","colorScore2","disabled","labelScore","labelScore2","labelScoreRank","labelScoreRank2","labelAddScore","labelAddScore2","label","fontName","labelScoreRankB","fontWeight","labelScoreB","createDivTimer","sizeIcon","name","labelTimer","createButtonSound","buttonSound","addEventListener","onClickSound","btn","createButtonHelp","buttonHelp","findbest","fn","prevSize","testSize","createDefinition","onlyMetrics","definition","ret","colorDefinition","paddingLeft","paddingRight","id","definitionHeight","divDefinition","updateLabelTimer","timeclose","timestart","dif","Date","getTime","sendTimeout","minutes","seconds","prefix","padStart","setTimeout","createDivMessage","message","divMessageHelp","areaTop","divMessageBackground","divMessage","createDivMessageStart","height1","showHelpScreen","remove","disableButtons","buttons","repairNickname","nickname","showScore","json","sumscore","rank","usercode","addscore","completedrank","percentcompleted","showColorPalette","canvas","ctx","getContext","strip","fillStyle","fillRect","strokeStyle","lineWidth","strokeRect","setColorsString","split","setColors","computeDifClock","time","difClock","computeTimeStartClose","drawRadio","color1","color2","clearRect","beginPath","arc","PI","fill","contains","createRadiobox","checked","createButtonsAvatar","widthNickName","heightNickName","buttonAvatarHeight","buttonsAvatarLeft","buttonsAvatarSrc","nicknames","buttonsAvatar","avatarTop","divNicknames","divNicknamesWidth","divNicknamesHeight","updateButtonsAvatar","avatar","lastIndexOf","pop","colorsBackground","buttonAvatarTop","gateOpen","mmogameid","pin","kinduser","auserid","url","gateComputeSizes","areaWidth","areaHeight","avatarid","paletteid","gatePlayGame","gateCreateScreen","user","require","Ajax","params","colorpaletteid","call","methodname","args","done","response","forEach","key","value","onServerGetAttempt","fail","error","vertical","gateCreateScreenVertical","gateCreateScreenHorizontal","maxHeight","maxWidth","labels","gateComputeLabelSize","heightCode","heightColors","heightAvatars","gridWidthColors","gridWidthAvatars","gridHeightColors","rest","bottom","gridHeightAvatars","gateCreateLabelEditVertical","edtCode","edt","gateUpdateSubmit","edtNickname","label1","font","elements","getElementsByClassName","parentNode","gateSendGetColorsAvatarsVertical","bottom2","btnSubmit","sName","sizeLabel","gateCreateLabelEditHorizontal","aLabel","labelWidth","align","leftEdit","divShortAnswer","type","autofocus","gateShowAvatars","countX","avatars","count","leftOriginal","avatarImagePath","avatarids","gateUpdateAvatar","leftColors","topColors","leftAvatars","topAvatars","updateColors","updateAvatars","countXcolors","countYcolors","countXavatars","countYavatars","colorpalettes","gateShowColorPalettes","countY","canvasColor","canvasSize","parsedPalettes","palette","iy","ix","colorpaletteids","cursor","gateUpdateColorPalete","borderStyle","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","hasCode","visible","M","util","get_string"],"mappings":"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"}