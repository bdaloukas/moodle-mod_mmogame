define("mmogametype_quiz/mmogametypequizaduel",["mmogametype_quiz/mmogametypequiz"],(function(MmoGameTypeQuiz){return class extends MmoGameTypeQuiz{constructor(){super();const isVertical=window.innerWidth<window.innerHeight,hasHelp=this.hasHelp();this.cIcons=isVertical?5:8+(hasHelp?1:0),this.hasBasBottom=isVertical,this.isWaitOponent=!1,this.autosubmit=!0,this.type="aduel"}createIconBar(){let i=0;this.clearBodyChildren();this.nickNameHeight=Math.round(this.iconSize/3),this.areaTop=2*this.padding+this.iconSize+this.nickNameHeight,this.areaLeft=this.padding,this.areaWidth=Math.round(window.innerWidth-2*this.padding),this.areaHeight=Math.round(window.innerHeight-this.areaTop-0),this.hasBasBottom&&(this.areaHeight-=this.iconSize+2*this.padding),this.buttonAvatarHeight=this.iconSize+this.nickNameHeight,this.createButtonsAvatar(1,Math.round(this.padding+i++*(this.iconSize+this.padding)),2*this.iconSize+this.padding,this.nickNameHeight),this.buttonsAvatar[1].style.top=this.padding+this.nickNameHeight+"px",this.createDivScorePercent(this.padding+i++*(this.iconSize+this.padding),this.padding+this.nickNameHeight,1,!0),this.createButtonsAvatar(2,Math.round(this.padding+i++*(this.iconSize+this.padding)),2*this.iconSize+this.padding,this.nickNameHeight),this.buttonsAvatar[2].style.top=this.padding+this.nickNameHeight+"px",this.createDivScore(Math.round(this.padding+i++*(this.iconSize+this.padding)),this.padding+this.nickNameHeight,2),this.buttonScore2.style.visibility="hidden",this.createDivTimer(this.padding+i++*(this.iconSize+this.padding),this.padding+this.nickNameHeight,this.iconSize),!1===this.hasBasBottom?this.createButtonSound(this.padding+i++*(this.iconSize+this.padding),this.padding+this.nickNameHeight):this.createButtonSound(this.padding,this.areaTop+this.areaHeight);let left,instance=this;!1===this.hasBasBottom?(this.buttonHighScore=this.createImageButton(this.body,"mmogame-quiz-highscore",this.padding+i*(this.iconSize+this.padding),this.padding+this.nickNameHeight,this.iconSize,this.iconSize,"assets/highscore.svg"),this.button5050=this.createImageButton(this.body,"mmogame-quiz-aduel-5050",this.padding+i++*(this.iconSize+this.padding),this.padding+this.nickNameHeight,this.iconSize,this.iconSize,"assets/cutred.svg")):(this.buttonHighScore=this.createImageButton(this.body,"mmogame-quiz-highscore",this.padding+(this.iconSize+this.padding),this.areaTop+this.areaHeight,this.iconSize,this.iconSize,"assets/highscore.svg"),this.button5050=this.createImageButton(this.body,"mmogame-quiz-aduel-5050",this.padding+(this.iconSize+this.padding),this.areaTop+this.areaHeight,this.iconSize,this.iconSize,"assets/cutred.svg")),this.buttonHighScore.style.visibility="hidden",this.buttonHighScore.addEventListener("click",(function(){instance.sendGetHighScore()})),this.button5050.addEventListener("click",(function(){instance.sendGetAttempt(!1,"tool1")})),this.button5050.title=this.getStringM("js_help_5050"),!1===this.hasBasBottom?(left=this.padding+i++*(this.iconSize+this.padding),this.buttonSkip=this.createImageButton(this.body,"mmogame-quiz-aduel-skip",left,this.padding+this.nickNameHeight,this.iconSize,this.iconSize,"assets/skip.svg")):this.buttonSkip=this.createImageButton(this.body,"mmogame-quiz-aduel-skip",this.padding+2*(this.iconSize+this.padding),this.areaTop+this.areaHeight,this.iconSize,this.iconSize,"assets/skip.svg"),this.buttonSkip.addEventListener("click",(function(){instance.sendAnswer("tool2")})),this.buttonSkip.title=this.getStringT("js_help_skip"),!1===this.hasBasBottom?this.buttonWizard=this.createImageButton(this.body,"mmogame-quiz-aduel-wizard",left,this.padding+this.nickNameHeight,this.iconSize,this.iconSize,"assets/wizard.svg"):this.buttonWizard=this.createImageButton(this.body,"mmogame-quiz-aduel-wizard",this.padding+2*(this.iconSize+this.padding),this.areaTop+this.areaHeight,this.iconSize,this.iconSize,"assets/wizard.svg"),this.buttonWizard.addEventListener("click",(function(){instance.sendGetAttempt(!1,"tool3")})),this.buttonWizard.style.visibility="hidden",this.buttonWizard.title=this.getStringT("js_wizarg"),this.hasHelp()&&(!1===this.hasBasBottom?this.createButtonHelp(this.padding+i++*(this.iconSize+this.padding),this.padding+this.nickNameHeight):this.createButtonHelp(this.padding+3*(this.iconSize+this.padding),this.areaTop+this.areaHeight),this.buttonHelp.addEventListener("click",(function(){instance.onClickHelp(instance.buttonHelp)}))),this.createDivColor(this.body,"mmogame-aduel-copyright",0,window.innerHeight-0-1,window.innerWidth-1,0,this.getColorGray(this.colorScore2)),this.vertical=this.areaHeight>this.areaWidth}createDivScore(left,top,num){let button=this.createDiv(this.area,"mmogame-score",left,top,this.iconSize,this.iconSize);button.style.borderRadius=this.iconSize+"px",button.style.border="0px solid "+this.getColorHex(16777215),button.style.boxShadow="inset 0 0 0.125em rgba(255, 255, 255, 0.75)",button.title=this.getStringM("js_grade"),button.alt=this.getStringM("js_grade"),1===num?(button.style.background=this.getColorHex(this.colorScore),button.style.color=this.getContrastingColor(this.colorScore)):(this.buttonScore2=button,button.style.background=this.getColorHex(this.colorScore2),button.style.color=this.getContrastingColor(this.colorScore2)),this.body.appendChild(button),button.innerHTML="100 %",this.autoResizeText(button,this.iconSize,this.iconSize,!1,0,0,1),button.innerHTML="";let div=this.createDiv(this.body,"mmogame-score",left,top+this.iconSize/4,this.iconSize,this.iconSize/2);div.style.lineHeight=this.iconSize/2+"px",div.style.textAlign="center",div.style.color=this.getContrastingColor(this.colorScore),div.title=this.getStringM("js_grade"),1===num?this.labelScore=div:this.labelScore2=div;let h=this.iconSize/3;div=this.createDiv(this.body,"mmogame-score",left,top,this.iconSize,h),div.style.textAlign="center",div.style.color=this.getContrastingColor(this.colorScore),button.disabled=!0,1===num?this.labelScoreRank=div:this.labelScoreRank2=div,this.createAddScore("mmogame-addscore",left,top+this.iconSize-h,this.iconSize,h,num)}updateButtonTool(btn,tool){btn.style.visibility=void 0!==tool&&0!==tool?"hidden":"visible"}processGetAttempt(json){return void 0!==this.buttonHighScore&&(this.buttonHighScore.style.visibility="hidden"),this.computeDifClock(json.time,json.timestart,json.timeclose),this.timefastjson=json.timefastjson,this.fastjson=json.fastjson,void 0!==json.name&&(window.document.title=json.name),void 0!==json.helpurl&&(this.helpUrl=json.helpurl),this.correct=void 0,0===json.state?(json.qtype="",super.processGetAttempt(json),this.showScore(json),this.onServerGetAttemptHideButtons(),void this.createDivMessageStart(this.getStringM("js_wait_to_start"))):(this.state=parseInt(json.state),void 0!==this.savedColors&&this.savedColors===json.colors||(this.savedColors=json.colors,this.colors=void 0),void 0===this.colors&&(this.setColorsString(json.colors),this.createIconBar()),this.updateButtonsAvatar(1,json.avatar,json.nickname),this.updateButtonsAvatar(2,json.aduelAvatar,json.aduelNickname),this.updateButtonTool(this.button5050,json.tool1numattempt),void 0!==json.tool3?json.tool2numattempt=-1:json.tool3numattempt=-1,this.updateButtonTool(this.buttonSkip,json.tool2numattempt),this.updateButtonTool(this.buttonWizard,json.tool3numattempt),this.attempt=json.attempt,this.aduelPlayer=json.aduelPlayer,this.aduelScore=json.aduelScore,this.aduelRank=json.aduelRank,void 0!==json.errorcode&&"aduel_no_rivals"===json.errorcode||0===json.attempt?(void 0===json.param&&this.waitOponent(),this.hideTools(),this.showScore(json),void this.onServerGetAttemptRetry()):(this.isWaitOponent=!1,this.qtype=json.qtype,"multichoice"===json.qtype&&(this.answers=[],this.answersID=json.answerids,json.answers.forEach(((answer,index)=>{this.answers[index]=this.repairP(answer)}))),this.answer=void 0!==json.answer?json.answer:null,this.definition=this.repairP(json.definition),void 0!==json.aduelAttempt&&(this.definition=json.aduelAttempt+". "+this.definition),this.single=json.single,this.autosave=0!==json.autosave,this.errorcode=json.errorcode,this.createScreen(json,!1),void 0!==this.btnSubmit&&(this.btnSubmit.style.visibility="hidden"),this.updateLabelTimer(),void this.sendFastJSON()))}onServerGetAttemptHideButtons(){this.button5050.style.visibility="hidden",this.buttonSkip.style.visibility="hidden",void 0!==this.btnSubmit&&(this.btnSubmit.style.visibility="hidden"),this.buttonsAvatar[2].style.visibility="hidden"}onTimeout(){this.labelTimer.innerHTML="",this.disableInput(),void 0!==this.btnSubmit&&(this.btnSubmit.style.display="none"),this.answer="",this.answerid=0,this.callSetAnswer();let btn=super.createImageButton(this.area,"mmogame-quiz-next",this.nextLeft,this.nextTop,0,this.iconSize,"assets/next.svg");btn.title=this.getStringM("js_next_question");let instance=this;btn.addEventListener("click",(function(){instance.sendGetAttempt(!1),instance.area.removeChild(btn)}))}waitOpponent(){this.isWaitOponent||(this.updateButtonsAvatar(2,"",""),this.createDivMessage("mmomgame-quiz-aduel-wait-opponent",this.getStringT("js_aduel_wait_opponent")),void 0!==this.labelTimer&&(this.labelTimer.innerHTML=""))}hideTools(){this.updateButtonTool(this.button5050,-1),this.updateButtonTool(this.buttonSkip,-1),this.updateButtonTool(this.buttonWizard,-1)}processSetAnswer(json){if(0===json.submit)return;if(this.correct=json.correct,void 0!==json.correct&&"multichoice"===this.qtype&&this.onServerAnswerMultichoice(json),this.disableInput(),this.buttonHighScore.style.visibility="visible",this.isWaitOponent=!1,void 0!==this.aItemAnswer&&void 0!==json.correct)for(let i=0;i<this.aItemAnswer.length;i++)this.aItemAnswer[i].classList.add("disabled");void 0!==this.btnSubmit&&(this.body.removeChild(this.btnSubmit),this.btnSubmit=void 0),this.showCorrectAnswer(json);let btn=super.createImageButton(this.area,"mmogame-quiz-next",this.nextLeft,this.nextTop,0,this.iconSize,"assets/next.svg");btn.title=this.getStringM("js_next_question");let instance=this;btn.addEventListener("click",(function(){instance.callGetAttempt(),instance.area.removeChild(btn)})),this.showScore(json),this.timeclose=0,1===this.aduelPlayer&&(0===json.attempt&&(this.timeclose=0,this.waitOpponent()),this.showScore(json)),void 0!==this.button5050&&(this.button5050.style.visibility="hidden",this.buttonSkip.style.visibility="hidden")}callSetAnswer(){void 0===this.correct&&super.callSetAnswer()}onServerAnswerMultichoice(json){let foundCorrect=!1,aduelAnswers=2===json.aduelPlayer&&null!==json.aduel_useranswer?json.aduel_useranswer.split(","):"",aCorrect=json.correct.split(",");for(let i=0;i<this.answersID.length;i++){if(""===this.answersID[i])continue;let iscorrect1,iscorrect2,label=this.aItemLabel[i],iscorrect=aCorrect.includes(this.answersID[i]);if(this.aItemAnswer[i].classList.contains("checked")&&(iscorrect1=aCorrect.includes(this.answersID[i])),iscorrect1&&(foundCorrect=!0),aduelAnswers.includes(this.answersID[i])&&(iscorrect2=aCorrect.includes(this.answersID[i])),!1===iscorrect&&void 0===iscorrect1&&void 0===iscorrect2)continue;let width=this.labelWidth,height=this.aItemLabel[i].scrollHeight,move=(void 0!==iscorrect2?2:1)*this.radioSize;void 0===iscorrect1&&void 0===iscorrect2&&(move=0),width-=move,0!==move&&(label.style.left=parseInt(label.style.left)+move+"px"),this.aItemLabel[i].style.width=width+"px",this.autoResizeText(this.aItemLabel[i],width,height,!0,this.minFontSize,this.maxFontSize,.5),this.onServerAnswerMultichoiceShowCorrect(i,iscorrect1,iscorrect2)}this.playAudio(foundCorrect?this.audioYes:this.audioNo)}onServerAnswerMultichoiceShowCorrect(i,iscorrect1,iscorrect2,iscorrect){if(iscorrect&&(this.aItemLabel[i].innerHTML="<b><u>"+this.aItemLabel[i].innerHTML+"</b></u>"),void 0!==iscorrect1){let t=parseInt(this.aItemAnswer[i].style.top),div=this.createDiv(this.area,"mmogame-quiz-aduel-correct-answer",this.aItemCorrectX[i],t,this.radioSize,this.radioSize);div.title=iscorrect1?this.getStringT("js_correct_answer"):this.getStringT("js_wrong_answer"),div.innerHTML=this.getSVGcorrect(this.radioSize,iscorrect1,this.colorScore,this.colorScore)}if(void 0!==iscorrect2){let t=parseInt(this.aItemAnswer[i].style.top),div=this.createDiv(this.area,"mmogame-aduel-opponent-correct",this.aItemCorrectX[i]+this.radioSize,t,this.radioSize,this.radioSize);div.innerHTML=this.getSVGcorrect(this.radioSize,iscorrect2,this.colorScore2,this.colorScore2),div.title=iscorrect2?this.getStringM("js_correct_answer"):this.getStringM("js_wrong_answer")}}showCorrectAnswer(_ref){let{aduel_iscorrect:aduel_iscorrect,iscorrect:iscorrect,tool2:tool2}=_ref;this.timeclose=0,this.updateLabelTimer(),this.strip=this.createDiv(this.area,"mmogame-quiz-aduel-strip",this.stripLeft,this.nextTop,this.stripWidth,this.stripHeight),void 0!==tool2&&2!==this.aduelPlayer||this.createImage(this.area,"mmogame-quiz-aduel-player1",this.stripLeft,this.nextTop,this.buttonsAvatar[1].width,this.buttonsAvatar[1].height,this.buttonsAvatar[1].src),void 0===tool2&&2===this.aduelPlayer&&this.createImage(this.area,"mmogame-quiz-aduel-player2",this.stripLeft+this.iconSize,this.nextTop,this.buttonsAvatar[2].width,this.buttonsAvatar[2].height,this.buttonsAvatar[2].src),this.strip.style.top=this.nextTop+"px";let s=this.getSVGcorrect(this.iconSize,0!==iscorrect,this.colorScore,this.colorScore);void 0!==tool2&&1===this.aduelPlayer&&(s=""),2===this.aduelPlayer&&void 0===tool2&&(s+=this.getSVGcorrect(this.iconSize,0!==aduel_iscorrect,this.colorScore2,this.colorScore2)),this.strip.innerHTML=s,this.strip.style.zIndex="1"}showScore(json){let rankc=json.completedrank;if(void 0!==json.rank&&void 0!==rankc&&(parseInt(json.rank)<parseInt(rankc)?(json.completedrank="",json.rank="# "+json.rank):(json.rank="",json.completedrank="# "+rankc)),2===json.aduelPlayer)super.showScore(json);else{let s=json.sumscore,sumscore=this.labelScore.innerHTML;super.showScore(json),json.sumscore=s,s=void 0===sumscore?"":"<b>"+sumscore+"</b>",this.labelScore.innerHTML!==s&&(this.labelScore.innerHTML=s,this.autoResizeText(this.labelScore,.8*this.iconSize/2,this.iconSize/2,!1,0,0,1))}if(1===json.aduelPlayer||void 0===json.aduelPlayer)this.labelScore2.style.visibility="hidden",this.labelScoreRank2.style.visibility="hidden",this.buttonScore2.style.visibility="hidden",this.labelAddScore2.style.visibility="hidden";else{this.labelScore2.style.visibility="visible",this.labelScoreRank2.style.visibility="visible",this.buttonScore2.style.visibility="visible",this.labelAddScore2.style.visibility="visible";let rank=json.aduelRank,score=json.aduelScore;if(void 0!==json.aduelRank&&void 0!==json.aduelCompletedrank){let rank1=parseInt(json.aduelRank),rank2=parseInt(json.aduelCompletedrank);rank1<=rank2?(rank="#"+rank1,score=json.aduelScore,this.labelScore2.title=this.getStringM("js_grade"),this.labelScoreRank2.title=this.getStringM("js_position_grade")):(rank="#"+rank2,score=Math.round(100*json.aduelCompletedrank)+"%",this.labelScore2.title=this.getStringM("js_percent_opponent"),this.labelScoreRank2.title=this.getStringM("js_position_percent"))}let s="<b>"+score+"</b>";this.labelScore2.innerHTML!==s&&(this.labelScore2.innerHTML=s,this.autoResizeText(this.labelScore2,this.iconSize-2*this.padding,this.iconSize/2,!1,0,0,1)),this.labelScoreRank2.innerHTML=rank,this.labelScoreRank2.style.lineHeight=this.iconSize/3+"px",this.autoResizeText(this.labelScoreRank2,.5*this.iconSize,this.iconSize/3,!0,0,0,1),this.labelAddScore2.innerHTML=void 0===json.aduelAddscore?"":json.aduelAddscore,this.autoResizeText(this.labelAddScore2,this.iconSize,this.iconSize/3,!0,0,0,1)}}onServerFastJson(response){if(""===response)return void this.sendFastJSON();let a=response.split("-"),newstate=a.length>0?parseInt(a[0]):0,newTimeFastJSON=a.length>1?a[1]:0;null===this.timefastjson&&(this.timefastjson=0),newstate===this.state&&newTimeFastJSON===this.timefastjson?this.sendFastJSON():this.callGetAttempt()}sendGetHighScore(){let params={mmogameid:this.mmogameid,kinduser:this.kinduser,user:this.user,count:10},instance=this;require(["core/ajax"],(function(Ajax){Ajax.call([{methodname:"mmogametype_quiz_get_highscore",args:params}])[0].done((function(response){instance.createScreenHighScore(JSON.parse(response))})).fail((function(error){return error}))}))}createScreenHighScore(json){if(void 0!==this.highScore)return this.body.removeChild(this.highScore),this.highScore=void 0,this.strip.style.visibility="visible",void(this.strip.style.zIndex="1");this.removeDivMessage(),this.vertical?this.createScreenVerticalHighScore(json):this.createScreenHorizontalHighScore(json)}createScreenHorizontalHighScore(json){this.createScreenVerticalHighScore(json)}createScreenVerticalHighScore(json){if(0===json.count)return;void 0!==this.strip&&(this.strip.style.visibility="hidden"),this.highScore=this.createDivColor(this.body,"mmogame-quiz-aduel-highscore-background",this.areaLeft,this.areaTop,this.areaWidth-this.padding,this.areaHeight-this.padding,this.getColorHex(this.colorBackground));let canvas=document.createElement("canvas");canvas.style.left="0px",canvas.style.top="0px",canvas.width=this.areaWidth,canvas.height=this.areaHeight,canvas.style.zIndex=8,canvas.style.position="absolute",this.highScore.appendChild(canvas);let ctx=canvas.getContext("2d"),fontSize=this.minFontSize;ctx.font=fontSize+"px sans-serif",this.drawHighScore1(json,ctx,fontSize)}drawHighScore1(json,ctx,fontSize){ctx.textAlign="center";let width1=ctx.measureText(this.getStringT("js_ranking_order")).width,width2=ctx.measureText(this.getStringM("js_grade")).width,col2=0+width1+this.padding,col3=col2+width2+this.padding,row=Math.round(3*fontSize*1.2),results=JSON.parse(json.results);ctx.fillStyle=this.getContrastingColor(this.colorBackground);let y=Math.round(1.2*fontSize);ctx.textAlign="center",ctx.fillText(this.getStringT("js_ranking_order"),0+width1/2,y),ctx.fillText(this.getStringM("js_grade"),col2+width2/2,y),ctx.textAlign="left",ctx.fillText(this.getStringM("js_name"),col3,y),results.forEach((player=>{y+=row/2+this.padding,ctx.textAlign="center",ctx.fillText(player.rank,0+width1/2,y),ctx.fillText(player.score,col2+width2/2,y),ctx.textAlign="left",ctx.fillText(player.name,col3+row-this.padding,y),this.createImage(this.highScore,"mmogame-quiz-aduel-player-avatars",col3,y-row/2,row-this.padding,row-this.padding,"assets/avatars/"+player.avatar),y+=row/2-this.padding}))}showHelpScreen(div){div.innerHTML="\n<div>"+this.getStringT("js_aduel_help")+'</div>\n\n<table border=1>\n    <tr>\n        <td><center>\n            <img height="90" src="../../../../assets/cutred.svg" alt="" />\n        </td>\n        <td>` + this.getStringT(\'js_aduel_cut\') + `</td>\n        <td><center>\n            <img height="90" src="../../../../assets/skip.svg" alt="" />\n        </td>\n        <td>` + this.getStringT(\'js_aduel_skip\') + `</td>\n        <td><center>\n            <img height="90" src="../../../../assets/wizard.svg" alt="" />\n        </td>\n        <td>` + this.getStringT(\'js_aduel_wizard\') + `</td>\n    </tr>\n\n    <tr>\n        <td><center>\n            <img height="90" src="../../assets/aduel/example1.png" alt="" />\n        </td><center>\n\n        <td>'+this.getStringT("js_aduel_example1")+'</td>\n        <td><center>\n            <img height="83" src="../../assets/aduel/example2.png" alt="" />\n        </td>\n\n        <td>` + this.getStringT( \'js_aduel_example2\') + `</td>\n    </tr>\n</table>        \n        '}createDivTimer(left,top,size){const timerDiv=this.createDiv(this.body,"mmogame-timer",left,top,size,size);timerDiv.style.textAlign="center",timerDiv.style.color=this.getContrastingColor(this.colorBackground),timerDiv.innerHTML="23:59",this.autoResizeText(timerDiv,size,size,!1,0,0,1),timerDiv.innerHTML="",timerDiv.title=this.getStringM("js_question_time"),this.labelTimer=timerDiv}}}));

//# sourceMappingURL=mmogametypequizaduel.min.js.map