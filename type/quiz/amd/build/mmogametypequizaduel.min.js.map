{"version":3,"file":"mmogametypequizaduel.min.js","sources":["../src/mmogametypequizaduel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mmogametype_quiz/mmogametypequiz'],\n    function(MmoGameTypeQuiz) {\n        return class MmoGameTypeQuizAduel extends MmoGameTypeQuiz {\n\n    player1; // Stores all info for player1\n    player2; // Stores all info for player2\n    isWaitOpponent; // True if wait someone to answer a set of questions.\n\n    // Timer variables.\n    divTimer;\n    timerTimeout;\n\n    nextLeft; // Left position of next button.\n    nextTop; // Top position of next button.\n\n    timeoutWaitOpponent = 2000;\n\n    // Tools button\n    buttonHighScore;\n    button5050;\n    buttonSkip;\n    buttonWizard;\n\n    constructor() {\n        super();\n\n        // Initialize core properties\n        this.cIcons = this.isVertical ? 5 : 8;\n\n        this.isWaitOpponent = false;\n    }\n\n    createIconBar() {\n        let i = 0;\n        const step = this.iconSize + this.padding;\n\n        const nicknameHeight = Math.round(this.iconSize / 3);\n        const fragment = document.createDocumentFragment(); // Batch DOM updates\n\n        let nickname, avatar;\n        [nickname, avatar] = this.createNicknameAvatar(fragment, 'mmogame-quiz-aduel',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player1 = this.createDivScorePercent(fragment, 'mmogame-quiz-aduel-player1',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), true);\n        this.player1.avatarElement = avatar;\n        this.player1.nicknameElement = nickname;\n        this.player1.cacheAvatar = '';\n        this.player1.cacheNickname = '';\n        this.player1.lblScore.title = this.getStringM('js_grade');\n        this.player1.lblRank.title = this.getStringM('js_position_grade');\n\n        [nickname, avatar] = this.createNicknameAvatar(fragment, 'mmogame-quiz-alone',\n            Math.round(this.padding + (i++) * step),\n            this.padding,\n            2 * this.iconSize + this.padding,\n            nicknameHeight,\n            this.padding + nicknameHeight,\n            this.iconSize);\n\n        this.player2 = this.createDivScorePercent(fragment, 'mmogame-quiz-aduel-player2',\n            this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.getContrastingColor(this.color), false);\n        this.player2.avatarElement = avatar;\n        this.player2.nicknameElement = nickname;\n        this.player2.cacheAvatar = '';\n        this.player2.cacheNickname = '';\n        this.player2.lblScore.title = this.getStringM('js_percent_opponent');\n        this.player2.lblRank.title = this.getStringM('js_position_percent');\n\n        this.createArea(2 * this.padding + this.iconSize + nicknameHeight);\n\n        if (this.isVertical) {\n            this.areaRect.height -= this.iconSize + 2 * this.padding;\n        }\n\n        this.createDivTimer(fragment, this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight,\n            this.iconSize);\n\n        if (this.isVertical) {\n            this.createButtonSound(fragment,\n                this.padding + (i++) * (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height);\n        } else {\n            this.createButtonSound(fragment, this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n        }\n\n        // High score button and Cut tool are in the same position.\n        let leftButton;\n        if (this.isVertical) {\n            leftButton = this.padding + (this.iconSize + this.padding);\n            this.buttonHighScore = this.createImageButton(fragment, 'mmogame-quiz-highscore',\n                leftButton, this.areaRect.top + this.areaRect.height,\n                this.iconSize, this.iconSize, 'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(fragment, 'mmogame-quiz-aduel-5050',\n                leftButton, this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize,\n                'assets/cutred.svg');\n        } else {\n            leftButton = this.padding + (i++) * (this.iconSize + this.padding);\n\n            this.buttonHighScore = this.createImageButton(fragment, 'mmogame-quiz-highscore',\n                leftButton, this.padding + nicknameHeight, this.iconSize, this.iconSize,\n                'assets/highscore.svg');\n\n            this.button5050 = this.createImageButton(fragment, 'mmogame-quiz-aduel-5050',\n                leftButton, this.padding + nicknameHeight, this.iconSize, this.iconSize,\n                'assets/cutred.svg');\n        }\n        this.buttonHighScore.style.visibility = 'hidden';\n        this.buttonHighScore.addEventListener(\"click\", () => {\n            this.sendGetHighScore();\n        });\n        this.button5050.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool1: 1});\n        });\n        this.button5050.title = this.getStringT('js_help_5050');\n\n        leftButton += this.iconSize + this.padding;\n\n        // Skip and wizard tools are in the same position.\n        if (this.isVertical) {\n            this.buttonSkip = this.createImageButton(fragment, 'mmogame-quiz-aduel-skip',\n                leftButton, this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize,\n                'assets/skip.svg');\n        } else {\n            this.buttonSkip = this.createImageButton(fragment, 'mmogame-quiz-aduel-skip',\n                leftButton, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/skip.svg');\n        }\n        this.buttonSkip.addEventListener(\"click\", () => {\n            this.callSetAnswer(\"tool2\");\n        });\n        this.buttonSkip.title = this.getStringT('js_help_skip');\n\n        if (this.isVertical) {\n            this.buttonWizard = this.createImageButton(fragment, 'mmogame-quiz-aduel-wizard',\n                leftButton, this.areaRect.top + this.areaRect.height, this.iconSize, this.iconSize,\n                'assets/wizard.svg');\n        } else {\n            this.buttonWizard = this.createImageButton(fragment, 'mmogame-quiz-aduel-wizard',\n                leftButton, this.padding + nicknameHeight, this.iconSize,\n                this.iconSize, 'assets/wizard.svg');\n        }\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool3: 1});\n        });\n        this.buttonWizard.style.visibility = 'hidden';\n        this.buttonWizard.title = this.getStringT('js_wizard');\n        this.buttonWizard.addEventListener(\"click\", () => {\n            this.callGetAttempt({tool3: 1});\n        });\n\n        if (this.hasHelp()) {\n            if (!this.isVertical) {\n                this.createButtonHelp(fragment,\n                    this.padding + (i++) * (this.iconSize + this.padding), this.padding + nicknameHeight);\n            } else {\n                this.createButtonHelp(fragment,\n                    this.padding + 3 * (this.iconSize + this.padding), this.areaRect.top + this.areaRect.height);\n            }\n        }\n\n        this.body.appendChild(fragment); // Batch insert into DOM\n    }\n\n    updateButtonTool(btn, tool) {\n        btn.style.visibility = tool !== undefined && parseInt(tool) !== 0 ? \"hidden\" : \"visible\";\n    }\n\n    processGetAttempt(json) {\n        if (this.buttonHighScore !== undefined) {\n            this.buttonHighScore.style.visibility = 'hidden';\n        }\n        this.computeDifClock(json.time, json.timestart, json.timeclose);\n        this.timefastjson = json.timefastjson;\n        this.fastjson = json.fastjson;\n\n        if (json.name !== undefined) {\n            window.document.title = json.name;\n        }\n\n        this.correct = undefined;\n        if (json.state === 0) {\n            json.qtype = '';\n            super.processGetAttempt(json);\n            this.showScore(json);\n            this.onServerGetAttemptHideButtons();\n            this.createDivMessageStart(this.getStringM('js_wait_to_start'));\n            return;\n        }\n\n        this.state = parseInt(json.state);\n\n        // Need for a change on colors.\n        if (this.savedColors === undefined || this.savedColors !== json.colors) {\n            this.savedColors = json.colors;\n            this.colors = undefined;\n        }\n\n        // Update the window title if a name is provided\n        if (json.name) {\n            document.title = json.name;\n        }\n\n        if (this.player1 === undefined) {\n            this.setColorsString(json.colors);\n            this.createIconBar();\n        }\n\n        const nicknameWidth = 2 * this.iconSize + this.padding;\n        const nicknameHeight = this.iconSize / 3;\n        this.updateNicknameAvatar(this.player1, json.avatar, json.nickname, nicknameWidth, nicknameHeight);\n        this.updateNicknameAvatar(this.player2, json.aduelAvatar, json.aduelNickname, nicknameWidth, nicknameHeight);\n\n        this.updateButtonTool(this.button5050, json.tool1numattempt);\n        if (json.tool3 !== undefined) {\n            json.tool2numattempt = -1;\n        } else {\n            json.tool3numattempt = -1;\n        }\n        this.updateButtonTool(this.buttonSkip, json.tool2numattempt);\n        this.updateButtonTool(this.buttonWizard, json.tool3numattempt);\n\n        this.attempt = json.attempt;\n        this.aduelPlayer = json.aduelPlayer;\n        this.aduelScore = json.aduelScore;\n        this.aduelRank = json.aduelRank;\n\n        if (json.errorcode !== undefined && json.errorcode === 'aduel_no_rivals' || json.attempt === 0) {\n            if (json.param === undefined) {\n                this.showWaitOpponent();\n            }\n            this.hideTools();\n            this.showScore(json);\n            this.timeout = setTimeout(() => {\n                this.callGetAttempt();\n            }, this.timeoutWaitOpponent);\n            return;\n        }\n\n        this.isWaitOpponent = false;\n\n        this.qtype = json.qtype;\n        if (json.qtype === 'multichoice') {\n            this.answers = [];\n            this.answersID = json.answerids;\n\n            json.answers.forEach((answer, index) => {\n                this.answers[index] = this.repairP(answer);\n            });\n        }\n        this.answer = json.answer !== undefined ? json.answer : null;\n        this.definition = this.repairP(json.definition);\n        if (json.aduelAttempt !== undefined) {\n            this.definition = json.aduelAttempt + \". \" + this.definition;\n        }\n        this.single = json.single;\n        this.autosave = json.autosave !== 0;\n        this.errorcode = json.errorcode;\n\n        // A this.readJsonFiles(json);\n        this.createScreen(json, false);\n        this.updateDivTimer();\n        this.sendFastJSON();\n    }\n\n    onServerGetAttemptHideButtons() {\n        this.button5050.style.visibility = 'hidden';\n        this.buttonSkip.style.visibility = 'hidden';\n        this.player2.avatarElement.style.visibility = 'hidden';\n    }\n\n    onTimeout() {\n        this.divTimer.innerHTML = '';\n        this.disableInput();\n\n        this.answer = '';\n        this.answerid = 0;\n        this.callSetAnswer();\n\n        this.createNextButton();\n    }\n\n    waitOpponent() {\n        if (this.isWaitOpponent) {\n            return;\n        }\n        this.updateNicknameAvatar(this.player2, \"\", \"\");\n        this.createDivMessage('mmomgame-quiz-aduel-wait-opponent',\n            this.getStringT('js_aduel_wait_opponent'));\n        if (this.labelTimer !== undefined) {\n            this.labelTimer.innerHTML = \"\";\n        }\n    }\n\n    hideTools() {\n        this.updateButtonTool(this.button5050, -1);\n        this.updateButtonTool(this.buttonSkip, -1);\n        this.updateButtonTool(this.buttonWizard, -1);\n    }\n\n    processSetAnswer(json) {\n        this.correct = json.correct;\n\n        if (json.correct !== undefined) {\n            if (this.qtype === \"multichoice\") {\n                this.onServerAnswerMultichoice(json);\n            }\n        }\n\n        this.disableInput();\n        this.buttonHighScore.style.visibility = 'visible';\n\n        this.isWaitOpponent = false;\n        if (this.aItemAnswer !== undefined && json.correct !== undefined) {\n            for (let i = 0; i < this.aItemAnswer.length; i++) {\n                this.aItemAnswer[i].classList.add(\"disabled\");\n            }\n        }\n\n        this.showCorrectAnswer(json);\n        this.createNextButton();\n\n        this.showScore(json);\n\n        this.timeclose = 0;\n\n        if (this.aduelPlayer === 1) {\n            if (json.attempt === 0) {\n                this.timeclose = 0;\n                this.waitOpponent();\n            }\n\n            this.showScore(json);\n        }\n\n        if (this.button5050 !== undefined) {\n            this.button5050.style.visibility = 'hidden';\n            this.buttonSkip.style.visibility = 'hidden';\n        }\n    }\n\n   callSetAnswer() {\n        if (this.correct === undefined) {\n            super.callSetAnswer();\n        }\n    }\n\n    onServerAnswerMultichoice(json) {\n        let foundCorrect = false;\n\n        let aduelAnswers = json.aduelPlayer === 2 && json.aduelUseranswer !== null ? json.aduelUseranswer.split(\",\") : '';\n        let aCorrect = json.correct.split(\",\");\n        for (let i = 0; i < this.answersID.length; i++) {\n            if (this.answersID[i] === '') {\n                continue;\n            }\n\n            let label = this.aItemLabel[i];\n\n            let iscorrect1, iscorrect2;\n\n            let iscorrect = aCorrect.includes(this.answersID[i]);\n\n            if (this.aItemAnswer[i].classList.contains(\"checked\")) {\n                iscorrect1 = aCorrect.includes(this.answersID[i]);\n            }\n            if (iscorrect1) {\n                foundCorrect = true;\n            }\n\n            if (aduelAnswers.includes(this.answersID[i])) {\n                iscorrect2 = aCorrect.includes(this.answersID[i]);\n            }\n\n            if (iscorrect === false && iscorrect1 === undefined && iscorrect2 === undefined) {\n                continue;\n            }\n\n            let width = this.labelWidth;\n            let height = this.aItemLabel[i].scrollHeight;\n\n            let move = (iscorrect2 !== undefined ? 2 : 1) * this.radioSize;\n            if (iscorrect1 === undefined && iscorrect2 === undefined) {\n                move = 0;\n            }\n            width -= move;\n\n            if (move !== 0) {\n                label.style.left = (parseInt(label.style.left) + move) + \"px\";\n            }\n            this.aItemLabel[i].style.width = width + \"px\";\n            this.autoResizeText(this.aItemLabel[i], width, height, true, this.minFontSize, this.maxFontSize, 0.5);\n\n            this.onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2);\n        }\n\n        this.playAudio(foundCorrect ? this.audioYes : this.audioNo);\n    }\n\n    onServerAnswerMultichoiceShowCorrect(i, iscorrect1, iscorrect2, iscorrect) {\n        if (iscorrect) {\n            this.aItemLabel[i].innerHTML = '<b><u>' + this.aItemLabel[i].innerHTML + '</b></u>';\n        }\n\n        if (iscorrect1 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-quiz-aduel-correct-answer',\n                this.aItemCorrectX[i], t, this.radioSize, this.radioSize);\n            div.title = iscorrect1 ? this.getStringT('js_correct_answer') : this.getStringT('js_wrong_answer');\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect1, this.colorScore, this.colorScore);\n        }\n\n        if (iscorrect2 !== undefined) {\n            let t = parseInt(this.aItemAnswer[i].style.top);\n            let div = this.createDiv(this.area, 'mmogame-aduel-opponent-correct',\n                this.aItemCorrectX[i] + this.radioSize, t, this.radioSize, this.radioSize);\n            div.innerHTML = this.getSVGcorrect(this.radioSize, iscorrect2, this.colorScore2, this.colorScore2);\n            div.title = iscorrect2 ? this.getStringM('js_correct_answer') : this.getStringM('js_wrong_answer');\n        }\n    }\n\n    showCorrectAnswer({iscorrect2, iscorrect, tool2}) {\n        this.timeclose = 0;\n        this.updateDivTimer();\n\n        this.strip = this.createDiv(this.area, 'mmogame-quiz-aduel-strip',\n            this.stripLeft, this.nextTop, this.stripWidth, this.stripHeight);\n\n        if (tool2 === undefined || this.aduelPlayer === 2) {\n                const btn = this.createImage(this.area, 'mmogame-quiz-aduel-player1',\n                this.stripLeft + this.iconSize / 2, this.nextTop, this.iconSize,\n            this.iconSize, \"assets/avatars/\" + this.player1.cacheAvatar);\n            btn.style.transform = 'translateX(-50%)';\n        }\n\n        if (tool2 === undefined && this.aduelPlayer === 2) {\n            const btn = this.createImage(this.area, 'mmogame-quiz-aduel-player2',\n                this.stripLeft + this.iconSize / 2 + this.iconSize, this.nextTop, this.iconSize,\n                this.iconSize, \"assets/avatars/\" + this.player2.cacheAvatar);\n            btn.style.transform = 'translateX(-50%)';\n        }\n\n        this.strip.style.top = this.nextTop + \"px\";\n        let s = this.getSVGcorrect(this.iconSize, iscorrect !== 0, this.colorScore, this.colorScore);\n        if (tool2 !== undefined && this.aduelPlayer === 1) {\n            s = '';\n        }\n        if (this.aduelPlayer === 2 && tool2 === undefined) {\n            s += this.getSVGcorrect(this.iconSize, iscorrect2 !== 0, this.colorScore2, this.colorScore2);\n        }\n        this.strip.innerHTML = s;\n\n        this.strip.style.zIndex = '1';\n    }\n\n    showScore(json) {\n        super.showScore(this.player1, json.sumscore, json.rank, json.percent, json.percentRank, true);\n        this.player1.lblAddScore.innerHTML = json.addscore === undefined ? '' : json.addscore;\n        this.autoResizeText(this.player1.lblAddScore, this.iconSize, this.player1.heightLine3, true, 0, 0, 1);\n\n        if (json.aduelPlayer === 2) {\n            this.player2.divMain.style.visibility = 'visible';\n            super.showScore(this.player2, json.aduelScore, json.aduelRank, json.aduelPercent, json.aduelPercentRank, true);\n        } else {\n            this.player2.divMain.style.visibility = 'hidden';\n            super.showScore(this.player2, '', '', '', '', false);\n        }\n    }\n\n    onServerFastJson(response) {\n        if (response === '') {\n            this.sendFastJSON();\n            return;\n        }\n\n        let a = response.split('-'); // Are state,timefastjson.\n        let newstate = a.length > 0 ? parseInt(a[0]) : 0;\n        let newTimeFastJSON = a.length > 1 ? a[1] : 0;\n\n        if (this.timefastjson === null) {\n            this.timefastjson = 0;\n        }\n\n        if (newstate !== this.state || newTimeFastJSON !== this.timefastjson) {\n            this.callGetAttempt();\n            return;\n        }\n\n        this.sendFastJSON();\n    }\n\n    sendGetHighScore() {\n        let params = {\n            mmogameid: this.mmogameid,\n            kinduser: this.kinduser,\n            user: this.user,\n            count: 10,\n        };\n\n        require(['core/ajax'], (Ajax) => {\n            // Calling the service through the Moodle AJAX API\n            let getHighScore = Ajax.call([{\n                methodname: 'mmogametype_quiz_get_highscore',\n                args: params\n            }]);\n\n            // Handling the response\n            getHighScore[0].done((response) => {\n                this.createScreenHighScore(JSON.parse(response));\n            }).fail((error) => {\n                return error;\n            });\n        });\n    }\n\n    createScreenHighScore(json) {\n        if (this.highScore !== undefined) {\n            this.body.removeChild(this.highScore);\n            this.highScore = undefined;\n            this.strip.style.visibility = 'visible';\n            this.strip.style.zIndex = '1';\n            return;\n        }\n\n        this.removeDivMessage();\n\n        let child;\n        while ((child = this.area.firstChild)) {\n            this.area.removeChild(child);\n        }\n\n        if (this.vertical) {\n            this.createScreenVerticalHighScore(json);\n        } else {\n            this.createScreenHorizontalHighScore(json);\n        }\n    }\n\n    createScreenHorizontalHighScore(json) {\n        this.createScreenVerticalHighScore(json);\n    }\n\n    createScreenVerticalHighScore(json) {\n        if (json.count === 0) {\n            return;\n        }\n\n        if (this.strip !== undefined) {\n            this.strip.style.visibility = 'hidden';\n        }\n\n        this.highScore = this.createDivColor(this.body, 'mmogame-quiz-aduel-highscore-background',\n            this.areaRect.left, this.areaRect.top,\n            this.areaRect.width - this.padding, this.areaRect.height - this.padding,\n            this.getColorHex(this.colorBackground));\n\n        let canvas = document.createElement('canvas');\n        canvas.style.left = '0px';\n        canvas.style.top = \"0px\";\n        canvas.width = this.areaRect.width;\n        canvas.height = this.areaRect.height;\n        canvas.style.zIndex = 8;\n        canvas.style.position = \"absolute\";\n\n        this.highScore.appendChild(canvas);\n\n        let ctx = canvas.getContext(\"2d\");\n        let fontSize = this.minFontSize;\n        ctx.font = fontSize + \"px sans-serif\";\n\n        this.drawHighScore1(json, ctx, fontSize);\n    }\n\n    drawHighScore1(json, ctx, fontSize) {\n        ctx.textAlign = \"center\";\n        let text1 = ctx.measureText(this.getStringT('js_ranking_order'));\n        let width1 = text1.width;\n        let text = ctx.measureText(this.getStringM('js_grade'));\n        let width2 = text.width;\n\n        let col1 = 0;\n        let col2 = col1 + width1 + this.padding;\n        let col3 = col2 + width2 + this.padding;\n        let row = Math.round(3 * fontSize * 1.2);\n\n        let results = JSON.parse(json.results);\n\n        ctx.fillStyle = this.getContrastingColor(this.colorBackground);\n\n        let y = Math.round(fontSize * 1.2);\n        ctx.textAlign = \"center\";\n        ctx.fillText(this.getStringT('js_ranking_order'), col1 + width1 / 2, y);\n\n        ctx.fillText(this.getStringM('js_grade'), col2 + width2 / 2, y);\n\n        ctx.textAlign = \"left\";\n        ctx.fillText(this.getStringM('js_name'), col3, y);\n\n        results.forEach(player => {\n            y += row / 2 + this.padding;\n\n            ctx.textAlign = \"center\";\n            ctx.fillText(player.rank, col1 + width1 / 2, y);\n\n            ctx.fillText(player.score, col2 + width2 / 2, y);\n\n            ctx.textAlign = \"left\";\n            ctx.fillText(player.name, col3 + row - this.padding, y);\n\n            this.createImage(this.highScore, 'mmogame-quiz-aduel-player-avatars',\n                col3, y - row / 2, row - this.padding, row - this.padding,\n                'assets/avatars/' + player.avatar);\n\n            y += row / 2 - this.padding;\n        });\n    }\n\n    showHelpScreen(div) {\n        div.innerHTML = `\n<div>` + this.getStringT('js_aduel_help') + `</div>\n\n<table class=\"mmogame-table-help\">\n    <tr>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/cutred.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_cut') + \\`</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/skip.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_skip') + \\`</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../../../assets/wizard.svg\" alt=\"\" />\n        </td>\n        <td>\\` + this.getStringT('js_aduel_wizard') + \\`</td>\n    </tr>\n\n    <tr>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"90\" src=\"../../assets/aduel/example1.png\" alt=\"\" />\n        </td>\n\n        <td>` + this.getStringT('js_aduel_example1') + `</td>\n        <td class=\"mmogame-td-help-image\">\n            <img height=\"83\" src=\"../../assets/aduel/example2.png\" alt=\"\" />\n        </td>\n\n        <td>\\` + this.getStringT( 'js_aduel_example2') + \\`</td>\n    </tr>\n</table>        \n        `;\n    }\n\n    /**\n     * Creates a timer display.\n     * @param {any} parent\n     * @param {number} left - Left position in pixels.\n     * @param {number} top - Top position in pixels.\n     * @param {number} size - Timer size.\n     */\n    createDivTimer(parent, left, top, size) {\n        this.divTimer = this.createDOMElement('div', {\n            parent: parent,\n            classnames: 'mmogame-button-sound',\n            styles: {\n                position: 'absolute',\n                left: `${left}px`,\n                top: `${top}px`,\n                width: `${size}px`,\n                height: `${size}px`,\n                textAlign: 'center',\n                color: this.getContrastingColor(this.colorBackground),\n            },\n            attributes: {\n                src: this.getMuteFile(),\n                alt: this.getStringM('js_sound'),\n                role: 'button',\n            },\n        });\n\n        this.divTimer.innerHTML = '23:59';\n        this.autoResizeText(this.divTimer, size, size, false, 0, 0);\n        this.divTimer.innerHTML = '';\n        this.divTimer.title = this.getStringM('js_question_time');\n    }\n\n    updateDivTimer() {\n        // Exit if labelTimer or timeclose are undefined\n        if (!this.divTimer || !this.timeclose) {\n            return;\n        }\n\n        // Calculate the remaining time in seconds\n        const now = Date.now() / 1000; // Get current time in seconds\n        let remainingTime = Math.max(0, this.timeclose - now);\n\n        // If no time is remaining, clear the label and handle timeout\n        if (remainingTime === 0) {\n            this.divTimer.innerHTML = '';\n            this.onTimeout();\n            return;\n        }\n\n        // Format the remaining time as mm:ss\n        const minutes = Math.floor(remainingTime / 60);\n        const seconds = String(Math.floor(remainingTime % 60)).padStart(2, '0');\n        this.divTimer.innerHTML = `${minutes}:${seconds}`;\n\n        // Set a timeout to update the timer every 500ms\n        this.timerTimeout = setTimeout(() => this.updateDivTimer(), 500);\n    }\n    createScreen(json, disabled) {\n        if (this.endofgame) {\n            // Display end-of-game message and final score\n            this.createDivMessage('mmogame-endofgame', this.getStringM('js_game_over'));\n            this.showScore(json);\n            return;\n        }\n\n        let child;\n        while ((child = this.area.firstChild)) {\n            this.area.removeChild(child);\n        }\n\n        // Render the screen layout based on orientation (vertical or horizontal)\n        if (this.vertical) {\n            this.createScreenVertical(json, disabled);\n        } else {\n            this.createScreenHorizontal(json, disabled);\n        }\n\n        // Display the current score\n        this.showScore(json);\n    }\n\n    createScreenHorizontal(json, disabled) {\n        let maxHeight = this.areaRect.height - 2 * this.padding;\n\n        maxHeight -= this.iconSize + this.padding; // Reserve space for submit button\n\n        const width = Math.round((this.areaRect.width - this.padding) / 2);\n        for (let step = 1; step <= 2; step++) {\n            let defSize;\n            this.fontSize = this.findbest(step === 1 ? this.minFontSize : this.minFontSize / 2, this.maxFontSize,\n                (fontSize) => {\n                defSize = this.createDefinition(0, 0, width - this.padding, 0, true, fontSize,\n                    json.definition);\n                if (defSize[0] >= width) {\n                    return 1;\n                }\n                let ansSize = this.createAnswer(0, 0, width - this.padding, true, fontSize, disabled);\n                    if (ansSize[0] >= width) {\n                        return 1;\n                    }\n                    return defSize[1] < maxHeight && ansSize[1] < maxHeight ? -1 : 1;\n            });\n            if (defSize[0] <= width && defSize[1] <= this.areaRect.height) {\n                break;\n            }\n        }\n\n        this.radioSize = Math.round(this.fontSize);\n        const heightAnswer = this.createAnswer(width, 0, width - this.padding, false, this.fontSize, disabled);\n\n        this.createDefinition(0, 0, width - this.padding, heightAnswer, false, this.fontSize, json.definition);\n\n        this.nextTop = heightAnswer + this.padding;\n\n        // Adjust strip dimensions\n        this.stripLeft = width + this.padding;\n        this.stripWidth = 2 * this.iconSize;\n        this.stripHeight = this.iconSize;\n    }\n\n    showWaitOpponent() {\n        if (this.isWaitOpponent) {\n            return;\n        }\n        this.updateNicknameAvatar(this.player2, '', '', 0, 0);\n        this.createDivMessage(this.getStringT('js_aduel_wait_opponent'));\n        if (this.divTimer !== undefined) {\n            this.divTimer.innerHTML = \"\";\n        }\n    }\n\n    createNextButton() {\n        let btn = super.createImageButton(this.area, 'mmogame-quiz-next',\n            this.nextLeft, this.nextTop, 0, this.iconSize, 'assets/next.svg');\n        btn.title = this.getStringM('js_next_question');\n        btn.addEventListener(\"click\", () => {\n            this.callGetAttempt();\n            this.area.removeChild(btn);\n        });\n    }\n\n        };\n});"],"names":["define","MmoGameTypeQuiz","player1","player2","isWaitOpponent","divTimer","timerTimeout","nextLeft","nextTop","timeoutWaitOpponent","buttonHighScore","button5050","buttonSkip","buttonWizard","constructor","super","this","cIcons","isVertical","createIconBar","i","step","iconSize","padding","nicknameHeight","Math","round","fragment","document","createDocumentFragment","nickname","avatar","leftButton","createNicknameAvatar","createDivScorePercent","getContrastingColor","color","avatarElement","nicknameElement","cacheAvatar","cacheNickname","lblScore","title","getStringM","lblRank","createArea","areaRect","height","createDivTimer","createButtonSound","top","createImageButton","style","visibility","addEventListener","sendGetHighScore","callGetAttempt","tool1","getStringT","callSetAnswer","tool3","hasHelp","createButtonHelp","body","appendChild","updateButtonTool","btn","tool","undefined","parseInt","processGetAttempt","json","computeDifClock","time","timestart","timeclose","timefastjson","fastjson","name","window","correct","state","qtype","showScore","onServerGetAttemptHideButtons","createDivMessageStart","savedColors","colors","setColorsString","nicknameWidth","updateNicknameAvatar","aduelAvatar","aduelNickname","tool1numattempt","tool2numattempt","tool3numattempt","attempt","aduelPlayer","aduelScore","aduelRank","errorcode","param","showWaitOpponent","hideTools","timeout","setTimeout","answers","answersID","answerids","forEach","answer","index","repairP","definition","aduelAttempt","single","autosave","createScreen","updateDivTimer","sendFastJSON","onTimeout","innerHTML","disableInput","answerid","createNextButton","waitOpponent","createDivMessage","labelTimer","processSetAnswer","onServerAnswerMultichoice","aItemAnswer","length","classList","add","showCorrectAnswer","foundCorrect","aduelAnswers","aduelUseranswer","split","aCorrect","iscorrect1","iscorrect2","label","aItemLabel","iscorrect","includes","contains","width","labelWidth","scrollHeight","move","radioSize","left","autoResizeText","minFontSize","maxFontSize","onServerAnswerMultichoiceShowCorrect","playAudio","audioYes","audioNo","t","div","createDiv","area","aItemCorrectX","getSVGcorrect","colorScore","colorScore2","_ref","tool2","strip","stripLeft","stripWidth","stripHeight","createImage","transform","s","zIndex","sumscore","rank","percent","percentRank","lblAddScore","addscore","heightLine3","divMain","aduelPercent","aduelPercentRank","onServerFastJson","response","a","newstate","newTimeFastJSON","params","mmogameid","kinduser","user","count","require","Ajax","call","methodname","args","done","createScreenHighScore","JSON","parse","fail","error","highScore","removeChild","child","removeDivMessage","firstChild","vertical","createScreenVerticalHighScore","createScreenHorizontalHighScore","createDivColor","getColorHex","colorBackground","canvas","createElement","position","ctx","getContext","fontSize","font","drawHighScore1","textAlign","width1","measureText","width2","col2","col3","row","results","fillStyle","y","fillText","player","score","showHelpScreen","parent","size","createDOMElement","classnames","styles","attributes","src","getMuteFile","alt","role","now","Date","remainingTime","max","minutes","floor","seconds","String","padStart","disabled","endofgame","createScreenVertical","createScreenHorizontal","maxHeight","defSize","findbest","createDefinition","ansSize","createAnswer","heightAnswer"],"mappings":"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"}