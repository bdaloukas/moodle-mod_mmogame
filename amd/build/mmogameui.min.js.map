{"version":3,"file":"mmogameui.min.js","sources":["../src/mmogameui.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\ndefine(['mod_mmogame/mmogame'], function(MmoGame) {\n    return class MmoGameUI extends MmoGame {\n\n        isVertical;\n        kindSound; // Type: Number (0 = on, 1 = off, 2 = speak)\n        buttonSound;\n        colorBackground2;\n\n        // Other\n        nickname;\n        user;\n        paletteid;\n        avatarid;\n        iconSize;\n        padding;\n\n        // Area\n        area;\n        areaRect;\n\n        // Form fields\n        edtNickname;\n\n        // Gate variables\n        mmogameid;\n\n        constructor() {\n            super();\n            this.isVertical = window.innerWidth < window.innerHeight;\n            this.area = undefined;\n        }\n\n        /**\n         * Returns the appropriate file for mute/unmute.\n         * @returns {string} The file path.\n         */\n        getMuteFile() {\n            return this.kindSound === 0 ? 'assets/sound-on-flat.png' : 'assets/sound-off-flat.png';\n        }\n\n        /**\n         * Plays a sound file if sound is enabled.\n         *\n         * @param {HTMLAudioElement} audioElement - The audio element to play.\n         */\n        async playAudio(audioElement) {\n            if (this.kindSound !== 0 && audioElement) {\n                try {\n                    await audioElement.play();\n                } catch (error) {\n                    this.showError(\"Playback failed:\", error);\n                }\n            }\n        }\n\n        createButtonSound(parent, left, top) {\n            this.buttonSound = this.createDOMElement('img', {\n                parent: parent,\n                classnames: 'mmogame-button-sound',\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${top}px`,\n                    width: `${this.iconSize}px`,\n                    height: `${this.iconSize}px`,\n                },\n                attributes: {\n                    src: this.getMuteFile(),\n                    alt: this.getStringM('js_sound'),\n                    role: 'button',\n                },\n            });\n            this.buttonSound.addEventListener(\"click\", () => this.onClickSound(this.buttonSound));\n        }\n\n        /**\n         * Toggles sound on or off when clicked.\n         * @param {HTMLElement} button - The sound toggle button.\n         */\n        onClickSound(button) {\n            this.kindSound = (this.kindSound + 1) % 2;\n            button.src = this.getMuteFile();\n            this.setOptions({kindSound: this.kindSound});\n        }\n\n        /**\n         * Opens the gate UI, computes sizes, and initializes settings based on the user type.\n         * @param {number} mmogameid - The game ID.\n         * @param {string} pin - The game PIN.\n         * @param {string} kinduser - The type of user (e.g., \"moodle\" or \"guid\").\n         * @param {string} user - The user identifier.\n         * @param {string} url - The game URL.\n         */\n        async gateOpen(mmogameid, pin, kinduser, user, url) {\n            this.url = url;\n            this.mmogameid = mmogameid;\n            this.pin = pin;\n            this.kinduser = kinduser;\n            this.user = user;\n\n            const option = await this.getOption('gate' + mmogameid);\n\n            const isReady = option !== null && option.nickname && option.avatarid && option.paletteid;\n\n            if (kinduser === 'moodle' && isReady) {\n                await this.gatePlayGame(false, option.nickname, option.paletteid, option.avatarid);\n            } else if (this.kinduser === 'guid') {\n                // Create a GUID if it needed.\n                if (!isReady) {\n                    this.user = crypto.randomUUID();\n                }\n                if (isReady) {\n                    await this.gatePlayGame(false, option.nickname, option.paletteid, option.avatarid);\n                } else {\n                    this.gateCreateScreen();\n                }\n            } else {\n                this.gateCreateScreen();\n            }\n        }\n\n        async gatePlayGame(save, nickname, paletteid, avatarid) {\n            const option = await this.getOption('kindsound');\n            this.kindSound = option !== null && [1, 2].includes(option.kindSound) ? option.kindSound : 0;\n\n            if (save) {\n                let data = {nickname, avatarid, paletteid};\n                if (this.kinduser === 'GUID') {\n                    data.user = this.user;\n                }\n                this.setOption('gate' + this.mmogameid, data);\n            }\n            this.nickname = nickname;\n            this.paletteid = paletteid;\n            this.avatarid = avatarid;\n            if (save) {\n                this.callGetAttempt({nickname, colorpaletteid: paletteid, avatarid});\n            } else {\n                this.callGetAttempt();\n            }\n        }\n\n        gateCreateScreen() {\n            this.gateCompute();\n\n            let maxHeight = this.areaRect.height - 5 * this.padding - this.iconSize;\n            let maxWidth = this.areaRect.width;\n            let size;\n            const labels = [\n                `${this.getStringM('js_name')}: `,\n                this.getStringM('js_code'),\n                this.getStringM('js_palette')\n            ];\n\n            this.fontSize = this.findbest(this.minFontSize, this.maxFontSize, (fontSize) => {\n                size = this.gateComputeLabelSize(fontSize, labels);\n\n                if (size[0] >= maxWidth) {\n                    return 1;\n                }\n\n                const heightColors = (maxHeight - 4 * fontSize) * 2 / 5;\n                let n = Math.floor(heightColors / this.iconSize);\n                if (n === 0) {\n                    return 1;\n                }\n                const heightAvatars = (maxHeight - 4 * fontSize + heightColors) * 3 / 5;\n                const computedHeight = 3 * size[1] + 8 * this.padding + heightColors + heightAvatars;\n\n                return computedHeight < maxHeight ? -1 : 1;\n            });\n\n            this.gateCreateScreenDo(maxWidth, maxHeight);\n        }\n\n        gateCreateScreenDo(maxWidth, maxHeight) {\n            // Creates the \"nickname\" field.\n            let top = this.gateCreateNickname(0, maxWidth) + this.padding;\n            this.edtNickname.focus();\n\n            // Palette\n            const [lblPalette, btnPalette] = this.gateCreateLabelRefresh(top, this.getStringM('js_palette'),\n                'mmogame-gate-palette-label', 'mmogame-gate-palette-refresh', 'assets/refresh.svg');\n            top += lblPalette.scrollHeight + this.padding;\n            const topGridPalette = top;\n            let gridHeightPalette = (maxHeight - topGridPalette - lblPalette.scrollHeight) * 2 / 5;\n            const countX = Math.floor((maxWidth - this.padding) / this.iconSize);\n            const countYpalette = Math.floor(gridHeightPalette / this.iconSize);\n            gridHeightPalette = countYpalette * this.iconSize;\n            top += gridHeightPalette + this.padding;\n            // Label Avatars\n            const [lblAvatars, btnAvatars] = this.gateCreateLabelRefresh(top, this.getStringM('js_avatars'),\n                'mmogame-gate-avatars-label', 'mmogame-gate-avatars-refresh', 'assets/refresh.svg');\n\n            top += lblAvatars.scrollHeight + this.padding;\n\n            const countYavatars = Math.floor(Math.floor(maxHeight - top - this.padding) / this.iconSize);\n            const gridHeightAvatars = countYavatars * this.iconSize;\n\n            this.addEventListenerRefresh(btnPalette, topGridPalette, countX, countYpalette,\n                top, countX, countYavatars, true, false);\n\n            this.addEventListenerRefresh(btnAvatars, topGridPalette, countX, countYpalette,\n                top, countX, countYavatars, false, true);\n\n            // Horizontal\n            this.gateSendGetColorsAvatars(0, topGridPalette, countX, countYpalette,\n                0, top, countX, countYavatars, true, true);\n\n            this.gateCreateSubmit(top + gridHeightAvatars + 2 * this.padding, maxWidth);\n        }\n\n        gateCreateNickname(top, maxWidth) {\n            const lblNickname = this.createDOMElement('label', {\n                parent: this.area,\n                classnames: 'mmogame-gate-name-label',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: '0',\n                    top: `${top}px`,\n                    width: '0',\n                    color: this.getContrastingColor(this.colorBackground),\n                },\n            });\n            lblNickname.innerHTML = this.getStringM('js_name') + \": \";\n\n            if (this.isVertical) {\n                top += lblNickname.scrollHeight + this.padding;\n            }\n\n            const leftEdit = this.isVertical ? 0 : lblNickname.scrollWidth + this.padding;\n            const width = this.isVertical ? maxWidth : maxWidth - 2 * this.padding;\n            this.edtNickname = this.createDOMElement('input', {\n                parent: this.area,\n                classnames: 'mmogame-gate-name',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${leftEdit}px`,\n                    top: `${top}px`,\n                    width: `${width - leftEdit - this.padding}px`\n                },\n            });\n            this.edtNickname.addEventListener(\"keyup\", this.debounce(() => this.gateUpdateSubmit(), 300));\n            top += this.padding + (this.isVertical ? this.fontSize : Math.max(lblNickname.scrollHeight, this.fontSize));\n\n            return top;\n        }\n\n        gateCreateSubmit(top, maxWidth) {\n           this.btnSubmit = this.createDOMElement('img', {\n                parent: this.area,\n                classnames: 'mmogame-button-gate-submit',\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${(maxWidth - this.iconSize) / 2}px`,\n                    top: `${top}px`,\n                    height: `${this.iconSize}px`,\n                    color: this.getContrastingColor(this.colorBackground),\n                    cursor: 'pointer',\n                    visibility: 'hidden',\n                },\n                attributes: {\n                    src: 'assets/submit.svg',\n                }\n            });\n            this.btnSubmit.addEventListener(\"click\", () => {\n                this.gatePlayGame(true, this.edtNickname.value, this.paletteid, this.avatarid);\n            });\n        }\n\n        gateComputeLabelSize(fontSize, aLabel) {\n            const instance = this;\n            let maxWidth = 0;\n            let maxHeight = 0;\n\n            for (let i = 0; i < aLabel.length; i++) {\n                const label = document.createElement(\"label\");\n                label.style.position = \"absolute\";\n                label.innerHTML = aLabel[i];\n                label.style.whiteSpace = \"nowrap\";\n                label.style.font = \"FontAwesome\";\n                label.style.fontSize = fontSize + \"px\";\n                label.style.width = \"0px\";\n                label.style.height = \"0px\";\n                instance.area.appendChild(label);\n\n                if (label.scrollWidth > maxWidth) {\n                    maxWidth = label.scrollWidth;\n                }\n\n                if (label.scrollHeight > maxHeight) {\n                    maxHeight = label.scrollHeight;\n                }\n                instance.area.removeChild(label);\n            }\n\n            return [maxWidth, maxHeight];\n        }\n\n        gateShowAvatars(left, top, countX, countY, avatarids, avatars) {\n            const instance = this;\n            if (!avatars || avatars.length === 0) {\n                return; // Exit early if no avatars exist\n            }\n\n            // Delete all previous avatar icons.\n            const elements = document.querySelectorAll('.mmogame-avatar');\n            elements.forEach(element => element.remove());\n\n            const fragment = document.createDocumentFragment();\n\n            instance.avatar = undefined;\n            const count = avatars.length;\n            let leftOriginal = left;\n            let w = Math.round(this.padding / 2) + \"px\";\n            for (let i = 0; i < count; i++) {\n                let avatarImagePath = 'assets/avatars/' + avatars[i];\n                let btn = instance.createCenterImageButton(\n                    fragment,\n                    left, top,\n                    instance.iconSize - instance.padding, instance.iconSize - instance.padding,\n                    'mmogame-avatar',\n                    avatarImagePath\n                );\n                btn.classList.add(\"mmogame-avatar\");\n                let id = avatarids[i];\n                btn.addEventListener(\"click\", () => {\n                    instance.gateUpdateAvatar(btn, id, w);\n                });\n\n                // Move left position after placing the button\n                left += instance.iconSize;\n\n                // Reset left and move to the next row after filling countX buttons\n                if ((i + 1) % countX === 0) {\n                    top += instance.iconSize;\n                    left = leftOriginal;\n                }\n            }\n            instance.area.appendChild(fragment);\n        }\n\n        gateSendGetColorsAvatars(leftPalette, topPalette, countXpalette, countYpalette,\n                                 leftAvatars, topAvatars, countXavatars, countYavatars,\n                                 updatePalette = true, updateAvatars = true) {\n            const instance = this;\n\n            require(['core/ajax'], (Ajax) => {\n                // Defining the parameters to be passed to the service\n                let params = {\n                    mmogameid: instance.mmogameid,\n                    kinduser: instance.kinduser,\n                    user: instance.user,\n                    avatars: updateAvatars ? countXavatars * countYavatars : 0,\n                    colorpalettes: updatePalette ? countXpalette * countYpalette : 0,\n                };\n                // Calling the service through the Moodle AJAX API\n                let getAssets = Ajax.call([{\n                    methodname: 'mod_mmogame_get_assets',\n                    args: params\n                }]);\n\n                // Handling the response\n                getAssets[0].done(({avatarids, avatars, colorpaletteids, colorpalettes}) => {\n                    if (updatePalette) {\n                        instance.gateShowColorPalettes(leftPalette, topPalette, countXpalette, countYpalette,\n                            colorpaletteids, colorpalettes);\n                    }\n                    if (updateAvatars) {\n                        instance.gateShowAvatars(leftAvatars, topAvatars, countXavatars, countYavatars,\n                            avatarids, avatars);\n                    }\n                }).fail((error) => {\n                    return error;\n                });\n            });\n        }\n\n        gateShowColorPalettes(left, top, countX, countY, colorpaletteids, colorpalettes) {\n            const instance = this;\n            let i = 0; // Counter for color palettes\n            const count = colorpalettes.length;\n            this.canvasColor = undefined;\n            const canvasSize = instance.iconSize - instance.padding * 3 / 2;\n            const parsedPalettes = colorpalettes.map(palette =>\n                palette.split(\",\").map(value => parseInt(value, 10) || 0)\n            );\n            const fragment = document.createDocumentFragment();\n            for (let iy = 0; iy < countY; iy++) {\n                for (let ix = 0; ix < countX; ix++) {\n                    // Check if we exceed available palettes or encounter invalid data\n                    if (i >= count || !parsedPalettes[i] || !colorpaletteids[i]) {\n                        i++; // Increment and continue if invalid\n                        continue;\n                    }\n\n                    // Create a new canvas element\n                    let canvas = document.createElement('canvas');\n                    canvas.style.position = \"absolute\";\n                    canvas.style.left = `${left + ix * instance.iconSize}px`;\n                    canvas.style.top = `${top + iy * instance.iconSize}px`;\n                    canvas.width = canvasSize;\n                    canvas.height = canvasSize;\n                    canvas.style.cursor = 'pointer';\n                    canvas.classList.add(\"mmogame_color\");\n\n                    // Append canvas to the area\n                    fragment.appendChild(canvas);\n\n                    // Render the color palette on the canvas\n                    instance.showColorPalette(canvas, parsedPalettes[i]);\n\n                    // Get the palette ID and attach a click event listener\n                    let id = colorpaletteids[i];\n                    canvas.addEventListener(\"click\", () => {\n                        instance.gateUpdateColorPalette(canvas, id);\n                    });\n\n                    i++;\n                }\n            }\n            instance.area.appendChild(fragment);\n        }\n\n        gateUpdateColorPalette(canvas, id) {\n            if (this.canvasColor !== undefined) {\n                this.canvasColor.style.borderStyle = \"none\";\n            }\n            this.canvasColor = canvas;\n            let w = Math.round(this.padding / 2) + \"px\";\n\n            Object.assign(canvas.style, {\n                borderStyle: \"outset\",\n                borderLeftWidth: w,\n                borderTopWidth: w,\n                borderRightWidth: w,\n                borderBottomWidth: w,\n            });\n            this.paletteid = id;\n\n            this.gateUpdateSubmit();\n        }\n\n        gateUpdateAvatar(avatar, id, w) {\n            const instance = this;\n\n            if (instance.avatar !== undefined) {\n                instance.avatar.style.borderStyle = \"none\";\n            }\n            instance.avatar = avatar;\n            avatar.style.borderStyle = \"outset\";\n\n            avatar.style.borderLeftWidth = w;\n            avatar.style.borderTopWidth = w;\n            avatar.style.borderRightWidth = w;\n            avatar.style.borderBottomWidth = w;\n\n            instance.avatarid = id;\n\n            instance.gateUpdateSubmit();\n        }\n\n        /**\n         * Updates the visibility of the submit button based on form input validation.\n         */\n        gateUpdateSubmit() {\n            const hasAvatar = this.avatarid !== undefined;\n            const hasPalette = this.paletteid !== undefined;\n            const hasNickname = this.edtNickname?.value?.length > 0;\n\n            this.btnSubmit.style.visibility = hasAvatar && hasPalette && hasNickname ? 'visible' : 'hidden';\n        }\n\n        gateComputeSizes() {\n            const instance = this;\n\n            instance.computeSizes();\n            instance.iconSize = Math.round(0.8 * instance.iconSize);\n            instance.padding = Math.round(0.8 * instance.padding);\n        }\n\n        /**\n         * Creates the screen palette UI with a label and a refresh button.\n         * @param {number} top - The vertical position for the elements.\n         * @param {string} title\n         * @param {string} classLabel\n         * @param {string} classButton\n         * @param {string} src\n         */\n        gateCreateLabelRefresh(top, title, classLabel, classButton, src) {\n            // Create and configure the label\n            const label = this.createDOMElement('label', {\n                parent: this.area,\n                classnames: classLabel,\n                styles: {\n                    position: 'absolute',\n                    font: 'FontAwesome',\n                    fontSize: `${this.fontSize}px`,\n                    width: '0px',\n                    whiteSpace: 'nowrap',\n                    color: this.getContrastingColor(this.colorBackground),\n                    top: `${top}px`,\n                    left: '0px',\n                },\n            });\n            label.innerHTML = title;\n\n            // Button refresh color palettes\n            let button = this.createDOMElement('img', {\n                parent: this.area,\n                classnames: classButton,\n                styles: {\n                    position: 'absolute',\n                    fontSize: `${this.fontSize}px`,\n                    left: `${label.scrollWidth + this.padding}px`,\n                    top: `${top}px`,\n                    height: `${label.scrollHeight}px`,\n                    color: this.getContrastingColor(this.colorBackground),\n                    cursor: 'pointer',\n                },\n                attributes: {\n                    src: src,\n                }\n            });\n\n            return [label, button];\n        }\n\n        /**\n         * Adds an event listener to refresh colors and avatars.\n         *\n         * @param {HTMLElement} btn - The button to attach the event listener to.\n         * @param {number} topPalette - The Y-coordinate offset for grid positioning.\n         * @param {number} countXpalette - Width of the color grid.\n         * @param {number} countYpalette - Height of the color grid.\n         * @param {number} topAvatars - The Y-coordinate offset for grid positioning.\n         * @param {number} countXavatars - Width of the avatar grid.\n         * @param {number} countYavatars - Height of the avatar grid.\n         * @param {boolean} updateColors - Callback to update colors.\n         * @param {boolean} updateAvatars - Callback to update avatars.\n         */\n        addEventListenerRefresh(btn, topPalette, countXpalette, countYpalette, topAvatars,\n                                countXavatars, countYavatars, updateColors, updateAvatars) {\n            btn.addEventListener(\"click\", () => {\n                const elements = Array.from(this.area.getElementsByClassName(\"mmogame-color\"));\n                elements.forEach(element => element.remove());\n\n                this.gateSendGetColorsAvatars(0, topPalette, countXpalette, countYpalette,\n                    0, topAvatars, countXavatars, countYavatars,\n                    updateColors, updateAvatars);\n            });\n        }\n\n        /**\n         * Creates the main game area.\n         */\n\n        createArea(top, bottomSpace) {\n            if (this.area !== undefined) {\n                this.body.removeChild(this.area);\n            }\n            this.area = this.createDOMElement('div', {\n                parent: this.body,\n                classnames: 'mmogame-area',\n                styles: {\n                    position: 'absolute',\n                    left: `${this.padding}px`,\n                    top: `${top}px`,\n                    right: `${this.padding}px`,\n                    bottom: `${this.padding + bottomSpace}px`,\n                    overflow: 'hidden',\n                }\n            });\n\n            this.areaRect = {\n                left: this.padding,\n                top: top,\n                width: this.area.offsetWidth,\n                height: this.area.offsetHeight,\n            };\n        }\n\n        createDivMessage(classnames, message) {\n            const instance = this;\n\n            if (instance.area !== undefined) {\n                instance.body.removeChild(instance.area);\n                instance.area = undefined;\n            }\n\n            if (instance.divMessageHelp !== undefined) {\n                instance.body.removeChild(instance.divMessageHelp);\n                instance.divMessageHelp = undefined;\n            }\n\n            let left = instance.padding;\n            let top = instance.areaRect !== undefined ? instance.areaRect.top : 0;\n            let width = window.innerWidth - 2 * instance.padding;\n            let height = window.innerHeight - instance.padding - top;\n\n            instance.createDivMessageDo(classnames, left, top, width, height, message, height);\n\n            instance.divMessage.style.top = (height - instance.divMessage.scrollHeight) / 2 + \"px\";\n        }\n\n        createNicknameAvatar(parent, prefixclassname, left, topNickname, widthNickname, heightNickname, topAvatar, widthAvatar) {\n            const nickname = this.createDOMElement('div', {\n                parent: parent,\n                classname: `${prefixclassname}-nickname`,\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${topNickname}px`,\n                    width: `${widthNickname}px`,\n                }\n            });\n\n            let leftAvatar = Math.round(left + this.iconSize / 2);\n            const avatar = this.createDOMElement('img', {\n                classname: `${prefixclassname}-avatar`,\n                parent: this.body,\n                styles: {\n                    position: 'absolute',\n                    left: `${leftAvatar}px`,\n                    top: `${topAvatar}px`,\n                    height: `${widthAvatar}px`,\n                    maxWidth: `${widthAvatar}px`,\n                    transform: 'translateX(-50%)',\n                }\n            });\n\n            return [nickname, avatar];\n        }\n\n\n        createDivMessageStart(message) {\n            const instance = this;\n\n            if (instance.area !== undefined) {\n                instance.body.removeChild(instance.area);\n                instance.area = undefined;\n            }\n\n            let left = instance.padding;\n            let top = instance.areaRect.top;\n            let width = window.innerWidth - 2 * instance.padding;\n            let height = window.innerHeight - instance.padding - top;\n\n            let height1 = height / 8;\n\n            instance.createDivMessageDo('mmogame-message-start', left, top, width, height, message, height1);\n\n            top += (height1 - instance.divMessage.scrollHeight) / 2;\n            instance.divMessage.style.top = top + \"px\";\n\n            if (instance.divMessageHelp === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"left\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.color = instance.getContrastingColor(this.colorBackground2);\n                let top = instance.iconSize + 3 * instance.padding + height1;\n                div.style.top = (top + instance.padding) + \"px\";\n                div.style.height = (height - height1) + \"px\";\n                instance.divMessageHelp = div;\n                instance.body.appendChild(instance.divMessageHelp);\n\n                instance.showHelpScreen(div, (width - 2 * instance.padding), (height - height1));\n            }\n        }\n\n        /**\n         * Calls the Moodle Web Service 'mmogametype_quiz_get_attempt' and processes the response.\n         *\n         * @param {Object} extraparams - Additional parameters to override default ones.\n         */\n        callGetAttempt(extraparams = undefined) {\n            require(['core/ajax'], (Ajax) => {\n                let params = {\n                    mmogameid: this.mmogameid,\n                    kinduser: this.kinduser,\n                    user: this.user,\n                    nickname: null,\n                    colorpaletteid: null,\n                    avatarid: null,\n                };\n                if (extraparams !== undefined) {\n                    params = {...params, ...extraparams};\n                }\n                // Calling the service through the Moodle AJAX API\n                let getAttempt = Ajax.call([{\n                    methodname: 'mmogametype_quiz_get_attempt',\n                    args: params,\n                }]);\n\n                // Handling the response\n                getAttempt[0].done((response) => {\n                    if (this.iconSize === undefined) {\n                        this.openGame();\n                    }\n                    this.processGetAttempt(JSON.parse(response));\n                }).fail((error) => {\n                    this.createDivMessage('mmogame-error', error.message);\n                    return error;\n                });\n            });\n        }\n\n        createDivMessageDo(classnames, left, top, width, height, message, heightmessage) {\n            if (this.divMessageBackground === undefined) {\n                let div = this.createDiv(this.body, classnames, left, top, width, height);\n                div.style.background = this.getColorHex(this.colorBackground2);\n                this.divMessageBackground = div;\n            }\n\n            if (this.divMessage === undefined) {\n                let div = document.createElement(\"div\");\n                div.style.position = \"absolute\";\n                div.style.left = left + \"px\";\n                div.style.textAlign = \"center\";\n                div.style.width = (width - 2 * this.padding) + \"px\";\n                div.style.paddingLeft = this.padding + \"px\";\n                div.style.paddingRight = this.padding + \"px\";\n\n                div.style.background = this.getColorHex(this.colorBackground2);\n                div.style.color = this.getContrastingColor(this.colorBackground2);\n                this.divMessage = div;\n            }\n            this.divMessage.innerHTML = message;\n            this.body.appendChild(this.divMessage);\n            this.autoResizeText(this.divMessage, width, heightmessage, false, this.minFontSize, this.maxFontSize, 0.5);\n        }\n\n        setColors(colors) {\n            super.setColors(colors);\n\n            this.colorBackground2 = colors[1];\n        }\n\n        /**\n         * Displays an error message on the screen.\n         * @param {string} name - The name of the error context.\n         * @param {Error} [error] - The error object to display.\n         */\n        showError(name, error) {\n            const message = error?.message || 'An unknown error occurred.';\n            this.createDivMessage('mmogame-error', message);\n        }\n\n        createButtonHelp(parent, left, top) {\n            return this.createDOMElement('img', {\n                parent: parent,\n                classnames: 'mmogame-button-help',\n                styles: {\n                    position: 'absolute',\n                    left: `${left}px`,\n                    top: `${top}px`,\n                    width: `${this.iconSize}px`,\n                    height: `${this.iconSize}px`,\n                },\n                attributes: {\n                    src: 'assets/help.svg',\n                    alt: this.getStringM('js_help'),\n                    role: 'button',\n                },\n            });\n        }\n\n        onClickHelp() {\n            this.createDivMessageStart('test');\n        }\n\n        gateCompute() {\n            // Adjust font sizes\n            this.minFontSize *= 2;\n            this.maxFontSize *= 2;\n\n            // Compute sizes and layout\n            this.gateComputeSizes();\n            this.createArea(this.padding, 0);\n        }\n    };\n});"],"names":["define","MmoGame","isVertical","kindSound","buttonSound","colorBackground2","nickname","user","paletteid","avatarid","iconSize","padding","area","areaRect","edtNickname","mmogameid","constructor","super","this","window","innerWidth","innerHeight","undefined","getMuteFile","playAudio","audioElement","play","error","showError","createButtonSound","parent","left","top","createDOMElement","classnames","styles","position","width","height","attributes","src","alt","getStringM","role","addEventListener","onClickSound","button","setOptions","gateOpen","pin","kinduser","url","option","getOption","isReady","gatePlayGame","crypto","randomUUID","gateCreateScreen","save","includes","data","setOption","callGetAttempt","colorpaletteid","gateCompute","size","maxHeight","maxWidth","labels","fontSize","findbest","minFontSize","maxFontSize","gateComputeLabelSize","heightColors","Math","floor","heightAvatars","gateCreateScreenDo","gateCreateNickname","focus","lblPalette","btnPalette","gateCreateLabelRefresh","scrollHeight","topGridPalette","gridHeightPalette","countX","countYpalette","lblAvatars","btnAvatars","countYavatars","gridHeightAvatars","addEventListenerRefresh","gateSendGetColorsAvatars","gateCreateSubmit","lblNickname","color","getContrastingColor","colorBackground","innerHTML","leftEdit","scrollWidth","debounce","gateUpdateSubmit","max","btnSubmit","cursor","visibility","value","aLabel","instance","i","length","label","document","createElement","style","whiteSpace","font","appendChild","removeChild","gateShowAvatars","countY","avatarids","avatars","querySelectorAll","forEach","element","remove","fragment","createDocumentFragment","avatar","count","leftOriginal","w","round","avatarImagePath","btn","createCenterImageButton","classList","add","id","gateUpdateAvatar","leftPalette","topPalette","countXpalette","leftAvatars","topAvatars","countXavatars","updatePalette","arguments","updateAvatars","require","Ajax","params","colorpalettes","call","methodname","args","done","_ref","colorpaletteids","gateShowColorPalettes","fail","canvasColor","canvasSize","parsedPalettes","map","palette","split","parseInt","iy","ix","canvas","showColorPalette","gateUpdateColorPalette","borderStyle","Object","assign","borderLeftWidth","borderTopWidth","borderRightWidth","borderBottomWidth","hasAvatar","hasPalette","hasNickname","gateComputeSizes","computeSizes","title","classLabel","classButton","updateColors","Array","from","getElementsByClassName","createArea","bottomSpace","body","right","bottom","overflow","offsetWidth","offsetHeight","createDivMessage","message","divMessageHelp","createDivMessageDo","divMessage","createNicknameAvatar","prefixclassname","topNickname","widthNickname","heightNickname","topAvatar","widthAvatar","classname","leftAvatar","transform","createDivMessageStart","height1","div","textAlign","paddingLeft","paddingRight","showHelpScreen","extraparams","response","openGame","processGetAttempt","JSON","parse","heightmessage","divMessageBackground","createDiv","background","getColorHex","autoResizeText","setColors","colors","name","createButtonHelp","onClickHelp"],"mappings":"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"}